<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.246">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Deep Learning for TS</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title"><a href="https://samikshathikekar.georgetown.domains/time-series-project-website/_site/intro.html">DSAN-5600 PROJECT</a></span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://samikshathikekar.georgetown.domains/time-series-project-layout/_site/">
 <span class="menu-text">Author</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://samikshathikekar.georgetown.domains/time-series-project-layout/_site/ts.html">
 <span class="menu-text">Time Series Overview</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./intro.qmd">
 <span class="menu-text">Time Series Project</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Deep Learning for TS</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Introduction</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./datasrc.html" class="sidebar-item-text sidebar-link">Data Sources</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dataviz.html" class="sidebar-item-text sidebar-link">Data Visualization</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./eda.html" class="sidebar-item-text sidebar-link">Exploratory Data Analysis</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./univariate.html" class="sidebar-item-text sidebar-link">Univariate TS Models (ARIMA / SARIMA)</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./multivariate.html" class="sidebar-item-text sidebar-link">Multivariate TS Models (ARIMAX / SARIMAX / VAR)</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./financial.html" class="sidebar-item-text sidebar-link">Financial TS Models (ARCH / GARCH)</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dl.html" class="sidebar-item-text sidebar-link active">Deep Learning for TS</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./conclusions.html" class="sidebar-item-text sidebar-link">Conclusions / Discussion</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#load-data" id="toc-load-data" class="nav-link active" data-scroll-target="#load-data">Load data</a></li>
  <li><a href="#visualize-raw-data" id="toc-visualize-raw-data" class="nav-link" data-scroll-target="#visualize-raw-data">Visualize “raw” data</a></li>
  <li><a href="#normalize" id="toc-normalize" class="nav-link" data-scroll-target="#normalize">Normalize</a></li>
  <li><a href="#split" id="toc-split" class="nav-link" data-scroll-target="#split">Split</a></li>
  <li><a href="#mini-batch-creation" id="toc-mini-batch-creation" class="nav-link" data-scroll-target="#mini-batch-creation">Mini-batch creation</a></li>
  <li><a href="#utility-function" id="toc-utility-function" class="nav-link" data-scroll-target="#utility-function">Utility function</a></li>
  <li><a href="#reshape" id="toc-reshape" class="nav-link" data-scroll-target="#reshape">Reshape</a></li>
  <li><a href="#rnn" id="toc-rnn" class="nav-link" data-scroll-target="#rnn">RNN</a></li>
  <li><a href="#rnn-with-l2-regularization" id="toc-rnn-with-l2-regularization" class="nav-link" data-scroll-target="#rnn-with-l2-regularization">RNN with L2 Regularization</a></li>
  <li><a href="#gru" id="toc-gru" class="nav-link" data-scroll-target="#gru">GRU</a></li>
  <li><a href="#gru-with-l2-regularization" id="toc-gru-with-l2-regularization" class="nav-link" data-scroll-target="#gru-with-l2-regularization">GRU with L2 Regularization</a></li>
  <li><a href="#lstm" id="toc-lstm" class="nav-link" data-scroll-target="#lstm">LSTM</a></li>
  <li><a href="#lstm-with-l2-regularization" id="toc-lstm-with-l2-regularization" class="nav-link" data-scroll-target="#lstm-with-l2-regularization">LSTM with L2 Regularization</a></li>
  <li><a href="#discussion" id="toc-discussion" class="nav-link" data-scroll-target="#discussion">Discussion</a>
  <ul class="collapse">
  <li><a href="#ann-model-comparison" id="toc-ann-model-comparison" class="nav-link" data-scroll-target="#ann-model-comparison">ANN Model Comparison</a></li>
  <li><a href="#ann-vs.-traditional-univariate-ts-models" id="toc-ann-vs.-traditional-univariate-ts-models" class="nav-link" data-scroll-target="#ann-vs.-traditional-univariate-ts-models">ANN vs.&nbsp;Traditional Univariate TS Models</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title d-none d-lg-block">Deep Learning for TS</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>On this page, I will be exploring deep learning methodologies for time series analysis. I’m going to implement various deep learning models like RNN, GRUs and LSTMs, with and without L2 regularization using structured approach outlined on this page. Finally, I’ll compare the results of deep learning models with traditional TS models used across this project.</p>
<section id="load-data" class="level2">
<h2 class="anchored" data-anchor-id="load-data">Load data</h2>
<p>Let’s load the time series dataset and explore it.</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Prices</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Consumption</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">Production</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" role="tab" aria-controls="tabset-1-4" aria-selected="false">Imports</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-5" role="tab" aria-controls="tabset-1-5" aria-selected="false">Exports</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-6" role="tab" aria-controls="tabset-1-6" aria-selected="false">CVX Stocks</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-7-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-7" role="tab" aria-controls="tabset-1-7" aria-selected="false">CO2 Emissions</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell" data-outputid="91b9f2f2-958c-42c2-dabc-397c73055d10" data-execution_count="3">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> yfinance <span class="im">as</span> yf</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> IFrame,display, Markdown</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, mean_absolute_error, mean_absolute_percentage_error</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow <span class="im">import</span> keras</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras <span class="im">import</span> layers</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras <span class="im">import</span> initializers</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras <span class="im">import</span> regularizers</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.layers <span class="im">import</span> Dense, SimpleRNN, LSTM, GRU</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tabulate <span class="im">import</span> tabulate</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>prices <span class="op">=</span> pd.read_csv(<span class="st">"datasets/eda/Henry_Hub_Natural_Gas_Spot_Price.csv"</span>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>prices <span class="op">=</span> prices.rename(columns<span class="op">=</span>{<span class="st">'Month'</span>:<span class="st">'t'</span>, <span class="st">'Henry Hub Natural Gas Spot Price Dollars per Million Btu'</span>:<span class="st">'y'</span>})</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>prices <span class="op">=</span> prices[[<span class="st">'t'</span>, <span class="st">'y'</span>]]</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> np.array([<span class="op">*</span><span class="bu">range</span>(<span class="dv">0</span>, prices.shape[<span class="dv">0</span>])])</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.array(prices[<span class="st">"y"</span>]).reshape(t.shape[<span class="dv">0</span>], <span class="dv">1</span>)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>feature_columns <span class="op">=</span> [<span class="dv">0</span>]  <span class="co"># columns to use as features</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>target_columns <span class="op">=</span> [<span class="dv">0</span>]  <span class="co"># columns to use as targets</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>table_shape_price <span class="op">=</span> [[<span class="st">'Variable'</span>,<span class="st">'Type'</span>, <span class="st">'Shape'</span>], [<span class="st">"t"</span>, <span class="bu">type</span>(t), t.shape], [<span class="st">"x"</span>, <span class="bu">type</span>(x), x.shape]]</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(table_shape_price, headers<span class="op">=</span><span class="st">'firstrow'</span>, tablefmt<span class="op">=</span><span class="st">'fancy_grid'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>╒════════════╤═════════════════════════╤══════════╕
│ Variable   │ Type                    │ Shape    │
╞════════════╪═════════════════════════╪══════════╡
│ t          │ &lt;class 'numpy.ndarray'&gt; │ (216,)   │
├────────────┼─────────────────────────┼──────────┤
│ x          │ &lt;class 'numpy.ndarray'&gt; │ (216, 1) │
╘════════════╧═════════════════════════╧══════════╛</code></pre>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell" data-outputid="2350bdec-c2c0-4855-b5ab-ebe9e29fc305" data-execution_count="4">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>consumption <span class="op">=</span> pd.read_csv(<span class="st">"datasets/eda/Consumption.csv"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>consumption <span class="op">=</span> consumption.rename(columns<span class="op">=</span>{<span class="st">'Month'</span>:<span class="st">'t'</span>, <span class="st">'Consumption'</span>:<span class="st">'y'</span>})</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>consumption <span class="op">=</span> consumption[[<span class="st">'t'</span>, <span class="st">'y'</span>]]</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>t_consump <span class="op">=</span> np.array([<span class="op">*</span><span class="bu">range</span>(<span class="dv">0</span>, consumption.shape[<span class="dv">0</span>])])</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>x_consump <span class="op">=</span> np.array(consumption[<span class="st">"y"</span>]).reshape(t_consump.shape[<span class="dv">0</span>], <span class="dv">1</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>feature_columns_consump <span class="op">=</span> [<span class="dv">0</span>]  <span class="co"># columns to use as features</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>target_columns_consump <span class="op">=</span> [<span class="dv">0</span>]  <span class="co"># columns to use as targets</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>table_shape_consumption <span class="op">=</span> [[<span class="st">'Variable'</span>,<span class="st">'Type'</span>, <span class="st">'Shape'</span>], [<span class="st">"t"</span>, <span class="bu">type</span>(t_consump), t_consump.shape], [<span class="st">"x"</span>, <span class="bu">type</span>(x_consump), x_consump.shape]]</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(table_shape_price, headers<span class="op">=</span><span class="st">'firstrow'</span>, tablefmt<span class="op">=</span><span class="st">'fancy_grid'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>╒════════════╤═════════════════════════╤══════════╕
│ Variable   │ Type                    │ Shape    │
╞════════════╪═════════════════════════╪══════════╡
│ t          │ &lt;class 'numpy.ndarray'&gt; │ (216,)   │
├────────────┼─────────────────────────┼──────────┤
│ x          │ &lt;class 'numpy.ndarray'&gt; │ (216, 1) │
╘════════════╧═════════════════════════╧══════════╛</code></pre>
</div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="cell" data-outputid="03fef29a-7eff-4022-e4af-0ce8f4618e0a" data-execution_count="5">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>production <span class="op">=</span> pd.read_csv(<span class="st">"datasets/eda/Production.csv"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>production <span class="op">=</span> production.rename(columns<span class="op">=</span>{<span class="st">'Month'</span>:<span class="st">'t'</span>, <span class="st">'Production'</span>:<span class="st">'y'</span>})</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>production <span class="op">=</span> production[[<span class="st">'t'</span>, <span class="st">'y'</span>]]</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>t_prod <span class="op">=</span> np.array([<span class="op">*</span><span class="bu">range</span>(<span class="dv">0</span>, production.shape[<span class="dv">0</span>])])</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>x_prod <span class="op">=</span> np.array(production[<span class="st">"y"</span>]).reshape(t_prod.shape[<span class="dv">0</span>], <span class="dv">1</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>feature_columns_prod <span class="op">=</span> [<span class="dv">0</span>]  <span class="co"># columns to use as features</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>target_columns_prod <span class="op">=</span> [<span class="dv">0</span>]  <span class="co"># columns to use as targets</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>table_shape_prod <span class="op">=</span> [[<span class="st">'Variable'</span>,<span class="st">'Type'</span>, <span class="st">'Shape'</span>], [<span class="st">"t"</span>, <span class="bu">type</span>(t_prod), t_prod.shape], [<span class="st">"x"</span>, <span class="bu">type</span>(x_prod), x_prod.shape]]</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(table_shape_price, headers<span class="op">=</span><span class="st">'firstrow'</span>, tablefmt<span class="op">=</span><span class="st">'fancy_grid'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>╒════════════╤═════════════════════════╤══════════╕
│ Variable   │ Type                    │ Shape    │
╞════════════╪═════════════════════════╪══════════╡
│ t          │ &lt;class 'numpy.ndarray'&gt; │ (216,)   │
├────────────┼─────────────────────────┼──────────┤
│ x          │ &lt;class 'numpy.ndarray'&gt; │ (216, 1) │
╘════════════╧═════════════════════════╧══════════╛</code></pre>
</div>
</div>
</div>
<div id="tabset-1-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-4-tab">
<div class="cell" data-outputid="47308b0b-e345-4c0d-a0af-f5ea19764cf2" data-execution_count="6">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>imports <span class="op">=</span> pd.read_csv(<span class="st">"datasets/eda/Imports.csv"</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>imports <span class="op">=</span> imports.rename(columns<span class="op">=</span>{<span class="st">'Month'</span>:<span class="st">'t'</span>, <span class="st">'Imports'</span>:<span class="st">'y'</span>})</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>imports <span class="op">=</span> imports[[<span class="st">'t'</span>, <span class="st">'y'</span>]]</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>t_imp <span class="op">=</span> np.array([<span class="op">*</span><span class="bu">range</span>(<span class="dv">0</span>, imports.shape[<span class="dv">0</span>])])</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>x_imp <span class="op">=</span> np.array(imports[<span class="st">"y"</span>]).reshape(t_imp.shape[<span class="dv">0</span>], <span class="dv">1</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>feature_columns_imp <span class="op">=</span> [<span class="dv">0</span>]  <span class="co"># columns to use as features</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>target_columns_imp <span class="op">=</span> [<span class="dv">0</span>]  <span class="co"># columns to use as targets</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>table_shape_imp <span class="op">=</span> [[<span class="st">'Variable'</span>,<span class="st">'Type'</span>, <span class="st">'Shape'</span>], [<span class="st">"t"</span>, <span class="bu">type</span>(t_imp), t_imp.shape], [<span class="st">"x"</span>, <span class="bu">type</span>(x_imp), x_imp.shape]]</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(table_shape_price, headers<span class="op">=</span><span class="st">'firstrow'</span>, tablefmt<span class="op">=</span><span class="st">'fancy_grid'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>╒════════════╤═════════════════════════╤══════════╕
│ Variable   │ Type                    │ Shape    │
╞════════════╪═════════════════════════╪══════════╡
│ t          │ &lt;class 'numpy.ndarray'&gt; │ (216,)   │
├────────────┼─────────────────────────┼──────────┤
│ x          │ &lt;class 'numpy.ndarray'&gt; │ (216, 1) │
╘════════════╧═════════════════════════╧══════════╛</code></pre>
</div>
</div>
</div>
<div id="tabset-1-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-5-tab">
<div class="cell" data-outputid="654c8845-af6b-418a-e3a2-ecb38ead565e" data-execution_count="7">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>exports <span class="op">=</span> pd.read_csv(<span class="st">"datasets/eda/Exports.csv"</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>exports <span class="op">=</span> exports.rename(columns<span class="op">=</span>{<span class="st">'Month'</span>:<span class="st">'t'</span>, <span class="st">'Exports'</span>:<span class="st">'y'</span>})</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>exports <span class="op">=</span> exports[[<span class="st">'t'</span>, <span class="st">'y'</span>]]</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>t_exp <span class="op">=</span> np.array([<span class="op">*</span><span class="bu">range</span>(<span class="dv">0</span>, exports.shape[<span class="dv">0</span>])])</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>x_exp <span class="op">=</span> np.array(exports[<span class="st">"y"</span>]).reshape(t_exp.shape[<span class="dv">0</span>], <span class="dv">1</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>feature_columns_exp <span class="op">=</span> [<span class="dv">0</span>]  <span class="co"># columns to use as features</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>target_columns_exp <span class="op">=</span> [<span class="dv">0</span>]  <span class="co"># columns to use as targets</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>table_shape_exp <span class="op">=</span> [[<span class="st">'Variable'</span>,<span class="st">'Type'</span>, <span class="st">'Shape'</span>], [<span class="st">"t"</span>, <span class="bu">type</span>(t_exp), t_exp.shape], [<span class="st">"x"</span>, <span class="bu">type</span>(x_exp), x_exp.shape]]</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(table_shape_price, headers<span class="op">=</span><span class="st">'firstrow'</span>, tablefmt<span class="op">=</span><span class="st">'fancy_grid'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>╒════════════╤═════════════════════════╤══════════╕
│ Variable   │ Type                    │ Shape    │
╞════════════╪═════════════════════════╪══════════╡
│ t          │ &lt;class 'numpy.ndarray'&gt; │ (216,)   │
├────────────┼─────────────────────────┼──────────┤
│ x          │ &lt;class 'numpy.ndarray'&gt; │ (216, 1) │
╘════════════╧═════════════════════════╧══════════╛</code></pre>
</div>
</div>
</div>
<div id="tabset-1-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-6-tab">
<div class="cell" data-outputid="6689a7bc-f935-4d36-b9fc-9ab923ec1c76" data-execution_count="8">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>stocks <span class="op">=</span> yf.download(<span class="st">"CVX"</span>, <span class="st">'2005-01-01'</span>,<span class="st">'2022-12-01'</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>stocks <span class="op">=</span> stocks.reset_index()</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>stocks <span class="op">=</span> stocks.rename(columns<span class="op">=</span>{<span class="st">'Date'</span>:<span class="st">'t'</span>, <span class="st">'Adj Close'</span>:<span class="st">'y'</span>})</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>stocks <span class="op">=</span> stocks[[<span class="st">'t'</span>, <span class="st">'y'</span>]]</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>t_stk <span class="op">=</span> np.array([<span class="op">*</span><span class="bu">range</span>(<span class="dv">0</span>,stocks.shape[<span class="dv">0</span>])])</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>x_stk <span class="op">=</span> np.array(stocks[<span class="st">'y'</span>]).reshape(t_stk.shape[<span class="dv">0</span>],<span class="dv">1</span>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>feature_columns_stk <span class="op">=</span> [<span class="dv">0</span>]</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>target_columns_stk <span class="op">=</span> [<span class="dv">0</span>]</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>table_shape_stk <span class="op">=</span> [[<span class="st">'Variable'</span>,<span class="st">'Type'</span>, <span class="st">'Shape'</span>], [<span class="st">"t"</span>, <span class="bu">type</span>(t_stk), t_stk.shape], [<span class="st">"x"</span>, <span class="bu">type</span>(x_stk), x_stk.shape]]</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(table_shape_price, headers<span class="op">=</span><span class="st">'firstrow'</span>, tablefmt<span class="op">=</span><span class="st">'fancy_grid'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>[*********************100%%**********************]  1 of 1 completed</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>╒════════════╤═════════════════════════╤══════════╕
│ Variable   │ Type                    │ Shape    │
╞════════════╪═════════════════════════╪══════════╡
│ t          │ &lt;class 'numpy.ndarray'&gt; │ (216,)   │
├────────────┼─────────────────────────┼──────────┤
│ x          │ &lt;class 'numpy.ndarray'&gt; │ (216, 1) │
╘════════════╧═════════════════════════╧══════════╛</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
</div>
</div>
<div id="tabset-1-7" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-7-tab">
<div class="cell" data-outputid="0d2f2a18-ed50-470f-e2f7-4932496d411f" data-execution_count="9">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>emissions <span class="op">=</span> pd.read_csv(<span class="st">"datasets/eda/co2_emissions.csv"</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>emissions[<span class="st">'Date'</span>] <span class="op">=</span> pd.to_datetime(emissions[<span class="st">'Date'</span>],<span class="bu">format</span> <span class="op">=</span> <span class="st">"%m/</span><span class="sc">%d</span><span class="st">/%y"</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>emissions <span class="op">=</span> emissions.rename(columns<span class="op">=</span>{<span class="st">'Date'</span>:<span class="st">'t'</span>, <span class="st">'co2_value'</span>:<span class="st">'y'</span>})</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>emissions <span class="op">=</span> emissions[[<span class="st">'t'</span>, <span class="st">'y'</span>]]</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>t_emissions <span class="op">=</span> np.array([<span class="op">*</span><span class="bu">range</span>(<span class="dv">0</span>, emissions.shape[<span class="dv">0</span>])])</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>x_emissions <span class="op">=</span> np.array(emissions[<span class="st">"y"</span>]).reshape(t_emissions.shape[<span class="dv">0</span>], <span class="dv">1</span>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>feature_columns_emissions <span class="op">=</span> [<span class="dv">0</span>]  <span class="co"># columns to use as features</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>target_columns_emissions <span class="op">=</span> [<span class="dv">0</span>]  <span class="co"># columns to use as targets</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>table_shape_emissions <span class="op">=</span> [[<span class="st">'Variable'</span>,<span class="st">'Type'</span>, <span class="st">'Shape'</span>], [<span class="st">"t"</span>, <span class="bu">type</span>(t_emissions), t_emissions.shape], [<span class="st">"x"</span>, <span class="bu">type</span>(x_emissions), x_emissions.shape]]</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(table_shape_emissions, headers<span class="op">=</span><span class="st">'firstrow'</span>, tablefmt<span class="op">=</span><span class="st">'fancy_grid'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>╒════════════╤═════════════════════════╤══════════╕
│ Variable   │ Type                    │ Shape    │
╞════════════╪═════════════════════════╪══════════╡
│ t          │ &lt;class 'numpy.ndarray'&gt; │ (310,)   │
├────────────┼─────────────────────────┼──────────┤
│ x          │ &lt;class 'numpy.ndarray'&gt; │ (310, 1) │
╘════════════╧═════════════════════════╧══════════╛</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="visualize-raw-data" class="level2">
<h2 class="anchored" data-anchor-id="visualize-raw-data">Visualize “raw” data</h2>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Prices</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Consumption</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false">Production</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-4" role="tab" aria-controls="tabset-2-4" aria-selected="false">Imports</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-5" role="tab" aria-controls="tabset-2-5" aria-selected="false">Exports</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-6" role="tab" aria-controls="tabset-2-6" aria-selected="false">CVX Stocks</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-7-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-7" role="tab" aria-controls="tabset-2-7" aria-selected="false">CO2 Emissions</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell" data-outputid="73be7683-fe6b-46cc-b1a1-be0c4b0ed554" data-execution_count="10">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, x.shape[<span class="dv">1</span>]):</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    ax.plot(t, x[:, i], <span class="st">"o"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    ax.plot(t, x[:, i], <span class="st">"-"</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>ax.plot(t, <span class="dv">0</span> <span class="op">*</span> x[:, <span class="dv">0</span>], <span class="st">"-"</span>)  <span class="co"># add baseline for reference</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-9-output-1.png" class="img-fluid"></p>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell" data-outputid="c2b3ec50-40b1-4af7-adcd-e8c9090aeddb" data-execution_count="11">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, x_consump.shape[<span class="dv">1</span>]):</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    ax.plot(t_consump, x_consump[:, i], <span class="st">"o"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    ax.plot(t_consump, x_consump[:, i], <span class="st">"-"</span>)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>ax.plot(t_consump, <span class="dv">0</span> <span class="op">*</span> x_consump[:, <span class="dv">0</span>], <span class="st">"-"</span>)  <span class="co"># add baseline for reference</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-10-output-1.png" class="img-fluid"></p>
</div>
</div>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<div class="cell" data-outputid="b89a7fb7-65d0-4168-ea73-b3e06220d02f" data-execution_count="12">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, x_prod.shape[<span class="dv">1</span>]):</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    ax.plot(t_prod, x_prod[:, i], <span class="st">"o"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    ax.plot(t_prod, x_prod[:, i], <span class="st">"-"</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>ax.plot(t_prod, <span class="dv">0</span> <span class="op">*</span> x_prod[:, <span class="dv">0</span>], <span class="st">"-"</span>)  <span class="co"># add baseline for reference</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-11-output-1.png" class="img-fluid"></p>
</div>
</div>
</div>
<div id="tabset-2-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-4-tab">
<div class="cell" data-outputid="1a8949d7-9aa0-49dc-dabe-fb84ea158382" data-execution_count="13">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, x_imp.shape[<span class="dv">1</span>]):</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    ax.plot(t_imp, x_imp[:, i], <span class="st">"o"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    ax.plot(t_imp, x_imp[:, i], <span class="st">"-"</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>ax.plot(t_imp, <span class="dv">0</span> <span class="op">*</span> x_imp[:, <span class="dv">0</span>], <span class="st">"-"</span>)  <span class="co"># add baseline for reference</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-12-output-1.png" class="img-fluid"></p>
</div>
</div>
</div>
<div id="tabset-2-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-5-tab">
<div class="cell" data-outputid="737873fb-e111-4645-adc6-aac474557706" data-execution_count="14">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, x_exp.shape[<span class="dv">1</span>]):</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    ax.plot(t_exp, x_exp[:, i], <span class="st">"o"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    ax.plot(t_exp, x_exp[:, i], <span class="st">"-"</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>ax.plot(t_exp, <span class="dv">0</span> <span class="op">*</span> x_exp[:, <span class="dv">0</span>], <span class="st">"-"</span>)  <span class="co"># add baseline for reference</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-13-output-1.png" class="img-fluid"></p>
</div>
</div>
</div>
<div id="tabset-2-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-6-tab">
<div class="cell" data-outputid="6ffa3c0f-d10e-46e3-daee-0f80e892e7bd" data-execution_count="15">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, x_stk.shape[<span class="dv">1</span>]):</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    ax.plot(t_stk, x_stk[:, i], <span class="st">"o"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    ax.plot(t_stk, x_stk[:, i], <span class="st">"-"</span>)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>ax.plot(t_stk, <span class="dv">0</span> <span class="op">*</span> x_stk[:, <span class="dv">0</span>], <span class="st">"-"</span>)  <span class="co"># add baseline for reference</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-14-output-1.png" class="img-fluid"></p>
</div>
</div>
</div>
<div id="tabset-2-7" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-7-tab">
<div class="cell" data-outputid="7e76e710-f8a0-4bf2-d23f-a0cf595ad314" data-execution_count="16">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, x_emissions.shape[<span class="dv">1</span>]):</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    ax.plot(t_emissions, x_emissions[:, i], <span class="st">"o"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    ax.plot(t_emissions, x_emissions[:, i], <span class="st">"-"</span>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>ax.plot(t_emissions, <span class="dv">0</span> <span class="op">*</span> x_emissions[:, <span class="dv">0</span>], <span class="st">"-"</span>)  <span class="co"># add baseline for reference</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-15-output-1.png" class="img-fluid"></p>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="normalize" class="level2">
<h2 class="anchored" data-anchor-id="normalize">Normalize</h2>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">Prices</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Consumption</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-3" role="tab" aria-controls="tabset-3-3" aria-selected="false">Production</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-4" role="tab" aria-controls="tabset-3-4" aria-selected="false">Imports</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-5" role="tab" aria-controls="tabset-3-5" aria-selected="false">Exports</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-6" role="tab" aria-controls="tabset-3-6" aria-selected="false">CVX Stocks</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-7-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-7" role="tab" aria-controls="tabset-3-7" aria-selected="false">CO2 Emissions</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell" data-outputid="6baa12f3-dd9c-4f66-df40-e7e2b61b6767" data-execution_count="17">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"----Shape of statistical measures and the normalized Data----"</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.mean(x, axis<span class="op">=</span><span class="dv">0</span>).shape, np.std(x, axis<span class="op">=</span><span class="dv">0</span>).shape)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> (x <span class="op">-</span> np.mean(x, axis<span class="op">=</span><span class="dv">0</span>)) <span class="op">/</span> np.std(x, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>----Shape of statistical measures and the normalized Data----
(1,) (1,)
(216, 1)</code></pre>
</div>
</div>
<div class="cell" data-outputid="d253773d-0aed-4fce-a43a-ce199e9b7aa9" data-execution_count="18">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize normalized data</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, x.shape[<span class="dv">1</span>]):</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    ax.plot(t, x[:, i], <span class="st">"o"</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    ax.plot(t, x[:, i], <span class="st">"-"</span>)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>ax.plot(t, <span class="dv">0</span> <span class="op">*</span> x[:, <span class="dv">0</span>], <span class="st">"-"</span>)  <span class="co"># add baseline for reference</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-17-output-1.png" class="img-fluid"></p>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell" data-outputid="b645f2ea-47c6-466a-a25c-42650518e446" data-execution_count="19">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"----Shape of statistical measures and the normalized Data----"</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.mean(x_consump, axis<span class="op">=</span><span class="dv">0</span>).shape, np.std(x_consump, axis<span class="op">=</span><span class="dv">0</span>).shape)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>x_consump <span class="op">=</span> (x_consump <span class="op">-</span> np.mean(x_consump, axis<span class="op">=</span><span class="dv">0</span>)) <span class="op">/</span> np.std(x_consump, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x_consump.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>----Shape of statistical measures and the normalized Data----
(1,) (1,)
(216, 1)</code></pre>
</div>
</div>
<div class="cell" data-outputid="1a57c045-ebb9-4669-bbb4-a481c5ab15ed" data-execution_count="20">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize normalized data</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, x_consump.shape[<span class="dv">1</span>]):</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    ax.plot(t_consump, x_consump[:, i], <span class="st">"o"</span>)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    ax.plot(t_consump, x_consump[:, i], <span class="st">"-"</span>)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>ax.plot(t_consump, <span class="dv">0</span> <span class="op">*</span> x_consump[:, <span class="dv">0</span>], <span class="st">"-"</span>)  <span class="co"># add baseline for reference</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-19-output-1.png" class="img-fluid"></p>
</div>
</div>
</div>
<div id="tabset-3-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-3-tab">
<div class="cell" data-outputid="c430404d-59b0-4193-cf6c-84cf5d4da469" data-execution_count="21">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"----Shape of statistical measures and the normalized Data----"</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.mean(x_prod, axis<span class="op">=</span><span class="dv">0</span>).shape, np.std(x_prod, axis<span class="op">=</span><span class="dv">0</span>).shape)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>x_prod <span class="op">=</span> (x_prod <span class="op">-</span> np.mean(x_prod, axis<span class="op">=</span><span class="dv">0</span>)) <span class="op">/</span> np.std(x_prod, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x_prod.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>----Shape of statistical measures and the normalized Data----
(1,) (1,)
(216, 1)</code></pre>
</div>
</div>
<div class="cell" data-outputid="3450955a-bb8e-497b-f89b-9005b383cbc3" data-execution_count="22">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize normalized data</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, x_prod.shape[<span class="dv">1</span>]):</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    ax.plot(t_prod, x_prod[:, i], <span class="st">"o"</span>)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    ax.plot(t_prod, x_prod[:, i], <span class="st">"-"</span>)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>ax.plot(t_prod, <span class="dv">0</span> <span class="op">*</span> x_prod[:, <span class="dv">0</span>], <span class="st">"-"</span>)  <span class="co"># add baseline for reference</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-21-output-1.png" class="img-fluid"></p>
</div>
</div>
</div>
<div id="tabset-3-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-4-tab">
<div class="cell" data-outputid="86e48a72-988c-458e-bfcd-01635ce1c185" data-execution_count="23">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"----Shape of statistical measures and the normalized Data----"</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.mean(x_imp, axis<span class="op">=</span><span class="dv">0</span>).shape, np.std(x_imp, axis<span class="op">=</span><span class="dv">0</span>).shape)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>x_imp <span class="op">=</span> (x_imp <span class="op">-</span> np.mean(x_imp, axis<span class="op">=</span><span class="dv">0</span>)) <span class="op">/</span> np.std(x_imp, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x_imp.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>----Shape of statistical measures and the normalized Data----
(1,) (1,)
(312, 1)</code></pre>
</div>
</div>
<div class="cell" data-outputid="0e6c7a14-ac90-4996-cce9-2a294802f3b5" data-execution_count="24">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize normalized data</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, x_imp.shape[<span class="dv">1</span>]):</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    ax.plot(t_imp, x_imp[:, i], <span class="st">"o"</span>)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    ax.plot(t_imp, x_imp[:, i], <span class="st">"-"</span>)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>ax.plot(t_imp, <span class="dv">0</span> <span class="op">*</span> x_imp[:, <span class="dv">0</span>], <span class="st">"-"</span>)  <span class="co"># add baseline for reference</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-23-output-1.png" class="img-fluid"></p>
</div>
</div>
</div>
<div id="tabset-3-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-5-tab">
<div class="cell" data-outputid="255cd743-4273-45da-ac8c-9ba9e6b2c31e" data-execution_count="25">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"----Shape of statistical measures and the normalized Data----"</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.mean(x_exp, axis<span class="op">=</span><span class="dv">0</span>).shape, np.std(x_exp, axis<span class="op">=</span><span class="dv">0</span>).shape)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>x_exp <span class="op">=</span> (x_exp <span class="op">-</span> np.mean(x_exp, axis<span class="op">=</span><span class="dv">0</span>)) <span class="op">/</span> np.std(x_exp, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x_exp.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>----Shape of statistical measures and the normalized Data----
(1,) (1,)
(312, 1)</code></pre>
</div>
</div>
<div class="cell" data-outputid="1193b999-3b93-43d9-d0fb-1e9e1d4e1fc8" data-execution_count="26">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize normalized data</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, x_exp.shape[<span class="dv">1</span>]):</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    ax.plot(t_exp, x_exp[:, i], <span class="st">"o"</span>)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    ax.plot(t_exp, x_exp[:, i], <span class="st">"-"</span>)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>ax.plot(t_exp, <span class="dv">0</span> <span class="op">*</span> x_exp[:, <span class="dv">0</span>], <span class="st">"-"</span>)  <span class="co"># add baseline for reference</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-25-output-1.png" class="img-fluid"></p>
</div>
</div>
</div>
<div id="tabset-3-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-6-tab">
<div class="cell" data-outputid="39050fab-c43e-4bcb-c042-acf5b793e228" data-execution_count="27">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"----Shape of statistical measures and the normalized Data----"</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.mean(x_stk, axis<span class="op">=</span><span class="dv">0</span>).shape, np.std(x_stk, axis<span class="op">=</span><span class="dv">0</span>).shape)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>x_stk <span class="op">=</span> (x_stk <span class="op">-</span> np.mean(x_stk, axis<span class="op">=</span><span class="dv">0</span>)) <span class="op">/</span> np.std(x_stk, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x_stk.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>----Shape of statistical measures and the normalized Data----
(1,) (1,)
(4510, 1)</code></pre>
</div>
</div>
<div class="cell" data-outputid="321ebf66-21dc-4400-ca93-9019d5abb507" data-execution_count="28">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize normalized data</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, x_stk.shape[<span class="dv">1</span>]):</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    ax.plot(t_stk, x_stk[:, i], <span class="st">"o"</span>)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    ax.plot(t_stk, x_stk[:, i], <span class="st">"-"</span>)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>ax.plot(t_stk, <span class="dv">0</span> <span class="op">*</span> x_stk[:, <span class="dv">0</span>], <span class="st">"-"</span>)  <span class="co"># add baseline for reference</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-27-output-1.png" class="img-fluid"></p>
</div>
</div>
</div>
<div id="tabset-3-7" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-7-tab">
<div class="cell" data-outputid="0cd44236-cdee-4334-e8c2-47dfddbe2c8a" data-execution_count="29">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"----Shape of statistical measures and the normalized Data----"</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.mean(x_emissions, axis<span class="op">=</span><span class="dv">0</span>).shape, np.std(x_emissions, axis<span class="op">=</span><span class="dv">0</span>).shape)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>x_emissions <span class="op">=</span> (x_emissions <span class="op">-</span> np.mean(x_emissions, axis<span class="op">=</span><span class="dv">0</span>)) <span class="op">/</span> np.std(x_emissions, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(x_emissions.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>----Shape of statistical measures and the normalized Data----
(1,) (1,)
(310, 1)</code></pre>
</div>
</div>
<div class="cell" data-outputid="df1cf35e-21fb-4ebc-b4c0-6e913936cb85" data-execution_count="30">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize normalized data</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, x_emissions.shape[<span class="dv">1</span>]):</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    ax.plot(t_emissions, x_emissions[:, i], <span class="st">"o"</span>)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    ax.plot(t_emissions, x_emissions[:, i], <span class="st">"-"</span>)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>ax.plot(t_emissions, <span class="dv">0</span> <span class="op">*</span> x_emissions[:, <span class="dv">0</span>], <span class="st">"-"</span>)  <span class="co"># add baseline for reference</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-29-output-1.png" class="img-fluid"></p>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="split" class="level2">
<h2 class="anchored" data-anchor-id="split">Split</h2>
<p>Partition into training and validation</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">Prices</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">Consumption</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-3" role="tab" aria-controls="tabset-4-3" aria-selected="false">Production</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-4" role="tab" aria-controls="tabset-4-4" aria-selected="false">Imports</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-5" role="tab" aria-controls="tabset-4-5" aria-selected="false">Exports</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-6" role="tab" aria-controls="tabset-4-6" aria-selected="false">CVX Stocks</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-7-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-7" role="tab" aria-controls="tabset-4-7" aria-selected="false">CO2 Emissions</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="cell" data-outputid="61d81545-ae80-4de2-e9a3-962371f7c3c6" data-execution_count="31">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>split_fraction <span class="op">=</span> <span class="fl">0.75</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>cut <span class="op">=</span> <span class="bu">int</span>(split_fraction <span class="op">*</span> x.shape[<span class="dv">0</span>])</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>tt <span class="op">=</span> t[<span class="dv">0</span>:cut]</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>xt <span class="op">=</span> x[<span class="dv">0</span>:cut]</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>tv <span class="op">=</span> t[cut:]</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>xv <span class="op">=</span> x[cut:]</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize normalized data</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, x.shape[<span class="dv">1</span>]):</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>    ax.plot(tt, xt[:, i], <span class="st">"ro"</span>, alpha<span class="op">=</span><span class="fl">0.25</span>)</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>    ax.plot(tt, xt[:, i], <span class="st">"g-"</span>)</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, x.shape[<span class="dv">1</span>]):</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>    ax.plot(tv, xv[:, i], <span class="st">"bo"</span>, alpha<span class="op">=</span><span class="fl">0.25</span>)</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>    ax.plot(tv, xv[:, i], <span class="st">"g-"</span>)</span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-30-output-1.png" class="img-fluid"></p>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="cell" data-outputid="01e270fd-9b1b-4ea2-9152-e4d2d95782e9" data-execution_count="32">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>split_fraction <span class="op">=</span> <span class="fl">0.75</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>cut_consump <span class="op">=</span> <span class="bu">int</span>(split_fraction <span class="op">*</span> x_consump.shape[<span class="dv">0</span>])</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>tt_consump <span class="op">=</span> t_consump[<span class="dv">0</span>:cut_consump]</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>xt_consump <span class="op">=</span> x_consump[<span class="dv">0</span>:cut_consump]</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>tv_consump <span class="op">=</span> t_consump[cut_consump:]</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>xv_consump <span class="op">=</span> x_consump[cut_consump:]</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize normalized data</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, x_consump.shape[<span class="dv">1</span>]):</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>    ax.plot(tt_consump, xt_consump[:, i], <span class="st">"ro"</span>, alpha<span class="op">=</span><span class="fl">0.25</span>)</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>    ax.plot(tt_consump, xt_consump[:, i], <span class="st">"g-"</span>)</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, x_consump.shape[<span class="dv">1</span>]):</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>    ax.plot(tv_consump, xv_consump[:, i], <span class="st">"bo"</span>, alpha<span class="op">=</span><span class="fl">0.25</span>)</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>    ax.plot(tv_consump, xv_consump[:, i], <span class="st">"g-"</span>)</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-31-output-1.png" class="img-fluid"></p>
</div>
</div>
</div>
<div id="tabset-4-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-3-tab">
<div class="cell" data-outputid="31bf8cff-f513-495c-b377-e2e7d76d5217" data-execution_count="33">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>split_fraction <span class="op">=</span> <span class="fl">0.75</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>cut_prod <span class="op">=</span> <span class="bu">int</span>(split_fraction <span class="op">*</span> x_prod.shape[<span class="dv">0</span>])</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>tt_prod <span class="op">=</span> t_prod[<span class="dv">0</span>:cut_prod]</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>xt_prod <span class="op">=</span> x_prod[<span class="dv">0</span>:cut_prod]</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>tv_prod <span class="op">=</span> t_prod[cut_prod:]</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>xv_prod <span class="op">=</span> x_prod[cut_prod:]</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize normalized data</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, x_prod.shape[<span class="dv">1</span>]):</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>    ax.plot(tt_prod, xt_prod[:, i], <span class="st">"ro"</span>, alpha<span class="op">=</span><span class="fl">0.25</span>)</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>    ax.plot(tt_prod, xt_prod[:, i], <span class="st">"g-"</span>)</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, x_prod.shape[<span class="dv">1</span>]):</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>    ax.plot(tv_prod, xv_prod[:, i], <span class="st">"bo"</span>, alpha<span class="op">=</span><span class="fl">0.25</span>)</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>    ax.plot(tv_prod, xv_prod[:, i], <span class="st">"g-"</span>)</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-32-output-1.png" class="img-fluid"></p>
</div>
</div>
</div>
<div id="tabset-4-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-4-tab">
<div class="cell" data-outputid="64e186f6-23ba-4256-db63-9f3bbe4429eb" data-execution_count="34">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>split_fraction <span class="op">=</span> <span class="fl">0.75</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>cut_imp <span class="op">=</span> <span class="bu">int</span>(split_fraction <span class="op">*</span> x_imp.shape[<span class="dv">0</span>])</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>tt_imp <span class="op">=</span> t_imp[<span class="dv">0</span>:cut_imp]</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>xt_imp <span class="op">=</span> x_imp[<span class="dv">0</span>:cut_imp]</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>tv_imp <span class="op">=</span> t_imp[cut_imp:]</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>xv_imp <span class="op">=</span> x_imp[cut_imp:]</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize normalized data</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, x_imp.shape[<span class="dv">1</span>]):</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>    ax.plot(tt_imp, xt_imp[:, i], <span class="st">"ro"</span>, alpha<span class="op">=</span><span class="fl">0.25</span>)</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>    ax.plot(tt_imp, xt_imp[:, i], <span class="st">"g-"</span>)</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, x_imp.shape[<span class="dv">1</span>]):</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>    ax.plot(tv_imp, xv_imp[:, i], <span class="st">"bo"</span>, alpha<span class="op">=</span><span class="fl">0.25</span>)</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>    ax.plot(tv_imp, xv_imp[:, i], <span class="st">"g-"</span>)</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-33-output-1.png" class="img-fluid"></p>
</div>
</div>
</div>
<div id="tabset-4-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-5-tab">
<div class="cell" data-outputid="81a1bf7a-b419-441a-f052-7d29818cdcfb" data-execution_count="35">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>split_fraction <span class="op">=</span> <span class="fl">0.75</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>cut_exp <span class="op">=</span> <span class="bu">int</span>(split_fraction <span class="op">*</span> x_exp.shape[<span class="dv">0</span>])</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>tt_exp <span class="op">=</span> t_exp[<span class="dv">0</span>:cut_exp]</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>xt_exp <span class="op">=</span> x_exp[<span class="dv">0</span>:cut_exp]</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>tv_exp <span class="op">=</span> t_exp[cut_exp:]</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>xv_exp <span class="op">=</span> x_exp[cut_exp:]</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize normalized data</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, x_exp.shape[<span class="dv">1</span>]):</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>    ax.plot(tt_exp, xt_exp[:, i], <span class="st">"ro"</span>, alpha<span class="op">=</span><span class="fl">0.25</span>)</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>    ax.plot(tt_exp, xt_exp[:, i], <span class="st">"g-"</span>)</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, x_exp.shape[<span class="dv">1</span>]):</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>    ax.plot(tv_exp, xv_exp[:, i], <span class="st">"bo"</span>, alpha<span class="op">=</span><span class="fl">0.25</span>)</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>    ax.plot(tv_exp, xv_exp[:, i], <span class="st">"g-"</span>)</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-34-output-1.png" class="img-fluid"></p>
</div>
</div>
</div>
<div id="tabset-4-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-6-tab">
<div class="cell" data-outputid="3b2ac0df-861f-433b-ae6c-89dc3aa18287" data-execution_count="36">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>split_fraction <span class="op">=</span> <span class="fl">0.75</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>cut_stk <span class="op">=</span> <span class="bu">int</span>(split_fraction <span class="op">*</span> x_stk.shape[<span class="dv">0</span>])</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>tt_stk <span class="op">=</span> t_stk[<span class="dv">0</span>:cut_stk]</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>xt_stk <span class="op">=</span> x_stk[<span class="dv">0</span>:cut_stk]</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>tv_stk <span class="op">=</span> t_stk[cut_stk:]</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>xv_stk <span class="op">=</span> x_stk[cut_stk:]</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize normalized data</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, x_stk.shape[<span class="dv">1</span>]):</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>    ax.plot(tt_stk, xt_stk[:, i], <span class="st">"ro"</span>, alpha<span class="op">=</span><span class="fl">0.25</span>)</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>    ax.plot(tt_stk, xt_stk[:, i], <span class="st">"g-"</span>)</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, x_stk.shape[<span class="dv">1</span>]):</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>    ax.plot(tv_stk, xv_stk[:, i], <span class="st">"bo"</span>, alpha<span class="op">=</span><span class="fl">0.25</span>)</span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>    ax.plot(tv_stk, xv_stk[:, i], <span class="st">"g-"</span>)</span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-35-output-1.png" class="img-fluid"></p>
</div>
</div>
</div>
<div id="tabset-4-7" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-7-tab">
<div class="cell" data-outputid="1c662471-0178-41c7-8e1b-4ac25343b053" data-execution_count="37">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>split_fraction <span class="op">=</span> <span class="fl">0.75</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>cut_emissions <span class="op">=</span> <span class="bu">int</span>(split_fraction <span class="op">*</span> x_emissions.shape[<span class="dv">0</span>])</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>tt_emissions <span class="op">=</span> t_emissions[<span class="dv">0</span>:cut_emissions]</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>xt_emissions <span class="op">=</span> x_emissions[<span class="dv">0</span>:cut_emissions]</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>tv_emissions <span class="op">=</span> t_emissions[cut_emissions:]</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>xv_emissions <span class="op">=</span> x_emissions[cut_emissions:]</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a><span class="co"># visualize normalized data</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, x_emissions.shape[<span class="dv">1</span>]):</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>    ax.plot(tt_emissions, xt_emissions[:, i], <span class="st">"ro"</span>, alpha<span class="op">=</span><span class="fl">0.25</span>)</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>    ax.plot(tt_emissions, xt_emissions[:, i], <span class="st">"g-"</span>)</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, x_emissions.shape[<span class="dv">1</span>]):</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>    ax.plot(tv_emissions, xv_emissions[:, i], <span class="st">"bo"</span>, alpha<span class="op">=</span><span class="fl">0.25</span>)</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>    ax.plot(tv_emissions, xv_emissions[:, i], <span class="st">"g-"</span>)</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-36-output-1.png" class="img-fluid"></p>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="mini-batch-creation" class="level2">
<h2 class="anchored" data-anchor-id="mini-batch-creation">Mini-batch creation</h2>
<p>Function to form time-series mini-batches</p>
<div class="cell" data-execution_count="38">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># function to form time-series mini-batches</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="co"># inputs are the mini-batching hyper-params</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="co"># x-&gt; 304 x 3</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> form_arrays(</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>    x,</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>    lookback<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>    delay<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>    step<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>    feature_columns<span class="op">=</span>[<span class="dv">0</span>],</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>    target_columns<span class="op">=</span>[<span class="dv">0</span>],</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>    unique<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># verbose=True --&gt; report and plot for debugging</span></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># unique=True --&gt; don't re-sample:</span></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># x1,x2,x3 --&gt; x4 then x4,x5,x6 --&gt; x7 instead of x2,x3,x4 --&gt; x5</span></span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># initialize</span></span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>    i_start <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>    count <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># initialize output arrays with samples</span></span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>    x_out <span class="op">=</span> []</span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a>    y_out <span class="op">=</span> []</span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># sequentially build mini-batch samples</span></span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> i_start <span class="op">+</span> lookback <span class="op">+</span> delay <span class="op">&lt;</span> x.shape[<span class="dv">0</span>]:</span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a>        <span class="co"># define index bounds</span></span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a>        i_stop <span class="op">=</span> i_start <span class="op">+</span> lookback</span>
<span id="cb52-34"><a href="#cb52-34" aria-hidden="true" tabindex="-1"></a>        i_pred <span class="op">=</span> i_stop <span class="op">+</span> delay</span>
<span id="cb52-35"><a href="#cb52-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-36"><a href="#cb52-36" aria-hidden="true" tabindex="-1"></a>        <span class="co"># report if desired</span></span>
<span id="cb52-37"><a href="#cb52-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> verbose <span class="kw">and</span> count <span class="op">&lt;</span> <span class="dv">2</span>:</span>
<span id="cb52-38"><a href="#cb52-38" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"indice range:"</span>, i_start, i_stop, <span class="st">"--&gt;"</span>, i_pred)</span>
<span id="cb52-39"><a href="#cb52-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-40"><a href="#cb52-40" aria-hidden="true" tabindex="-1"></a>        <span class="co"># define arrays:</span></span>
<span id="cb52-41"><a href="#cb52-41" aria-hidden="true" tabindex="-1"></a>        <span class="co"># method-1: buggy due to indexing from left</span></span>
<span id="cb52-42"><a href="#cb52-42" aria-hidden="true" tabindex="-1"></a>        <span class="co"># numpy's slicing --&gt; start:stop:step</span></span>
<span id="cb52-43"><a href="#cb52-43" aria-hidden="true" tabindex="-1"></a>        <span class="co"># xtmp=x[i_start:i_stop+1:steps]</span></span>
<span id="cb52-44"><a href="#cb52-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-45"><a href="#cb52-45" aria-hidden="true" tabindex="-1"></a>        <span class="co"># method-2: non-vectorized but cleaner</span></span>
<span id="cb52-46"><a href="#cb52-46" aria-hidden="true" tabindex="-1"></a>        indices_to_keep <span class="op">=</span> []</span>
<span id="cb52-47"><a href="#cb52-47" aria-hidden="true" tabindex="-1"></a>        j <span class="op">=</span> i_stop</span>
<span id="cb52-48"><a href="#cb52-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> j <span class="op">&gt;=</span> i_start:</span>
<span id="cb52-49"><a href="#cb52-49" aria-hidden="true" tabindex="-1"></a>            indices_to_keep.append(j)</span>
<span id="cb52-50"><a href="#cb52-50" aria-hidden="true" tabindex="-1"></a>            j <span class="op">=</span> j <span class="op">-</span> step</span>
<span id="cb52-51"><a href="#cb52-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-52"><a href="#cb52-52" aria-hidden="true" tabindex="-1"></a>        <span class="co"># create mini-batch sample</span></span>
<span id="cb52-53"><a href="#cb52-53" aria-hidden="true" tabindex="-1"></a>        xtmp <span class="op">=</span> x[indices_to_keep, :]  <span class="co"># isolate relevant indices</span></span>
<span id="cb52-54"><a href="#cb52-54" aria-hidden="true" tabindex="-1"></a>        xtmp <span class="op">=</span> xtmp[:, feature_columns]  <span class="co"># isolate desire features</span></span>
<span id="cb52-55"><a href="#cb52-55" aria-hidden="true" tabindex="-1"></a>        ytmp <span class="op">=</span> x[i_pred, target_columns]</span>
<span id="cb52-56"><a href="#cb52-56" aria-hidden="true" tabindex="-1"></a>        x_out.append(xtmp)</span>
<span id="cb52-57"><a href="#cb52-57" aria-hidden="true" tabindex="-1"></a>        y_out.append(ytmp)</span>
<span id="cb52-58"><a href="#cb52-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-59"><a href="#cb52-59" aria-hidden="true" tabindex="-1"></a>        <span class="co"># report if desired</span></span>
<span id="cb52-60"><a href="#cb52-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> verbose <span class="kw">and</span> count <span class="op">&lt;</span> <span class="dv">2</span>:</span>
<span id="cb52-61"><a href="#cb52-61" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(xtmp, <span class="st">"--&gt;"</span>, ytmp)</span>
<span id="cb52-62"><a href="#cb52-62" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> verbose <span class="kw">and</span> count <span class="op">&lt;</span> <span class="dv">2</span>:</span>
<span id="cb52-63"><a href="#cb52-63" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"shape:"</span>, xtmp.shape, <span class="st">"--&gt;"</span>, ytmp.shape)</span>
<span id="cb52-64"><a href="#cb52-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-65"><a href="#cb52-65" aria-hidden="true" tabindex="-1"></a>        <span class="co"># PLOT FIRST SAMPLE IF DESIRED FOR DEBUGGING</span></span>
<span id="cb52-66"><a href="#cb52-66" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> verbose <span class="kw">and</span> count <span class="op">&lt;</span> <span class="dv">2</span>:</span>
<span id="cb52-67"><a href="#cb52-67" aria-hidden="true" tabindex="-1"></a>            fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb52-68"><a href="#cb52-68" aria-hidden="true" tabindex="-1"></a>            ax.plot(x, <span class="st">"b-"</span>)</span>
<span id="cb52-69"><a href="#cb52-69" aria-hidden="true" tabindex="-1"></a>            ax.plot(x, <span class="st">"bx"</span>)</span>
<span id="cb52-70"><a href="#cb52-70" aria-hidden="true" tabindex="-1"></a>            ax.plot(indices_to_keep, xtmp, <span class="st">"go"</span>)</span>
<span id="cb52-71"><a href="#cb52-71" aria-hidden="true" tabindex="-1"></a>            ax.plot(i_pred <span class="op">*</span> np.ones(<span class="bu">len</span>(target_columns)), ytmp, <span class="st">"ro"</span>)</span>
<span id="cb52-72"><a href="#cb52-72" aria-hidden="true" tabindex="-1"></a>            plt.show()</span>
<span id="cb52-73"><a href="#cb52-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-74"><a href="#cb52-74" aria-hidden="true" tabindex="-1"></a>        <span class="co"># UPDATE START POINT</span></span>
<span id="cb52-75"><a href="#cb52-75" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> unique:</span>
<span id="cb52-76"><a href="#cb52-76" aria-hidden="true" tabindex="-1"></a>            i_start <span class="op">+=</span> lookback</span>
<span id="cb52-77"><a href="#cb52-77" aria-hidden="true" tabindex="-1"></a>        i_start <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb52-78"><a href="#cb52-78" aria-hidden="true" tabindex="-1"></a>        count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb52-79"><a href="#cb52-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-80"><a href="#cb52-80" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.array(x_out), np.array(y_out)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true">Prices</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false">Consumption</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-3" role="tab" aria-controls="tabset-5-3" aria-selected="false">Production</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-4" role="tab" aria-controls="tabset-5-4" aria-selected="false">Imports</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-5" role="tab" aria-controls="tabset-5-5" aria-selected="false">Exports</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-6" role="tab" aria-controls="tabset-5-6" aria-selected="false">CVX Stocks</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-7-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-7" role="tab" aria-controls="tabset-5-7" aria-selected="false">CO2 Emissions</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<div class="cell" data-outputid="a8f362ff-623c-4785-989c-8698f6140bad" data-execution_count="39">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>L<span class="op">=</span><span class="dv">4</span><span class="op">;</span> S<span class="op">=</span><span class="dv">1</span><span class="op">;</span> D<span class="op">=</span><span class="dv">1</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>Xt,Yt<span class="op">=</span>form_arrays(xt,lookback<span class="op">=</span>L,delay<span class="op">=</span>D,step<span class="op">=</span>S,feature_columns<span class="op">=</span>feature_columns,target_columns<span class="op">=</span>target_columns,unique<span class="op">=</span><span class="va">False</span>,verbose<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="co"># validation</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>Xv,Yv<span class="op">=</span>form_arrays(xv,lookback<span class="op">=</span>L,delay<span class="op">=</span>D,step<span class="op">=</span>S,feature_columns<span class="op">=</span>feature_columns,target_columns<span class="op">=</span>target_columns,unique<span class="op">=</span><span class="va">False</span>,verbose<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"training:"</span>,Xt.shape,Yt.shape)</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"validation:"</span>,Xv.shape,Yv.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>indice range: 0 4 --&gt; 5
[[0.85610218]
 [1.15450362]
 [1.06801045]
 [0.71338845]
 [0.71771311]] --&gt; [1.16315293]
shape: (5, 1) --&gt; (1,)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-38-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>indice range: 1 5 --&gt; 6
[[1.16315293]
 [0.85610218]
 [1.15450362]
 [1.06801045]
 [0.71338845]] --&gt; [1.35776256]
shape: (5, 1) --&gt; (1,)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-38-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>indice range: 0 4 --&gt; 5
[[-0.17316653]
 [-0.52346387]
 [-0.64455431]
 [-0.66185294]
 [-0.7180735 ]] --&gt; [-0.19478983]
shape: (5, 1) --&gt; (1,)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-38-output-6.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>indice range: 1 5 --&gt; 6
[[-0.19478983]
 [-0.17316653]
 [-0.52346387]
 [-0.64455431]
 [-0.66185294]] --&gt; [-0.59698306]
shape: (5, 1) --&gt; (1,)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-38-output-8.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>training: (157, 5, 1) (157, 1)
validation: (49, 5, 1) (49, 1)</code></pre>
</div>
</div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<div class="cell" data-outputid="953ccea8-8733-4022-9934-443abedd7a4f" data-execution_count="40">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>L<span class="op">=</span><span class="dv">4</span><span class="op">;</span> S<span class="op">=</span><span class="dv">1</span><span class="op">;</span> D<span class="op">=</span><span class="dv">1</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>Xt_consump,Yt_consump<span class="op">=</span>form_arrays(xt_consump,lookback<span class="op">=</span>L,delay<span class="op">=</span>D,step<span class="op">=</span>S,feature_columns<span class="op">=</span>feature_columns_consump,target_columns<span class="op">=</span>target_columns_consump,unique<span class="op">=</span><span class="va">False</span>,verbose<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="co"># validation</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>Xv_consump,Yv_consump<span class="op">=</span>form_arrays(xv_consump,lookback<span class="op">=</span>L,delay<span class="op">=</span>D,step<span class="op">=</span>S,feature_columns<span class="op">=</span>feature_columns_consump,target_columns<span class="op">=</span>target_columns_consump,unique<span class="op">=</span><span class="va">False</span>,verbose<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"training:"</span>,Xt_consump.shape,Yt_consump.shape)</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"validation:"</span>,Xv_consump.shape,Yv_consump.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>indice range: 0 4 --&gt; 5
[[-1.43677685e+00]
 [-1.01144131e+00]
 [-1.48583565e-04]
 [ 7.80761951e-02]
 [ 7.48623565e-01]] --&gt; [-1.41257488]
shape: (5, 1) --&gt; (1,)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-39-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>indice range: 1 5 --&gt; 6
[[-1.41257488e+00]
 [-1.43677685e+00]
 [-1.01144131e+00]
 [-1.48583565e-04]
 [ 7.80761951e-02]] --&gt; [-1.09191406]
shape: (5, 1) --&gt; (1,)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-39-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>indice range: 0 4 --&gt; 5
[[ 1.07264267]
 [ 0.16822216]
 [-0.10471185]
 [ 0.22706476]
 [ 0.30462503]] --&gt; [1.66895021]
shape: (5, 1) --&gt; (1,)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-39-output-6.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>indice range: 1 5 --&gt; 6
[[ 1.66895021]
 [ 1.07264267]
 [ 0.16822216]
 [-0.10471185]
 [ 0.22706476]] --&gt; [2.5622339]
shape: (5, 1) --&gt; (1,)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-39-output-8.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>training: (157, 5, 1) (157, 1)
validation: (49, 5, 1) (49, 1)</code></pre>
</div>
</div>
</div>
<div id="tabset-5-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-3-tab">
<div class="cell" data-outputid="8149ac45-3060-4e53-f910-cf76fb433ffd" data-execution_count="41">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>L<span class="op">=</span><span class="dv">4</span><span class="op">;</span> S<span class="op">=</span><span class="dv">1</span><span class="op">;</span> D<span class="op">=</span><span class="dv">1</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>Xt_prod,Yt_prod<span class="op">=</span>form_arrays(xt_prod,lookback<span class="op">=</span>L,delay<span class="op">=</span>D,step<span class="op">=</span>S,feature_columns<span class="op">=</span>feature_columns_prod,target_columns<span class="op">=</span>target_columns_prod,unique<span class="op">=</span><span class="va">False</span>,verbose<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="co"># validation</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>Xv_prod,Yv_prod<span class="op">=</span>form_arrays(xv_prod,lookback<span class="op">=</span>L,delay<span class="op">=</span>D,step<span class="op">=</span>S,feature_columns<span class="op">=</span>feature_columns_prod,target_columns<span class="op">=</span>target_columns_prod,unique<span class="op">=</span><span class="va">False</span>,verbose<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"training:"</span>,Xt_prod.shape,Yt_prod.shape)</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"validation:"</span>,Xv_prod.shape,Yv_prod.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>indice range: 0 4 --&gt; 5
[[-1.1702813 ]
 [-1.2273701 ]
 [-1.04221774]
 [-1.4269967 ]
 [-1.12554455]] --&gt; [-1.23928047]
shape: (5, 1) --&gt; (1,)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-40-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>indice range: 1 5 --&gt; 6
[[-1.23928047]
 [-1.1702813 ]
 [-1.2273701 ]
 [-1.04221774]
 [-1.4269967 ]] --&gt; [-1.21881347]
shape: (5, 1) --&gt; (1,)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-40-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>indice range: 0 4 --&gt; 5
[[1.11922115]
 [1.21958425]
 [0.92508149]
 [1.02074385]
 [0.89624295]] --&gt; [1.36032606]
shape: (5, 1) --&gt; (1,)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-40-output-6.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>indice range: 1 5 --&gt; 6
[[1.36032606]
 [1.11922115]
 [1.21958425]
 [0.92508149]
 [1.02074385]] --&gt; [1.33331651]
shape: (5, 1) --&gt; (1,)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-40-output-8.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>training: (157, 5, 1) (157, 1)
validation: (49, 5, 1) (49, 1)</code></pre>
</div>
</div>
</div>
<div id="tabset-5-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-4-tab">
<div class="cell" data-outputid="e1ee2422-14ea-476e-86ff-172cf16083e7" data-execution_count="42">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>L<span class="op">=</span><span class="dv">4</span><span class="op">;</span> S<span class="op">=</span><span class="dv">1</span><span class="op">;</span> D<span class="op">=</span><span class="dv">1</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>Xt_imp,Yt_imp<span class="op">=</span>form_arrays(xt_imp,lookback<span class="op">=</span>L,delay<span class="op">=</span>D,step<span class="op">=</span>S,feature_columns<span class="op">=</span>feature_columns_imp,target_columns<span class="op">=</span>target_columns_imp,unique<span class="op">=</span><span class="va">False</span>,verbose<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="co"># validation</span></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>Xv_imp,Yv_imp<span class="op">=</span>form_arrays(xv_imp,lookback<span class="op">=</span>L,delay<span class="op">=</span>D,step<span class="op">=</span>S,feature_columns<span class="op">=</span>feature_columns_imp,target_columns<span class="op">=</span>target_columns_imp,unique<span class="op">=</span><span class="va">False</span>,verbose<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"training:"</span>,Xt_imp.shape,Yt_imp.shape)</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"validation:"</span>,Xv_imp.shape,Yv_imp.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>indice range: 0 4 --&gt; 5
[[-0.81519714]
 [-0.88043638]
 [-0.53520443]
 [-0.83698639]
 [-0.14415448]] --&gt; [-0.99167718]
shape: (5, 1) --&gt; (1,)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-41-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>indice range: 1 5 --&gt; 6
[[-0.99167718]
 [-0.81519714]
 [-0.88043638]
 [-0.53520443]
 [-0.83698639]] --&gt; [-0.92788811]
shape: (5, 1) --&gt; (1,)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-41-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>indice range: 0 4 --&gt; 5
[[-1.01139213]
 [-1.00395772]
 [-0.87469078]
 [-0.4434583 ]
 [-0.3876727 ]] --&gt; [-0.09820799]
shape: (5, 1) --&gt; (1,)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-41-output-6.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>indice range: 1 5 --&gt; 6
[[-0.09820799]
 [-1.01139213]
 [-1.00395772]
 [-0.87469078]
 [-0.4434583 ]] --&gt; [0.10123611]
shape: (5, 1) --&gt; (1,)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-41-output-8.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>training: (229, 5, 1) (229, 1)
validation: (73, 5, 1) (73, 1)</code></pre>
</div>
</div>
</div>
<div id="tabset-5-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-5-tab">
<div class="cell" data-outputid="8cb91f83-220e-4a51-a3f3-425b9433825c" data-execution_count="43">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>L<span class="op">=</span><span class="dv">4</span><span class="op">;</span> S<span class="op">=</span><span class="dv">1</span><span class="op">;</span> D<span class="op">=</span><span class="dv">1</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>Xt_exp,Yt_exp<span class="op">=</span>form_arrays(xt_exp,lookback<span class="op">=</span>L,delay<span class="op">=</span>D,step<span class="op">=</span>S,feature_columns<span class="op">=</span>feature_columns_exp,target_columns<span class="op">=</span>target_columns_exp,unique<span class="op">=</span><span class="va">False</span>,verbose<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="co"># validation</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>Xv_exp,Yv_exp<span class="op">=</span>form_arrays(xv_exp,lookback<span class="op">=</span>L,delay<span class="op">=</span>D,step<span class="op">=</span>S,feature_columns<span class="op">=</span>feature_columns_exp,target_columns<span class="op">=</span>target_columns_exp,unique<span class="op">=</span><span class="va">False</span>,verbose<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"training:"</span>,Xt_exp.shape,Yt_exp.shape)</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"validation:"</span>,Xv_exp.shape,Yv_exp.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>indice range: 0 4 --&gt; 5
[[-0.90925709]
 [-0.88599358]
 [-0.87117889]
 [-0.89479982]
 [-0.89735727]] --&gt; [-0.91276973]
shape: (5, 1) --&gt; (1,)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-42-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>indice range: 1 5 --&gt; 6
[[-0.91276973]
 [-0.90925709]
 [-0.88599358]
 [-0.87117889]
 [-0.89479982]] --&gt; [-0.90901675]
shape: (5, 1) --&gt; (1,)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-42-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>indice range: 0 4 --&gt; 5
[[0.43307505]
 [0.11599498]
 [0.27326245]
 [0.34869168]
 [0.1912763 ]] --&gt; [0.57430149]
shape: (5, 1) --&gt; (1,)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-42-output-6.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>indice range: 1 5 --&gt; 6
[[0.57430149]
 [0.43307505]
 [0.11599498]
 [0.27326245]
 [0.34869168]] --&gt; [0.69215349]
shape: (5, 1) --&gt; (1,)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-42-output-8.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>training: (229, 5, 1) (229, 1)
validation: (73, 5, 1) (73, 1)</code></pre>
</div>
</div>
</div>
<div id="tabset-5-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-6-tab">
<div class="cell" data-outputid="ce258fdf-b92d-4601-c514-89bb3847b229" data-execution_count="44">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>L<span class="op">=</span><span class="dv">4</span><span class="op">;</span> S<span class="op">=</span><span class="dv">1</span><span class="op">;</span> D<span class="op">=</span><span class="dv">1</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>Xt_stk,Yt_stk<span class="op">=</span>form_arrays(xt_stk,lookback<span class="op">=</span>L,delay<span class="op">=</span>D,step<span class="op">=</span>S,feature_columns<span class="op">=</span>feature_columns_stk,target_columns<span class="op">=</span>target_columns_stk,unique<span class="op">=</span><span class="va">False</span>,verbose<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a><span class="co"># validation</span></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>Xv_stk,Yv_stk<span class="op">=</span>form_arrays(xv_stk,lookback<span class="op">=</span>L,delay<span class="op">=</span>D,step<span class="op">=</span>S,feature_columns<span class="op">=</span>feature_columns_stk,target_columns<span class="op">=</span>target_columns_stk,unique<span class="op">=</span><span class="va">False</span>,verbose<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"training:"</span>,Xt_stk.shape,Yt_stk.shape)</span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"validation:"</span>,Xv_stk.shape,Yv_stk.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>indice range: 0 4 --&gt; 5
[[-1.54942093]
 [-1.53950359]
 [-1.55403739]
 [-1.55967994]
 [-1.55369545]] --&gt; [-1.54548849]
shape: (5, 1) --&gt; (1,)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-43-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>indice range: 1 5 --&gt; 6
[[-1.54548849]
 [-1.54942093]
 [-1.53950359]
 [-1.55403739]
 [-1.55967994]] --&gt; [-1.54514621]
shape: (5, 1) --&gt; (1,)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-43-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>indice range: 0 4 --&gt; 5
[[0.97752522]
 [1.04526005]
 [1.06061717]
 [1.06089093]
 [1.0740536 ]] --&gt; [1.030451]
shape: (5, 1) --&gt; (1,)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-43-output-6.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>indice range: 1 5 --&gt; 6
[[1.030451  ]
 [0.97752522]
 [1.04526005]
 [1.06061717]
 [1.06089093]] --&gt; [1.01866013]
shape: (5, 1) --&gt; (1,)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-43-output-8.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>training: (3377, 5, 1) (3377, 1)
validation: (1123, 5, 1) (1123, 1)</code></pre>
</div>
</div>
</div>
<div id="tabset-5-7" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-7-tab">
<div class="cell" data-outputid="9ae9336e-0ab2-41c9-88dc-7f054e1f8a31" data-execution_count="45">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>L<span class="op">=</span><span class="dv">4</span><span class="op">;</span> S<span class="op">=</span><span class="dv">1</span><span class="op">;</span> D<span class="op">=</span><span class="dv">1</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>Xt_emissions,Yt_emissions<span class="op">=</span>form_arrays(xt_emissions,lookback<span class="op">=</span>L,delay<span class="op">=</span>D,step<span class="op">=</span>S,feature_columns<span class="op">=</span>feature_columns_emissions,target_columns<span class="op">=</span>target_columns_emissions,unique<span class="op">=</span><span class="va">False</span>,verbose<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a><span class="co"># validation</span></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>Xv_emissions,Yv_emissions<span class="op">=</span>form_arrays(xv_emissions,lookback<span class="op">=</span>L,delay<span class="op">=</span>D,step<span class="op">=</span>S,feature_columns<span class="op">=</span>feature_columns_emissions,target_columns<span class="op">=</span>target_columns_emissions,unique<span class="op">=</span><span class="va">False</span>,verbose<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"training:"</span>,Xt_emissions.shape,Yt_emissions.shape)</span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"validation:"</span>,Xv_emissions.shape,Yv_emissions.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>indice range: 0 4 --&gt; 5
[[-0.34947117]
 [-0.33473844]
 [-0.29320189]
 [-0.25213225]
 [-0.22136124]] --&gt; [-0.36881048]
shape: (5, 1) --&gt; (1,)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-44-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>indice range: 1 5 --&gt; 6
[[-0.36881048]
 [-0.34947117]
 [-0.33473844]
 [-0.29320189]
 [-0.25213225]] --&gt; [-0.3599988]
shape: (5, 1) --&gt; (1,)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-44-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>indice range: 0 4 --&gt; 5
[[-0.17532518]
 [-0.18899325]
 [-0.0868485 ]
 [ 3.74965096]
 [-0.12675237]] --&gt; [-0.24779927]
shape: (5, 1) --&gt; (1,)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-44-output-6.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>indice range: 1 5 --&gt; 6
[[-0.24779927]
 [-0.17532518]
 [-0.18899325]
 [-0.0868485 ]
 [ 3.74965096]] --&gt; [-0.29592599]
shape: (5, 1) --&gt; (1,)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-44-output-8.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>training: (227, 5, 1) (227, 1)
validation: (73, 5, 1) (73, 1)</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="utility-function" class="level2">
<h2 class="anchored" data-anchor-id="utility-function">Utility function</h2>
<p>Function for reporting results</p>
<div class="cell" data-execution_count="46">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> (</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>    mean_squared_error,</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>    mean_absolute_percentage_error,</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>    mean_absolute_error,</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a><span class="co"># UTILITY FUNCTION</span></span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> regression_report(yt, ytp, yv, yvp):</span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"---------- Regression report ----------"</span>)</span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"TRAINING:"</span>)</span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">" MSE:"</span>, mean_squared_error(yt, ytp))</span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">" MAE:"</span>, mean_absolute_error(yt, ytp))</span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(" MAPE:",mean_absolute_percentage_error(Yt,Ytp))</span></span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-17"><a href="#cb95-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># PARITY PLOT</span></span>
<span id="cb95-18"><a href="#cb95-18" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb95-19"><a href="#cb95-19" aria-hidden="true" tabindex="-1"></a>    ax.plot(yt, ytp, <span class="st">"ro"</span>)</span>
<span id="cb95-20"><a href="#cb95-20" aria-hidden="true" tabindex="-1"></a>    ax.plot(yt, yt, <span class="st">"b-"</span>)</span>
<span id="cb95-21"><a href="#cb95-21" aria-hidden="true" tabindex="-1"></a>    ax.<span class="bu">set</span>(</span>
<span id="cb95-22"><a href="#cb95-22" aria-hidden="true" tabindex="-1"></a>        xlabel<span class="op">=</span><span class="st">"y_data"</span>,</span>
<span id="cb95-23"><a href="#cb95-23" aria-hidden="true" tabindex="-1"></a>        ylabel<span class="op">=</span><span class="st">"y_predicted"</span>,</span>
<span id="cb95-24"><a href="#cb95-24" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">"Training data parity plot (line y=x represents a perfect fit)"</span>,</span>
<span id="cb95-25"><a href="#cb95-25" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb95-26"><a href="#cb95-26" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb95-27"><a href="#cb95-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-28"><a href="#cb95-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># PLOT PART OF THE PREDICTED TIME-SERIES</span></span>
<span id="cb95-29"><a href="#cb95-29" aria-hidden="true" tabindex="-1"></a>    frac_plot <span class="op">=</span> <span class="fl">1.0</span></span>
<span id="cb95-30"><a href="#cb95-30" aria-hidden="true" tabindex="-1"></a>    upper <span class="op">=</span> <span class="bu">int</span>(frac_plot <span class="op">*</span> yt.shape[<span class="dv">0</span>])</span>
<span id="cb95-31"><a href="#cb95-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(int(0.5*yt.shape[0]))</span></span>
<span id="cb95-32"><a href="#cb95-32" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb95-33"><a href="#cb95-33" aria-hidden="true" tabindex="-1"></a>    ax.plot(yt[<span class="dv">0</span>:upper], <span class="st">"b-"</span>)</span>
<span id="cb95-34"><a href="#cb95-34" aria-hidden="true" tabindex="-1"></a>    ax.plot(ytp[<span class="dv">0</span>:upper], <span class="st">"r-"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb95-35"><a href="#cb95-35" aria-hidden="true" tabindex="-1"></a>    ax.plot(ytp[<span class="dv">0</span>:upper], <span class="st">"ro"</span>, alpha<span class="op">=</span><span class="fl">0.25</span>)</span>
<span id="cb95-36"><a href="#cb95-36" aria-hidden="true" tabindex="-1"></a>    ax.<span class="bu">set</span>(</span>
<span id="cb95-37"><a href="#cb95-37" aria-hidden="true" tabindex="-1"></a>        xlabel<span class="op">=</span><span class="st">"index"</span>,</span>
<span id="cb95-38"><a href="#cb95-38" aria-hidden="true" tabindex="-1"></a>        ylabel<span class="op">=</span><span class="st">"y(t (blue=actual &amp; red=prediction)"</span>,</span>
<span id="cb95-39"><a href="#cb95-39" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">"Training: Time-series prediction"</span>,</span>
<span id="cb95-40"><a href="#cb95-40" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb95-41"><a href="#cb95-41" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb95-42"><a href="#cb95-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-43"><a href="#cb95-43" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"VALIDATION:"</span>)</span>
<span id="cb95-44"><a href="#cb95-44" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">" MSE:"</span>, mean_squared_error(yv, yvp))</span>
<span id="cb95-45"><a href="#cb95-45" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">" MAE:"</span>, mean_absolute_error(yv, yvp))</span>
<span id="cb95-46"><a href="#cb95-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(" MAPE:",mean_absolute_percentage_error(Yt,Ytp))</span></span>
<span id="cb95-47"><a href="#cb95-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-48"><a href="#cb95-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># PARITY PLOT</span></span>
<span id="cb95-49"><a href="#cb95-49" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb95-50"><a href="#cb95-50" aria-hidden="true" tabindex="-1"></a>    ax.plot(yv, yvp, <span class="st">"ro"</span>)</span>
<span id="cb95-51"><a href="#cb95-51" aria-hidden="true" tabindex="-1"></a>    ax.plot(yv, yv, <span class="st">"b-"</span>)</span>
<span id="cb95-52"><a href="#cb95-52" aria-hidden="true" tabindex="-1"></a>    ax.<span class="bu">set</span>(</span>
<span id="cb95-53"><a href="#cb95-53" aria-hidden="true" tabindex="-1"></a>        xlabel<span class="op">=</span><span class="st">"y_data"</span>,</span>
<span id="cb95-54"><a href="#cb95-54" aria-hidden="true" tabindex="-1"></a>        ylabel<span class="op">=</span><span class="st">"y_predicted"</span>,</span>
<span id="cb95-55"><a href="#cb95-55" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">"Validation data parity plot (line y=x represents a perfect fit)"</span>,</span>
<span id="cb95-56"><a href="#cb95-56" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb95-57"><a href="#cb95-57" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb95-58"><a href="#cb95-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-59"><a href="#cb95-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># PLOT PART OF THE PREDICTED TIME-SERIES</span></span>
<span id="cb95-60"><a href="#cb95-60" aria-hidden="true" tabindex="-1"></a>    upper <span class="op">=</span> <span class="bu">int</span>(frac_plot <span class="op">*</span> yv.shape[<span class="dv">0</span>])</span>
<span id="cb95-61"><a href="#cb95-61" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb95-62"><a href="#cb95-62" aria-hidden="true" tabindex="-1"></a>    ax.plot(yv[<span class="dv">0</span>:upper], <span class="st">"b-"</span>)</span>
<span id="cb95-63"><a href="#cb95-63" aria-hidden="true" tabindex="-1"></a>    ax.plot(yvp[<span class="dv">0</span>:upper], <span class="st">"r-"</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb95-64"><a href="#cb95-64" aria-hidden="true" tabindex="-1"></a>    ax.plot(yvp[<span class="dv">0</span>:upper], <span class="st">"ro"</span>, alpha<span class="op">=</span><span class="fl">0.25</span>)</span>
<span id="cb95-65"><a href="#cb95-65" aria-hidden="true" tabindex="-1"></a>    ax.<span class="bu">set</span>(</span>
<span id="cb95-66"><a href="#cb95-66" aria-hidden="true" tabindex="-1"></a>        xlabel<span class="op">=</span><span class="st">"index"</span>,</span>
<span id="cb95-67"><a href="#cb95-67" aria-hidden="true" tabindex="-1"></a>        ylabel<span class="op">=</span><span class="st">"y(t) (blue=actual &amp; red=prediction)"</span>,</span>
<span id="cb95-68"><a href="#cb95-68" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">"Validation: Time-series prediction"</span>,</span>
<span id="cb95-69"><a href="#cb95-69" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb95-70"><a href="#cb95-70" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb95-71"><a href="#cb95-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-72"><a href="#cb95-72" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> history_plot(history):</span>
<span id="cb95-73"><a href="#cb95-73" aria-hidden="true" tabindex="-1"></a>    FS<span class="op">=</span><span class="dv">18</span>   <span class="co">#FONT SIZE</span></span>
<span id="cb95-74"><a href="#cb95-74" aria-hidden="true" tabindex="-1"></a>    <span class="co"># PLOTTING THE TRAINING AND VALIDATION LOSS</span></span>
<span id="cb95-75"><a href="#cb95-75" aria-hidden="true" tabindex="-1"></a>    history_dict <span class="op">=</span> history.history</span>
<span id="cb95-76"><a href="#cb95-76" aria-hidden="true" tabindex="-1"></a>    loss_values <span class="op">=</span> history_dict[<span class="st">"loss"</span>]</span>
<span id="cb95-77"><a href="#cb95-77" aria-hidden="true" tabindex="-1"></a>    val_loss_values <span class="op">=</span> history_dict[<span class="st">"val_loss"</span>]</span>
<span id="cb95-78"><a href="#cb95-78" aria-hidden="true" tabindex="-1"></a>    epochs <span class="op">=</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(loss_values) <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb95-79"><a href="#cb95-79" aria-hidden="true" tabindex="-1"></a>    plt.plot(epochs, loss_values, <span class="st">"bo"</span>, label<span class="op">=</span><span class="st">"Training loss"</span>)</span>
<span id="cb95-80"><a href="#cb95-80" aria-hidden="true" tabindex="-1"></a>    plt.plot(epochs, val_loss_values, <span class="st">"b"</span>, label<span class="op">=</span><span class="st">"Validation loss"</span>)</span>
<span id="cb95-81"><a href="#cb95-81" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">"Training and validation loss"</span>)</span>
<span id="cb95-82"><a href="#cb95-82" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">"Epochs"</span>)</span>
<span id="cb95-83"><a href="#cb95-83" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">"Loss"</span>)</span>
<span id="cb95-84"><a href="#cb95-84" aria-hidden="true" tabindex="-1"></a>    plt.legend()</span>
<span id="cb95-85"><a href="#cb95-85" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="reshape" class="level2">
<h2 class="anchored" data-anchor-id="reshape">Reshape</h2>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true">Prices</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false">Consumption</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-3" role="tab" aria-controls="tabset-6-3" aria-selected="false">Production</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-4" role="tab" aria-controls="tabset-6-4" aria-selected="false">Imports</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-5" role="tab" aria-controls="tabset-6-5" aria-selected="false">Exports</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-6" role="tab" aria-controls="tabset-6-6" aria-selected="false">CVX Stocks</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-7-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-7" role="tab" aria-controls="tabset-6-7" aria-selected="false">CO2 Emissions</a></li></ul>
<div class="tab-content">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<div class="cell" data-outputid="91cb5d53-a8d6-4abf-880b-b845d9c6eacc" data-execution_count="47">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"---------- Data setup ----------"</span>)</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="co"># RECALL</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"training:"</span>, Xt.shape, Yt.shape)</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"validation:"</span>, Xv.shape, Yv.shape)</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a><span class="co"># RESHAPE INTO A DATA FRAME</span></span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>Xt1 <span class="op">=</span> Xt.reshape(Xt.shape[<span class="dv">0</span>], Xt.shape[<span class="dv">1</span>] <span class="op">*</span> Xt.shape[<span class="dv">2</span>])</span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>Xv1 <span class="op">=</span> Xv.reshape(Xv.shape[<span class="dv">0</span>], Xv.shape[<span class="dv">1</span>] <span class="op">*</span> Xv.shape[<span class="dv">2</span>])</span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW SIZES</span></span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xt1.shape, <span class="st">"--&gt;"</span>, Yt.shape)</span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xv1.shape, <span class="st">"--&gt;"</span>, Yv.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>---------- Data setup ----------
training: (157, 5, 1) (157, 1)
validation: (49, 5, 1) (49, 1)
(157, 5) --&gt; (157, 1)
(49, 5) --&gt; (49, 1)</code></pre>
</div>
</div>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<div class="cell" data-outputid="7a155acf-dc49-4b0a-9a91-70a8b69784d1" data-execution_count="48">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"---------- Data setup ----------"</span>)</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="co"># RECALL</span></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"training:"</span>, Xt_consump.shape, Yt_consump.shape)</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"validation:"</span>, Xv_consump.shape, Yv_consump.shape)</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a><span class="co"># RESHAPE INTO A DATA FRAME</span></span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>Xt1_consump <span class="op">=</span> Xt_consump.reshape(Xt_consump.shape[<span class="dv">0</span>], Xt_consump.shape[<span class="dv">1</span>] <span class="op">*</span> Xt_consump.shape[<span class="dv">2</span>])</span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>Xv1_consump <span class="op">=</span> Xv_consump.reshape(Xv_consump.shape[<span class="dv">0</span>], Xv_consump.shape[<span class="dv">1</span>] <span class="op">*</span> Xv_consump.shape[<span class="dv">2</span>])</span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW SIZES</span></span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xt1_consump.shape, <span class="st">"--&gt;"</span>, Yt_consump.shape)</span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xv1_consump.shape, <span class="st">"--&gt;"</span>, Yv_consump.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>---------- Data setup ----------
training: (157, 5, 1) (157, 1)
validation: (49, 5, 1) (49, 1)
(157, 5) --&gt; (157, 1)
(49, 5) --&gt; (49, 1)</code></pre>
</div>
</div>
</div>
<div id="tabset-6-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-3-tab">
<div class="cell" data-outputid="08a49c6b-2753-4bd0-ee23-9e050ed4834b" data-execution_count="49">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"---------- Data setup ----------"</span>)</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="co"># RECALL</span></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"training:"</span>, Xt_prod.shape, Yt_prod.shape)</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"validation:"</span>, Xv_prod.shape, Yv_prod.shape)</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a><span class="co"># RESHAPE INTO A DATA FRAME</span></span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>Xt1_prod <span class="op">=</span> Xt_prod.reshape(Xt_prod.shape[<span class="dv">0</span>], Xt_prod.shape[<span class="dv">1</span>] <span class="op">*</span> Xt_prod.shape[<span class="dv">2</span>])</span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>Xv1_prod <span class="op">=</span> Xv_prod.reshape(Xv_prod.shape[<span class="dv">0</span>], Xv_prod.shape[<span class="dv">1</span>] <span class="op">*</span> Xv_prod.shape[<span class="dv">2</span>])</span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW SIZES</span></span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xt1_prod.shape, <span class="st">"--&gt;"</span>, Yt_prod.shape)</span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xv1_prod.shape, <span class="st">"--&gt;"</span>, Yv_prod.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>---------- Data setup ----------
training: (157, 5, 1) (157, 1)
validation: (49, 5, 1) (49, 1)
(157, 5) --&gt; (157, 1)
(49, 5) --&gt; (49, 1)</code></pre>
</div>
</div>
</div>
<div id="tabset-6-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-4-tab">
<div class="cell" data-outputid="51f84c00-8a44-443d-e3d1-fb6157f1ceaa" data-execution_count="50">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"---------- Data setup ----------"</span>)</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a><span class="co"># RECALL</span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"training:"</span>, Xt_imp.shape, Yt_imp.shape)</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"validation:"</span>, Xv_imp.shape, Yv_imp.shape)</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a><span class="co"># RESHAPE INTO A DATA FRAME</span></span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>Xt1_imp <span class="op">=</span> Xt_imp.reshape(Xt_imp.shape[<span class="dv">0</span>], Xt_imp.shape[<span class="dv">1</span>] <span class="op">*</span> Xt_imp.shape[<span class="dv">2</span>])</span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>Xv1_imp <span class="op">=</span> Xv_imp.reshape(Xv_imp.shape[<span class="dv">0</span>], Xv_imp.shape[<span class="dv">1</span>] <span class="op">*</span> Xv_imp.shape[<span class="dv">2</span>])</span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW SIZES</span></span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xt1_imp.shape, <span class="st">"--&gt;"</span>, Yt_imp.shape)</span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xv1_imp.shape, <span class="st">"--&gt;"</span>, Yv_imp.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>---------- Data setup ----------
training: (229, 5, 1) (229, 1)
validation: (73, 5, 1) (73, 1)
(229, 5) --&gt; (229, 1)
(73, 5) --&gt; (73, 1)</code></pre>
</div>
</div>
</div>
<div id="tabset-6-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-5-tab">
<div class="cell" data-outputid="2888c3d2-7a14-4966-d176-42a20afe2773" data-execution_count="51">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"---------- Data setup ----------"</span>)</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="co"># RECALL</span></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"training:"</span>, Xt_exp.shape, Yt_exp.shape)</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"validation:"</span>, Xv_exp.shape, Yv_exp.shape)</span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a><span class="co"># RESHAPE INTO A DATA FRAME</span></span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>Xt1_exp <span class="op">=</span> Xt_exp.reshape(Xt_exp.shape[<span class="dv">0</span>], Xt_exp.shape[<span class="dv">1</span>] <span class="op">*</span> Xt_exp.shape[<span class="dv">2</span>])</span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>Xv1_exp <span class="op">=</span> Xv_exp.reshape(Xv_exp.shape[<span class="dv">0</span>], Xv_exp.shape[<span class="dv">1</span>] <span class="op">*</span> Xv_exp.shape[<span class="dv">2</span>])</span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW SIZES</span></span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xt1_exp.shape, <span class="st">"--&gt;"</span>, Yt_exp.shape)</span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xv1_exp.shape, <span class="st">"--&gt;"</span>, Yv_exp.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>---------- Data setup ----------
training: (229, 5, 1) (229, 1)
validation: (73, 5, 1) (73, 1)
(229, 5) --&gt; (229, 1)
(73, 5) --&gt; (73, 1)</code></pre>
</div>
</div>
</div>
<div id="tabset-6-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-6-tab">
<div class="cell" data-outputid="21c7328d-ffad-4b3a-a668-6c27a7a73521" data-execution_count="52">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"---------- Data setup ----------"</span>)</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a><span class="co"># RECALL</span></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"training:"</span>, Xt_stk.shape, Yt_stk.shape)</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"validation:"</span>, Xv_stk.shape, Yv_stk.shape)</span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a><span class="co"># RESHAPE INTO A DATA FRAME</span></span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>Xt1_stk <span class="op">=</span> Xt_stk.reshape(Xt_stk.shape[<span class="dv">0</span>], Xt_stk.shape[<span class="dv">1</span>] <span class="op">*</span> Xt_stk.shape[<span class="dv">2</span>])</span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>Xv1_stk <span class="op">=</span> Xv_stk.reshape(Xv_stk.shape[<span class="dv">0</span>], Xv_stk.shape[<span class="dv">1</span>] <span class="op">*</span> Xv_stk.shape[<span class="dv">2</span>])</span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW SIZES</span></span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xt1_stk.shape, <span class="st">"--&gt;"</span>, Yt_stk.shape)</span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xv1_stk.shape, <span class="st">"--&gt;"</span>, Yv_stk.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>---------- Data setup ----------
training: (3377, 5, 1) (3377, 1)
validation: (1123, 5, 1) (1123, 1)
(3377, 5) --&gt; (3377, 1)
(1123, 5) --&gt; (1123, 1)</code></pre>
</div>
</div>
</div>
<div id="tabset-6-7" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-7-tab">
<div class="cell" data-outputid="d270ad30-d25a-4a18-a272-40ecd5dfc5d4" data-execution_count="53">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"---------- Data setup ----------"</span>)</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="co"># RECALL</span></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"training:"</span>, Xt_emissions.shape, Yt_emissions.shape)</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"validation:"</span>, Xv_emissions.shape, Yv_emissions.shape)</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a><span class="co"># RESHAPE INTO A DATA FRAME</span></span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>Xt1_emissions <span class="op">=</span> Xt_emissions.reshape(Xt_emissions.shape[<span class="dv">0</span>], Xt_emissions.shape[<span class="dv">1</span>] <span class="op">*</span> Xt_emissions.shape[<span class="dv">2</span>])</span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a>Xv1_emissions <span class="op">=</span> Xv_emissions.reshape(Xv_emissions.shape[<span class="dv">0</span>], Xv_emissions.shape[<span class="dv">1</span>] <span class="op">*</span> Xv_emissions.shape[<span class="dv">2</span>])</span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW SIZES</span></span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xt1_emissions.shape, <span class="st">"--&gt;"</span>, Yt_emissions.shape)</span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xv1_emissions.shape, <span class="st">"--&gt;"</span>, Yv_emissions.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>---------- Data setup ----------
training: (227, 5, 1) (227, 1)
validation: (73, 5, 1) (73, 1)
(227, 5) --&gt; (227, 1)
(73, 5) --&gt; (73, 1)</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="rnn" class="level2">
<h2 class="anchored" data-anchor-id="rnn">RNN</h2>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-7-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-1" role="tab" aria-controls="tabset-7-1" aria-selected="true">Prices</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-2" role="tab" aria-controls="tabset-7-2" aria-selected="false">Consumption</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-3" role="tab" aria-controls="tabset-7-3" aria-selected="false">Production</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-4" role="tab" aria-controls="tabset-7-4" aria-selected="false">Imports</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-5" role="tab" aria-controls="tabset-7-5" aria-selected="false">Exports</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-6" role="tab" aria-controls="tabset-7-6" aria-selected="false">CVX Stocks</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-7-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-7" role="tab" aria-controls="tabset-7-7" aria-selected="false">CO2 Emissions</a></li></ul>
<div class="tab-content">
<div id="tabset-7-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-7-1-tab">
<div class="cell" data-outputid="03e7d929-6851-4f5e-f7cd-1e4cda35c7ba" data-execution_count="54">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW SIZES</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xt.shape, <span class="st">"--&gt;"</span>, Yt.shape)</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xv.shape, <span class="st">"--&gt;"</span>, Yv.shape)</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a><span class="co"># HYPERPARAMETERS</span></span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>optimizer<span class="op">=</span><span class="st">"rmsprop"</span></span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>loss_function<span class="op">=</span><span class="st">"MeanSquaredError"</span></span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>learning_rate<span class="op">=</span><span class="fl">0.001</span></span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a>numbers_epochs<span class="op">=</span><span class="dv">200</span> <span class="co">#100</span></span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a>L2<span class="op">=</span><span class="dv">0</span> <span class="co">#1e-4</span></span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>(Xt.shape[<span class="dv">1</span>],Xt.shape[<span class="dv">2</span>])</span>
<span id="cb110-12"><a href="#cb110-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-13"><a href="#cb110-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-14"><a href="#cb110-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ------ Choose the batch size ------</span></span>
<span id="cb110-15"><a href="#cb110-15" aria-hidden="true" tabindex="-1"></a><span class="co"># batch_size=1                       # stocastic training</span></span>
<span id="cb110-16"><a href="#cb110-16" aria-hidden="true" tabindex="-1"></a><span class="co"># # batch_size=int(len(x_train)/2.)    # mini-batch training</span></span>
<span id="cb110-17"><a href="#cb110-17" aria-hidden="true" tabindex="-1"></a>batch_size<span class="op">=</span><span class="bu">len</span>(Xt1)              <span class="co"># batch training</span></span>
<span id="cb110-18"><a href="#cb110-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-19"><a href="#cb110-19" aria-hidden="true" tabindex="-1"></a><span class="co"># BUILD MODEL</span></span>
<span id="cb110-20"><a href="#cb110-20" aria-hidden="true" tabindex="-1"></a>recurrent_hidden_units<span class="op">=</span><span class="dv">32</span></span>
<span id="cb110-21"><a href="#cb110-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-22"><a href="#cb110-22" aria-hidden="true" tabindex="-1"></a><span class="co"># CREATE MODEL</span></span>
<span id="cb110-23"><a href="#cb110-23" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> keras.Sequential()</span>
<span id="cb110-24"><a href="#cb110-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-25"><a href="#cb110-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ADD RECURRENT LAYER</span></span>
<span id="cb110-26"><a href="#cb110-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-27"><a href="#cb110-27" aria-hidden="true" tabindex="-1"></a><span class="co"># #COMMENT/UNCOMMENT TO USE RNN, LSTM,GRU</span></span>
<span id="cb110-28"><a href="#cb110-28" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(LSTM(</span></span>
<span id="cb110-29"><a href="#cb110-29" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(GRU(</span></span>
<span id="cb110-30"><a href="#cb110-30" aria-hidden="true" tabindex="-1"></a>model.add(SimpleRNN(</span>
<span id="cb110-31"><a href="#cb110-31" aria-hidden="true" tabindex="-1"></a>units<span class="op">=</span>recurrent_hidden_units,</span>
<span id="cb110-32"><a href="#cb110-32" aria-hidden="true" tabindex="-1"></a>return_sequences<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb110-33"><a href="#cb110-33" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>input_shape,</span>
<span id="cb110-34"><a href="#cb110-34" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_dropout=0.8,</span></span>
<span id="cb110-35"><a href="#cb110-35" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_regularizer=False</span></span>
<span id="cb110-36"><a href="#cb110-36" aria-hidden="true" tabindex="-1"></a>                     )</span>
<span id="cb110-37"><a href="#cb110-37" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb110-38"><a href="#cb110-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-39"><a href="#cb110-39" aria-hidden="true" tabindex="-1"></a><span class="co"># NEED TO TAKE THE OUTPUT RNN AND CONVERT TO SCALAR</span></span>
<span id="cb110-40"><a href="#cb110-40" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span><span class="st">'linear'</span>))</span>
<span id="cb110-41"><a href="#cb110-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-42"><a href="#cb110-42" aria-hidden="true" tabindex="-1"></a><span class="co"># MODEL SUMMARY</span></span>
<span id="cb110-43"><a href="#cb110-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())<span class="op">;</span> <span class="co">#print(x_train.shape,y_train.shape)</span></span>
<span id="cb110-44"><a href="#cb110-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-45"><a href="#cb110-45" aria-hidden="true" tabindex="-1"></a><span class="co"># # COMPILING THE MODEL</span></span>
<span id="cb110-46"><a href="#cb110-46" aria-hidden="true" tabindex="-1"></a>opt <span class="op">=</span> keras.optimizers.RMSprop(learning_rate<span class="op">=</span>learning_rate)</span>
<span id="cb110-47"><a href="#cb110-47" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>opt, loss<span class="op">=</span>loss_function)</span>
<span id="cb110-48"><a href="#cb110-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-49"><a href="#cb110-49" aria-hidden="true" tabindex="-1"></a><span class="co"># TRAINING YOUR MODEL</span></span>
<span id="cb110-50"><a href="#cb110-50" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(</span>
<span id="cb110-51"><a href="#cb110-51" aria-hidden="true" tabindex="-1"></a>    Xt,</span>
<span id="cb110-52"><a href="#cb110-52" aria-hidden="true" tabindex="-1"></a>    Yt,</span>
<span id="cb110-53"><a href="#cb110-53" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span>numbers_epochs,</span>
<span id="cb110-54"><a href="#cb110-54" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span>batch_size,</span>
<span id="cb110-55"><a href="#cb110-55" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb110-56"><a href="#cb110-56" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>(Xv, Yv),</span>
<span id="cb110-57"><a href="#cb110-57" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-58"><a href="#cb110-58" aria-hidden="true" tabindex="-1"></a><span class="co"># History plot</span></span>
<span id="cb110-59"><a href="#cb110-59" aria-hidden="true" tabindex="-1"></a>history_plot(history)</span>
<span id="cb110-60"><a href="#cb110-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-61"><a href="#cb110-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb110-62"><a href="#cb110-62" aria-hidden="true" tabindex="-1"></a>Ytp <span class="op">=</span> model.predict(Xt)</span>
<span id="cb110-63"><a href="#cb110-63" aria-hidden="true" tabindex="-1"></a>Yvp <span class="op">=</span> model.predict(Xv)</span>
<span id="cb110-64"><a href="#cb110-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-65"><a href="#cb110-65" aria-hidden="true" tabindex="-1"></a><span class="co"># REPORT</span></span>
<span id="cb110-66"><a href="#cb110-66" aria-hidden="true" tabindex="-1"></a>regression_report(Yt, Ytp, Yv, Yvp)</span>
<span id="cb110-67"><a href="#cb110-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-68"><a href="#cb110-68" aria-hidden="true" tabindex="-1"></a><span class="co"># compute RMSE using numpy</span></span>
<span id="cb110-69"><a href="#cb110-69" aria-hidden="true" tabindex="-1"></a>training_RMSE <span class="op">=</span> np.sqrt(mean_squared_error(Yt, Ytp))</span>
<span id="cb110-70"><a href="#cb110-70" aria-hidden="true" tabindex="-1"></a>validation_RMSE <span class="op">=</span> np.sqrt(mean_squared_error(Yv, Yvp))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(157, 5, 1) --&gt; (157, 1)
(49, 5, 1) --&gt; (49, 1)
Model: "sequential"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 simple_rnn (SimpleRNN)      (None, 32)                1088      
                                                                 
 dense (Dense)               (None, 1)                 33        
                                                                 
=================================================================
Total params: 1121 (4.38 KB)
Trainable params: 1121 (4.38 KB)
Non-trainable params: 0 (0.00 Byte)
_________________________________________________________________
None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-53-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>5/5 [==============================] - 0s 3ms/step
2/2 [==============================] - 0s 10ms/step
---------- Regression report ----------
TRAINING:
 MSE: 0.08564239257871006
 MAE: 0.2153671237872524</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-53-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-53-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>VALIDATION:
 MSE: 0.15087434726218102
 MAE: 0.28913158219267315</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-53-output-7.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-53-output-8.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Error Summary</strong></p>
<div class="cell" data-outputid="53cf52b3-f2e7-41df-9eaf-f5ecb25ad744" data-execution_count="55">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>error_table <span class="op">=</span> [[<span class="st">'Model'</span>,<span class="st">'train_MSE'</span>,<span class="st">'train_MAE'</span>,<span class="st">'train_RMSE'</span>,<span class="st">'val_MSE'</span>,<span class="st">'val_MAE'</span>,<span class="st">'val_RMSE'</span>],</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>              [<span class="st">'RNN'</span>,</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yt, Ytp),</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yt, Ytp),</span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>              training_RMSE,</span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yv, Yvp),</span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yv, Yvp),</span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a>               validation_RMSE]]</span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(error_table, headers<span class="op">=</span><span class="st">'firstrow'</span>, tablefmt<span class="op">=</span><span class="st">'fancy_grid'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>╒═════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model   │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞═════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ RNN     │   0.0856424 │    0.215367 │     0.292647 │  0.150874 │  0.289132 │   0.388425 │
╘═════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
</div>
<div id="tabset-7-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-2-tab">
<div class="cell" data-outputid="e3a84f7c-8b48-43af-948f-b0432a6df817" data-execution_count="56">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW SIZES</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xt_consump.shape, <span class="st">"--&gt;"</span>, Yt_consump.shape)</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xv_consump.shape, <span class="st">"--&gt;"</span>, Yv_consump.shape)</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a><span class="co"># HYPERPARAMETERS</span></span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>optimizer<span class="op">=</span><span class="st">"rmsprop"</span></span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>loss_function<span class="op">=</span><span class="st">"MeanSquaredError"</span></span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a>learning_rate<span class="op">=</span><span class="fl">0.001</span></span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a>numbers_epochs<span class="op">=</span><span class="dv">200</span> <span class="co">#100</span></span>
<span id="cb116-10"><a href="#cb116-10" aria-hidden="true" tabindex="-1"></a>L2<span class="op">=</span><span class="dv">0</span> <span class="co">#1e-4</span></span>
<span id="cb116-11"><a href="#cb116-11" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>(Xt_consump.shape[<span class="dv">1</span>],Xt_consump.shape[<span class="dv">2</span>])</span>
<span id="cb116-12"><a href="#cb116-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-13"><a href="#cb116-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-14"><a href="#cb116-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ------ Choose the batch size ------</span></span>
<span id="cb116-15"><a href="#cb116-15" aria-hidden="true" tabindex="-1"></a><span class="co"># batch_size=1                       # stocastic training</span></span>
<span id="cb116-16"><a href="#cb116-16" aria-hidden="true" tabindex="-1"></a><span class="co"># # batch_size=int(len(x_train)/2.)    # mini-batch training</span></span>
<span id="cb116-17"><a href="#cb116-17" aria-hidden="true" tabindex="-1"></a>batch_size<span class="op">=</span><span class="bu">len</span>(Xt1_consump)              <span class="co"># batch training</span></span>
<span id="cb116-18"><a href="#cb116-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-19"><a href="#cb116-19" aria-hidden="true" tabindex="-1"></a><span class="co"># BUILD MODEL</span></span>
<span id="cb116-20"><a href="#cb116-20" aria-hidden="true" tabindex="-1"></a>recurrent_hidden_units<span class="op">=</span><span class="dv">32</span></span>
<span id="cb116-21"><a href="#cb116-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-22"><a href="#cb116-22" aria-hidden="true" tabindex="-1"></a><span class="co"># CREATE MODEL</span></span>
<span id="cb116-23"><a href="#cb116-23" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> keras.Sequential()</span>
<span id="cb116-24"><a href="#cb116-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-25"><a href="#cb116-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ADD RECURRENT LAYER</span></span>
<span id="cb116-26"><a href="#cb116-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-27"><a href="#cb116-27" aria-hidden="true" tabindex="-1"></a><span class="co"># #COMMENT/UNCOMMENT TO USE RNN, LSTM,GRU</span></span>
<span id="cb116-28"><a href="#cb116-28" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(LSTM(</span></span>
<span id="cb116-29"><a href="#cb116-29" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(GRU(</span></span>
<span id="cb116-30"><a href="#cb116-30" aria-hidden="true" tabindex="-1"></a>model.add(SimpleRNN(</span>
<span id="cb116-31"><a href="#cb116-31" aria-hidden="true" tabindex="-1"></a>units<span class="op">=</span>recurrent_hidden_units,</span>
<span id="cb116-32"><a href="#cb116-32" aria-hidden="true" tabindex="-1"></a>return_sequences<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb116-33"><a href="#cb116-33" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>input_shape,</span>
<span id="cb116-34"><a href="#cb116-34" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_dropout=0.8,</span></span>
<span id="cb116-35"><a href="#cb116-35" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_regularizer=False</span></span>
<span id="cb116-36"><a href="#cb116-36" aria-hidden="true" tabindex="-1"></a>                     )</span>
<span id="cb116-37"><a href="#cb116-37" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb116-38"><a href="#cb116-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-39"><a href="#cb116-39" aria-hidden="true" tabindex="-1"></a><span class="co"># NEED TO TAKE THE OUTPUT RNN AND CONVERT TO SCALAR</span></span>
<span id="cb116-40"><a href="#cb116-40" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span><span class="st">'linear'</span>))</span>
<span id="cb116-41"><a href="#cb116-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-42"><a href="#cb116-42" aria-hidden="true" tabindex="-1"></a><span class="co"># MODEL SUMMARY</span></span>
<span id="cb116-43"><a href="#cb116-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())<span class="op">;</span> <span class="co">#print(x_train.shape,y_train.shape)</span></span>
<span id="cb116-44"><a href="#cb116-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-45"><a href="#cb116-45" aria-hidden="true" tabindex="-1"></a><span class="co"># # COMPILING THE MODEL</span></span>
<span id="cb116-46"><a href="#cb116-46" aria-hidden="true" tabindex="-1"></a>opt <span class="op">=</span> keras.optimizers.RMSprop(learning_rate<span class="op">=</span>learning_rate)</span>
<span id="cb116-47"><a href="#cb116-47" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>opt, loss<span class="op">=</span>loss_function)</span>
<span id="cb116-48"><a href="#cb116-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-49"><a href="#cb116-49" aria-hidden="true" tabindex="-1"></a><span class="co"># TRAINING YOUR MODEL</span></span>
<span id="cb116-50"><a href="#cb116-50" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(</span>
<span id="cb116-51"><a href="#cb116-51" aria-hidden="true" tabindex="-1"></a>    Xt_consump,</span>
<span id="cb116-52"><a href="#cb116-52" aria-hidden="true" tabindex="-1"></a>    Yt_consump,</span>
<span id="cb116-53"><a href="#cb116-53" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span>numbers_epochs,</span>
<span id="cb116-54"><a href="#cb116-54" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span>batch_size,</span>
<span id="cb116-55"><a href="#cb116-55" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb116-56"><a href="#cb116-56" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>(Xv_consump, Yv_consump),</span>
<span id="cb116-57"><a href="#cb116-57" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb116-58"><a href="#cb116-58" aria-hidden="true" tabindex="-1"></a><span class="co"># History plot</span></span>
<span id="cb116-59"><a href="#cb116-59" aria-hidden="true" tabindex="-1"></a>history_plot(history)</span>
<span id="cb116-60"><a href="#cb116-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-61"><a href="#cb116-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb116-62"><a href="#cb116-62" aria-hidden="true" tabindex="-1"></a>Ytp_consump <span class="op">=</span> model.predict(Xt_consump)</span>
<span id="cb116-63"><a href="#cb116-63" aria-hidden="true" tabindex="-1"></a>Yvp_consump <span class="op">=</span> model.predict(Xv_consump)</span>
<span id="cb116-64"><a href="#cb116-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-65"><a href="#cb116-65" aria-hidden="true" tabindex="-1"></a><span class="co"># REPORT</span></span>
<span id="cb116-66"><a href="#cb116-66" aria-hidden="true" tabindex="-1"></a>regression_report(Yt_consump, Ytp_consump, Yv_consump, Yvp_consump)</span>
<span id="cb116-67"><a href="#cb116-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-68"><a href="#cb116-68" aria-hidden="true" tabindex="-1"></a><span class="co"># compute RMSE using numpy</span></span>
<span id="cb116-69"><a href="#cb116-69" aria-hidden="true" tabindex="-1"></a>training_RMSE_consump <span class="op">=</span> np.sqrt(mean_squared_error(Yt_consump, Ytp_consump))</span>
<span id="cb116-70"><a href="#cb116-70" aria-hidden="true" tabindex="-1"></a>validation_RMSE_consump <span class="op">=</span> np.sqrt(mean_squared_error(Yv_consump, Yvp_consump))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(157, 5, 1) --&gt; (157, 1)
(49, 5, 1) --&gt; (49, 1)
Model: "sequential_1"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 simple_rnn_1 (SimpleRNN)    (None, 32)                1088      
                                                                 
 dense_1 (Dense)             (None, 1)                 33        
                                                                 
=================================================================
Total params: 1121 (4.38 KB)
Trainable params: 1121 (4.38 KB)
Non-trainable params: 0 (0.00 Byte)
_________________________________________________________________
None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-55-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>5/5 [==============================] - 0s 6ms/step
2/2 [==============================] - 0s 6ms/step
---------- Regression report ----------
TRAINING:
 MSE: 0.12364105531700466
 MAE: 0.27592941675879085</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-55-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-55-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>VALIDATION:
 MSE: 0.4220541753851497
 MAE: 0.5226954378234901</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-55-output-7.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-55-output-8.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Error Summary</strong></p>
<div class="cell" data-outputid="b684676b-b274-46a4-f309-c108eb4dc07e" data-execution_count="57">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>error_table_consump <span class="op">=</span> [[<span class="st">'Model'</span>,<span class="st">'train_MSE'</span>,<span class="st">'train_MAE'</span>,<span class="st">'train_RMSE'</span>,<span class="st">'val_MSE'</span>,<span class="st">'val_MAE'</span>,<span class="st">'val_RMSE'</span>],</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>              [<span class="st">'RNN'</span>,</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yt_consump, Ytp_consump),</span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yt_consump, Ytp_consump),</span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>              training_RMSE_consump,</span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yv_consump, Yvp_consump),</span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yv_consump, Yvp_consump),</span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a>               validation_RMSE_consump]]</span>
<span id="cb120-9"><a href="#cb120-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(error_table_consump, headers<span class="op">=</span><span class="st">'firstrow'</span>, tablefmt<span class="op">=</span><span class="st">'fancy_grid'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>╒═════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model   │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞═════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ RNN     │    0.123641 │    0.275929 │     0.351626 │  0.422054 │  0.522695 │   0.649657 │
╘═════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
</div>
<div id="tabset-7-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-3-tab">
<div class="cell" data-outputid="aaddec00-46d3-49e7-decd-42c1ada8eb02" data-execution_count="58">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW SIZES</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xt_prod.shape, <span class="st">"--&gt;"</span>, Yt_prod.shape)</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xv_prod.shape, <span class="st">"--&gt;"</span>, Yv_prod.shape)</span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a><span class="co"># HYPERPARAMETERS</span></span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a>optimizer<span class="op">=</span><span class="st">"rmsprop"</span></span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a>loss_function<span class="op">=</span><span class="st">"MeanSquaredError"</span></span>
<span id="cb122-8"><a href="#cb122-8" aria-hidden="true" tabindex="-1"></a>learning_rate<span class="op">=</span><span class="fl">0.001</span></span>
<span id="cb122-9"><a href="#cb122-9" aria-hidden="true" tabindex="-1"></a>numbers_epochs<span class="op">=</span><span class="dv">200</span> <span class="co">#100</span></span>
<span id="cb122-10"><a href="#cb122-10" aria-hidden="true" tabindex="-1"></a>L2<span class="op">=</span><span class="dv">0</span> <span class="co">#1e-4</span></span>
<span id="cb122-11"><a href="#cb122-11" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>(Xt_prod.shape[<span class="dv">1</span>],Xt_prod.shape[<span class="dv">2</span>])</span>
<span id="cb122-12"><a href="#cb122-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-13"><a href="#cb122-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-14"><a href="#cb122-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ------ Choose the batch size ------</span></span>
<span id="cb122-15"><a href="#cb122-15" aria-hidden="true" tabindex="-1"></a><span class="co"># batch_size=1                       # stocastic training</span></span>
<span id="cb122-16"><a href="#cb122-16" aria-hidden="true" tabindex="-1"></a><span class="co"># # batch_size=int(len(x_train)/2.)    # mini-batch training</span></span>
<span id="cb122-17"><a href="#cb122-17" aria-hidden="true" tabindex="-1"></a>batch_size<span class="op">=</span><span class="bu">len</span>(Xt1_prod)              <span class="co"># batch training</span></span>
<span id="cb122-18"><a href="#cb122-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-19"><a href="#cb122-19" aria-hidden="true" tabindex="-1"></a><span class="co"># BUILD MODEL</span></span>
<span id="cb122-20"><a href="#cb122-20" aria-hidden="true" tabindex="-1"></a>recurrent_hidden_units<span class="op">=</span><span class="dv">32</span></span>
<span id="cb122-21"><a href="#cb122-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-22"><a href="#cb122-22" aria-hidden="true" tabindex="-1"></a><span class="co"># CREATE MODEL</span></span>
<span id="cb122-23"><a href="#cb122-23" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> keras.Sequential()</span>
<span id="cb122-24"><a href="#cb122-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-25"><a href="#cb122-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ADD RECURRENT LAYER</span></span>
<span id="cb122-26"><a href="#cb122-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-27"><a href="#cb122-27" aria-hidden="true" tabindex="-1"></a><span class="co"># #COMMENT/UNCOMMENT TO USE RNN, LSTM,GRU</span></span>
<span id="cb122-28"><a href="#cb122-28" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(LSTM(</span></span>
<span id="cb122-29"><a href="#cb122-29" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(GRU(</span></span>
<span id="cb122-30"><a href="#cb122-30" aria-hidden="true" tabindex="-1"></a>model.add(SimpleRNN(</span>
<span id="cb122-31"><a href="#cb122-31" aria-hidden="true" tabindex="-1"></a>units<span class="op">=</span>recurrent_hidden_units,</span>
<span id="cb122-32"><a href="#cb122-32" aria-hidden="true" tabindex="-1"></a>return_sequences<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb122-33"><a href="#cb122-33" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>input_shape,</span>
<span id="cb122-34"><a href="#cb122-34" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_dropout=0.8,</span></span>
<span id="cb122-35"><a href="#cb122-35" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_regularizer=False</span></span>
<span id="cb122-36"><a href="#cb122-36" aria-hidden="true" tabindex="-1"></a>                     )</span>
<span id="cb122-37"><a href="#cb122-37" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb122-38"><a href="#cb122-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-39"><a href="#cb122-39" aria-hidden="true" tabindex="-1"></a><span class="co"># NEED TO TAKE THE OUTPUT RNN AND CONVERT TO SCALAR</span></span>
<span id="cb122-40"><a href="#cb122-40" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span><span class="st">'linear'</span>))</span>
<span id="cb122-41"><a href="#cb122-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-42"><a href="#cb122-42" aria-hidden="true" tabindex="-1"></a><span class="co"># MODEL SUMMARY</span></span>
<span id="cb122-43"><a href="#cb122-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())<span class="op">;</span> <span class="co">#print(x_train.shape,y_train.shape)</span></span>
<span id="cb122-44"><a href="#cb122-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-45"><a href="#cb122-45" aria-hidden="true" tabindex="-1"></a><span class="co"># # COMPILING THE MODEL</span></span>
<span id="cb122-46"><a href="#cb122-46" aria-hidden="true" tabindex="-1"></a>opt <span class="op">=</span> keras.optimizers.RMSprop(learning_rate<span class="op">=</span>learning_rate)</span>
<span id="cb122-47"><a href="#cb122-47" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>opt, loss<span class="op">=</span>loss_function)</span>
<span id="cb122-48"><a href="#cb122-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-49"><a href="#cb122-49" aria-hidden="true" tabindex="-1"></a><span class="co"># TRAINING YOUR MODEL</span></span>
<span id="cb122-50"><a href="#cb122-50" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(</span>
<span id="cb122-51"><a href="#cb122-51" aria-hidden="true" tabindex="-1"></a>    Xt_prod,</span>
<span id="cb122-52"><a href="#cb122-52" aria-hidden="true" tabindex="-1"></a>    Yt_prod,</span>
<span id="cb122-53"><a href="#cb122-53" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span>numbers_epochs,</span>
<span id="cb122-54"><a href="#cb122-54" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span>batch_size,</span>
<span id="cb122-55"><a href="#cb122-55" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb122-56"><a href="#cb122-56" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>(Xv_prod, Yv_prod),</span>
<span id="cb122-57"><a href="#cb122-57" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb122-58"><a href="#cb122-58" aria-hidden="true" tabindex="-1"></a><span class="co"># History plot</span></span>
<span id="cb122-59"><a href="#cb122-59" aria-hidden="true" tabindex="-1"></a>history_plot(history)</span>
<span id="cb122-60"><a href="#cb122-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-61"><a href="#cb122-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb122-62"><a href="#cb122-62" aria-hidden="true" tabindex="-1"></a>Ytp_prod <span class="op">=</span> model.predict(Xt_prod)</span>
<span id="cb122-63"><a href="#cb122-63" aria-hidden="true" tabindex="-1"></a>Yvp_prod <span class="op">=</span> model.predict(Xv_prod)</span>
<span id="cb122-64"><a href="#cb122-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-65"><a href="#cb122-65" aria-hidden="true" tabindex="-1"></a><span class="co"># REPORT</span></span>
<span id="cb122-66"><a href="#cb122-66" aria-hidden="true" tabindex="-1"></a>regression_report(Yt_prod, Ytp_prod, Yv_prod, Yvp_prod)</span>
<span id="cb122-67"><a href="#cb122-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-68"><a href="#cb122-68" aria-hidden="true" tabindex="-1"></a><span class="co"># compute RMSE using numpy</span></span>
<span id="cb122-69"><a href="#cb122-69" aria-hidden="true" tabindex="-1"></a>training_RMSE_prod <span class="op">=</span> np.sqrt(mean_squared_error(Yt_prod, Ytp_prod))</span>
<span id="cb122-70"><a href="#cb122-70" aria-hidden="true" tabindex="-1"></a>validation_RMSE_prod <span class="op">=</span> np.sqrt(mean_squared_error(Yv_prod, Yvp_prod))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(157, 5, 1) --&gt; (157, 1)
(49, 5, 1) --&gt; (49, 1)
Model: "sequential_2"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 simple_rnn_2 (SimpleRNN)    (None, 32)                1088      
                                                                 
 dense_2 (Dense)             (None, 1)                 33        
                                                                 
=================================================================
Total params: 1121 (4.38 KB)
Trainable params: 1121 (4.38 KB)
Non-trainable params: 0 (0.00 Byte)
_________________________________________________________________
None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-57-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>5/5 [==============================] - 0s 3ms/step
2/2 [==============================] - 0s 7ms/step
---------- Regression report ----------
TRAINING:
 MSE: 0.022704780666281316
 MAE: 0.11801223130892244</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-57-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-57-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>VALIDATION:
 MSE: 0.09145595200163269
 MAE: 0.2620996457905679</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-57-output-7.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-57-output-8.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Error Summary</strong></p>
<div class="cell" data-outputid="6c7de34a-b654-4479-a39f-dad78aa2a13a" data-execution_count="59">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>error_table_prod <span class="op">=</span> [[<span class="st">'Model'</span>,<span class="st">'train_MSE'</span>,<span class="st">'train_MAE'</span>,<span class="st">'train_RMSE'</span>,<span class="st">'val_MSE'</span>,<span class="st">'val_MAE'</span>,<span class="st">'val_RMSE'</span>],</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>              [<span class="st">'RNN'</span>,</span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yt_prod, Ytp_prod),</span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yt_prod, Ytp_prod),</span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>              training_RMSE_prod,</span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yv_prod, Yvp_prod),</span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yv_prod, Yvp_prod),</span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a>               validation_RMSE_prod]]</span>
<span id="cb126-9"><a href="#cb126-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(error_table_prod, headers<span class="op">=</span><span class="st">'firstrow'</span>, tablefmt<span class="op">=</span><span class="st">'fancy_grid'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>╒═════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model   │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞═════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ RNN     │   0.0227048 │    0.118012 │     0.150681 │  0.091456 │    0.2621 │   0.302417 │
╘═════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
</div>
<div id="tabset-7-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-4-tab">
<div class="cell" data-outputid="448379ef-e33e-4c23-ef09-97bbc9a1b0af" data-execution_count="60">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW SIZES</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xt_imp.shape, <span class="st">"--&gt;"</span>, Yt_imp.shape)</span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xv_imp.shape, <span class="st">"--&gt;"</span>, Yv_imp.shape)</span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a><span class="co"># HYPERPARAMETERS</span></span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>optimizer<span class="op">=</span><span class="st">"rmsprop"</span></span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a>loss_function<span class="op">=</span><span class="st">"MeanSquaredError"</span></span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a>learning_rate<span class="op">=</span><span class="fl">0.001</span></span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a>numbers_epochs<span class="op">=</span><span class="dv">200</span> <span class="co">#100</span></span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a>L2<span class="op">=</span><span class="dv">0</span> <span class="co">#1e-4</span></span>
<span id="cb128-11"><a href="#cb128-11" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>(Xt_imp.shape[<span class="dv">1</span>],Xt_imp.shape[<span class="dv">2</span>])</span>
<span id="cb128-12"><a href="#cb128-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-13"><a href="#cb128-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-14"><a href="#cb128-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ------ Choose the batch size ------</span></span>
<span id="cb128-15"><a href="#cb128-15" aria-hidden="true" tabindex="-1"></a><span class="co"># batch_size=1                       # stocastic training</span></span>
<span id="cb128-16"><a href="#cb128-16" aria-hidden="true" tabindex="-1"></a><span class="co"># # batch_size=int(len(x_train)/2.)    # mini-batch training</span></span>
<span id="cb128-17"><a href="#cb128-17" aria-hidden="true" tabindex="-1"></a>batch_size<span class="op">=</span><span class="bu">len</span>(Xt1_imp)              <span class="co"># batch training</span></span>
<span id="cb128-18"><a href="#cb128-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-19"><a href="#cb128-19" aria-hidden="true" tabindex="-1"></a><span class="co"># BUILD MODEL</span></span>
<span id="cb128-20"><a href="#cb128-20" aria-hidden="true" tabindex="-1"></a>recurrent_hidden_units<span class="op">=</span><span class="dv">32</span></span>
<span id="cb128-21"><a href="#cb128-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-22"><a href="#cb128-22" aria-hidden="true" tabindex="-1"></a><span class="co"># CREATE MODEL</span></span>
<span id="cb128-23"><a href="#cb128-23" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> keras.Sequential()</span>
<span id="cb128-24"><a href="#cb128-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-25"><a href="#cb128-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ADD RECURRENT LAYER</span></span>
<span id="cb128-26"><a href="#cb128-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-27"><a href="#cb128-27" aria-hidden="true" tabindex="-1"></a><span class="co"># #COMMENT/UNCOMMENT TO USE RNN, LSTM,GRU</span></span>
<span id="cb128-28"><a href="#cb128-28" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(LSTM(</span></span>
<span id="cb128-29"><a href="#cb128-29" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(GRU(</span></span>
<span id="cb128-30"><a href="#cb128-30" aria-hidden="true" tabindex="-1"></a>model.add(SimpleRNN(</span>
<span id="cb128-31"><a href="#cb128-31" aria-hidden="true" tabindex="-1"></a>units<span class="op">=</span>recurrent_hidden_units,</span>
<span id="cb128-32"><a href="#cb128-32" aria-hidden="true" tabindex="-1"></a>return_sequences<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb128-33"><a href="#cb128-33" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>input_shape,</span>
<span id="cb128-34"><a href="#cb128-34" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_dropout=0.8,</span></span>
<span id="cb128-35"><a href="#cb128-35" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_regularizer=False</span></span>
<span id="cb128-36"><a href="#cb128-36" aria-hidden="true" tabindex="-1"></a>                     )</span>
<span id="cb128-37"><a href="#cb128-37" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb128-38"><a href="#cb128-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-39"><a href="#cb128-39" aria-hidden="true" tabindex="-1"></a><span class="co"># NEED TO TAKE THE OUTPUT RNN AND CONVERT TO SCALAR</span></span>
<span id="cb128-40"><a href="#cb128-40" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span><span class="st">'linear'</span>))</span>
<span id="cb128-41"><a href="#cb128-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-42"><a href="#cb128-42" aria-hidden="true" tabindex="-1"></a><span class="co"># MODEL SUMMARY</span></span>
<span id="cb128-43"><a href="#cb128-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())<span class="op">;</span> <span class="co">#print(x_train.shape,y_train.shape)</span></span>
<span id="cb128-44"><a href="#cb128-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-45"><a href="#cb128-45" aria-hidden="true" tabindex="-1"></a><span class="co"># # COMPILING THE MODEL</span></span>
<span id="cb128-46"><a href="#cb128-46" aria-hidden="true" tabindex="-1"></a>opt <span class="op">=</span> keras.optimizers.RMSprop(learning_rate<span class="op">=</span>learning_rate)</span>
<span id="cb128-47"><a href="#cb128-47" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>opt, loss<span class="op">=</span>loss_function)</span>
<span id="cb128-48"><a href="#cb128-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-49"><a href="#cb128-49" aria-hidden="true" tabindex="-1"></a><span class="co"># TRAINING YOUR MODEL</span></span>
<span id="cb128-50"><a href="#cb128-50" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(</span>
<span id="cb128-51"><a href="#cb128-51" aria-hidden="true" tabindex="-1"></a>    Xt_imp,</span>
<span id="cb128-52"><a href="#cb128-52" aria-hidden="true" tabindex="-1"></a>    Yt_imp,</span>
<span id="cb128-53"><a href="#cb128-53" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span>numbers_epochs,</span>
<span id="cb128-54"><a href="#cb128-54" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span>batch_size,</span>
<span id="cb128-55"><a href="#cb128-55" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb128-56"><a href="#cb128-56" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>(Xv_imp, Yv_imp),</span>
<span id="cb128-57"><a href="#cb128-57" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb128-58"><a href="#cb128-58" aria-hidden="true" tabindex="-1"></a><span class="co"># History plot</span></span>
<span id="cb128-59"><a href="#cb128-59" aria-hidden="true" tabindex="-1"></a>history_plot(history)</span>
<span id="cb128-60"><a href="#cb128-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-61"><a href="#cb128-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb128-62"><a href="#cb128-62" aria-hidden="true" tabindex="-1"></a>Ytp_imp <span class="op">=</span> model.predict(Xt_imp)</span>
<span id="cb128-63"><a href="#cb128-63" aria-hidden="true" tabindex="-1"></a>Yvp_imp <span class="op">=</span> model.predict(Xv_imp)</span>
<span id="cb128-64"><a href="#cb128-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-65"><a href="#cb128-65" aria-hidden="true" tabindex="-1"></a><span class="co"># REPORT</span></span>
<span id="cb128-66"><a href="#cb128-66" aria-hidden="true" tabindex="-1"></a>regression_report(Yt_imp, Ytp_imp, Yv_imp, Yvp_imp)</span>
<span id="cb128-67"><a href="#cb128-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-68"><a href="#cb128-68" aria-hidden="true" tabindex="-1"></a><span class="co"># compute RMSE using numpy</span></span>
<span id="cb128-69"><a href="#cb128-69" aria-hidden="true" tabindex="-1"></a>training_RMSE_imp <span class="op">=</span> np.sqrt(mean_squared_error(Yt_imp, Ytp_imp))</span>
<span id="cb128-70"><a href="#cb128-70" aria-hidden="true" tabindex="-1"></a>validation_RMSE_imp <span class="op">=</span> np.sqrt(mean_squared_error(Yv_imp, Yvp_imp))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(229, 5, 1) --&gt; (229, 1)
(73, 5, 1) --&gt; (73, 1)
Model: "sequential_3"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 simple_rnn_3 (SimpleRNN)    (None, 32)                1088      
                                                                 
 dense_3 (Dense)             (None, 1)                 33        
                                                                 
=================================================================
Total params: 1121 (4.38 KB)
Trainable params: 1121 (4.38 KB)
Non-trainable params: 0 (0.00 Byte)
_________________________________________________________________
None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-59-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>8/8 [==============================] - 1s 6ms/step
3/3 [==============================] - 0s 8ms/step
---------- Regression report ----------
TRAINING:
 MSE: 0.1560476381351537
 MAE: 0.3165801404532817</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-59-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-59-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>VALIDATION:
 MSE: 0.18567062606530266
 MAE: 0.35992918817697195</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-59-output-7.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-59-output-8.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Error Summary</strong></p>
<div class="cell" data-outputid="7a80859a-003c-4771-cf54-0094f63c173e" data-execution_count="61">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>error_table_imp <span class="op">=</span> [[<span class="st">'Model'</span>,<span class="st">'train_MSE'</span>,<span class="st">'train_MAE'</span>,<span class="st">'train_RMSE'</span>,<span class="st">'val_MSE'</span>,<span class="st">'val_MAE'</span>,<span class="st">'val_RMSE'</span>],</span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>              [<span class="st">'RNN'</span>,</span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yt_imp, Ytp_imp),</span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yt_imp, Ytp_imp),</span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a>               training_RMSE_imp,</span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yv_imp, Yvp_imp),</span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yv_imp, Yvp_imp),</span>
<span id="cb132-8"><a href="#cb132-8" aria-hidden="true" tabindex="-1"></a>               validation_RMSE_imp]]</span>
<span id="cb132-9"><a href="#cb132-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(error_table_imp, headers<span class="op">=</span><span class="st">'firstrow'</span>, tablefmt<span class="op">=</span><span class="st">'fancy_grid'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>╒═════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model   │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞═════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ RNN     │    0.156048 │     0.31658 │     0.395029 │  0.185671 │  0.359929 │   0.430895 │
╘═════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
</div>
<div id="tabset-7-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-5-tab">
<div class="cell" data-outputid="0234f6a9-74e5-4d20-d79a-38917253617f" data-execution_count="62">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW SIZES</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xt_exp.shape, <span class="st">"--&gt;"</span>, Yt_exp.shape)</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xv_exp.shape, <span class="st">"--&gt;"</span>, Yv_exp.shape)</span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a><span class="co"># HYPERPARAMETERS</span></span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>optimizer<span class="op">=</span><span class="st">"rmsprop"</span></span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a>loss_function<span class="op">=</span><span class="st">"MeanSquaredError"</span></span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a>learning_rate<span class="op">=</span><span class="fl">0.001</span></span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a>numbers_epochs<span class="op">=</span><span class="dv">200</span> <span class="co">#100</span></span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a>L2<span class="op">=</span><span class="dv">0</span> <span class="co">#1e-4</span></span>
<span id="cb134-11"><a href="#cb134-11" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>(Xt_exp.shape[<span class="dv">1</span>],Xt_exp.shape[<span class="dv">2</span>])</span>
<span id="cb134-12"><a href="#cb134-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-13"><a href="#cb134-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-14"><a href="#cb134-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ------ Choose the batch size ------</span></span>
<span id="cb134-15"><a href="#cb134-15" aria-hidden="true" tabindex="-1"></a><span class="co"># batch_size=1                       # stocastic training</span></span>
<span id="cb134-16"><a href="#cb134-16" aria-hidden="true" tabindex="-1"></a><span class="co"># # batch_size=int(len(x_train)/2.)    # mini-batch training</span></span>
<span id="cb134-17"><a href="#cb134-17" aria-hidden="true" tabindex="-1"></a>batch_size<span class="op">=</span><span class="bu">len</span>(Xt1_exp)              <span class="co"># batch training</span></span>
<span id="cb134-18"><a href="#cb134-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-19"><a href="#cb134-19" aria-hidden="true" tabindex="-1"></a><span class="co"># BUILD MODEL</span></span>
<span id="cb134-20"><a href="#cb134-20" aria-hidden="true" tabindex="-1"></a>recurrent_hidden_units<span class="op">=</span><span class="dv">32</span></span>
<span id="cb134-21"><a href="#cb134-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-22"><a href="#cb134-22" aria-hidden="true" tabindex="-1"></a><span class="co"># CREATE MODEL</span></span>
<span id="cb134-23"><a href="#cb134-23" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> keras.Sequential()</span>
<span id="cb134-24"><a href="#cb134-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-25"><a href="#cb134-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ADD RECURRENT LAYER</span></span>
<span id="cb134-26"><a href="#cb134-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-27"><a href="#cb134-27" aria-hidden="true" tabindex="-1"></a><span class="co"># #COMMENT/UNCOMMENT TO USE RNN, LSTM,GRU</span></span>
<span id="cb134-28"><a href="#cb134-28" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(LSTM(</span></span>
<span id="cb134-29"><a href="#cb134-29" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(GRU(</span></span>
<span id="cb134-30"><a href="#cb134-30" aria-hidden="true" tabindex="-1"></a>model.add(SimpleRNN(</span>
<span id="cb134-31"><a href="#cb134-31" aria-hidden="true" tabindex="-1"></a>units<span class="op">=</span>recurrent_hidden_units,</span>
<span id="cb134-32"><a href="#cb134-32" aria-hidden="true" tabindex="-1"></a>return_sequences<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb134-33"><a href="#cb134-33" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>input_shape,</span>
<span id="cb134-34"><a href="#cb134-34" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_dropout=0.8,</span></span>
<span id="cb134-35"><a href="#cb134-35" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_regularizer=False</span></span>
<span id="cb134-36"><a href="#cb134-36" aria-hidden="true" tabindex="-1"></a>                     )</span>
<span id="cb134-37"><a href="#cb134-37" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb134-38"><a href="#cb134-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-39"><a href="#cb134-39" aria-hidden="true" tabindex="-1"></a><span class="co"># NEED TO TAKE THE OUTPUT RNN AND CONVERT TO SCALAR</span></span>
<span id="cb134-40"><a href="#cb134-40" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span><span class="st">'linear'</span>))</span>
<span id="cb134-41"><a href="#cb134-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-42"><a href="#cb134-42" aria-hidden="true" tabindex="-1"></a><span class="co"># MODEL SUMMARY</span></span>
<span id="cb134-43"><a href="#cb134-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())<span class="op">;</span> <span class="co">#print(x_train.shape,y_train.shape)</span></span>
<span id="cb134-44"><a href="#cb134-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-45"><a href="#cb134-45" aria-hidden="true" tabindex="-1"></a><span class="co"># # COMPILING THE MODEL</span></span>
<span id="cb134-46"><a href="#cb134-46" aria-hidden="true" tabindex="-1"></a>opt <span class="op">=</span> keras.optimizers.RMSprop(learning_rate<span class="op">=</span>learning_rate)</span>
<span id="cb134-47"><a href="#cb134-47" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>opt, loss<span class="op">=</span>loss_function)</span>
<span id="cb134-48"><a href="#cb134-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-49"><a href="#cb134-49" aria-hidden="true" tabindex="-1"></a><span class="co"># TRAINING YOUR MODEL</span></span>
<span id="cb134-50"><a href="#cb134-50" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(</span>
<span id="cb134-51"><a href="#cb134-51" aria-hidden="true" tabindex="-1"></a>    Xt_exp,</span>
<span id="cb134-52"><a href="#cb134-52" aria-hidden="true" tabindex="-1"></a>    Yt_exp,</span>
<span id="cb134-53"><a href="#cb134-53" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span>numbers_epochs,</span>
<span id="cb134-54"><a href="#cb134-54" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span>batch_size,</span>
<span id="cb134-55"><a href="#cb134-55" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb134-56"><a href="#cb134-56" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>(Xv_exp, Yv_exp),</span>
<span id="cb134-57"><a href="#cb134-57" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb134-58"><a href="#cb134-58" aria-hidden="true" tabindex="-1"></a><span class="co"># History plot</span></span>
<span id="cb134-59"><a href="#cb134-59" aria-hidden="true" tabindex="-1"></a>history_plot(history)</span>
<span id="cb134-60"><a href="#cb134-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-61"><a href="#cb134-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb134-62"><a href="#cb134-62" aria-hidden="true" tabindex="-1"></a>Ytp_exp <span class="op">=</span> model.predict(Xt_exp)</span>
<span id="cb134-63"><a href="#cb134-63" aria-hidden="true" tabindex="-1"></a>Yvp_exp <span class="op">=</span> model.predict(Xv_exp)</span>
<span id="cb134-64"><a href="#cb134-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-65"><a href="#cb134-65" aria-hidden="true" tabindex="-1"></a><span class="co"># REPORT</span></span>
<span id="cb134-66"><a href="#cb134-66" aria-hidden="true" tabindex="-1"></a>regression_report(Yt_exp, Ytp_exp, Yv_exp, Yvp_exp)</span>
<span id="cb134-67"><a href="#cb134-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-68"><a href="#cb134-68" aria-hidden="true" tabindex="-1"></a><span class="co"># compute RMSE using numpy</span></span>
<span id="cb134-69"><a href="#cb134-69" aria-hidden="true" tabindex="-1"></a>training_RMSE_exp <span class="op">=</span> np.sqrt(mean_squared_error(Yt_exp, Ytp_exp))</span>
<span id="cb134-70"><a href="#cb134-70" aria-hidden="true" tabindex="-1"></a>validation_RMSE_exp <span class="op">=</span> np.sqrt(mean_squared_error(Yv_exp, Yvp_exp))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(229, 5, 1) --&gt; (229, 1)
(73, 5, 1) --&gt; (73, 1)
Model: "sequential_4"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 simple_rnn_4 (SimpleRNN)    (None, 32)                1088      
                                                                 
 dense_4 (Dense)             (None, 1)                 33        
                                                                 
=================================================================
Total params: 1121 (4.38 KB)
Trainable params: 1121 (4.38 KB)
Non-trainable params: 0 (0.00 Byte)
_________________________________________________________________
None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-61-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>8/8 [==============================] - 0s 3ms/step
3/3 [==============================] - 0s 5ms/step
---------- Regression report ----------
TRAINING:
 MSE: 0.005350366835801499
 MAE: 0.055133177214101235</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-61-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-61-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>VALIDATION:
 MSE: 0.7585070258742818
 MAE: 0.6409075051411177</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-61-output-7.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-61-output-8.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Error Summary</strong></p>
<div class="cell" data-outputid="d308bad7-ee65-485c-b9c9-af44299434fd" data-execution_count="63">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>error_table_exp <span class="op">=</span> [[<span class="st">'Model'</span>,<span class="st">'train_MSE'</span>,<span class="st">'train_MAE'</span>,<span class="st">'train_RMSE'</span>,<span class="st">'val_MSE'</span>,<span class="st">'val_MAE'</span>,<span class="st">'val_RMSE'</span>],</span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>              [<span class="st">'RNN'</span>,</span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yt_exp, Ytp_exp),</span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yt_exp, Ytp_exp),</span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a>               training_RMSE_exp,</span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yv_exp, Yvp_exp),</span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yv_exp, Yvp_exp),</span>
<span id="cb138-8"><a href="#cb138-8" aria-hidden="true" tabindex="-1"></a>               validation_RMSE_exp]]</span>
<span id="cb138-9"><a href="#cb138-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(error_table_exp, headers<span class="op">=</span><span class="st">'firstrow'</span>, tablefmt<span class="op">=</span><span class="st">'fancy_grid'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>╒═════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model   │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞═════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ RNN     │  0.00535037 │   0.0551332 │    0.0731462 │  0.758507 │  0.640908 │   0.870923 │
╘═════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
</div>
<div id="tabset-7-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-6-tab">
<div class="cell" data-outputid="0b7d9c31-bc04-405d-9320-94a16b6da822" data-execution_count="64">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW SIZES</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xt_stk.shape, <span class="st">"--&gt;"</span>, Yt_stk.shape)</span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xv_stk.shape, <span class="st">"--&gt;"</span>, Yv_stk.shape)</span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a><span class="co"># HYPERPARAMETERS</span></span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>optimizer<span class="op">=</span><span class="st">"rmsprop"</span></span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a>loss_function<span class="op">=</span><span class="st">"MeanSquaredError"</span></span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a>learning_rate<span class="op">=</span><span class="fl">0.001</span></span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a>numbers_epochs<span class="op">=</span><span class="dv">200</span> <span class="co">#100</span></span>
<span id="cb140-10"><a href="#cb140-10" aria-hidden="true" tabindex="-1"></a>L2<span class="op">=</span><span class="dv">0</span> <span class="co">#1e-4</span></span>
<span id="cb140-11"><a href="#cb140-11" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>(Xt_stk.shape[<span class="dv">1</span>],Xt_stk.shape[<span class="dv">2</span>])</span>
<span id="cb140-12"><a href="#cb140-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-13"><a href="#cb140-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-14"><a href="#cb140-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ------ Choose the batch size ------</span></span>
<span id="cb140-15"><a href="#cb140-15" aria-hidden="true" tabindex="-1"></a><span class="co"># batch_size=1                       # stocastic training</span></span>
<span id="cb140-16"><a href="#cb140-16" aria-hidden="true" tabindex="-1"></a><span class="co"># # batch_size=int(len(x_train)/2.)    # mini-batch training</span></span>
<span id="cb140-17"><a href="#cb140-17" aria-hidden="true" tabindex="-1"></a>batch_size<span class="op">=</span><span class="bu">len</span>(Xt1_stk)              <span class="co"># batch training</span></span>
<span id="cb140-18"><a href="#cb140-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-19"><a href="#cb140-19" aria-hidden="true" tabindex="-1"></a><span class="co"># BUILD MODEL</span></span>
<span id="cb140-20"><a href="#cb140-20" aria-hidden="true" tabindex="-1"></a>recurrent_hidden_units<span class="op">=</span><span class="dv">32</span></span>
<span id="cb140-21"><a href="#cb140-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-22"><a href="#cb140-22" aria-hidden="true" tabindex="-1"></a><span class="co"># CREATE MODEL</span></span>
<span id="cb140-23"><a href="#cb140-23" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> keras.Sequential()</span>
<span id="cb140-24"><a href="#cb140-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-25"><a href="#cb140-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ADD RECURRENT LAYER</span></span>
<span id="cb140-26"><a href="#cb140-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-27"><a href="#cb140-27" aria-hidden="true" tabindex="-1"></a><span class="co"># #COMMENT/UNCOMMENT TO USE RNN, LSTM,GRU</span></span>
<span id="cb140-28"><a href="#cb140-28" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(LSTM(</span></span>
<span id="cb140-29"><a href="#cb140-29" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(GRU(</span></span>
<span id="cb140-30"><a href="#cb140-30" aria-hidden="true" tabindex="-1"></a>model.add(SimpleRNN(</span>
<span id="cb140-31"><a href="#cb140-31" aria-hidden="true" tabindex="-1"></a>units<span class="op">=</span>recurrent_hidden_units,</span>
<span id="cb140-32"><a href="#cb140-32" aria-hidden="true" tabindex="-1"></a>return_sequences<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb140-33"><a href="#cb140-33" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>input_shape,</span>
<span id="cb140-34"><a href="#cb140-34" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_dropout=0.8,</span></span>
<span id="cb140-35"><a href="#cb140-35" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_regularizer=False</span></span>
<span id="cb140-36"><a href="#cb140-36" aria-hidden="true" tabindex="-1"></a>                     )</span>
<span id="cb140-37"><a href="#cb140-37" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb140-38"><a href="#cb140-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-39"><a href="#cb140-39" aria-hidden="true" tabindex="-1"></a><span class="co"># NEED TO TAKE THE OUTPUT RNN AND CONVERT TO SCALAR</span></span>
<span id="cb140-40"><a href="#cb140-40" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span><span class="st">'linear'</span>))</span>
<span id="cb140-41"><a href="#cb140-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-42"><a href="#cb140-42" aria-hidden="true" tabindex="-1"></a><span class="co"># MODEL SUMMARY</span></span>
<span id="cb140-43"><a href="#cb140-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())<span class="op">;</span> <span class="co">#print(x_train.shape,y_train.shape)</span></span>
<span id="cb140-44"><a href="#cb140-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-45"><a href="#cb140-45" aria-hidden="true" tabindex="-1"></a><span class="co"># # COMPILING THE MODEL</span></span>
<span id="cb140-46"><a href="#cb140-46" aria-hidden="true" tabindex="-1"></a>opt <span class="op">=</span> keras.optimizers.RMSprop(learning_rate<span class="op">=</span>learning_rate)</span>
<span id="cb140-47"><a href="#cb140-47" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>opt, loss<span class="op">=</span>loss_function)</span>
<span id="cb140-48"><a href="#cb140-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-49"><a href="#cb140-49" aria-hidden="true" tabindex="-1"></a><span class="co"># TRAINING YOUR MODEL</span></span>
<span id="cb140-50"><a href="#cb140-50" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(</span>
<span id="cb140-51"><a href="#cb140-51" aria-hidden="true" tabindex="-1"></a>    Xt_stk,</span>
<span id="cb140-52"><a href="#cb140-52" aria-hidden="true" tabindex="-1"></a>    Yt_stk,</span>
<span id="cb140-53"><a href="#cb140-53" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span>numbers_epochs,</span>
<span id="cb140-54"><a href="#cb140-54" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span>batch_size,</span>
<span id="cb140-55"><a href="#cb140-55" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb140-56"><a href="#cb140-56" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>(Xv_stk, Yv_stk),</span>
<span id="cb140-57"><a href="#cb140-57" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb140-58"><a href="#cb140-58" aria-hidden="true" tabindex="-1"></a><span class="co"># History plot</span></span>
<span id="cb140-59"><a href="#cb140-59" aria-hidden="true" tabindex="-1"></a>history_plot(history)</span>
<span id="cb140-60"><a href="#cb140-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-61"><a href="#cb140-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb140-62"><a href="#cb140-62" aria-hidden="true" tabindex="-1"></a>Ytp_stk <span class="op">=</span> model.predict(Xt_stk)</span>
<span id="cb140-63"><a href="#cb140-63" aria-hidden="true" tabindex="-1"></a>Yvp_stk <span class="op">=</span> model.predict(Xv_stk)</span>
<span id="cb140-64"><a href="#cb140-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-65"><a href="#cb140-65" aria-hidden="true" tabindex="-1"></a><span class="co"># REPORT</span></span>
<span id="cb140-66"><a href="#cb140-66" aria-hidden="true" tabindex="-1"></a>regression_report(Yt_stk, Ytp_stk, Yv_stk, Yvp_stk)</span>
<span id="cb140-67"><a href="#cb140-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-68"><a href="#cb140-68" aria-hidden="true" tabindex="-1"></a><span class="co"># compute RMSE using numpy</span></span>
<span id="cb140-69"><a href="#cb140-69" aria-hidden="true" tabindex="-1"></a>training_RMSE_stk <span class="op">=</span> np.sqrt(mean_squared_error(Yt_stk, Ytp_stk))</span>
<span id="cb140-70"><a href="#cb140-70" aria-hidden="true" tabindex="-1"></a>validation_RMSE_stk <span class="op">=</span> np.sqrt(mean_squared_error(Yv_stk, Yvp_stk))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(3377, 5, 1) --&gt; (3377, 1)
(1123, 5, 1) --&gt; (1123, 1)
Model: "sequential_5"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 simple_rnn_5 (SimpleRNN)    (None, 32)                1088      
                                                                 
 dense_5 (Dense)             (None, 1)                 33        
                                                                 
=================================================================
Total params: 1121 (4.38 KB)
Trainable params: 1121 (4.38 KB)
Non-trainable params: 0 (0.00 Byte)
_________________________________________________________________
None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-63-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>106/106 [==============================] - 0s 2ms/step
36/36 [==============================] - 0s 2ms/step
---------- Regression report ----------
TRAINING:
 MSE: 0.003859248605304056
 MAE: 0.04937039958418123</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-63-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-63-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>VALIDATION:
 MSE: 0.2414823291143868
 MAE: 0.2529345975930672</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-63-output-7.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-63-output-8.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Error Summary</strong></p>
<div class="cell" data-outputid="c5e87862-9bd8-456b-d2aa-a80b50177b0f" data-execution_count="65">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>error_table_stk <span class="op">=</span> [[<span class="st">'Model'</span>,<span class="st">'train_MSE'</span>,<span class="st">'train_MAE'</span>,<span class="st">'train_RMSE'</span>,<span class="st">'val_MSE'</span>,<span class="st">'val_MAE'</span>,<span class="st">'val_RMSE'</span>],</span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>              [<span class="st">'RNN'</span>,</span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yt_stk, Ytp_stk),</span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yt_stk, Ytp_stk),</span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a>               training_RMSE_stk,</span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yv_stk, Yvp_stk),</span>
<span id="cb144-7"><a href="#cb144-7" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yv_stk, Yvp_stk),</span>
<span id="cb144-8"><a href="#cb144-8" aria-hidden="true" tabindex="-1"></a>               validation_RMSE_stk]]</span>
<span id="cb144-9"><a href="#cb144-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(error_table_stk, headers<span class="op">=</span><span class="st">'firstrow'</span>, tablefmt<span class="op">=</span><span class="st">'fancy_grid'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>╒═════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model   │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞═════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ RNN     │  0.00385925 │   0.0493704 │    0.0621229 │  0.241482 │  0.252935 │   0.491409 │
╘═════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
</div>
<div id="tabset-7-7" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-7-tab">
<div class="cell" data-outputid="1efa0e7d-8221-4731-a871-9ee377530901" data-execution_count="66">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW SIZES</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xt_emissions.shape, <span class="st">"--&gt;"</span>, Yt_emissions.shape)</span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xv_emissions.shape, <span class="st">"--&gt;"</span>, Yv_emissions.shape)</span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a><span class="co"># HYPERPARAMETERS</span></span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a>optimizer<span class="op">=</span><span class="st">"rmsprop"</span></span>
<span id="cb146-7"><a href="#cb146-7" aria-hidden="true" tabindex="-1"></a>loss_function<span class="op">=</span><span class="st">"MeanSquaredError"</span></span>
<span id="cb146-8"><a href="#cb146-8" aria-hidden="true" tabindex="-1"></a>learning_rate<span class="op">=</span><span class="fl">0.001</span></span>
<span id="cb146-9"><a href="#cb146-9" aria-hidden="true" tabindex="-1"></a>numbers_epochs<span class="op">=</span><span class="dv">200</span> <span class="co">#100</span></span>
<span id="cb146-10"><a href="#cb146-10" aria-hidden="true" tabindex="-1"></a>L2<span class="op">=</span><span class="dv">0</span> <span class="co">#1e-4</span></span>
<span id="cb146-11"><a href="#cb146-11" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>(Xt_emissions.shape[<span class="dv">1</span>],Xt_emissions.shape[<span class="dv">2</span>])</span>
<span id="cb146-12"><a href="#cb146-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-13"><a href="#cb146-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-14"><a href="#cb146-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ------ Choose the batch size ------</span></span>
<span id="cb146-15"><a href="#cb146-15" aria-hidden="true" tabindex="-1"></a><span class="co"># batch_size=1                       # stocastic training</span></span>
<span id="cb146-16"><a href="#cb146-16" aria-hidden="true" tabindex="-1"></a><span class="co"># # batch_size=int(len(x_train)/2.)    # mini-batch training</span></span>
<span id="cb146-17"><a href="#cb146-17" aria-hidden="true" tabindex="-1"></a>batch_size<span class="op">=</span><span class="bu">len</span>(Xt1_emissions)              <span class="co"># batch training</span></span>
<span id="cb146-18"><a href="#cb146-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-19"><a href="#cb146-19" aria-hidden="true" tabindex="-1"></a><span class="co"># BUILD MODEL</span></span>
<span id="cb146-20"><a href="#cb146-20" aria-hidden="true" tabindex="-1"></a>recurrent_hidden_units<span class="op">=</span><span class="dv">32</span></span>
<span id="cb146-21"><a href="#cb146-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-22"><a href="#cb146-22" aria-hidden="true" tabindex="-1"></a><span class="co"># CREATE MODEL</span></span>
<span id="cb146-23"><a href="#cb146-23" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> keras.Sequential()</span>
<span id="cb146-24"><a href="#cb146-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-25"><a href="#cb146-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ADD RECURRENT LAYER</span></span>
<span id="cb146-26"><a href="#cb146-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-27"><a href="#cb146-27" aria-hidden="true" tabindex="-1"></a><span class="co"># #COMMENT/UNCOMMENT TO USE RNN, LSTM,GRU</span></span>
<span id="cb146-28"><a href="#cb146-28" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(LSTM(</span></span>
<span id="cb146-29"><a href="#cb146-29" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(GRU(</span></span>
<span id="cb146-30"><a href="#cb146-30" aria-hidden="true" tabindex="-1"></a>model.add(SimpleRNN(</span>
<span id="cb146-31"><a href="#cb146-31" aria-hidden="true" tabindex="-1"></a>units<span class="op">=</span>recurrent_hidden_units,</span>
<span id="cb146-32"><a href="#cb146-32" aria-hidden="true" tabindex="-1"></a>return_sequences<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb146-33"><a href="#cb146-33" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>input_shape,</span>
<span id="cb146-34"><a href="#cb146-34" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_dropout=0.8,</span></span>
<span id="cb146-35"><a href="#cb146-35" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_regularizer=False</span></span>
<span id="cb146-36"><a href="#cb146-36" aria-hidden="true" tabindex="-1"></a>                     )</span>
<span id="cb146-37"><a href="#cb146-37" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb146-38"><a href="#cb146-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-39"><a href="#cb146-39" aria-hidden="true" tabindex="-1"></a><span class="co"># NEED TO TAKE THE OUTPUT RNN AND CONVERT TO SCALAR</span></span>
<span id="cb146-40"><a href="#cb146-40" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span><span class="st">'linear'</span>))</span>
<span id="cb146-41"><a href="#cb146-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-42"><a href="#cb146-42" aria-hidden="true" tabindex="-1"></a><span class="co"># MODEL SUMMARY</span></span>
<span id="cb146-43"><a href="#cb146-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())<span class="op">;</span> <span class="co">#print(x_train.shape,y_train.shape)</span></span>
<span id="cb146-44"><a href="#cb146-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-45"><a href="#cb146-45" aria-hidden="true" tabindex="-1"></a><span class="co"># # COMPILING THE MODEL</span></span>
<span id="cb146-46"><a href="#cb146-46" aria-hidden="true" tabindex="-1"></a>opt <span class="op">=</span> keras.optimizers.RMSprop(learning_rate<span class="op">=</span>learning_rate)</span>
<span id="cb146-47"><a href="#cb146-47" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>opt, loss<span class="op">=</span>loss_function)</span>
<span id="cb146-48"><a href="#cb146-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-49"><a href="#cb146-49" aria-hidden="true" tabindex="-1"></a><span class="co"># TRAINING YOUR MODEL</span></span>
<span id="cb146-50"><a href="#cb146-50" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(</span>
<span id="cb146-51"><a href="#cb146-51" aria-hidden="true" tabindex="-1"></a>    Xt_emissions,</span>
<span id="cb146-52"><a href="#cb146-52" aria-hidden="true" tabindex="-1"></a>    Yt_emissions,</span>
<span id="cb146-53"><a href="#cb146-53" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span>numbers_epochs,</span>
<span id="cb146-54"><a href="#cb146-54" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span>batch_size,</span>
<span id="cb146-55"><a href="#cb146-55" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb146-56"><a href="#cb146-56" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>(Xv_emissions, Yv_emissions),</span>
<span id="cb146-57"><a href="#cb146-57" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb146-58"><a href="#cb146-58" aria-hidden="true" tabindex="-1"></a><span class="co"># History plot</span></span>
<span id="cb146-59"><a href="#cb146-59" aria-hidden="true" tabindex="-1"></a>history_plot(history)</span>
<span id="cb146-60"><a href="#cb146-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-61"><a href="#cb146-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb146-62"><a href="#cb146-62" aria-hidden="true" tabindex="-1"></a>Ytp_emissions <span class="op">=</span> model.predict(Xt_emissions)</span>
<span id="cb146-63"><a href="#cb146-63" aria-hidden="true" tabindex="-1"></a>Yvp_emissions <span class="op">=</span> model.predict(Xv_emissions)</span>
<span id="cb146-64"><a href="#cb146-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-65"><a href="#cb146-65" aria-hidden="true" tabindex="-1"></a><span class="co"># REPORT</span></span>
<span id="cb146-66"><a href="#cb146-66" aria-hidden="true" tabindex="-1"></a>regression_report(Yt_emissions, Ytp_emissions, Yv_emissions, Yvp_emissions)</span>
<span id="cb146-67"><a href="#cb146-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-68"><a href="#cb146-68" aria-hidden="true" tabindex="-1"></a><span class="co"># compute RMSE using numpy</span></span>
<span id="cb146-69"><a href="#cb146-69" aria-hidden="true" tabindex="-1"></a>training_RMSE_emissions <span class="op">=</span> np.sqrt(mean_squared_error(Yt_emissions, Ytp_emissions))</span>
<span id="cb146-70"><a href="#cb146-70" aria-hidden="true" tabindex="-1"></a>validation_RMSE_emissions <span class="op">=</span> np.sqrt(mean_squared_error(Yv_emissions, Yvp_emissions))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(227, 5, 1) --&gt; (227, 1)
(73, 5, 1) --&gt; (73, 1)
Model: "sequential_6"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 simple_rnn_6 (SimpleRNN)    (None, 32)                1088      
                                                                 
 dense_6 (Dense)             (None, 1)                 33        
                                                                 
=================================================================
Total params: 1121 (4.38 KB)
Trainable params: 1121 (4.38 KB)
Non-trainable params: 0 (0.00 Byte)
_________________________________________________________________
None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-65-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>8/8 [==============================] - 0s 4ms/step
3/3 [==============================] - 0s 7ms/step
---------- Regression report ----------
TRAINING:
 MSE: 0.3033295428161593
 MAE: 0.3487574632804835</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-65-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-65-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>VALIDATION:
 MSE: 1.5143298833546888
 MAE: 0.9687692360570798</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-65-output-7.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-65-output-8.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Error Summary</strong></p>
<div class="cell" data-outputid="cb32c22d-b32a-40b4-9359-1e7bacc75238" data-execution_count="67">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>error_table_emissions <span class="op">=</span> [[<span class="st">'Model'</span>,<span class="st">'train_MSE'</span>,<span class="st">'train_MAE'</span>,<span class="st">'train_RMSE'</span>,<span class="st">'val_MSE'</span>,<span class="st">'val_MAE'</span>,<span class="st">'val_RMSE'</span>],</span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>              [<span class="st">'RNN'</span>,</span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yt_emissions, Ytp_emissions),</span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yt_emissions, Ytp_emissions),</span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a>               training_RMSE_emissions,</span>
<span id="cb150-6"><a href="#cb150-6" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yv_emissions, Yvp_emissions),</span>
<span id="cb150-7"><a href="#cb150-7" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yv_emissions, Yvp_emissions),</span>
<span id="cb150-8"><a href="#cb150-8" aria-hidden="true" tabindex="-1"></a>               validation_RMSE_emissions]]</span>
<span id="cb150-9"><a href="#cb150-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(error_table_emissions, headers<span class="op">=</span><span class="st">'firstrow'</span>, tablefmt<span class="op">=</span><span class="st">'fancy_grid'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>╒═════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model   │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞═════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ RNN     │     0.30333 │    0.348757 │     0.550754 │   1.51433 │  0.968769 │    1.23058 │
╘═════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="rnn-with-l2-regularization" class="level2">
<h2 class="anchored" data-anchor-id="rnn-with-l2-regularization">RNN with L2 Regularization</h2>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-8-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-1" role="tab" aria-controls="tabset-8-1" aria-selected="true">Prices</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-2" role="tab" aria-controls="tabset-8-2" aria-selected="false">Consumption</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-3" role="tab" aria-controls="tabset-8-3" aria-selected="false">Production</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-4" role="tab" aria-controls="tabset-8-4" aria-selected="false">Imports</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-5" role="tab" aria-controls="tabset-8-5" aria-selected="false">Exports</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-6" role="tab" aria-controls="tabset-8-6" aria-selected="false">CVX Stocks</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-7-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-7" role="tab" aria-controls="tabset-8-7" aria-selected="false">CO2 Emissions</a></li></ul>
<div class="tab-content">
<div id="tabset-8-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-8-1-tab">
<div class="cell" data-outputid="5921414f-28dd-47a7-b655-6c94d1256b95" data-execution_count="68">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW SIZES</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xt.shape, <span class="st">"--&gt;"</span>, Yt.shape)</span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xv.shape, <span class="st">"--&gt;"</span>, Yv.shape)</span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-5"><a href="#cb152-5" aria-hidden="true" tabindex="-1"></a><span class="co"># HYPERPARAMETERS</span></span>
<span id="cb152-6"><a href="#cb152-6" aria-hidden="true" tabindex="-1"></a>optimizer<span class="op">=</span><span class="st">"rmsprop"</span></span>
<span id="cb152-7"><a href="#cb152-7" aria-hidden="true" tabindex="-1"></a>loss_function<span class="op">=</span><span class="st">"MeanSquaredError"</span></span>
<span id="cb152-8"><a href="#cb152-8" aria-hidden="true" tabindex="-1"></a>learning_rate<span class="op">=</span><span class="fl">0.001</span></span>
<span id="cb152-9"><a href="#cb152-9" aria-hidden="true" tabindex="-1"></a>numbers_epochs<span class="op">=</span><span class="dv">200</span> <span class="co">#100</span></span>
<span id="cb152-10"><a href="#cb152-10" aria-hidden="true" tabindex="-1"></a>L2<span class="op">=</span><span class="fl">1e-4</span></span>
<span id="cb152-11"><a href="#cb152-11" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>(Xt.shape[<span class="dv">1</span>],Xt.shape[<span class="dv">2</span>])</span>
<span id="cb152-12"><a href="#cb152-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-13"><a href="#cb152-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-14"><a href="#cb152-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ------ Choose the batch size ------</span></span>
<span id="cb152-15"><a href="#cb152-15" aria-hidden="true" tabindex="-1"></a><span class="co"># batch_size=1                       # stocastic training</span></span>
<span id="cb152-16"><a href="#cb152-16" aria-hidden="true" tabindex="-1"></a><span class="co"># # batch_size=int(len(x_train)/2.)    # mini-batch training</span></span>
<span id="cb152-17"><a href="#cb152-17" aria-hidden="true" tabindex="-1"></a>batch_size<span class="op">=</span><span class="bu">len</span>(Xt1)              <span class="co"># batch training</span></span>
<span id="cb152-18"><a href="#cb152-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-19"><a href="#cb152-19" aria-hidden="true" tabindex="-1"></a><span class="co"># BUILD MODEL</span></span>
<span id="cb152-20"><a href="#cb152-20" aria-hidden="true" tabindex="-1"></a>recurrent_hidden_units<span class="op">=</span><span class="dv">32</span></span>
<span id="cb152-21"><a href="#cb152-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-22"><a href="#cb152-22" aria-hidden="true" tabindex="-1"></a><span class="co"># CREATE MODEL</span></span>
<span id="cb152-23"><a href="#cb152-23" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> keras.Sequential()</span>
<span id="cb152-24"><a href="#cb152-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-25"><a href="#cb152-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ADD RECURRENT LAYER</span></span>
<span id="cb152-26"><a href="#cb152-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-27"><a href="#cb152-27" aria-hidden="true" tabindex="-1"></a><span class="co"># #COMMENT/UNCOMMENT TO USE RNN, LSTM,GRU</span></span>
<span id="cb152-28"><a href="#cb152-28" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(LSTM(</span></span>
<span id="cb152-29"><a href="#cb152-29" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(GRU(</span></span>
<span id="cb152-30"><a href="#cb152-30" aria-hidden="true" tabindex="-1"></a>model.add(SimpleRNN(</span>
<span id="cb152-31"><a href="#cb152-31" aria-hidden="true" tabindex="-1"></a>units<span class="op">=</span>recurrent_hidden_units,</span>
<span id="cb152-32"><a href="#cb152-32" aria-hidden="true" tabindex="-1"></a>return_sequences<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb152-33"><a href="#cb152-33" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>input_shape,</span>
<span id="cb152-34"><a href="#cb152-34" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_dropout=0.8,</span></span>
<span id="cb152-35"><a href="#cb152-35" aria-hidden="true" tabindex="-1"></a>recurrent_regularizer<span class="op">=</span>regularizers.L2(L2),</span>
<span id="cb152-36"><a href="#cb152-36" aria-hidden="true" tabindex="-1"></a>activation<span class="op">=</span><span class="st">'relu'</span>)</span>
<span id="cb152-37"><a href="#cb152-37" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb152-38"><a href="#cb152-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-39"><a href="#cb152-39" aria-hidden="true" tabindex="-1"></a><span class="co"># NEED TO TAKE THE OUTPUT RNN AND CONVERT TO SCALAR</span></span>
<span id="cb152-40"><a href="#cb152-40" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span><span class="st">'linear'</span>))</span>
<span id="cb152-41"><a href="#cb152-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-42"><a href="#cb152-42" aria-hidden="true" tabindex="-1"></a><span class="co"># MODEL SUMMARY</span></span>
<span id="cb152-43"><a href="#cb152-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())<span class="op">;</span> <span class="co">#print(x_train.shape,y_train.shape)</span></span>
<span id="cb152-44"><a href="#cb152-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-45"><a href="#cb152-45" aria-hidden="true" tabindex="-1"></a><span class="co"># # COMPILING THE MODEL</span></span>
<span id="cb152-46"><a href="#cb152-46" aria-hidden="true" tabindex="-1"></a>opt <span class="op">=</span> keras.optimizers.RMSprop(learning_rate<span class="op">=</span>learning_rate)</span>
<span id="cb152-47"><a href="#cb152-47" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>opt, loss<span class="op">=</span>loss_function)</span>
<span id="cb152-48"><a href="#cb152-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-49"><a href="#cb152-49" aria-hidden="true" tabindex="-1"></a><span class="co"># TRAINING YOUR MODEL</span></span>
<span id="cb152-50"><a href="#cb152-50" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(</span>
<span id="cb152-51"><a href="#cb152-51" aria-hidden="true" tabindex="-1"></a>    Xt,</span>
<span id="cb152-52"><a href="#cb152-52" aria-hidden="true" tabindex="-1"></a>    Yt,</span>
<span id="cb152-53"><a href="#cb152-53" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span>numbers_epochs,</span>
<span id="cb152-54"><a href="#cb152-54" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span>batch_size,</span>
<span id="cb152-55"><a href="#cb152-55" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb152-56"><a href="#cb152-56" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>(Xv, Yv),</span>
<span id="cb152-57"><a href="#cb152-57" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb152-58"><a href="#cb152-58" aria-hidden="true" tabindex="-1"></a><span class="co"># History plot</span></span>
<span id="cb152-59"><a href="#cb152-59" aria-hidden="true" tabindex="-1"></a>history_plot(history)</span>
<span id="cb152-60"><a href="#cb152-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-61"><a href="#cb152-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb152-62"><a href="#cb152-62" aria-hidden="true" tabindex="-1"></a>Ytp <span class="op">=</span> model.predict(Xt)</span>
<span id="cb152-63"><a href="#cb152-63" aria-hidden="true" tabindex="-1"></a>Yvp <span class="op">=</span> model.predict(Xv)</span>
<span id="cb152-64"><a href="#cb152-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-65"><a href="#cb152-65" aria-hidden="true" tabindex="-1"></a><span class="co"># REPORT</span></span>
<span id="cb152-66"><a href="#cb152-66" aria-hidden="true" tabindex="-1"></a>regression_report(Yt, Ytp, Yv, Yvp)</span>
<span id="cb152-67"><a href="#cb152-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-68"><a href="#cb152-68" aria-hidden="true" tabindex="-1"></a><span class="co"># compute RMSE using numpy</span></span>
<span id="cb152-69"><a href="#cb152-69" aria-hidden="true" tabindex="-1"></a>training_RMSE <span class="op">=</span> np.sqrt(mean_squared_error(Yt, Ytp))</span>
<span id="cb152-70"><a href="#cb152-70" aria-hidden="true" tabindex="-1"></a>validation_RMSE <span class="op">=</span> np.sqrt(mean_squared_error(Yv, Yvp))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(157, 5, 1) --&gt; (157, 1)
(49, 5, 1) --&gt; (49, 1)
Model: "sequential_7"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 simple_rnn_7 (SimpleRNN)    (None, 32)                1088      
                                                                 
 dense_7 (Dense)             (None, 1)                 33        
                                                                 
=================================================================
Total params: 1121 (4.38 KB)
Trainable params: 1121 (4.38 KB)
Non-trainable params: 0 (0.00 Byte)
_________________________________________________________________
None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-67-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>5/5 [==============================] - 0s 3ms/step
2/2 [==============================] - 0s 8ms/step
---------- Regression report ----------
TRAINING:
 MSE: 0.09695274568972209
 MAE: 0.19832510495281233</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-67-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-67-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>VALIDATION:
 MSE: 0.14788218490913857
 MAE: 0.2533704014187368</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-67-output-7.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-67-output-8.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Error Summary</strong></p>
<div class="cell" data-outputid="2758e1bb-871d-4df7-e492-731f5bbadcab" data-execution_count="69">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>error_table_rnn_l2 <span class="op">=</span> [[<span class="st">'Model'</span>,<span class="st">'train_MSE'</span>,<span class="st">'train_MAE'</span>,<span class="st">'train_RMSE'</span>,<span class="st">'val_MSE'</span>,<span class="st">'val_MAE'</span>,<span class="st">'val_RMSE'</span>],</span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>              [<span class="st">'RNN(L2 Reg)'</span>,</span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yt, Ytp),</span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yt, Ytp),</span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a>               training_RMSE,</span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yv, Yvp),</span>
<span id="cb156-7"><a href="#cb156-7" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yv, Yvp),</span>
<span id="cb156-8"><a href="#cb156-8" aria-hidden="true" tabindex="-1"></a>               validation_RMSE]]</span>
<span id="cb156-9"><a href="#cb156-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(error_table_rnn_l2, headers<span class="op">=</span><span class="st">'firstrow'</span>, tablefmt<span class="op">=</span><span class="st">'fancy_grid'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>╒═════════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model       │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞═════════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ RNN(L2 Reg) │   0.0969527 │    0.198325 │     0.311372 │  0.147882 │   0.25337 │   0.384555 │
╘═════════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
</div>
<div id="tabset-8-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-2-tab">
<div class="cell" data-outputid="afbc8df5-562e-4465-a371-2ce19350a50a" data-execution_count="70">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW SIZES</span></span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xt_consump.shape, <span class="st">"--&gt;"</span>, Yt_consump.shape)</span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xv_consump.shape, <span class="st">"--&gt;"</span>, Yv_consump.shape)</span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a><span class="co"># HYPERPARAMETERS</span></span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a>optimizer<span class="op">=</span><span class="st">"rmsprop"</span></span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a>loss_function<span class="op">=</span><span class="st">"MeanSquaredError"</span></span>
<span id="cb158-8"><a href="#cb158-8" aria-hidden="true" tabindex="-1"></a>learning_rate<span class="op">=</span><span class="fl">0.001</span></span>
<span id="cb158-9"><a href="#cb158-9" aria-hidden="true" tabindex="-1"></a>numbers_epochs<span class="op">=</span><span class="dv">200</span> <span class="co">#100</span></span>
<span id="cb158-10"><a href="#cb158-10" aria-hidden="true" tabindex="-1"></a>L2<span class="op">=</span><span class="fl">1e-4</span></span>
<span id="cb158-11"><a href="#cb158-11" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>(Xt_consump.shape[<span class="dv">1</span>],Xt_consump.shape[<span class="dv">2</span>])</span>
<span id="cb158-12"><a href="#cb158-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-13"><a href="#cb158-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-14"><a href="#cb158-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ------ Choose the batch size ------</span></span>
<span id="cb158-15"><a href="#cb158-15" aria-hidden="true" tabindex="-1"></a><span class="co"># batch_size=1                       # stocastic training</span></span>
<span id="cb158-16"><a href="#cb158-16" aria-hidden="true" tabindex="-1"></a><span class="co"># # batch_size=int(len(x_train)/2.)    # mini-batch training</span></span>
<span id="cb158-17"><a href="#cb158-17" aria-hidden="true" tabindex="-1"></a>batch_size<span class="op">=</span><span class="bu">len</span>(Xt1_consump)              <span class="co"># batch training</span></span>
<span id="cb158-18"><a href="#cb158-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-19"><a href="#cb158-19" aria-hidden="true" tabindex="-1"></a><span class="co"># BUILD MODEL</span></span>
<span id="cb158-20"><a href="#cb158-20" aria-hidden="true" tabindex="-1"></a>recurrent_hidden_units<span class="op">=</span><span class="dv">32</span></span>
<span id="cb158-21"><a href="#cb158-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-22"><a href="#cb158-22" aria-hidden="true" tabindex="-1"></a><span class="co"># CREATE MODEL</span></span>
<span id="cb158-23"><a href="#cb158-23" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> keras.Sequential()</span>
<span id="cb158-24"><a href="#cb158-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-25"><a href="#cb158-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ADD RECURRENT LAYER</span></span>
<span id="cb158-26"><a href="#cb158-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-27"><a href="#cb158-27" aria-hidden="true" tabindex="-1"></a><span class="co"># #COMMENT/UNCOMMENT TO USE RNN, LSTM,GRU</span></span>
<span id="cb158-28"><a href="#cb158-28" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(LSTM(</span></span>
<span id="cb158-29"><a href="#cb158-29" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(GRU(</span></span>
<span id="cb158-30"><a href="#cb158-30" aria-hidden="true" tabindex="-1"></a>model.add(SimpleRNN(</span>
<span id="cb158-31"><a href="#cb158-31" aria-hidden="true" tabindex="-1"></a>units<span class="op">=</span>recurrent_hidden_units,</span>
<span id="cb158-32"><a href="#cb158-32" aria-hidden="true" tabindex="-1"></a>return_sequences<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb158-33"><a href="#cb158-33" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>input_shape,</span>
<span id="cb158-34"><a href="#cb158-34" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_dropout=0.8,</span></span>
<span id="cb158-35"><a href="#cb158-35" aria-hidden="true" tabindex="-1"></a>recurrent_regularizer<span class="op">=</span>regularizers.L2(L2),</span>
<span id="cb158-36"><a href="#cb158-36" aria-hidden="true" tabindex="-1"></a>activation<span class="op">=</span><span class="st">'relu'</span>)</span>
<span id="cb158-37"><a href="#cb158-37" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb158-38"><a href="#cb158-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-39"><a href="#cb158-39" aria-hidden="true" tabindex="-1"></a><span class="co"># NEED TO TAKE THE OUTPUT RNN AND CONVERT TO SCALAR</span></span>
<span id="cb158-40"><a href="#cb158-40" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span><span class="st">'linear'</span>))</span>
<span id="cb158-41"><a href="#cb158-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-42"><a href="#cb158-42" aria-hidden="true" tabindex="-1"></a><span class="co"># MODEL SUMMARY</span></span>
<span id="cb158-43"><a href="#cb158-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())<span class="op">;</span> <span class="co">#print(x_train.shape,y_train.shape)</span></span>
<span id="cb158-44"><a href="#cb158-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-45"><a href="#cb158-45" aria-hidden="true" tabindex="-1"></a><span class="co"># # COMPILING THE MODEL</span></span>
<span id="cb158-46"><a href="#cb158-46" aria-hidden="true" tabindex="-1"></a>opt <span class="op">=</span> keras.optimizers.RMSprop(learning_rate<span class="op">=</span>learning_rate)</span>
<span id="cb158-47"><a href="#cb158-47" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>opt, loss<span class="op">=</span>loss_function)</span>
<span id="cb158-48"><a href="#cb158-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-49"><a href="#cb158-49" aria-hidden="true" tabindex="-1"></a><span class="co"># TRAINING YOUR MODEL</span></span>
<span id="cb158-50"><a href="#cb158-50" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(</span>
<span id="cb158-51"><a href="#cb158-51" aria-hidden="true" tabindex="-1"></a>    Xt_consump,</span>
<span id="cb158-52"><a href="#cb158-52" aria-hidden="true" tabindex="-1"></a>    Yt_consump,</span>
<span id="cb158-53"><a href="#cb158-53" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span>numbers_epochs,</span>
<span id="cb158-54"><a href="#cb158-54" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span>batch_size,</span>
<span id="cb158-55"><a href="#cb158-55" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb158-56"><a href="#cb158-56" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>(Xv_consump, Yv_consump),</span>
<span id="cb158-57"><a href="#cb158-57" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb158-58"><a href="#cb158-58" aria-hidden="true" tabindex="-1"></a><span class="co"># History plot</span></span>
<span id="cb158-59"><a href="#cb158-59" aria-hidden="true" tabindex="-1"></a>history_plot(history)</span>
<span id="cb158-60"><a href="#cb158-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-61"><a href="#cb158-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb158-62"><a href="#cb158-62" aria-hidden="true" tabindex="-1"></a>Ytp_consump <span class="op">=</span> model.predict(Xt_consump)</span>
<span id="cb158-63"><a href="#cb158-63" aria-hidden="true" tabindex="-1"></a>Yvp_consump <span class="op">=</span> model.predict(Xv_consump)</span>
<span id="cb158-64"><a href="#cb158-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-65"><a href="#cb158-65" aria-hidden="true" tabindex="-1"></a><span class="co"># REPORT</span></span>
<span id="cb158-66"><a href="#cb158-66" aria-hidden="true" tabindex="-1"></a>regression_report(Yt_consump, Ytp_consump, Yv_consump, Yvp_consump)</span>
<span id="cb158-67"><a href="#cb158-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-68"><a href="#cb158-68" aria-hidden="true" tabindex="-1"></a><span class="co"># compute RMSE using numpy</span></span>
<span id="cb158-69"><a href="#cb158-69" aria-hidden="true" tabindex="-1"></a>training_RMSE_consump <span class="op">=</span> np.sqrt(mean_squared_error(Yt_consump, Ytp_consump))</span>
<span id="cb158-70"><a href="#cb158-70" aria-hidden="true" tabindex="-1"></a>validation_RMSE_consump <span class="op">=</span> np.sqrt(mean_squared_error(Yv_consump, Yvp_consump))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(157, 5, 1) --&gt; (157, 1)
(49, 5, 1) --&gt; (49, 1)
Model: "sequential_8"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 simple_rnn_8 (SimpleRNN)    (None, 32)                1088      
                                                                 
 dense_8 (Dense)             (None, 1)                 33        
                                                                 
=================================================================
Total params: 1121 (4.38 KB)
Trainable params: 1121 (4.38 KB)
Non-trainable params: 0 (0.00 Byte)
_________________________________________________________________
None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-69-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>5/5 [==============================] - 0s 3ms/step
2/2 [==============================] - 0s 9ms/step
---------- Regression report ----------
TRAINING:
 MSE: 0.08783466579054877
 MAE: 0.23079411155968446</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-69-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-69-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>VALIDATION:
 MSE: 0.37950958354797426
 MAE: 0.4788762563089349</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-69-output-7.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-69-output-8.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Error Summary</strong></p>
<div class="cell" data-outputid="6f993886-73dd-4cd1-8d4f-324155a02dd8" data-execution_count="71">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a>error_table_consump_rnn_l2 <span class="op">=</span> [[<span class="st">'Model'</span>,<span class="st">'train_MSE'</span>,<span class="st">'train_MAE'</span>,<span class="st">'train_RMSE'</span>,<span class="st">'val_MSE'</span>,<span class="st">'val_MAE'</span>,<span class="st">'val_RMSE'</span>],</span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a>              [<span class="st">'RNN(L2 Reg)'</span>,</span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yt_consump, Ytp_consump),</span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yt_consump, Ytp_consump),</span>
<span id="cb162-5"><a href="#cb162-5" aria-hidden="true" tabindex="-1"></a>              training_RMSE_consump,</span>
<span id="cb162-6"><a href="#cb162-6" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yv_consump, Yvp_consump),</span>
<span id="cb162-7"><a href="#cb162-7" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yv_consump, Yvp_consump),</span>
<span id="cb162-8"><a href="#cb162-8" aria-hidden="true" tabindex="-1"></a>               validation_RMSE_consump]]</span>
<span id="cb162-9"><a href="#cb162-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(error_table_consump_rnn_l2, headers<span class="op">=</span><span class="st">'firstrow'</span>, tablefmt<span class="op">=</span><span class="st">'fancy_grid'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>╒═════════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model       │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞═════════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ RNN(L2 Reg) │   0.0878347 │    0.230794 │     0.296369 │   0.37951 │  0.478876 │   0.616043 │
╘═════════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
</div>
<div id="tabset-8-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-3-tab">
<div class="cell" data-outputid="d0589f52-4b8a-4d75-ebd1-bc61c3637d34" data-execution_count="72">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW SIZES</span></span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xt_prod.shape, <span class="st">"--&gt;"</span>, Yt_prod.shape)</span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xv_prod.shape, <span class="st">"--&gt;"</span>, Yv_prod.shape)</span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a><span class="co"># HYPERPARAMETERS</span></span>
<span id="cb164-6"><a href="#cb164-6" aria-hidden="true" tabindex="-1"></a>optimizer<span class="op">=</span><span class="st">"rmsprop"</span></span>
<span id="cb164-7"><a href="#cb164-7" aria-hidden="true" tabindex="-1"></a>loss_function<span class="op">=</span><span class="st">"MeanSquaredError"</span></span>
<span id="cb164-8"><a href="#cb164-8" aria-hidden="true" tabindex="-1"></a>learning_rate<span class="op">=</span><span class="fl">0.001</span></span>
<span id="cb164-9"><a href="#cb164-9" aria-hidden="true" tabindex="-1"></a>numbers_epochs<span class="op">=</span><span class="dv">200</span> <span class="co">#100</span></span>
<span id="cb164-10"><a href="#cb164-10" aria-hidden="true" tabindex="-1"></a>L2<span class="op">=</span><span class="fl">1e-4</span></span>
<span id="cb164-11"><a href="#cb164-11" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>(Xt_prod.shape[<span class="dv">1</span>],Xt_prod.shape[<span class="dv">2</span>])</span>
<span id="cb164-12"><a href="#cb164-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-13"><a href="#cb164-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-14"><a href="#cb164-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ------ Choose the batch size ------</span></span>
<span id="cb164-15"><a href="#cb164-15" aria-hidden="true" tabindex="-1"></a><span class="co"># batch_size=1                       # stocastic training</span></span>
<span id="cb164-16"><a href="#cb164-16" aria-hidden="true" tabindex="-1"></a><span class="co"># # batch_size=int(len(x_train)/2.)    # mini-batch training</span></span>
<span id="cb164-17"><a href="#cb164-17" aria-hidden="true" tabindex="-1"></a>batch_size<span class="op">=</span><span class="bu">len</span>(Xt1_prod)              <span class="co"># batch training</span></span>
<span id="cb164-18"><a href="#cb164-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-19"><a href="#cb164-19" aria-hidden="true" tabindex="-1"></a><span class="co"># BUILD MODEL</span></span>
<span id="cb164-20"><a href="#cb164-20" aria-hidden="true" tabindex="-1"></a>recurrent_hidden_units<span class="op">=</span><span class="dv">32</span></span>
<span id="cb164-21"><a href="#cb164-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-22"><a href="#cb164-22" aria-hidden="true" tabindex="-1"></a><span class="co"># CREATE MODEL</span></span>
<span id="cb164-23"><a href="#cb164-23" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> keras.Sequential()</span>
<span id="cb164-24"><a href="#cb164-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-25"><a href="#cb164-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ADD RECURRENT LAYER</span></span>
<span id="cb164-26"><a href="#cb164-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-27"><a href="#cb164-27" aria-hidden="true" tabindex="-1"></a><span class="co"># #COMMENT/UNCOMMENT TO USE RNN, LSTM,GRU</span></span>
<span id="cb164-28"><a href="#cb164-28" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(LSTM(</span></span>
<span id="cb164-29"><a href="#cb164-29" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(GRU(</span></span>
<span id="cb164-30"><a href="#cb164-30" aria-hidden="true" tabindex="-1"></a>model.add(SimpleRNN(</span>
<span id="cb164-31"><a href="#cb164-31" aria-hidden="true" tabindex="-1"></a>units<span class="op">=</span>recurrent_hidden_units,</span>
<span id="cb164-32"><a href="#cb164-32" aria-hidden="true" tabindex="-1"></a>return_sequences<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb164-33"><a href="#cb164-33" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>input_shape,</span>
<span id="cb164-34"><a href="#cb164-34" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_dropout=0.8,</span></span>
<span id="cb164-35"><a href="#cb164-35" aria-hidden="true" tabindex="-1"></a>recurrent_regularizer<span class="op">=</span>regularizers.L2(L2),</span>
<span id="cb164-36"><a href="#cb164-36" aria-hidden="true" tabindex="-1"></a>activation<span class="op">=</span><span class="st">'relu'</span>)</span>
<span id="cb164-37"><a href="#cb164-37" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb164-38"><a href="#cb164-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-39"><a href="#cb164-39" aria-hidden="true" tabindex="-1"></a><span class="co"># NEED TO TAKE THE OUTPUT RNN AND CONVERT TO SCALAR</span></span>
<span id="cb164-40"><a href="#cb164-40" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span><span class="st">'linear'</span>))</span>
<span id="cb164-41"><a href="#cb164-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-42"><a href="#cb164-42" aria-hidden="true" tabindex="-1"></a><span class="co"># MODEL SUMMARY</span></span>
<span id="cb164-43"><a href="#cb164-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())<span class="op">;</span> <span class="co">#print(x_train.shape,y_train.shape)</span></span>
<span id="cb164-44"><a href="#cb164-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-45"><a href="#cb164-45" aria-hidden="true" tabindex="-1"></a><span class="co"># # COMPILING THE MODEL</span></span>
<span id="cb164-46"><a href="#cb164-46" aria-hidden="true" tabindex="-1"></a>opt <span class="op">=</span> keras.optimizers.RMSprop(learning_rate<span class="op">=</span>learning_rate)</span>
<span id="cb164-47"><a href="#cb164-47" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>opt, loss<span class="op">=</span>loss_function)</span>
<span id="cb164-48"><a href="#cb164-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-49"><a href="#cb164-49" aria-hidden="true" tabindex="-1"></a><span class="co"># TRAINING YOUR MODEL</span></span>
<span id="cb164-50"><a href="#cb164-50" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(</span>
<span id="cb164-51"><a href="#cb164-51" aria-hidden="true" tabindex="-1"></a>    Xt_prod,</span>
<span id="cb164-52"><a href="#cb164-52" aria-hidden="true" tabindex="-1"></a>    Yt_prod,</span>
<span id="cb164-53"><a href="#cb164-53" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span>numbers_epochs,</span>
<span id="cb164-54"><a href="#cb164-54" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span>batch_size,</span>
<span id="cb164-55"><a href="#cb164-55" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb164-56"><a href="#cb164-56" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>(Xv_prod, Yv_prod),</span>
<span id="cb164-57"><a href="#cb164-57" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb164-58"><a href="#cb164-58" aria-hidden="true" tabindex="-1"></a><span class="co"># History plot</span></span>
<span id="cb164-59"><a href="#cb164-59" aria-hidden="true" tabindex="-1"></a>history_plot(history)</span>
<span id="cb164-60"><a href="#cb164-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-61"><a href="#cb164-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb164-62"><a href="#cb164-62" aria-hidden="true" tabindex="-1"></a>Ytp_prod <span class="op">=</span> model.predict(Xt_prod)</span>
<span id="cb164-63"><a href="#cb164-63" aria-hidden="true" tabindex="-1"></a>Yvp_prod <span class="op">=</span> model.predict(Xv_prod)</span>
<span id="cb164-64"><a href="#cb164-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-65"><a href="#cb164-65" aria-hidden="true" tabindex="-1"></a><span class="co"># REPORT</span></span>
<span id="cb164-66"><a href="#cb164-66" aria-hidden="true" tabindex="-1"></a>regression_report(Yt_prod, Ytp_prod, Yv_prod, Yvp_prod)</span>
<span id="cb164-67"><a href="#cb164-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-68"><a href="#cb164-68" aria-hidden="true" tabindex="-1"></a><span class="co"># compute RMSE using numpy</span></span>
<span id="cb164-69"><a href="#cb164-69" aria-hidden="true" tabindex="-1"></a>training_RMSE_prod <span class="op">=</span> np.sqrt(mean_squared_error(Yt_prod, Ytp_prod))</span>
<span id="cb164-70"><a href="#cb164-70" aria-hidden="true" tabindex="-1"></a>validation_RMSE_prod <span class="op">=</span> np.sqrt(mean_squared_error(Yv_prod, Yvp_prod))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(157, 5, 1) --&gt; (157, 1)
(49, 5, 1) --&gt; (49, 1)
Model: "sequential_9"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 simple_rnn_9 (SimpleRNN)    (None, 32)                1088      
                                                                 
 dense_9 (Dense)             (None, 1)                 33        
                                                                 
=================================================================
Total params: 1121 (4.38 KB)
Trainable params: 1121 (4.38 KB)
Non-trainable params: 0 (0.00 Byte)
_________________________________________________________________
None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-71-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>5/5 [==============================] - 0s 3ms/step
2/2 [==============================] - 0s 7ms/step
---------- Regression report ----------
TRAINING:
 MSE: 0.01818179822574183
 MAE: 0.10452351690930663</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-71-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-71-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>VALIDATION:
 MSE: 0.08730496132160037
 MAE: 0.2596031001030938</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-71-output-7.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-71-output-8.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Error Summary</strong></p>
<div class="cell" data-outputid="7dbd441e-898d-45c4-fac3-8835ad117d7e" data-execution_count="73">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a>error_table_prod_rnn_l2 <span class="op">=</span> [[<span class="st">'Model'</span>,<span class="st">'train_MSE'</span>,<span class="st">'train_MAE'</span>,<span class="st">'train_RMSE'</span>,<span class="st">'val_MSE'</span>,<span class="st">'val_MAE'</span>,<span class="st">'val_RMSE'</span>],</span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>              [<span class="st">'RNN(L2 Reg)'</span>,</span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yt_prod, Ytp_prod),</span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yt_prod, Ytp_prod),</span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a>              training_RMSE_prod,</span>
<span id="cb168-6"><a href="#cb168-6" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yv_prod, Yvp_prod),</span>
<span id="cb168-7"><a href="#cb168-7" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yv_prod, Yvp_prod),</span>
<span id="cb168-8"><a href="#cb168-8" aria-hidden="true" tabindex="-1"></a>               validation_RMSE_prod]]</span>
<span id="cb168-9"><a href="#cb168-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(error_table_prod_rnn_l2, headers<span class="op">=</span><span class="st">'firstrow'</span>, tablefmt<span class="op">=</span><span class="st">'fancy_grid'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>╒═════════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model       │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞═════════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ RNN(L2 Reg) │   0.0181818 │    0.104524 │      0.13484 │  0.087305 │  0.259603 │   0.295474 │
╘═════════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
</div>
<div id="tabset-8-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-4-tab">
<div class="cell" data-outputid="98b385ca-6847-412c-84d8-cb82947a6142" data-execution_count="74">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW SIZES</span></span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xt_imp.shape, <span class="st">"--&gt;"</span>, Yt_imp.shape)</span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xv_imp.shape, <span class="st">"--&gt;"</span>, Yv_imp.shape)</span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-5"><a href="#cb170-5" aria-hidden="true" tabindex="-1"></a><span class="co"># HYPERPARAMETERS</span></span>
<span id="cb170-6"><a href="#cb170-6" aria-hidden="true" tabindex="-1"></a>optimizer<span class="op">=</span><span class="st">"rmsprop"</span></span>
<span id="cb170-7"><a href="#cb170-7" aria-hidden="true" tabindex="-1"></a>loss_function<span class="op">=</span><span class="st">"MeanSquaredError"</span></span>
<span id="cb170-8"><a href="#cb170-8" aria-hidden="true" tabindex="-1"></a>learning_rate<span class="op">=</span><span class="fl">0.001</span></span>
<span id="cb170-9"><a href="#cb170-9" aria-hidden="true" tabindex="-1"></a>numbers_epochs<span class="op">=</span><span class="dv">200</span> <span class="co">#100</span></span>
<span id="cb170-10"><a href="#cb170-10" aria-hidden="true" tabindex="-1"></a>L2<span class="op">=</span><span class="fl">1e-4</span></span>
<span id="cb170-11"><a href="#cb170-11" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>(Xt_imp.shape[<span class="dv">1</span>],Xt_imp.shape[<span class="dv">2</span>])</span>
<span id="cb170-12"><a href="#cb170-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-13"><a href="#cb170-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-14"><a href="#cb170-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ------ Choose the batch size ------</span></span>
<span id="cb170-15"><a href="#cb170-15" aria-hidden="true" tabindex="-1"></a><span class="co"># batch_size=1                       # stocastic training</span></span>
<span id="cb170-16"><a href="#cb170-16" aria-hidden="true" tabindex="-1"></a><span class="co"># # batch_size=int(len(x_train)/2.)    # mini-batch training</span></span>
<span id="cb170-17"><a href="#cb170-17" aria-hidden="true" tabindex="-1"></a>batch_size<span class="op">=</span><span class="bu">len</span>(Xt1_imp)              <span class="co"># batch training</span></span>
<span id="cb170-18"><a href="#cb170-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-19"><a href="#cb170-19" aria-hidden="true" tabindex="-1"></a><span class="co"># BUILD MODEL</span></span>
<span id="cb170-20"><a href="#cb170-20" aria-hidden="true" tabindex="-1"></a>recurrent_hidden_units<span class="op">=</span><span class="dv">32</span></span>
<span id="cb170-21"><a href="#cb170-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-22"><a href="#cb170-22" aria-hidden="true" tabindex="-1"></a><span class="co"># CREATE MODEL</span></span>
<span id="cb170-23"><a href="#cb170-23" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> keras.Sequential()</span>
<span id="cb170-24"><a href="#cb170-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-25"><a href="#cb170-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ADD RECURRENT LAYER</span></span>
<span id="cb170-26"><a href="#cb170-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-27"><a href="#cb170-27" aria-hidden="true" tabindex="-1"></a><span class="co"># #COMMENT/UNCOMMENT TO USE RNN, LSTM,GRU</span></span>
<span id="cb170-28"><a href="#cb170-28" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(LSTM(</span></span>
<span id="cb170-29"><a href="#cb170-29" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(GRU(</span></span>
<span id="cb170-30"><a href="#cb170-30" aria-hidden="true" tabindex="-1"></a>model.add(SimpleRNN(</span>
<span id="cb170-31"><a href="#cb170-31" aria-hidden="true" tabindex="-1"></a>units<span class="op">=</span>recurrent_hidden_units,</span>
<span id="cb170-32"><a href="#cb170-32" aria-hidden="true" tabindex="-1"></a>return_sequences<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb170-33"><a href="#cb170-33" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>input_shape,</span>
<span id="cb170-34"><a href="#cb170-34" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_dropout=0.8,</span></span>
<span id="cb170-35"><a href="#cb170-35" aria-hidden="true" tabindex="-1"></a>recurrent_regularizer<span class="op">=</span>regularizers.L2(L2),</span>
<span id="cb170-36"><a href="#cb170-36" aria-hidden="true" tabindex="-1"></a>activation<span class="op">=</span><span class="st">'relu'</span>)</span>
<span id="cb170-37"><a href="#cb170-37" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb170-38"><a href="#cb170-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-39"><a href="#cb170-39" aria-hidden="true" tabindex="-1"></a><span class="co"># NEED TO TAKE THE OUTPUT RNN AND CONVERT TO SCALAR</span></span>
<span id="cb170-40"><a href="#cb170-40" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span><span class="st">'linear'</span>))</span>
<span id="cb170-41"><a href="#cb170-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-42"><a href="#cb170-42" aria-hidden="true" tabindex="-1"></a><span class="co"># MODEL SUMMARY</span></span>
<span id="cb170-43"><a href="#cb170-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())<span class="op">;</span> <span class="co">#print(x_train.shape,y_train.shape)</span></span>
<span id="cb170-44"><a href="#cb170-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-45"><a href="#cb170-45" aria-hidden="true" tabindex="-1"></a><span class="co"># # COMPILING THE MODEL</span></span>
<span id="cb170-46"><a href="#cb170-46" aria-hidden="true" tabindex="-1"></a>opt <span class="op">=</span> keras.optimizers.RMSprop(learning_rate<span class="op">=</span>learning_rate)</span>
<span id="cb170-47"><a href="#cb170-47" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>opt, loss<span class="op">=</span>loss_function)</span>
<span id="cb170-48"><a href="#cb170-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-49"><a href="#cb170-49" aria-hidden="true" tabindex="-1"></a><span class="co"># TRAINING YOUR MODEL</span></span>
<span id="cb170-50"><a href="#cb170-50" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(</span>
<span id="cb170-51"><a href="#cb170-51" aria-hidden="true" tabindex="-1"></a>    Xt_imp,</span>
<span id="cb170-52"><a href="#cb170-52" aria-hidden="true" tabindex="-1"></a>    Yt_imp,</span>
<span id="cb170-53"><a href="#cb170-53" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span>numbers_epochs,</span>
<span id="cb170-54"><a href="#cb170-54" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span>batch_size,</span>
<span id="cb170-55"><a href="#cb170-55" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb170-56"><a href="#cb170-56" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>(Xv_imp, Yv_imp),</span>
<span id="cb170-57"><a href="#cb170-57" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb170-58"><a href="#cb170-58" aria-hidden="true" tabindex="-1"></a><span class="co"># History plot</span></span>
<span id="cb170-59"><a href="#cb170-59" aria-hidden="true" tabindex="-1"></a>history_plot(history)</span>
<span id="cb170-60"><a href="#cb170-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-61"><a href="#cb170-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb170-62"><a href="#cb170-62" aria-hidden="true" tabindex="-1"></a>Ytp_imp <span class="op">=</span> model.predict(Xt_imp)</span>
<span id="cb170-63"><a href="#cb170-63" aria-hidden="true" tabindex="-1"></a>Yvp_imp <span class="op">=</span> model.predict(Xv_imp)</span>
<span id="cb170-64"><a href="#cb170-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-65"><a href="#cb170-65" aria-hidden="true" tabindex="-1"></a><span class="co"># REPORT</span></span>
<span id="cb170-66"><a href="#cb170-66" aria-hidden="true" tabindex="-1"></a>regression_report(Yt_imp, Ytp_imp, Yv_imp, Yvp_imp)</span>
<span id="cb170-67"><a href="#cb170-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-68"><a href="#cb170-68" aria-hidden="true" tabindex="-1"></a><span class="co"># compute RMSE using numpy</span></span>
<span id="cb170-69"><a href="#cb170-69" aria-hidden="true" tabindex="-1"></a>training_RMSE_imp <span class="op">=</span> np.sqrt(mean_squared_error(Yt_imp, Ytp_imp))</span>
<span id="cb170-70"><a href="#cb170-70" aria-hidden="true" tabindex="-1"></a>validation_RMSE_imp <span class="op">=</span> np.sqrt(mean_squared_error(Yv_imp, Yvp_imp))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(229, 5, 1) --&gt; (229, 1)
(73, 5, 1) --&gt; (73, 1)
Model: "sequential_10"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 simple_rnn_10 (SimpleRNN)   (None, 32)                1088      
                                                                 
 dense_10 (Dense)            (None, 1)                 33        
                                                                 
=================================================================
Total params: 1121 (4.38 KB)
Trainable params: 1121 (4.38 KB)
Non-trainable params: 0 (0.00 Byte)
_________________________________________________________________
None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-73-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>8/8 [==============================] - 0s 2ms/step
3/3 [==============================] - 0s 4ms/step
---------- Regression report ----------
TRAINING:
 MSE: 0.12219420752197113
 MAE: 0.2650835268729244</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-73-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-73-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>VALIDATION:
 MSE: 0.13696709684218533
 MAE: 0.29662623805609023</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-73-output-7.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-73-output-8.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Error Summary</strong></p>
<div class="cell" data-outputid="f0748688-45eb-428c-b204-24f3a58e49a3" data-execution_count="75">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a>error_table_imp_rnn_l2 <span class="op">=</span> [[<span class="st">'Model'</span>,<span class="st">'train_MSE'</span>,<span class="st">'train_MAE'</span>,<span class="st">'train_RMSE'</span>,<span class="st">'val_MSE'</span>,<span class="st">'val_MAE'</span>,<span class="st">'val_RMSE'</span>],</span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a>              [<span class="st">'RNN(L2 Reg)'</span>,</span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yt_imp, Ytp_imp),</span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yt_imp, Ytp_imp),</span>
<span id="cb174-5"><a href="#cb174-5" aria-hidden="true" tabindex="-1"></a>               training_RMSE_imp,</span>
<span id="cb174-6"><a href="#cb174-6" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yv_imp, Yvp_imp),</span>
<span id="cb174-7"><a href="#cb174-7" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yv_imp, Yvp_imp),</span>
<span id="cb174-8"><a href="#cb174-8" aria-hidden="true" tabindex="-1"></a>               validation_RMSE_imp]]</span>
<span id="cb174-9"><a href="#cb174-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(error_table_imp_rnn_l2, headers<span class="op">=</span><span class="st">'firstrow'</span>, tablefmt<span class="op">=</span><span class="st">'fancy_grid'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>╒═════════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model       │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞═════════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ RNN(L2 Reg) │    0.122194 │    0.265084 │     0.349563 │  0.136967 │  0.296626 │   0.370091 │
╘═════════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
</div>
<div id="tabset-8-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-5-tab">
<div class="cell" data-outputid="f5d9e3b7-cf30-47f0-f62b-64cdeb5b73c6" data-execution_count="76">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW SIZES</span></span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xt_exp.shape, <span class="st">"--&gt;"</span>, Yt_exp.shape)</span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xv_exp.shape, <span class="st">"--&gt;"</span>, Yv_exp.shape)</span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-5"><a href="#cb176-5" aria-hidden="true" tabindex="-1"></a><span class="co"># HYPERPARAMETERS</span></span>
<span id="cb176-6"><a href="#cb176-6" aria-hidden="true" tabindex="-1"></a>optimizer<span class="op">=</span><span class="st">"rmsprop"</span></span>
<span id="cb176-7"><a href="#cb176-7" aria-hidden="true" tabindex="-1"></a>loss_function<span class="op">=</span><span class="st">"MeanSquaredError"</span></span>
<span id="cb176-8"><a href="#cb176-8" aria-hidden="true" tabindex="-1"></a>learning_rate<span class="op">=</span><span class="fl">0.001</span></span>
<span id="cb176-9"><a href="#cb176-9" aria-hidden="true" tabindex="-1"></a>numbers_epochs<span class="op">=</span><span class="dv">200</span> <span class="co">#100</span></span>
<span id="cb176-10"><a href="#cb176-10" aria-hidden="true" tabindex="-1"></a>L2<span class="op">=</span><span class="fl">1e-4</span></span>
<span id="cb176-11"><a href="#cb176-11" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>(Xt_exp.shape[<span class="dv">1</span>],Xt_exp.shape[<span class="dv">2</span>])</span>
<span id="cb176-12"><a href="#cb176-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-13"><a href="#cb176-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-14"><a href="#cb176-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ------ Choose the batch size ------</span></span>
<span id="cb176-15"><a href="#cb176-15" aria-hidden="true" tabindex="-1"></a><span class="co"># batch_size=1                       # stocastic training</span></span>
<span id="cb176-16"><a href="#cb176-16" aria-hidden="true" tabindex="-1"></a><span class="co"># # batch_size=int(len(x_train)/2.)    # mini-batch training</span></span>
<span id="cb176-17"><a href="#cb176-17" aria-hidden="true" tabindex="-1"></a>batch_size<span class="op">=</span><span class="bu">len</span>(Xt1_exp)              <span class="co"># batch training</span></span>
<span id="cb176-18"><a href="#cb176-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-19"><a href="#cb176-19" aria-hidden="true" tabindex="-1"></a><span class="co"># BUILD MODEL</span></span>
<span id="cb176-20"><a href="#cb176-20" aria-hidden="true" tabindex="-1"></a>recurrent_hidden_units<span class="op">=</span><span class="dv">32</span></span>
<span id="cb176-21"><a href="#cb176-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-22"><a href="#cb176-22" aria-hidden="true" tabindex="-1"></a><span class="co"># CREATE MODEL</span></span>
<span id="cb176-23"><a href="#cb176-23" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> keras.Sequential()</span>
<span id="cb176-24"><a href="#cb176-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-25"><a href="#cb176-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ADD RECURRENT LAYER</span></span>
<span id="cb176-26"><a href="#cb176-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-27"><a href="#cb176-27" aria-hidden="true" tabindex="-1"></a><span class="co"># #COMMENT/UNCOMMENT TO USE RNN, LSTM,GRU</span></span>
<span id="cb176-28"><a href="#cb176-28" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(LSTM(</span></span>
<span id="cb176-29"><a href="#cb176-29" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(GRU(</span></span>
<span id="cb176-30"><a href="#cb176-30" aria-hidden="true" tabindex="-1"></a>model.add(SimpleRNN(</span>
<span id="cb176-31"><a href="#cb176-31" aria-hidden="true" tabindex="-1"></a>units<span class="op">=</span>recurrent_hidden_units,</span>
<span id="cb176-32"><a href="#cb176-32" aria-hidden="true" tabindex="-1"></a>return_sequences<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb176-33"><a href="#cb176-33" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>input_shape,</span>
<span id="cb176-34"><a href="#cb176-34" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_dropout=0.8,</span></span>
<span id="cb176-35"><a href="#cb176-35" aria-hidden="true" tabindex="-1"></a>recurrent_regularizer<span class="op">=</span>regularizers.L2(L2),</span>
<span id="cb176-36"><a href="#cb176-36" aria-hidden="true" tabindex="-1"></a>activation<span class="op">=</span><span class="st">'relu'</span>)</span>
<span id="cb176-37"><a href="#cb176-37" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb176-38"><a href="#cb176-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-39"><a href="#cb176-39" aria-hidden="true" tabindex="-1"></a><span class="co"># NEED TO TAKE THE OUTPUT RNN AND CONVERT TO SCALAR</span></span>
<span id="cb176-40"><a href="#cb176-40" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span><span class="st">'linear'</span>))</span>
<span id="cb176-41"><a href="#cb176-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-42"><a href="#cb176-42" aria-hidden="true" tabindex="-1"></a><span class="co"># MODEL SUMMARY</span></span>
<span id="cb176-43"><a href="#cb176-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())<span class="op">;</span> <span class="co">#print(x_train.shape,y_train.shape)</span></span>
<span id="cb176-44"><a href="#cb176-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-45"><a href="#cb176-45" aria-hidden="true" tabindex="-1"></a><span class="co"># # COMPILING THE MODEL</span></span>
<span id="cb176-46"><a href="#cb176-46" aria-hidden="true" tabindex="-1"></a>opt <span class="op">=</span> keras.optimizers.RMSprop(learning_rate<span class="op">=</span>learning_rate)</span>
<span id="cb176-47"><a href="#cb176-47" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>opt, loss<span class="op">=</span>loss_function)</span>
<span id="cb176-48"><a href="#cb176-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-49"><a href="#cb176-49" aria-hidden="true" tabindex="-1"></a><span class="co"># TRAINING YOUR MODEL</span></span>
<span id="cb176-50"><a href="#cb176-50" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(</span>
<span id="cb176-51"><a href="#cb176-51" aria-hidden="true" tabindex="-1"></a>    Xt_exp,</span>
<span id="cb176-52"><a href="#cb176-52" aria-hidden="true" tabindex="-1"></a>    Yt_exp,</span>
<span id="cb176-53"><a href="#cb176-53" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span>numbers_epochs,</span>
<span id="cb176-54"><a href="#cb176-54" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span>batch_size,</span>
<span id="cb176-55"><a href="#cb176-55" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb176-56"><a href="#cb176-56" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>(Xv_exp, Yv_exp),</span>
<span id="cb176-57"><a href="#cb176-57" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb176-58"><a href="#cb176-58" aria-hidden="true" tabindex="-1"></a><span class="co"># History plot</span></span>
<span id="cb176-59"><a href="#cb176-59" aria-hidden="true" tabindex="-1"></a>history_plot(history)</span>
<span id="cb176-60"><a href="#cb176-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-61"><a href="#cb176-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb176-62"><a href="#cb176-62" aria-hidden="true" tabindex="-1"></a>Ytp_exp <span class="op">=</span> model.predict(Xt_exp)</span>
<span id="cb176-63"><a href="#cb176-63" aria-hidden="true" tabindex="-1"></a>Yvp_exp <span class="op">=</span> model.predict(Xv_exp)</span>
<span id="cb176-64"><a href="#cb176-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-65"><a href="#cb176-65" aria-hidden="true" tabindex="-1"></a><span class="co"># REPORT</span></span>
<span id="cb176-66"><a href="#cb176-66" aria-hidden="true" tabindex="-1"></a>regression_report(Yt_exp, Ytp_exp, Yv_exp, Yvp_exp)</span>
<span id="cb176-67"><a href="#cb176-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-68"><a href="#cb176-68" aria-hidden="true" tabindex="-1"></a><span class="co"># compute RMSE using numpy</span></span>
<span id="cb176-69"><a href="#cb176-69" aria-hidden="true" tabindex="-1"></a>training_RMSE_exp <span class="op">=</span> np.sqrt(mean_squared_error(Yt_exp, Ytp_exp))</span>
<span id="cb176-70"><a href="#cb176-70" aria-hidden="true" tabindex="-1"></a>validation_RMSE_exp <span class="op">=</span> np.sqrt(mean_squared_error(Yv_exp, Yvp_exp))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(229, 5, 1) --&gt; (229, 1)
(73, 5, 1) --&gt; (73, 1)
Model: "sequential_11"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 simple_rnn_11 (SimpleRNN)   (None, 32)                1088      
                                                                 
 dense_11 (Dense)            (None, 1)                 33        
                                                                 
=================================================================
Total params: 1121 (4.38 KB)
Trainable params: 1121 (4.38 KB)
Non-trainable params: 0 (0.00 Byte)
_________________________________________________________________
None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-75-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>8/8 [==============================] - 0s 3ms/step
3/3 [==============================] - 0s 6ms/step
---------- Regression report ----------
TRAINING:
 MSE: 0.00453961182804625
 MAE: 0.0536077609618094</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-75-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-75-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>VALIDATION:
 MSE: 1.2263178960178174
 MAE: 0.9641191578617606</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-75-output-7.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-75-output-8.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Error Summary</strong></p>
<div class="cell" data-outputid="98de7604-9fa9-40c1-b0e8-d4728f878ad6" data-execution_count="77">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a>error_table_exp_rnn_l2 <span class="op">=</span> [[<span class="st">'Model'</span>,<span class="st">'train_MSE'</span>,<span class="st">'train_MAE'</span>,<span class="st">'train_RMSE'</span>,<span class="st">'val_MSE'</span>,<span class="st">'val_MAE'</span>,<span class="st">'val_RMSE'</span>],</span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a>              [<span class="st">'RNN(L2 Reg)'</span>,</span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yt_exp, Ytp_exp),</span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yt_exp, Ytp_exp),</span>
<span id="cb180-5"><a href="#cb180-5" aria-hidden="true" tabindex="-1"></a>               training_RMSE_exp,</span>
<span id="cb180-6"><a href="#cb180-6" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yv_exp, Yvp_exp),</span>
<span id="cb180-7"><a href="#cb180-7" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yv_exp, Yvp_exp),</span>
<span id="cb180-8"><a href="#cb180-8" aria-hidden="true" tabindex="-1"></a>               validation_RMSE_exp]]</span>
<span id="cb180-9"><a href="#cb180-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(error_table_exp_rnn_l2, headers<span class="op">=</span><span class="st">'firstrow'</span>, tablefmt<span class="op">=</span><span class="st">'fancy_grid'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>╒═════════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model       │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞═════════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ RNN(L2 Reg) │  0.00453961 │   0.0536078 │    0.0673766 │   1.22632 │  0.964119 │    1.10739 │
╘═════════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
</div>
<div id="tabset-8-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-6-tab">
<div class="cell" data-outputid="e12c8465-6d39-41f5-c058-eaa59a71f49a" data-execution_count="78">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW SIZES</span></span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xt_stk.shape, <span class="st">"--&gt;"</span>, Yt_stk.shape)</span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xv_stk.shape, <span class="st">"--&gt;"</span>, Yv_stk.shape)</span>
<span id="cb182-4"><a href="#cb182-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-5"><a href="#cb182-5" aria-hidden="true" tabindex="-1"></a><span class="co"># HYPERPARAMETERS</span></span>
<span id="cb182-6"><a href="#cb182-6" aria-hidden="true" tabindex="-1"></a>optimizer<span class="op">=</span><span class="st">"rmsprop"</span></span>
<span id="cb182-7"><a href="#cb182-7" aria-hidden="true" tabindex="-1"></a>loss_function<span class="op">=</span><span class="st">"MeanSquaredError"</span></span>
<span id="cb182-8"><a href="#cb182-8" aria-hidden="true" tabindex="-1"></a>learning_rate<span class="op">=</span><span class="fl">0.001</span></span>
<span id="cb182-9"><a href="#cb182-9" aria-hidden="true" tabindex="-1"></a>numbers_epochs<span class="op">=</span><span class="dv">200</span> <span class="co">#100</span></span>
<span id="cb182-10"><a href="#cb182-10" aria-hidden="true" tabindex="-1"></a>L2<span class="op">=</span><span class="fl">1e-4</span></span>
<span id="cb182-11"><a href="#cb182-11" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>(Xt_stk.shape[<span class="dv">1</span>],Xt_stk.shape[<span class="dv">2</span>])</span>
<span id="cb182-12"><a href="#cb182-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-13"><a href="#cb182-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-14"><a href="#cb182-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ------ Choose the batch size ------</span></span>
<span id="cb182-15"><a href="#cb182-15" aria-hidden="true" tabindex="-1"></a><span class="co"># batch_size=1                       # stocastic training</span></span>
<span id="cb182-16"><a href="#cb182-16" aria-hidden="true" tabindex="-1"></a><span class="co"># # batch_size=int(len(x_train)/2.)    # mini-batch training</span></span>
<span id="cb182-17"><a href="#cb182-17" aria-hidden="true" tabindex="-1"></a>batch_size<span class="op">=</span><span class="bu">len</span>(Xt1_stk)              <span class="co"># batch training</span></span>
<span id="cb182-18"><a href="#cb182-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-19"><a href="#cb182-19" aria-hidden="true" tabindex="-1"></a><span class="co"># BUILD MODEL</span></span>
<span id="cb182-20"><a href="#cb182-20" aria-hidden="true" tabindex="-1"></a>recurrent_hidden_units<span class="op">=</span><span class="dv">32</span></span>
<span id="cb182-21"><a href="#cb182-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-22"><a href="#cb182-22" aria-hidden="true" tabindex="-1"></a><span class="co"># CREATE MODEL</span></span>
<span id="cb182-23"><a href="#cb182-23" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> keras.Sequential()</span>
<span id="cb182-24"><a href="#cb182-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-25"><a href="#cb182-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ADD RECURRENT LAYER</span></span>
<span id="cb182-26"><a href="#cb182-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-27"><a href="#cb182-27" aria-hidden="true" tabindex="-1"></a><span class="co"># #COMMENT/UNCOMMENT TO USE RNN, LSTM,GRU</span></span>
<span id="cb182-28"><a href="#cb182-28" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(LSTM(</span></span>
<span id="cb182-29"><a href="#cb182-29" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(GRU(</span></span>
<span id="cb182-30"><a href="#cb182-30" aria-hidden="true" tabindex="-1"></a>model.add(SimpleRNN(</span>
<span id="cb182-31"><a href="#cb182-31" aria-hidden="true" tabindex="-1"></a>units<span class="op">=</span>recurrent_hidden_units,</span>
<span id="cb182-32"><a href="#cb182-32" aria-hidden="true" tabindex="-1"></a>return_sequences<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb182-33"><a href="#cb182-33" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>input_shape,</span>
<span id="cb182-34"><a href="#cb182-34" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_dropout=0.8,</span></span>
<span id="cb182-35"><a href="#cb182-35" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_regularizer=False</span></span>
<span id="cb182-36"><a href="#cb182-36" aria-hidden="true" tabindex="-1"></a>recurrent_regularizer<span class="op">=</span>regularizers.L2(L2),</span>
<span id="cb182-37"><a href="#cb182-37" aria-hidden="true" tabindex="-1"></a>activation<span class="op">=</span><span class="st">'relu'</span>)</span>
<span id="cb182-38"><a href="#cb182-38" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb182-39"><a href="#cb182-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-40"><a href="#cb182-40" aria-hidden="true" tabindex="-1"></a><span class="co"># NEED TO TAKE THE OUTPUT RNN AND CONVERT TO SCALAR</span></span>
<span id="cb182-41"><a href="#cb182-41" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span><span class="st">'linear'</span>))</span>
<span id="cb182-42"><a href="#cb182-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-43"><a href="#cb182-43" aria-hidden="true" tabindex="-1"></a><span class="co"># MODEL SUMMARY</span></span>
<span id="cb182-44"><a href="#cb182-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())<span class="op">;</span> <span class="co">#print(x_train.shape,y_train.shape)</span></span>
<span id="cb182-45"><a href="#cb182-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-46"><a href="#cb182-46" aria-hidden="true" tabindex="-1"></a><span class="co"># # COMPILING THE MODEL</span></span>
<span id="cb182-47"><a href="#cb182-47" aria-hidden="true" tabindex="-1"></a>opt <span class="op">=</span> keras.optimizers.RMSprop(learning_rate<span class="op">=</span>learning_rate)</span>
<span id="cb182-48"><a href="#cb182-48" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>opt, loss<span class="op">=</span>loss_function)</span>
<span id="cb182-49"><a href="#cb182-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-50"><a href="#cb182-50" aria-hidden="true" tabindex="-1"></a><span class="co"># TRAINING YOUR MODEL</span></span>
<span id="cb182-51"><a href="#cb182-51" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(</span>
<span id="cb182-52"><a href="#cb182-52" aria-hidden="true" tabindex="-1"></a>    Xt_stk,</span>
<span id="cb182-53"><a href="#cb182-53" aria-hidden="true" tabindex="-1"></a>    Yt_stk,</span>
<span id="cb182-54"><a href="#cb182-54" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span>numbers_epochs,</span>
<span id="cb182-55"><a href="#cb182-55" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span>batch_size,</span>
<span id="cb182-56"><a href="#cb182-56" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb182-57"><a href="#cb182-57" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>(Xv_stk, Yv_stk),</span>
<span id="cb182-58"><a href="#cb182-58" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb182-59"><a href="#cb182-59" aria-hidden="true" tabindex="-1"></a><span class="co"># History plot</span></span>
<span id="cb182-60"><a href="#cb182-60" aria-hidden="true" tabindex="-1"></a>history_plot(history)</span>
<span id="cb182-61"><a href="#cb182-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-62"><a href="#cb182-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb182-63"><a href="#cb182-63" aria-hidden="true" tabindex="-1"></a>Ytp_stk <span class="op">=</span> model.predict(Xt_stk)</span>
<span id="cb182-64"><a href="#cb182-64" aria-hidden="true" tabindex="-1"></a>Yvp_stk <span class="op">=</span> model.predict(Xv_stk)</span>
<span id="cb182-65"><a href="#cb182-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-66"><a href="#cb182-66" aria-hidden="true" tabindex="-1"></a><span class="co"># REPORT</span></span>
<span id="cb182-67"><a href="#cb182-67" aria-hidden="true" tabindex="-1"></a>regression_report(Yt_stk, Ytp_stk, Yv_stk, Yvp_stk)</span>
<span id="cb182-68"><a href="#cb182-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-69"><a href="#cb182-69" aria-hidden="true" tabindex="-1"></a><span class="co"># compute RMSE using numpy</span></span>
<span id="cb182-70"><a href="#cb182-70" aria-hidden="true" tabindex="-1"></a>training_RMSE_stk <span class="op">=</span> np.sqrt(mean_squared_error(Yt_stk, Ytp_stk))</span>
<span id="cb182-71"><a href="#cb182-71" aria-hidden="true" tabindex="-1"></a>validation_RMSE_stk <span class="op">=</span> np.sqrt(mean_squared_error(Yv_stk, Yvp_stk))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(3377, 5, 1) --&gt; (3377, 1)
(1123, 5, 1) --&gt; (1123, 1)
Model: "sequential_12"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 simple_rnn_12 (SimpleRNN)   (None, 32)                1088      
                                                                 
 dense_12 (Dense)            (None, 1)                 33        
                                                                 
=================================================================
Total params: 1121 (4.38 KB)
Trainable params: 1121 (4.38 KB)
Non-trainable params: 0 (0.00 Byte)
_________________________________________________________________
None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-77-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>106/106 [==============================] - 0s 2ms/step
36/36 [==============================] - 0s 2ms/step
---------- Regression report ----------
TRAINING:
 MSE: 0.001972599895865288
 MAE: 0.03555915816751766</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-77-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-77-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>VALIDATION:
 MSE: 0.012517007405626432
 MAE: 0.07993816860155734</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-77-output-7.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-77-output-8.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Error Summary</strong></p>
<div class="cell" data-outputid="08c87141-1903-4f34-aad3-916f0a5e4177" data-execution_count="79">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a>error_table_stk_rnn_l2 <span class="op">=</span> [[<span class="st">'Model'</span>,<span class="st">'train_MSE'</span>,<span class="st">'train_MAE'</span>,<span class="st">'train_RMSE'</span>,<span class="st">'val_MSE'</span>,<span class="st">'val_MAE'</span>,<span class="st">'val_RMSE'</span>],</span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a>              [<span class="st">'RNN(L2 Reg)'</span>,</span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yt_stk, Ytp_stk),</span>
<span id="cb186-4"><a href="#cb186-4" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yt_stk, Ytp_stk),</span>
<span id="cb186-5"><a href="#cb186-5" aria-hidden="true" tabindex="-1"></a>               training_RMSE_stk,</span>
<span id="cb186-6"><a href="#cb186-6" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yv_stk, Yvp_stk),</span>
<span id="cb186-7"><a href="#cb186-7" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yv_stk, Yvp_stk),</span>
<span id="cb186-8"><a href="#cb186-8" aria-hidden="true" tabindex="-1"></a>               validation_RMSE_stk]]</span>
<span id="cb186-9"><a href="#cb186-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(error_table_stk_rnn_l2, headers<span class="op">=</span><span class="st">'firstrow'</span>, tablefmt<span class="op">=</span><span class="st">'fancy_grid'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>╒═════════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model       │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞═════════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ RNN(L2 Reg) │   0.0019726 │   0.0355592 │     0.044414 │  0.012517 │ 0.0799382 │   0.111879 │
╘═════════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
</div>
<div id="tabset-8-7" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-7-tab">
<div class="cell" data-outputid="881285f5-6771-4c27-e99e-27d3cef8862b" data-execution_count="80">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW SIZES</span></span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xt_emissions.shape, <span class="st">"--&gt;"</span>, Yt_emissions.shape)</span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xv_emissions.shape, <span class="st">"--&gt;"</span>, Yv_emissions.shape)</span>
<span id="cb188-4"><a href="#cb188-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-5"><a href="#cb188-5" aria-hidden="true" tabindex="-1"></a><span class="co"># HYPERPARAMETERS</span></span>
<span id="cb188-6"><a href="#cb188-6" aria-hidden="true" tabindex="-1"></a>optimizer<span class="op">=</span><span class="st">"rmsprop"</span></span>
<span id="cb188-7"><a href="#cb188-7" aria-hidden="true" tabindex="-1"></a>loss_function<span class="op">=</span><span class="st">"MeanSquaredError"</span></span>
<span id="cb188-8"><a href="#cb188-8" aria-hidden="true" tabindex="-1"></a>learning_rate<span class="op">=</span><span class="fl">0.001</span></span>
<span id="cb188-9"><a href="#cb188-9" aria-hidden="true" tabindex="-1"></a>numbers_epochs<span class="op">=</span><span class="dv">200</span> <span class="co">#100</span></span>
<span id="cb188-10"><a href="#cb188-10" aria-hidden="true" tabindex="-1"></a>L2<span class="op">=</span><span class="fl">1e-4</span></span>
<span id="cb188-11"><a href="#cb188-11" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>(Xt_emissions.shape[<span class="dv">1</span>],Xt_emissions.shape[<span class="dv">2</span>])</span>
<span id="cb188-12"><a href="#cb188-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-13"><a href="#cb188-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-14"><a href="#cb188-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ------ Choose the batch size ------</span></span>
<span id="cb188-15"><a href="#cb188-15" aria-hidden="true" tabindex="-1"></a><span class="co"># batch_size=1                       # stocastic training</span></span>
<span id="cb188-16"><a href="#cb188-16" aria-hidden="true" tabindex="-1"></a><span class="co"># # batch_size=int(len(x_train)/2.)    # mini-batch training</span></span>
<span id="cb188-17"><a href="#cb188-17" aria-hidden="true" tabindex="-1"></a>batch_size<span class="op">=</span><span class="bu">len</span>(Xt1_emissions)              <span class="co"># batch training</span></span>
<span id="cb188-18"><a href="#cb188-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-19"><a href="#cb188-19" aria-hidden="true" tabindex="-1"></a><span class="co"># BUILD MODEL</span></span>
<span id="cb188-20"><a href="#cb188-20" aria-hidden="true" tabindex="-1"></a>recurrent_hidden_units<span class="op">=</span><span class="dv">32</span></span>
<span id="cb188-21"><a href="#cb188-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-22"><a href="#cb188-22" aria-hidden="true" tabindex="-1"></a><span class="co"># CREATE MODEL</span></span>
<span id="cb188-23"><a href="#cb188-23" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> keras.Sequential()</span>
<span id="cb188-24"><a href="#cb188-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-25"><a href="#cb188-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ADD RECURRENT LAYER</span></span>
<span id="cb188-26"><a href="#cb188-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-27"><a href="#cb188-27" aria-hidden="true" tabindex="-1"></a><span class="co"># #COMMENT/UNCOMMENT TO USE RNN, LSTM,GRU</span></span>
<span id="cb188-28"><a href="#cb188-28" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(LSTM(</span></span>
<span id="cb188-29"><a href="#cb188-29" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(GRU(</span></span>
<span id="cb188-30"><a href="#cb188-30" aria-hidden="true" tabindex="-1"></a>model.add(SimpleRNN(</span>
<span id="cb188-31"><a href="#cb188-31" aria-hidden="true" tabindex="-1"></a>units<span class="op">=</span>recurrent_hidden_units,</span>
<span id="cb188-32"><a href="#cb188-32" aria-hidden="true" tabindex="-1"></a>return_sequences<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb188-33"><a href="#cb188-33" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>input_shape,</span>
<span id="cb188-34"><a href="#cb188-34" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_dropout=0.8,</span></span>
<span id="cb188-35"><a href="#cb188-35" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_regularizer=False</span></span>
<span id="cb188-36"><a href="#cb188-36" aria-hidden="true" tabindex="-1"></a>recurrent_regularizer<span class="op">=</span>regularizers.L2(L2),</span>
<span id="cb188-37"><a href="#cb188-37" aria-hidden="true" tabindex="-1"></a>activation<span class="op">=</span><span class="st">'relu'</span>)</span>
<span id="cb188-38"><a href="#cb188-38" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb188-39"><a href="#cb188-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-40"><a href="#cb188-40" aria-hidden="true" tabindex="-1"></a><span class="co"># NEED TO TAKE THE OUTPUT RNN AND CONVERT TO SCALAR</span></span>
<span id="cb188-41"><a href="#cb188-41" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span><span class="st">'linear'</span>))</span>
<span id="cb188-42"><a href="#cb188-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-43"><a href="#cb188-43" aria-hidden="true" tabindex="-1"></a><span class="co"># MODEL SUMMARY</span></span>
<span id="cb188-44"><a href="#cb188-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())<span class="op">;</span> <span class="co">#print(x_train.shape,y_train.shape)</span></span>
<span id="cb188-45"><a href="#cb188-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-46"><a href="#cb188-46" aria-hidden="true" tabindex="-1"></a><span class="co"># # COMPILING THE MODEL</span></span>
<span id="cb188-47"><a href="#cb188-47" aria-hidden="true" tabindex="-1"></a>opt <span class="op">=</span> keras.optimizers.RMSprop(learning_rate<span class="op">=</span>learning_rate)</span>
<span id="cb188-48"><a href="#cb188-48" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>opt, loss<span class="op">=</span>loss_function)</span>
<span id="cb188-49"><a href="#cb188-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-50"><a href="#cb188-50" aria-hidden="true" tabindex="-1"></a><span class="co"># TRAINING YOUR MODEL</span></span>
<span id="cb188-51"><a href="#cb188-51" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(</span>
<span id="cb188-52"><a href="#cb188-52" aria-hidden="true" tabindex="-1"></a>    Xt_emissions,</span>
<span id="cb188-53"><a href="#cb188-53" aria-hidden="true" tabindex="-1"></a>    Yt_emissions,</span>
<span id="cb188-54"><a href="#cb188-54" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span>numbers_epochs,</span>
<span id="cb188-55"><a href="#cb188-55" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span>batch_size,</span>
<span id="cb188-56"><a href="#cb188-56" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb188-57"><a href="#cb188-57" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>(Xv_emissions, Yv_emissions),</span>
<span id="cb188-58"><a href="#cb188-58" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb188-59"><a href="#cb188-59" aria-hidden="true" tabindex="-1"></a><span class="co"># History plot</span></span>
<span id="cb188-60"><a href="#cb188-60" aria-hidden="true" tabindex="-1"></a>history_plot(history)</span>
<span id="cb188-61"><a href="#cb188-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-62"><a href="#cb188-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb188-63"><a href="#cb188-63" aria-hidden="true" tabindex="-1"></a>Ytp_emissions <span class="op">=</span> model.predict(Xt_emissions)</span>
<span id="cb188-64"><a href="#cb188-64" aria-hidden="true" tabindex="-1"></a>Yvp_emissions <span class="op">=</span> model.predict(Xv_emissions)</span>
<span id="cb188-65"><a href="#cb188-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-66"><a href="#cb188-66" aria-hidden="true" tabindex="-1"></a><span class="co"># REPORT</span></span>
<span id="cb188-67"><a href="#cb188-67" aria-hidden="true" tabindex="-1"></a>regression_report(Yt_emissions, Ytp_emissions, Yv_emissions, Yvp_emissions)</span>
<span id="cb188-68"><a href="#cb188-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-69"><a href="#cb188-69" aria-hidden="true" tabindex="-1"></a><span class="co"># compute RMSE using numpy</span></span>
<span id="cb188-70"><a href="#cb188-70" aria-hidden="true" tabindex="-1"></a>training_RMSE_emissions <span class="op">=</span> np.sqrt(mean_squared_error(Yt_emissions, Ytp_emissions))</span>
<span id="cb188-71"><a href="#cb188-71" aria-hidden="true" tabindex="-1"></a>validation_RMSE_emissions <span class="op">=</span> np.sqrt(mean_squared_error(Yv_emissions, Yvp_emissions))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(227, 5, 1) --&gt; (227, 1)
(73, 5, 1) --&gt; (73, 1)
Model: "sequential_13"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 simple_rnn_13 (SimpleRNN)   (None, 32)                1088      
                                                                 
 dense_13 (Dense)            (None, 1)                 33        
                                                                 
=================================================================
Total params: 1121 (4.38 KB)
Trainable params: 1121 (4.38 KB)
Non-trainable params: 0 (0.00 Byte)
_________________________________________________________________
None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-79-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>8/8 [==============================] - 0s 3ms/step
3/3 [==============================] - 0s 4ms/step
---------- Regression report ----------
TRAINING:
 MSE: 0.2467168729013631
 MAE: 0.3427165033846242</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-79-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-79-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>VALIDATION:
 MSE: 1.0040270495300536
 MAE: 0.7742765141142125</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-79-output-7.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-79-output-8.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Error Summary</strong></p>
<div class="cell" data-outputid="dbdc2e81-c6d9-424e-bcbb-cd96cd796950" data-execution_count="81">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a>error_table_emissions_rnn_l2 <span class="op">=</span> [[<span class="st">'Model'</span>,<span class="st">'train_MSE'</span>,<span class="st">'train_MAE'</span>,<span class="st">'train_RMSE'</span>,<span class="st">'val_MSE'</span>,<span class="st">'val_MAE'</span>,<span class="st">'val_RMSE'</span>],</span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a>              [<span class="st">'RNN(L2 Reg)'</span>,</span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yt_emissions, Ytp_emissions),</span>
<span id="cb192-4"><a href="#cb192-4" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yt_emissions, Ytp_emissions),</span>
<span id="cb192-5"><a href="#cb192-5" aria-hidden="true" tabindex="-1"></a>               training_RMSE_emissions,</span>
<span id="cb192-6"><a href="#cb192-6" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yv_emissions, Yvp_emissions),</span>
<span id="cb192-7"><a href="#cb192-7" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yv_emissions, Yvp_emissions),</span>
<span id="cb192-8"><a href="#cb192-8" aria-hidden="true" tabindex="-1"></a>               validation_RMSE_emissions]]</span>
<span id="cb192-9"><a href="#cb192-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(error_table_emissions_rnn_l2, headers<span class="op">=</span><span class="st">'firstrow'</span>, tablefmt<span class="op">=</span><span class="st">'fancy_grid'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>╒═════════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model       │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞═════════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ RNN(L2 Reg) │    0.246717 │    0.342717 │     0.496706 │   1.00403 │  0.774277 │    1.00201 │
╘═════════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="gru" class="level2">
<h2 class="anchored" data-anchor-id="gru">GRU</h2>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-9-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-1" role="tab" aria-controls="tabset-9-1" aria-selected="true">Prices</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-2" role="tab" aria-controls="tabset-9-2" aria-selected="false">Consumption</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-3" role="tab" aria-controls="tabset-9-3" aria-selected="false">Production</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-4" role="tab" aria-controls="tabset-9-4" aria-selected="false">Imports</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-5" role="tab" aria-controls="tabset-9-5" aria-selected="false">Exports</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-6" role="tab" aria-controls="tabset-9-6" aria-selected="false">CVX Stocks</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-7-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-7" role="tab" aria-controls="tabset-9-7" aria-selected="false">CO2 Emissions</a></li></ul>
<div class="tab-content">
<div id="tabset-9-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-9-1-tab">
<div class="cell" data-outputid="3e4e5743-7373-4010-d3a6-f27e52140b31" data-execution_count="82">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW SIZES</span></span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xt.shape, <span class="st">"--&gt;"</span>, Yt.shape)</span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xv.shape, <span class="st">"--&gt;"</span>, Yv.shape)</span>
<span id="cb194-4"><a href="#cb194-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5"><a href="#cb194-5" aria-hidden="true" tabindex="-1"></a><span class="co"># HYPERPARAMETERS</span></span>
<span id="cb194-6"><a href="#cb194-6" aria-hidden="true" tabindex="-1"></a>optimizer<span class="op">=</span><span class="st">"rmsprop"</span></span>
<span id="cb194-7"><a href="#cb194-7" aria-hidden="true" tabindex="-1"></a>loss_function<span class="op">=</span><span class="st">"MeanSquaredError"</span></span>
<span id="cb194-8"><a href="#cb194-8" aria-hidden="true" tabindex="-1"></a>learning_rate<span class="op">=</span><span class="fl">0.001</span></span>
<span id="cb194-9"><a href="#cb194-9" aria-hidden="true" tabindex="-1"></a>numbers_epochs<span class="op">=</span><span class="dv">200</span> <span class="co">#100</span></span>
<span id="cb194-10"><a href="#cb194-10" aria-hidden="true" tabindex="-1"></a>L2<span class="op">=</span><span class="dv">0</span> <span class="co">#1e-4</span></span>
<span id="cb194-11"><a href="#cb194-11" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>(Xt.shape[<span class="dv">1</span>],Xt.shape[<span class="dv">2</span>])</span>
<span id="cb194-12"><a href="#cb194-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-13"><a href="#cb194-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-14"><a href="#cb194-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ------ Choose the batch size ------</span></span>
<span id="cb194-15"><a href="#cb194-15" aria-hidden="true" tabindex="-1"></a><span class="co"># batch_size=1                       # stocastic training</span></span>
<span id="cb194-16"><a href="#cb194-16" aria-hidden="true" tabindex="-1"></a><span class="co"># # batch_size=int(len(x_train)/2.)    # mini-batch training</span></span>
<span id="cb194-17"><a href="#cb194-17" aria-hidden="true" tabindex="-1"></a>batch_size<span class="op">=</span><span class="bu">len</span>(Xt1)              <span class="co"># batch training</span></span>
<span id="cb194-18"><a href="#cb194-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-19"><a href="#cb194-19" aria-hidden="true" tabindex="-1"></a><span class="co"># BUILD MODEL</span></span>
<span id="cb194-20"><a href="#cb194-20" aria-hidden="true" tabindex="-1"></a>recurrent_hidden_units<span class="op">=</span><span class="dv">32</span></span>
<span id="cb194-21"><a href="#cb194-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-22"><a href="#cb194-22" aria-hidden="true" tabindex="-1"></a><span class="co"># CREATE MODEL</span></span>
<span id="cb194-23"><a href="#cb194-23" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> keras.Sequential()</span>
<span id="cb194-24"><a href="#cb194-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-25"><a href="#cb194-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ADD RECURRENT LAYER</span></span>
<span id="cb194-26"><a href="#cb194-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-27"><a href="#cb194-27" aria-hidden="true" tabindex="-1"></a><span class="co"># #COMMENT/UNCOMMENT TO USE RNN, LSTM,GRU</span></span>
<span id="cb194-28"><a href="#cb194-28" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(LSTM(</span></span>
<span id="cb194-29"><a href="#cb194-29" aria-hidden="true" tabindex="-1"></a>model.add(GRU(</span>
<span id="cb194-30"><a href="#cb194-30" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(SimpleRNN(</span></span>
<span id="cb194-31"><a href="#cb194-31" aria-hidden="true" tabindex="-1"></a>units<span class="op">=</span>recurrent_hidden_units,</span>
<span id="cb194-32"><a href="#cb194-32" aria-hidden="true" tabindex="-1"></a>return_sequences<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb194-33"><a href="#cb194-33" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>input_shape,</span>
<span id="cb194-34"><a href="#cb194-34" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_dropout=0.8,</span></span>
<span id="cb194-35"><a href="#cb194-35" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_regularizer=regularizers.L2(L2),</span></span>
<span id="cb194-36"><a href="#cb194-36" aria-hidden="true" tabindex="-1"></a><span class="co"># activation='relu'</span></span>
<span id="cb194-37"><a href="#cb194-37" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb194-38"><a href="#cb194-38" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb194-39"><a href="#cb194-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-40"><a href="#cb194-40" aria-hidden="true" tabindex="-1"></a><span class="co"># NEED TO TAKE THE OUTPUT RNN AND CONVERT TO SCALAR</span></span>
<span id="cb194-41"><a href="#cb194-41" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span><span class="st">'linear'</span>))</span>
<span id="cb194-42"><a href="#cb194-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-43"><a href="#cb194-43" aria-hidden="true" tabindex="-1"></a><span class="co"># MODEL SUMMARY</span></span>
<span id="cb194-44"><a href="#cb194-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())<span class="op">;</span> <span class="co">#print(x_train.shape,y_train.shape)</span></span>
<span id="cb194-45"><a href="#cb194-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-46"><a href="#cb194-46" aria-hidden="true" tabindex="-1"></a><span class="co"># # COMPILING THE MODEL</span></span>
<span id="cb194-47"><a href="#cb194-47" aria-hidden="true" tabindex="-1"></a>opt <span class="op">=</span> keras.optimizers.RMSprop(learning_rate<span class="op">=</span>learning_rate)</span>
<span id="cb194-48"><a href="#cb194-48" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>opt, loss<span class="op">=</span>loss_function)</span>
<span id="cb194-49"><a href="#cb194-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-50"><a href="#cb194-50" aria-hidden="true" tabindex="-1"></a><span class="co"># TRAINING YOUR MODEL</span></span>
<span id="cb194-51"><a href="#cb194-51" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(</span>
<span id="cb194-52"><a href="#cb194-52" aria-hidden="true" tabindex="-1"></a>    Xt,</span>
<span id="cb194-53"><a href="#cb194-53" aria-hidden="true" tabindex="-1"></a>    Yt,</span>
<span id="cb194-54"><a href="#cb194-54" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span>numbers_epochs,</span>
<span id="cb194-55"><a href="#cb194-55" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span>batch_size,</span>
<span id="cb194-56"><a href="#cb194-56" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb194-57"><a href="#cb194-57" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>(Xv, Yv),</span>
<span id="cb194-58"><a href="#cb194-58" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb194-59"><a href="#cb194-59" aria-hidden="true" tabindex="-1"></a><span class="co"># History plot</span></span>
<span id="cb194-60"><a href="#cb194-60" aria-hidden="true" tabindex="-1"></a>history_plot(history)</span>
<span id="cb194-61"><a href="#cb194-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-62"><a href="#cb194-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb194-63"><a href="#cb194-63" aria-hidden="true" tabindex="-1"></a>Ytp <span class="op">=</span> model.predict(Xt)</span>
<span id="cb194-64"><a href="#cb194-64" aria-hidden="true" tabindex="-1"></a>Yvp <span class="op">=</span> model.predict(Xv)</span>
<span id="cb194-65"><a href="#cb194-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-66"><a href="#cb194-66" aria-hidden="true" tabindex="-1"></a><span class="co"># REPORT</span></span>
<span id="cb194-67"><a href="#cb194-67" aria-hidden="true" tabindex="-1"></a>regression_report(Yt, Ytp, Yv, Yvp)</span>
<span id="cb194-68"><a href="#cb194-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-69"><a href="#cb194-69" aria-hidden="true" tabindex="-1"></a><span class="co"># compute RMSE using numpy</span></span>
<span id="cb194-70"><a href="#cb194-70" aria-hidden="true" tabindex="-1"></a>training_RMSE <span class="op">=</span> np.sqrt(mean_squared_error(Yt, Ytp))</span>
<span id="cb194-71"><a href="#cb194-71" aria-hidden="true" tabindex="-1"></a>validation_RMSE <span class="op">=</span> np.sqrt(mean_squared_error(Yv, Yvp))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(157, 5, 1) --&gt; (157, 1)
(49, 5, 1) --&gt; (49, 1)
Model: "sequential_14"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 gru (GRU)                   (None, 32)                3360      
                                                                 
 dense_14 (Dense)            (None, 1)                 33        
                                                                 
=================================================================
Total params: 3393 (13.25 KB)
Trainable params: 3393 (13.25 KB)
Non-trainable params: 0 (0.00 Byte)
_________________________________________________________________
None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-81-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>5/5 [==============================] - 1s 4ms/step
2/2 [==============================] - 0s 7ms/step
---------- Regression report ----------
TRAINING:
 MSE: 0.09307459561413757
 MAE: 0.21239367581368906</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-81-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-81-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>VALIDATION:
 MSE: 0.1832772696117805
 MAE: 0.3187538903683385</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-81-output-7.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-81-output-8.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Error Summary</strong></p>
<div class="cell" data-outputid="92ea749c-bd1f-43ce-f1b1-825e380b8ba7" data-execution_count="83">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a>error_table_gru <span class="op">=</span> [[<span class="st">'Model'</span>,<span class="st">'train_MSE'</span>,<span class="st">'train_MAE'</span>,<span class="st">'train_RMSE'</span>,<span class="st">'val_MSE'</span>,<span class="st">'val_MAE'</span>,<span class="st">'val_RMSE'</span>],</span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a>              [<span class="st">'GRU'</span>,</span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yt, Ytp),</span>
<span id="cb198-4"><a href="#cb198-4" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yt, Ytp),</span>
<span id="cb198-5"><a href="#cb198-5" aria-hidden="true" tabindex="-1"></a>              training_RMSE,</span>
<span id="cb198-6"><a href="#cb198-6" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yv, Yvp),</span>
<span id="cb198-7"><a href="#cb198-7" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yv, Yvp),</span>
<span id="cb198-8"><a href="#cb198-8" aria-hidden="true" tabindex="-1"></a>               validation_RMSE]]</span>
<span id="cb198-9"><a href="#cb198-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(error_table_gru, headers<span class="op">=</span><span class="st">'firstrow'</span>, tablefmt<span class="op">=</span><span class="st">'fancy_grid'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>╒═════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model   │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞═════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ GRU     │   0.0930746 │    0.212394 │     0.305081 │  0.183277 │  0.318754 │   0.428109 │
╘═════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
</div>
<div id="tabset-9-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-2-tab">
<div class="cell" data-outputid="edc9cae8-3190-4328-d2e1-2883214625ff" data-execution_count="84">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb200"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW SIZES</span></span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xt_consump.shape, <span class="st">"--&gt;"</span>, Yt_consump.shape)</span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xv_consump.shape, <span class="st">"--&gt;"</span>, Yv_consump.shape)</span>
<span id="cb200-4"><a href="#cb200-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-5"><a href="#cb200-5" aria-hidden="true" tabindex="-1"></a><span class="co"># HYPERPARAMETERS</span></span>
<span id="cb200-6"><a href="#cb200-6" aria-hidden="true" tabindex="-1"></a>optimizer<span class="op">=</span><span class="st">"rmsprop"</span></span>
<span id="cb200-7"><a href="#cb200-7" aria-hidden="true" tabindex="-1"></a>loss_function<span class="op">=</span><span class="st">"MeanSquaredError"</span></span>
<span id="cb200-8"><a href="#cb200-8" aria-hidden="true" tabindex="-1"></a>learning_rate<span class="op">=</span><span class="fl">0.001</span></span>
<span id="cb200-9"><a href="#cb200-9" aria-hidden="true" tabindex="-1"></a>numbers_epochs<span class="op">=</span><span class="dv">200</span> <span class="co">#100</span></span>
<span id="cb200-10"><a href="#cb200-10" aria-hidden="true" tabindex="-1"></a>L2<span class="op">=</span><span class="dv">0</span> <span class="co">#1e-4</span></span>
<span id="cb200-11"><a href="#cb200-11" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>(Xt_consump.shape[<span class="dv">1</span>],Xt_consump.shape[<span class="dv">2</span>])</span>
<span id="cb200-12"><a href="#cb200-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-13"><a href="#cb200-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-14"><a href="#cb200-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ------ Choose the batch size ------</span></span>
<span id="cb200-15"><a href="#cb200-15" aria-hidden="true" tabindex="-1"></a><span class="co"># batch_size=1                       # stocastic training</span></span>
<span id="cb200-16"><a href="#cb200-16" aria-hidden="true" tabindex="-1"></a><span class="co"># # batch_size=int(len(x_train)/2.)    # mini-batch training</span></span>
<span id="cb200-17"><a href="#cb200-17" aria-hidden="true" tabindex="-1"></a>batch_size<span class="op">=</span><span class="bu">len</span>(Xt1_consump)              <span class="co"># batch training</span></span>
<span id="cb200-18"><a href="#cb200-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-19"><a href="#cb200-19" aria-hidden="true" tabindex="-1"></a><span class="co"># BUILD MODEL</span></span>
<span id="cb200-20"><a href="#cb200-20" aria-hidden="true" tabindex="-1"></a>recurrent_hidden_units<span class="op">=</span><span class="dv">32</span></span>
<span id="cb200-21"><a href="#cb200-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-22"><a href="#cb200-22" aria-hidden="true" tabindex="-1"></a><span class="co"># CREATE MODEL</span></span>
<span id="cb200-23"><a href="#cb200-23" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> keras.Sequential()</span>
<span id="cb200-24"><a href="#cb200-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-25"><a href="#cb200-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ADD RECURRENT LAYER</span></span>
<span id="cb200-26"><a href="#cb200-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-27"><a href="#cb200-27" aria-hidden="true" tabindex="-1"></a><span class="co"># #COMMENT/UNCOMMENT TO USE RNN, LSTM,GRU</span></span>
<span id="cb200-28"><a href="#cb200-28" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(LSTM(</span></span>
<span id="cb200-29"><a href="#cb200-29" aria-hidden="true" tabindex="-1"></a>model.add(GRU(</span>
<span id="cb200-30"><a href="#cb200-30" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(SimpleRNN(</span></span>
<span id="cb200-31"><a href="#cb200-31" aria-hidden="true" tabindex="-1"></a>units<span class="op">=</span>recurrent_hidden_units,</span>
<span id="cb200-32"><a href="#cb200-32" aria-hidden="true" tabindex="-1"></a>return_sequences<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb200-33"><a href="#cb200-33" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>input_shape,</span>
<span id="cb200-34"><a href="#cb200-34" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_dropout=0.8,</span></span>
<span id="cb200-35"><a href="#cb200-35" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_regularizer=regularizers.L2(L2),</span></span>
<span id="cb200-36"><a href="#cb200-36" aria-hidden="true" tabindex="-1"></a><span class="co"># activation='relu'</span></span>
<span id="cb200-37"><a href="#cb200-37" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb200-38"><a href="#cb200-38" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb200-39"><a href="#cb200-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-40"><a href="#cb200-40" aria-hidden="true" tabindex="-1"></a><span class="co"># NEED TO TAKE THE OUTPUT RNN AND CONVERT TO SCALAR</span></span>
<span id="cb200-41"><a href="#cb200-41" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span><span class="st">'linear'</span>))</span>
<span id="cb200-42"><a href="#cb200-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-43"><a href="#cb200-43" aria-hidden="true" tabindex="-1"></a><span class="co"># MODEL SUMMARY</span></span>
<span id="cb200-44"><a href="#cb200-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())<span class="op">;</span> <span class="co">#print(x_train.shape,y_train.shape)</span></span>
<span id="cb200-45"><a href="#cb200-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-46"><a href="#cb200-46" aria-hidden="true" tabindex="-1"></a><span class="co"># # COMPILING THE MODEL</span></span>
<span id="cb200-47"><a href="#cb200-47" aria-hidden="true" tabindex="-1"></a>opt <span class="op">=</span> keras.optimizers.RMSprop(learning_rate<span class="op">=</span>learning_rate)</span>
<span id="cb200-48"><a href="#cb200-48" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>opt, loss<span class="op">=</span>loss_function)</span>
<span id="cb200-49"><a href="#cb200-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-50"><a href="#cb200-50" aria-hidden="true" tabindex="-1"></a><span class="co"># TRAINING YOUR MODEL</span></span>
<span id="cb200-51"><a href="#cb200-51" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(</span>
<span id="cb200-52"><a href="#cb200-52" aria-hidden="true" tabindex="-1"></a>    Xt_consump,</span>
<span id="cb200-53"><a href="#cb200-53" aria-hidden="true" tabindex="-1"></a>    Yt_consump,</span>
<span id="cb200-54"><a href="#cb200-54" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span>numbers_epochs,</span>
<span id="cb200-55"><a href="#cb200-55" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span>batch_size,</span>
<span id="cb200-56"><a href="#cb200-56" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb200-57"><a href="#cb200-57" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>(Xv_consump, Yv_consump),</span>
<span id="cb200-58"><a href="#cb200-58" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb200-59"><a href="#cb200-59" aria-hidden="true" tabindex="-1"></a><span class="co"># History plot</span></span>
<span id="cb200-60"><a href="#cb200-60" aria-hidden="true" tabindex="-1"></a>history_plot(history)</span>
<span id="cb200-61"><a href="#cb200-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-62"><a href="#cb200-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb200-63"><a href="#cb200-63" aria-hidden="true" tabindex="-1"></a>Ytp_consump <span class="op">=</span> model.predict(Xt_consump)</span>
<span id="cb200-64"><a href="#cb200-64" aria-hidden="true" tabindex="-1"></a>Yvp_consump <span class="op">=</span> model.predict(Xv_consump)</span>
<span id="cb200-65"><a href="#cb200-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-66"><a href="#cb200-66" aria-hidden="true" tabindex="-1"></a><span class="co"># REPORT</span></span>
<span id="cb200-67"><a href="#cb200-67" aria-hidden="true" tabindex="-1"></a>regression_report(Yt_consump, Ytp_consump, Yv_consump, Yvp_consump)</span>
<span id="cb200-68"><a href="#cb200-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-69"><a href="#cb200-69" aria-hidden="true" tabindex="-1"></a><span class="co"># compute RMSE using numpy</span></span>
<span id="cb200-70"><a href="#cb200-70" aria-hidden="true" tabindex="-1"></a>training_RMSE_consump <span class="op">=</span> np.sqrt(mean_squared_error(Yt_consump, Ytp_consump))</span>
<span id="cb200-71"><a href="#cb200-71" aria-hidden="true" tabindex="-1"></a>validation_RMSE_consump <span class="op">=</span> np.sqrt(mean_squared_error(Yv_consump, Yvp_consump))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(157, 5, 1) --&gt; (157, 1)
(49, 5, 1) --&gt; (49, 1)
Model: "sequential_15"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 gru_1 (GRU)                 (None, 32)                3360      
                                                                 
 dense_15 (Dense)            (None, 1)                 33        
                                                                 
=================================================================
Total params: 3393 (13.25 KB)
Trainable params: 3393 (13.25 KB)
Non-trainable params: 0 (0.00 Byte)
_________________________________________________________________
None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-83-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>5/5 [==============================] - 0s 3ms/step
2/2 [==============================] - 0s 7ms/step
---------- Regression report ----------
TRAINING:
 MSE: 0.23355664103124701
 MAE: 0.3685060510260475</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-83-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-83-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>VALIDATION:
 MSE: 0.5929653026508562
 MAE: 0.6548865234409081</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-83-output-7.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-83-output-8.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Error Summary</strong></p>
<div class="cell" data-outputid="7090c47b-1712-4353-f1aa-77b7dee937fa" data-execution_count="85">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb204"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a>error_table_consump_gru <span class="op">=</span> [[<span class="st">'Model'</span>,<span class="st">'train_MSE'</span>,<span class="st">'train_MAE'</span>,<span class="st">'train_RMSE'</span>,<span class="st">'val_MSE'</span>,<span class="st">'val_MAE'</span>,<span class="st">'val_RMSE'</span>],</span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a>              [<span class="st">'GRU'</span>,</span>
<span id="cb204-3"><a href="#cb204-3" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yt_consump, Ytp_consump),</span>
<span id="cb204-4"><a href="#cb204-4" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yt_consump, Ytp_consump),</span>
<span id="cb204-5"><a href="#cb204-5" aria-hidden="true" tabindex="-1"></a>              training_RMSE_consump,</span>
<span id="cb204-6"><a href="#cb204-6" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yv_consump, Yvp_consump),</span>
<span id="cb204-7"><a href="#cb204-7" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yv_consump, Yvp_consump),</span>
<span id="cb204-8"><a href="#cb204-8" aria-hidden="true" tabindex="-1"></a>               validation_RMSE_consump]]</span>
<span id="cb204-9"><a href="#cb204-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(error_table_consump_gru, headers<span class="op">=</span><span class="st">'firstrow'</span>, tablefmt<span class="op">=</span><span class="st">'fancy_grid'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>╒═════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model   │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞═════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ GRU     │    0.233557 │    0.368506 │     0.483277 │  0.592965 │  0.654887 │   0.770042 │
╘═════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
</div>
<div id="tabset-9-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-3-tab">
<div class="cell" data-outputid="f56778c0-5505-4253-901f-013e41051beb" data-execution_count="86">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb206"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW SIZES</span></span>
<span id="cb206-2"><a href="#cb206-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xt_prod.shape, <span class="st">"--&gt;"</span>, Yt_prod.shape)</span>
<span id="cb206-3"><a href="#cb206-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xv_prod.shape, <span class="st">"--&gt;"</span>, Yv_prod.shape)</span>
<span id="cb206-4"><a href="#cb206-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-5"><a href="#cb206-5" aria-hidden="true" tabindex="-1"></a><span class="co"># HYPERPARAMETERS</span></span>
<span id="cb206-6"><a href="#cb206-6" aria-hidden="true" tabindex="-1"></a>optimizer<span class="op">=</span><span class="st">"rmsprop"</span></span>
<span id="cb206-7"><a href="#cb206-7" aria-hidden="true" tabindex="-1"></a>loss_function<span class="op">=</span><span class="st">"MeanSquaredError"</span></span>
<span id="cb206-8"><a href="#cb206-8" aria-hidden="true" tabindex="-1"></a>learning_rate<span class="op">=</span><span class="fl">0.001</span></span>
<span id="cb206-9"><a href="#cb206-9" aria-hidden="true" tabindex="-1"></a>numbers_epochs<span class="op">=</span><span class="dv">200</span> <span class="co">#100</span></span>
<span id="cb206-10"><a href="#cb206-10" aria-hidden="true" tabindex="-1"></a>L2<span class="op">=</span><span class="dv">0</span> <span class="co">#1e-4</span></span>
<span id="cb206-11"><a href="#cb206-11" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>(Xt_prod.shape[<span class="dv">1</span>],Xt_prod.shape[<span class="dv">2</span>])</span>
<span id="cb206-12"><a href="#cb206-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-13"><a href="#cb206-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-14"><a href="#cb206-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ------ Choose the batch size ------</span></span>
<span id="cb206-15"><a href="#cb206-15" aria-hidden="true" tabindex="-1"></a><span class="co"># batch_size=1                       # stocastic training</span></span>
<span id="cb206-16"><a href="#cb206-16" aria-hidden="true" tabindex="-1"></a><span class="co"># # batch_size=int(len(x_train)/2.)    # mini-batch training</span></span>
<span id="cb206-17"><a href="#cb206-17" aria-hidden="true" tabindex="-1"></a>batch_size<span class="op">=</span><span class="bu">len</span>(Xt1_prod)              <span class="co"># batch training</span></span>
<span id="cb206-18"><a href="#cb206-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-19"><a href="#cb206-19" aria-hidden="true" tabindex="-1"></a><span class="co"># BUILD MODEL</span></span>
<span id="cb206-20"><a href="#cb206-20" aria-hidden="true" tabindex="-1"></a>recurrent_hidden_units<span class="op">=</span><span class="dv">32</span></span>
<span id="cb206-21"><a href="#cb206-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-22"><a href="#cb206-22" aria-hidden="true" tabindex="-1"></a><span class="co"># CREATE MODEL</span></span>
<span id="cb206-23"><a href="#cb206-23" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> keras.Sequential()</span>
<span id="cb206-24"><a href="#cb206-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-25"><a href="#cb206-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ADD RECURRENT LAYER</span></span>
<span id="cb206-26"><a href="#cb206-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-27"><a href="#cb206-27" aria-hidden="true" tabindex="-1"></a><span class="co"># #COMMENT/UNCOMMENT TO USE RNN, LSTM,GRU</span></span>
<span id="cb206-28"><a href="#cb206-28" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(LSTM(</span></span>
<span id="cb206-29"><a href="#cb206-29" aria-hidden="true" tabindex="-1"></a>model.add(GRU(</span>
<span id="cb206-30"><a href="#cb206-30" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(SimpleRNN(</span></span>
<span id="cb206-31"><a href="#cb206-31" aria-hidden="true" tabindex="-1"></a>units<span class="op">=</span>recurrent_hidden_units,</span>
<span id="cb206-32"><a href="#cb206-32" aria-hidden="true" tabindex="-1"></a>return_sequences<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb206-33"><a href="#cb206-33" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>input_shape,</span>
<span id="cb206-34"><a href="#cb206-34" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_dropout=0.8,</span></span>
<span id="cb206-35"><a href="#cb206-35" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_regularizer=regularizers.L2(L2),</span></span>
<span id="cb206-36"><a href="#cb206-36" aria-hidden="true" tabindex="-1"></a><span class="co"># activation='relu'</span></span>
<span id="cb206-37"><a href="#cb206-37" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb206-38"><a href="#cb206-38" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb206-39"><a href="#cb206-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-40"><a href="#cb206-40" aria-hidden="true" tabindex="-1"></a><span class="co"># NEED TO TAKE THE OUTPUT RNN AND CONVERT TO SCALAR</span></span>
<span id="cb206-41"><a href="#cb206-41" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span><span class="st">'linear'</span>))</span>
<span id="cb206-42"><a href="#cb206-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-43"><a href="#cb206-43" aria-hidden="true" tabindex="-1"></a><span class="co"># MODEL SUMMARY</span></span>
<span id="cb206-44"><a href="#cb206-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())<span class="op">;</span> <span class="co">#print(x_train.shape,y_train.shape)</span></span>
<span id="cb206-45"><a href="#cb206-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-46"><a href="#cb206-46" aria-hidden="true" tabindex="-1"></a><span class="co"># # COMPILING THE MODEL</span></span>
<span id="cb206-47"><a href="#cb206-47" aria-hidden="true" tabindex="-1"></a>opt <span class="op">=</span> keras.optimizers.RMSprop(learning_rate<span class="op">=</span>learning_rate)</span>
<span id="cb206-48"><a href="#cb206-48" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>opt, loss<span class="op">=</span>loss_function)</span>
<span id="cb206-49"><a href="#cb206-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-50"><a href="#cb206-50" aria-hidden="true" tabindex="-1"></a><span class="co"># TRAINING YOUR MODEL</span></span>
<span id="cb206-51"><a href="#cb206-51" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(</span>
<span id="cb206-52"><a href="#cb206-52" aria-hidden="true" tabindex="-1"></a>    Xt_prod,</span>
<span id="cb206-53"><a href="#cb206-53" aria-hidden="true" tabindex="-1"></a>    Yt_prod,</span>
<span id="cb206-54"><a href="#cb206-54" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span>numbers_epochs,</span>
<span id="cb206-55"><a href="#cb206-55" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span>batch_size,</span>
<span id="cb206-56"><a href="#cb206-56" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb206-57"><a href="#cb206-57" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>(Xv_prod, Yv_prod),</span>
<span id="cb206-58"><a href="#cb206-58" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb206-59"><a href="#cb206-59" aria-hidden="true" tabindex="-1"></a><span class="co"># History plot</span></span>
<span id="cb206-60"><a href="#cb206-60" aria-hidden="true" tabindex="-1"></a>history_plot(history)</span>
<span id="cb206-61"><a href="#cb206-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-62"><a href="#cb206-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb206-63"><a href="#cb206-63" aria-hidden="true" tabindex="-1"></a>Ytp_prod <span class="op">=</span> model.predict(Xt_prod)</span>
<span id="cb206-64"><a href="#cb206-64" aria-hidden="true" tabindex="-1"></a>Yvp_prod <span class="op">=</span> model.predict(Xv_prod)</span>
<span id="cb206-65"><a href="#cb206-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-66"><a href="#cb206-66" aria-hidden="true" tabindex="-1"></a><span class="co"># REPORT</span></span>
<span id="cb206-67"><a href="#cb206-67" aria-hidden="true" tabindex="-1"></a>regression_report(Yt_prod, Ytp_prod, Yv_prod, Yvp_prod)</span>
<span id="cb206-68"><a href="#cb206-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-69"><a href="#cb206-69" aria-hidden="true" tabindex="-1"></a><span class="co"># compute RMSE using numpy</span></span>
<span id="cb206-70"><a href="#cb206-70" aria-hidden="true" tabindex="-1"></a>training_RMSE_prod <span class="op">=</span> np.sqrt(mean_squared_error(Yt_prod, Ytp_prod))</span>
<span id="cb206-71"><a href="#cb206-71" aria-hidden="true" tabindex="-1"></a>validation_RMSE_prod <span class="op">=</span> np.sqrt(mean_squared_error(Yv_prod, Yvp_prod))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(157, 5, 1) --&gt; (157, 1)
(49, 5, 1) --&gt; (49, 1)
Model: "sequential_16"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 gru_2 (GRU)                 (None, 32)                3360      
                                                                 
 dense_16 (Dense)            (None, 1)                 33        
                                                                 
=================================================================
Total params: 3393 (13.25 KB)
Trainable params: 3393 (13.25 KB)
Non-trainable params: 0 (0.00 Byte)
_________________________________________________________________
None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-85-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>5/5 [==============================] - 0s 3ms/step
2/2 [==============================] - 0s 7ms/step
---------- Regression report ----------
TRAINING:
 MSE: 0.02292736260911077
 MAE: 0.11412029267993612</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-85-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-85-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>VALIDATION:
 MSE: 0.1303638047994717
 MAE: 0.32803943068324254</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-85-output-7.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-85-output-8.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Error Summary</strong></p>
<div class="cell" data-outputid="7f8ec9f2-01da-4da6-8ba0-3d4b0f309915" data-execution_count="87">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb210"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a>error_table_prod_gru <span class="op">=</span> [[<span class="st">'Model'</span>,<span class="st">'train_MSE'</span>,<span class="st">'train_MAE'</span>,<span class="st">'train_RMSE'</span>,<span class="st">'val_MSE'</span>,<span class="st">'val_MAE'</span>,<span class="st">'val_RMSE'</span>],</span>
<span id="cb210-2"><a href="#cb210-2" aria-hidden="true" tabindex="-1"></a>              [<span class="st">'GRU'</span>,</span>
<span id="cb210-3"><a href="#cb210-3" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yt_prod, Ytp_prod),</span>
<span id="cb210-4"><a href="#cb210-4" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yt_prod, Ytp_prod),</span>
<span id="cb210-5"><a href="#cb210-5" aria-hidden="true" tabindex="-1"></a>              training_RMSE_prod,</span>
<span id="cb210-6"><a href="#cb210-6" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yv_prod, Yvp_prod),</span>
<span id="cb210-7"><a href="#cb210-7" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yv_prod, Yvp_prod),</span>
<span id="cb210-8"><a href="#cb210-8" aria-hidden="true" tabindex="-1"></a>               validation_RMSE_prod]]</span>
<span id="cb210-9"><a href="#cb210-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(error_table_prod_gru, headers<span class="op">=</span><span class="st">'firstrow'</span>, tablefmt<span class="op">=</span><span class="st">'fancy_grid'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>╒═════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model   │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞═════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ GRU     │   0.0229274 │     0.11412 │     0.151418 │  0.130364 │  0.328039 │   0.361059 │
╘═════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
</div>
<div id="tabset-9-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-4-tab">
<div class="cell" data-outputid="c02d6d47-f7ff-42c9-8ce0-384c880819cd" data-execution_count="88">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb212"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW SIZES</span></span>
<span id="cb212-2"><a href="#cb212-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xt_imp.shape, <span class="st">"--&gt;"</span>, Yt_imp.shape)</span>
<span id="cb212-3"><a href="#cb212-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xv_imp.shape, <span class="st">"--&gt;"</span>, Yv_imp.shape)</span>
<span id="cb212-4"><a href="#cb212-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-5"><a href="#cb212-5" aria-hidden="true" tabindex="-1"></a><span class="co"># HYPERPARAMETERS</span></span>
<span id="cb212-6"><a href="#cb212-6" aria-hidden="true" tabindex="-1"></a>optimizer<span class="op">=</span><span class="st">"rmsprop"</span></span>
<span id="cb212-7"><a href="#cb212-7" aria-hidden="true" tabindex="-1"></a>loss_function<span class="op">=</span><span class="st">"MeanSquaredError"</span></span>
<span id="cb212-8"><a href="#cb212-8" aria-hidden="true" tabindex="-1"></a>learning_rate<span class="op">=</span><span class="fl">0.001</span></span>
<span id="cb212-9"><a href="#cb212-9" aria-hidden="true" tabindex="-1"></a>numbers_epochs<span class="op">=</span><span class="dv">200</span> <span class="co">#100</span></span>
<span id="cb212-10"><a href="#cb212-10" aria-hidden="true" tabindex="-1"></a>L2<span class="op">=</span><span class="dv">0</span> <span class="co">#1e-4</span></span>
<span id="cb212-11"><a href="#cb212-11" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>(Xt_imp.shape[<span class="dv">1</span>],Xt_imp.shape[<span class="dv">2</span>])</span>
<span id="cb212-12"><a href="#cb212-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-13"><a href="#cb212-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-14"><a href="#cb212-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ------ Choose the batch size ------</span></span>
<span id="cb212-15"><a href="#cb212-15" aria-hidden="true" tabindex="-1"></a><span class="co"># batch_size=1                       # stocastic training</span></span>
<span id="cb212-16"><a href="#cb212-16" aria-hidden="true" tabindex="-1"></a><span class="co"># # batch_size=int(len(x_train)/2.)    # mini-batch training</span></span>
<span id="cb212-17"><a href="#cb212-17" aria-hidden="true" tabindex="-1"></a>batch_size<span class="op">=</span><span class="bu">len</span>(Xt1_imp)              <span class="co"># batch training</span></span>
<span id="cb212-18"><a href="#cb212-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-19"><a href="#cb212-19" aria-hidden="true" tabindex="-1"></a><span class="co"># BUILD MODEL</span></span>
<span id="cb212-20"><a href="#cb212-20" aria-hidden="true" tabindex="-1"></a>recurrent_hidden_units<span class="op">=</span><span class="dv">32</span></span>
<span id="cb212-21"><a href="#cb212-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-22"><a href="#cb212-22" aria-hidden="true" tabindex="-1"></a><span class="co"># CREATE MODEL</span></span>
<span id="cb212-23"><a href="#cb212-23" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> keras.Sequential()</span>
<span id="cb212-24"><a href="#cb212-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-25"><a href="#cb212-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ADD RECURRENT LAYER</span></span>
<span id="cb212-26"><a href="#cb212-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-27"><a href="#cb212-27" aria-hidden="true" tabindex="-1"></a><span class="co"># #COMMENT/UNCOMMENT TO USE RNN, LSTM,GRU</span></span>
<span id="cb212-28"><a href="#cb212-28" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(LSTM(</span></span>
<span id="cb212-29"><a href="#cb212-29" aria-hidden="true" tabindex="-1"></a>model.add(GRU(</span>
<span id="cb212-30"><a href="#cb212-30" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(SimpleRNN(</span></span>
<span id="cb212-31"><a href="#cb212-31" aria-hidden="true" tabindex="-1"></a>units<span class="op">=</span>recurrent_hidden_units,</span>
<span id="cb212-32"><a href="#cb212-32" aria-hidden="true" tabindex="-1"></a>return_sequences<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb212-33"><a href="#cb212-33" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>input_shape,</span>
<span id="cb212-34"><a href="#cb212-34" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_dropout=0.8,</span></span>
<span id="cb212-35"><a href="#cb212-35" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_regularizer=regularizers.L2(L2),</span></span>
<span id="cb212-36"><a href="#cb212-36" aria-hidden="true" tabindex="-1"></a><span class="co"># activation='relu'</span></span>
<span id="cb212-37"><a href="#cb212-37" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb212-38"><a href="#cb212-38" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb212-39"><a href="#cb212-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-40"><a href="#cb212-40" aria-hidden="true" tabindex="-1"></a><span class="co"># NEED TO TAKE THE OUTPUT RNN AND CONVERT TO SCALAR</span></span>
<span id="cb212-41"><a href="#cb212-41" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span><span class="st">'linear'</span>))</span>
<span id="cb212-42"><a href="#cb212-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-43"><a href="#cb212-43" aria-hidden="true" tabindex="-1"></a><span class="co"># MODEL SUMMARY</span></span>
<span id="cb212-44"><a href="#cb212-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())<span class="op">;</span> <span class="co">#print(x_train.shape,y_train.shape)</span></span>
<span id="cb212-45"><a href="#cb212-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-46"><a href="#cb212-46" aria-hidden="true" tabindex="-1"></a><span class="co"># # COMPILING THE MODEL</span></span>
<span id="cb212-47"><a href="#cb212-47" aria-hidden="true" tabindex="-1"></a>opt <span class="op">=</span> keras.optimizers.RMSprop(learning_rate<span class="op">=</span>learning_rate)</span>
<span id="cb212-48"><a href="#cb212-48" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>opt, loss<span class="op">=</span>loss_function)</span>
<span id="cb212-49"><a href="#cb212-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-50"><a href="#cb212-50" aria-hidden="true" tabindex="-1"></a><span class="co"># TRAINING YOUR MODEL</span></span>
<span id="cb212-51"><a href="#cb212-51" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(</span>
<span id="cb212-52"><a href="#cb212-52" aria-hidden="true" tabindex="-1"></a>    Xt_imp,</span>
<span id="cb212-53"><a href="#cb212-53" aria-hidden="true" tabindex="-1"></a>    Yt_imp,</span>
<span id="cb212-54"><a href="#cb212-54" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span>numbers_epochs,</span>
<span id="cb212-55"><a href="#cb212-55" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span>batch_size,</span>
<span id="cb212-56"><a href="#cb212-56" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb212-57"><a href="#cb212-57" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>(Xv_imp, Yv_imp),</span>
<span id="cb212-58"><a href="#cb212-58" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb212-59"><a href="#cb212-59" aria-hidden="true" tabindex="-1"></a><span class="co"># History plot</span></span>
<span id="cb212-60"><a href="#cb212-60" aria-hidden="true" tabindex="-1"></a>history_plot(history)</span>
<span id="cb212-61"><a href="#cb212-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-62"><a href="#cb212-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb212-63"><a href="#cb212-63" aria-hidden="true" tabindex="-1"></a>Ytp_imp <span class="op">=</span> model.predict(Xt_imp)</span>
<span id="cb212-64"><a href="#cb212-64" aria-hidden="true" tabindex="-1"></a>Yvp_imp <span class="op">=</span> model.predict(Xv_imp)</span>
<span id="cb212-65"><a href="#cb212-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-66"><a href="#cb212-66" aria-hidden="true" tabindex="-1"></a><span class="co"># REPORT</span></span>
<span id="cb212-67"><a href="#cb212-67" aria-hidden="true" tabindex="-1"></a>regression_report(Yt_imp, Ytp_imp, Yv_imp, Yvp_imp)</span>
<span id="cb212-68"><a href="#cb212-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-69"><a href="#cb212-69" aria-hidden="true" tabindex="-1"></a><span class="co"># compute RMSE using numpy</span></span>
<span id="cb212-70"><a href="#cb212-70" aria-hidden="true" tabindex="-1"></a>training_RMSE_imp <span class="op">=</span> np.sqrt(mean_squared_error(Yt_imp, Ytp_imp))</span>
<span id="cb212-71"><a href="#cb212-71" aria-hidden="true" tabindex="-1"></a>validation_RMSE_imp <span class="op">=</span> np.sqrt(mean_squared_error(Yv_imp, Yvp_imp))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(229, 5, 1) --&gt; (229, 1)
(73, 5, 1) --&gt; (73, 1)
Model: "sequential_17"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 gru_3 (GRU)                 (None, 32)                3360      
                                                                 
 dense_17 (Dense)            (None, 1)                 33        
                                                                 
=================================================================
Total params: 3393 (13.25 KB)
Trainable params: 3393 (13.25 KB)
Non-trainable params: 0 (0.00 Byte)
_________________________________________________________________
None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-87-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>8/8 [==============================] - 0s 3ms/step
3/3 [==============================] - 0s 5ms/step
---------- Regression report ----------
TRAINING:
 MSE: 0.19197940418155066
 MAE: 0.3450106572232673</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-87-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-87-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>VALIDATION:
 MSE: 0.2222956142443242
 MAE: 0.37296668297977176</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-87-output-7.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-87-output-8.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Error Summary</strong></p>
<div class="cell" data-outputid="9e0da575-5c94-4e95-ac6c-9be7b90e750d" data-execution_count="89">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb216"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a>error_table_imp_gru <span class="op">=</span> [[<span class="st">'Model'</span>,<span class="st">'train_MSE'</span>,<span class="st">'train_MAE'</span>,<span class="st">'train_RMSE'</span>,<span class="st">'val_MSE'</span>,<span class="st">'val_MAE'</span>,<span class="st">'val_RMSE'</span>],</span>
<span id="cb216-2"><a href="#cb216-2" aria-hidden="true" tabindex="-1"></a>              [<span class="st">'GRU'</span>,</span>
<span id="cb216-3"><a href="#cb216-3" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yt_imp, Ytp_imp),</span>
<span id="cb216-4"><a href="#cb216-4" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yt_imp, Ytp_imp),</span>
<span id="cb216-5"><a href="#cb216-5" aria-hidden="true" tabindex="-1"></a>               training_RMSE_imp,</span>
<span id="cb216-6"><a href="#cb216-6" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yv_imp, Yvp_imp),</span>
<span id="cb216-7"><a href="#cb216-7" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yv_imp, Yvp_imp),</span>
<span id="cb216-8"><a href="#cb216-8" aria-hidden="true" tabindex="-1"></a>               validation_RMSE_imp]]</span>
<span id="cb216-9"><a href="#cb216-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(error_table_imp_gru, headers<span class="op">=</span><span class="st">'firstrow'</span>, tablefmt<span class="op">=</span><span class="st">'fancy_grid'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>╒═════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model   │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞═════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ GRU     │    0.191979 │    0.345011 │     0.438155 │  0.222296 │  0.372967 │   0.471482 │
╘═════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
</div>
<div id="tabset-9-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-5-tab">
<div class="cell" data-outputid="6751f5c3-4bb6-4468-dc07-57fa68f0b00c" data-execution_count="90">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb218"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW SIZES</span></span>
<span id="cb218-2"><a href="#cb218-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xt_exp.shape, <span class="st">"--&gt;"</span>, Yt_exp.shape)</span>
<span id="cb218-3"><a href="#cb218-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xv_exp.shape, <span class="st">"--&gt;"</span>, Yv_exp.shape)</span>
<span id="cb218-4"><a href="#cb218-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-5"><a href="#cb218-5" aria-hidden="true" tabindex="-1"></a><span class="co"># HYPERPARAMETERS</span></span>
<span id="cb218-6"><a href="#cb218-6" aria-hidden="true" tabindex="-1"></a>optimizer<span class="op">=</span><span class="st">"rmsprop"</span></span>
<span id="cb218-7"><a href="#cb218-7" aria-hidden="true" tabindex="-1"></a>loss_function<span class="op">=</span><span class="st">"MeanSquaredError"</span></span>
<span id="cb218-8"><a href="#cb218-8" aria-hidden="true" tabindex="-1"></a>learning_rate<span class="op">=</span><span class="fl">0.001</span></span>
<span id="cb218-9"><a href="#cb218-9" aria-hidden="true" tabindex="-1"></a>numbers_epochs<span class="op">=</span><span class="dv">200</span> <span class="co">#100</span></span>
<span id="cb218-10"><a href="#cb218-10" aria-hidden="true" tabindex="-1"></a>L2<span class="op">=</span><span class="dv">0</span> <span class="co">#1e-4</span></span>
<span id="cb218-11"><a href="#cb218-11" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>(Xt_exp.shape[<span class="dv">1</span>],Xt_exp.shape[<span class="dv">2</span>])</span>
<span id="cb218-12"><a href="#cb218-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-13"><a href="#cb218-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-14"><a href="#cb218-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ------ Choose the batch size ------</span></span>
<span id="cb218-15"><a href="#cb218-15" aria-hidden="true" tabindex="-1"></a><span class="co"># batch_size=1                       # stocastic training</span></span>
<span id="cb218-16"><a href="#cb218-16" aria-hidden="true" tabindex="-1"></a><span class="co"># # batch_size=int(len(x_train)/2.)    # mini-batch training</span></span>
<span id="cb218-17"><a href="#cb218-17" aria-hidden="true" tabindex="-1"></a>batch_size<span class="op">=</span><span class="bu">len</span>(Xt1_exp)              <span class="co"># batch training</span></span>
<span id="cb218-18"><a href="#cb218-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-19"><a href="#cb218-19" aria-hidden="true" tabindex="-1"></a><span class="co"># BUILD MODEL</span></span>
<span id="cb218-20"><a href="#cb218-20" aria-hidden="true" tabindex="-1"></a>recurrent_hidden_units<span class="op">=</span><span class="dv">32</span></span>
<span id="cb218-21"><a href="#cb218-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-22"><a href="#cb218-22" aria-hidden="true" tabindex="-1"></a><span class="co"># CREATE MODEL</span></span>
<span id="cb218-23"><a href="#cb218-23" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> keras.Sequential()</span>
<span id="cb218-24"><a href="#cb218-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-25"><a href="#cb218-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ADD RECURRENT LAYER</span></span>
<span id="cb218-26"><a href="#cb218-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-27"><a href="#cb218-27" aria-hidden="true" tabindex="-1"></a><span class="co"># #COMMENT/UNCOMMENT TO USE RNN, LSTM,GRU</span></span>
<span id="cb218-28"><a href="#cb218-28" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(LSTM(</span></span>
<span id="cb218-29"><a href="#cb218-29" aria-hidden="true" tabindex="-1"></a>model.add(GRU(</span>
<span id="cb218-30"><a href="#cb218-30" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(SimpleRNN(</span></span>
<span id="cb218-31"><a href="#cb218-31" aria-hidden="true" tabindex="-1"></a>units<span class="op">=</span>recurrent_hidden_units,</span>
<span id="cb218-32"><a href="#cb218-32" aria-hidden="true" tabindex="-1"></a>return_sequences<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb218-33"><a href="#cb218-33" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>input_shape,</span>
<span id="cb218-34"><a href="#cb218-34" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_dropout=0.8,</span></span>
<span id="cb218-35"><a href="#cb218-35" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_regularizer=regularizers.L2(L2),</span></span>
<span id="cb218-36"><a href="#cb218-36" aria-hidden="true" tabindex="-1"></a><span class="co"># activation='relu'</span></span>
<span id="cb218-37"><a href="#cb218-37" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb218-38"><a href="#cb218-38" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb218-39"><a href="#cb218-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-40"><a href="#cb218-40" aria-hidden="true" tabindex="-1"></a><span class="co"># NEED TO TAKE THE OUTPUT RNN AND CONVERT TO SCALAR</span></span>
<span id="cb218-41"><a href="#cb218-41" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span><span class="st">'linear'</span>))</span>
<span id="cb218-42"><a href="#cb218-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-43"><a href="#cb218-43" aria-hidden="true" tabindex="-1"></a><span class="co"># MODEL SUMMARY</span></span>
<span id="cb218-44"><a href="#cb218-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())<span class="op">;</span> <span class="co">#print(x_train.shape,y_train.shape)</span></span>
<span id="cb218-45"><a href="#cb218-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-46"><a href="#cb218-46" aria-hidden="true" tabindex="-1"></a><span class="co"># # COMPILING THE MODEL</span></span>
<span id="cb218-47"><a href="#cb218-47" aria-hidden="true" tabindex="-1"></a>opt <span class="op">=</span> keras.optimizers.RMSprop(learning_rate<span class="op">=</span>learning_rate)</span>
<span id="cb218-48"><a href="#cb218-48" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>opt, loss<span class="op">=</span>loss_function)</span>
<span id="cb218-49"><a href="#cb218-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-50"><a href="#cb218-50" aria-hidden="true" tabindex="-1"></a><span class="co"># TRAINING YOUR MODEL</span></span>
<span id="cb218-51"><a href="#cb218-51" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(</span>
<span id="cb218-52"><a href="#cb218-52" aria-hidden="true" tabindex="-1"></a>    Xt_exp,</span>
<span id="cb218-53"><a href="#cb218-53" aria-hidden="true" tabindex="-1"></a>    Yt_exp,</span>
<span id="cb218-54"><a href="#cb218-54" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span>numbers_epochs,</span>
<span id="cb218-55"><a href="#cb218-55" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span>batch_size,</span>
<span id="cb218-56"><a href="#cb218-56" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb218-57"><a href="#cb218-57" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>(Xv_exp, Yv_exp),</span>
<span id="cb218-58"><a href="#cb218-58" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb218-59"><a href="#cb218-59" aria-hidden="true" tabindex="-1"></a><span class="co"># History plot</span></span>
<span id="cb218-60"><a href="#cb218-60" aria-hidden="true" tabindex="-1"></a>history_plot(history)</span>
<span id="cb218-61"><a href="#cb218-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-62"><a href="#cb218-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb218-63"><a href="#cb218-63" aria-hidden="true" tabindex="-1"></a>Ytp_exp <span class="op">=</span> model.predict(Xt_exp)</span>
<span id="cb218-64"><a href="#cb218-64" aria-hidden="true" tabindex="-1"></a>Yvp_exp <span class="op">=</span> model.predict(Xv_exp)</span>
<span id="cb218-65"><a href="#cb218-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-66"><a href="#cb218-66" aria-hidden="true" tabindex="-1"></a><span class="co"># REPORT</span></span>
<span id="cb218-67"><a href="#cb218-67" aria-hidden="true" tabindex="-1"></a>regression_report(Yt_exp, Ytp_exp, Yv_exp, Yvp_exp)</span>
<span id="cb218-68"><a href="#cb218-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-69"><a href="#cb218-69" aria-hidden="true" tabindex="-1"></a><span class="co"># compute RMSE using numpy</span></span>
<span id="cb218-70"><a href="#cb218-70" aria-hidden="true" tabindex="-1"></a>training_RMSE_exp <span class="op">=</span> np.sqrt(mean_squared_error(Yt_exp, Ytp_exp))</span>
<span id="cb218-71"><a href="#cb218-71" aria-hidden="true" tabindex="-1"></a>validation_RMSE_exp <span class="op">=</span> np.sqrt(mean_squared_error(Yv_exp, Yvp_exp))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(229, 5, 1) --&gt; (229, 1)
(73, 5, 1) --&gt; (73, 1)
Model: "sequential_18"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 gru_4 (GRU)                 (None, 32)                3360      
                                                                 
 dense_18 (Dense)            (None, 1)                 33        
                                                                 
=================================================================
Total params: 3393 (13.25 KB)
Trainable params: 3393 (13.25 KB)
Non-trainable params: 0 (0.00 Byte)
_________________________________________________________________
None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-89-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>8/8 [==============================] - 0s 3ms/step
3/3 [==============================] - 0s 5ms/step
---------- Regression report ----------
TRAINING:
 MSE: 0.005926264873573486
 MAE: 0.05846742314216646</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-89-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-89-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>VALIDATION:
 MSE: 0.8894577127439768
 MAE: 0.7667608707053157</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-89-output-7.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-89-output-8.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Error Summary</strong></p>
<div class="cell" data-outputid="f8111ca2-3f06-4203-b007-2d45e3b0676e" data-execution_count="91">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb222"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a>error_table_exp_gru <span class="op">=</span> [[<span class="st">'Model'</span>,<span class="st">'train_MSE'</span>,<span class="st">'train_MAE'</span>,<span class="st">'train_RMSE'</span>,<span class="st">'val_MSE'</span>,<span class="st">'val_MAE'</span>,<span class="st">'val_RMSE'</span>],</span>
<span id="cb222-2"><a href="#cb222-2" aria-hidden="true" tabindex="-1"></a>              [<span class="st">'GRU'</span>,</span>
<span id="cb222-3"><a href="#cb222-3" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yt_exp, Ytp_exp),</span>
<span id="cb222-4"><a href="#cb222-4" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yt_exp, Ytp_exp),</span>
<span id="cb222-5"><a href="#cb222-5" aria-hidden="true" tabindex="-1"></a>               training_RMSE_exp,</span>
<span id="cb222-6"><a href="#cb222-6" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yv_exp, Yvp_exp),</span>
<span id="cb222-7"><a href="#cb222-7" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yv_exp, Yvp_exp),</span>
<span id="cb222-8"><a href="#cb222-8" aria-hidden="true" tabindex="-1"></a>               validation_RMSE_exp]]</span>
<span id="cb222-9"><a href="#cb222-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(error_table_exp_gru, headers<span class="op">=</span><span class="st">'firstrow'</span>, tablefmt<span class="op">=</span><span class="st">'fancy_grid'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>╒═════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model   │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞═════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ GRU     │  0.00592626 │   0.0584674 │    0.0769822 │  0.889458 │  0.766761 │   0.943111 │
╘═════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
</div>
<div id="tabset-9-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-6-tab">
<div class="cell" data-outputid="3b65adbe-3586-429e-c46e-7c587c6cc8a1" data-execution_count="92">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb224"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW SIZES</span></span>
<span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xt_stk.shape, <span class="st">"--&gt;"</span>, Yt_stk.shape)</span>
<span id="cb224-3"><a href="#cb224-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xv_stk.shape, <span class="st">"--&gt;"</span>, Yv_stk.shape)</span>
<span id="cb224-4"><a href="#cb224-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-5"><a href="#cb224-5" aria-hidden="true" tabindex="-1"></a><span class="co"># HYPERPARAMETERS</span></span>
<span id="cb224-6"><a href="#cb224-6" aria-hidden="true" tabindex="-1"></a>optimizer<span class="op">=</span><span class="st">"rmsprop"</span></span>
<span id="cb224-7"><a href="#cb224-7" aria-hidden="true" tabindex="-1"></a>loss_function<span class="op">=</span><span class="st">"MeanSquaredError"</span></span>
<span id="cb224-8"><a href="#cb224-8" aria-hidden="true" tabindex="-1"></a>learning_rate<span class="op">=</span><span class="fl">0.001</span></span>
<span id="cb224-9"><a href="#cb224-9" aria-hidden="true" tabindex="-1"></a>numbers_epochs<span class="op">=</span><span class="dv">200</span> <span class="co">#100</span></span>
<span id="cb224-10"><a href="#cb224-10" aria-hidden="true" tabindex="-1"></a>L2<span class="op">=</span><span class="dv">0</span> <span class="co">#1e-4</span></span>
<span id="cb224-11"><a href="#cb224-11" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>(Xt_stk.shape[<span class="dv">1</span>],Xt_stk.shape[<span class="dv">2</span>])</span>
<span id="cb224-12"><a href="#cb224-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-13"><a href="#cb224-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-14"><a href="#cb224-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ------ Choose the batch size ------</span></span>
<span id="cb224-15"><a href="#cb224-15" aria-hidden="true" tabindex="-1"></a><span class="co"># batch_size=1                       # stocastic training</span></span>
<span id="cb224-16"><a href="#cb224-16" aria-hidden="true" tabindex="-1"></a><span class="co"># # batch_size=int(len(x_train)/2.)    # mini-batch training</span></span>
<span id="cb224-17"><a href="#cb224-17" aria-hidden="true" tabindex="-1"></a>batch_size<span class="op">=</span><span class="bu">len</span>(Xt1_stk)              <span class="co"># batch training</span></span>
<span id="cb224-18"><a href="#cb224-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-19"><a href="#cb224-19" aria-hidden="true" tabindex="-1"></a><span class="co"># BUILD MODEL</span></span>
<span id="cb224-20"><a href="#cb224-20" aria-hidden="true" tabindex="-1"></a>recurrent_hidden_units<span class="op">=</span><span class="dv">32</span></span>
<span id="cb224-21"><a href="#cb224-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-22"><a href="#cb224-22" aria-hidden="true" tabindex="-1"></a><span class="co"># CREATE MODEL</span></span>
<span id="cb224-23"><a href="#cb224-23" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> keras.Sequential()</span>
<span id="cb224-24"><a href="#cb224-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-25"><a href="#cb224-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ADD RECURRENT LAYER</span></span>
<span id="cb224-26"><a href="#cb224-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-27"><a href="#cb224-27" aria-hidden="true" tabindex="-1"></a><span class="co"># #COMMENT/UNCOMMENT TO USE RNN, LSTM,GRU</span></span>
<span id="cb224-28"><a href="#cb224-28" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(LSTM(</span></span>
<span id="cb224-29"><a href="#cb224-29" aria-hidden="true" tabindex="-1"></a>model.add(GRU(</span>
<span id="cb224-30"><a href="#cb224-30" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(SimpleRNN(</span></span>
<span id="cb224-31"><a href="#cb224-31" aria-hidden="true" tabindex="-1"></a>units<span class="op">=</span>recurrent_hidden_units,</span>
<span id="cb224-32"><a href="#cb224-32" aria-hidden="true" tabindex="-1"></a>return_sequences<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb224-33"><a href="#cb224-33" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>input_shape,</span>
<span id="cb224-34"><a href="#cb224-34" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_dropout=0.8,</span></span>
<span id="cb224-35"><a href="#cb224-35" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_regularizer=regularizers.L2(L2),</span></span>
<span id="cb224-36"><a href="#cb224-36" aria-hidden="true" tabindex="-1"></a><span class="co"># activation='relu'</span></span>
<span id="cb224-37"><a href="#cb224-37" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb224-38"><a href="#cb224-38" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb224-39"><a href="#cb224-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-40"><a href="#cb224-40" aria-hidden="true" tabindex="-1"></a><span class="co"># NEED TO TAKE THE OUTPUT RNN AND CONVERT TO SCALAR</span></span>
<span id="cb224-41"><a href="#cb224-41" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span><span class="st">'linear'</span>))</span>
<span id="cb224-42"><a href="#cb224-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-43"><a href="#cb224-43" aria-hidden="true" tabindex="-1"></a><span class="co"># MODEL SUMMARY</span></span>
<span id="cb224-44"><a href="#cb224-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())<span class="op">;</span> <span class="co">#print(x_train.shape,y_train.shape)</span></span>
<span id="cb224-45"><a href="#cb224-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-46"><a href="#cb224-46" aria-hidden="true" tabindex="-1"></a><span class="co"># # COMPILING THE MODEL</span></span>
<span id="cb224-47"><a href="#cb224-47" aria-hidden="true" tabindex="-1"></a>opt <span class="op">=</span> keras.optimizers.RMSprop(learning_rate<span class="op">=</span>learning_rate)</span>
<span id="cb224-48"><a href="#cb224-48" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>opt, loss<span class="op">=</span>loss_function)</span>
<span id="cb224-49"><a href="#cb224-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-50"><a href="#cb224-50" aria-hidden="true" tabindex="-1"></a><span class="co"># TRAINING YOUR MODEL</span></span>
<span id="cb224-51"><a href="#cb224-51" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(</span>
<span id="cb224-52"><a href="#cb224-52" aria-hidden="true" tabindex="-1"></a>    Xt_stk,</span>
<span id="cb224-53"><a href="#cb224-53" aria-hidden="true" tabindex="-1"></a>    Yt_stk,</span>
<span id="cb224-54"><a href="#cb224-54" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span>numbers_epochs,</span>
<span id="cb224-55"><a href="#cb224-55" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span>batch_size,</span>
<span id="cb224-56"><a href="#cb224-56" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb224-57"><a href="#cb224-57" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>(Xv_stk, Yv_stk),</span>
<span id="cb224-58"><a href="#cb224-58" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb224-59"><a href="#cb224-59" aria-hidden="true" tabindex="-1"></a><span class="co"># History plot</span></span>
<span id="cb224-60"><a href="#cb224-60" aria-hidden="true" tabindex="-1"></a>history_plot(history)</span>
<span id="cb224-61"><a href="#cb224-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-62"><a href="#cb224-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb224-63"><a href="#cb224-63" aria-hidden="true" tabindex="-1"></a>Ytp_stk <span class="op">=</span> model.predict(Xt_stk)</span>
<span id="cb224-64"><a href="#cb224-64" aria-hidden="true" tabindex="-1"></a>Yvp_stk <span class="op">=</span> model.predict(Xv_stk)</span>
<span id="cb224-65"><a href="#cb224-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-66"><a href="#cb224-66" aria-hidden="true" tabindex="-1"></a><span class="co"># REPORT</span></span>
<span id="cb224-67"><a href="#cb224-67" aria-hidden="true" tabindex="-1"></a>regression_report(Yt_stk, Ytp_stk, Yv_stk, Yvp_stk)</span>
<span id="cb224-68"><a href="#cb224-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-69"><a href="#cb224-69" aria-hidden="true" tabindex="-1"></a><span class="co"># compute RMSE using numpy</span></span>
<span id="cb224-70"><a href="#cb224-70" aria-hidden="true" tabindex="-1"></a>training_RMSE_stk <span class="op">=</span> np.sqrt(mean_squared_error(Yt_stk, Ytp_stk))</span>
<span id="cb224-71"><a href="#cb224-71" aria-hidden="true" tabindex="-1"></a>validation_RMSE_stk <span class="op">=</span> np.sqrt(mean_squared_error(Yv_stk, Yvp_stk))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(3377, 5, 1) --&gt; (3377, 1)
(1123, 5, 1) --&gt; (1123, 1)
Model: "sequential_19"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 gru_5 (GRU)                 (None, 32)                3360      
                                                                 
 dense_19 (Dense)            (None, 1)                 33        
                                                                 
=================================================================
Total params: 3393 (13.25 KB)
Trainable params: 3393 (13.25 KB)
Non-trainable params: 0 (0.00 Byte)
_________________________________________________________________
None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-91-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>106/106 [==============================] - 1s 2ms/step
36/36 [==============================] - 0s 3ms/step
---------- Regression report ----------
TRAINING:
 MSE: 0.0024811101772368917
 MAE: 0.03790346794311486</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-91-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-91-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>VALIDATION:
 MSE: 0.22407084458733548
 MAE: 0.2609358026053276</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-91-output-7.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-91-output-8.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Error Summary</strong></p>
<div class="cell" data-outputid="a6470e5a-a5e7-4b0e-fda9-3726c7d61ba3" data-execution_count="93">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb228"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a>error_table_stk_gru <span class="op">=</span> [[<span class="st">'Model'</span>,<span class="st">'train_MSE'</span>,<span class="st">'train_MAE'</span>,<span class="st">'train_RMSE'</span>,<span class="st">'val_MSE'</span>,<span class="st">'val_MAE'</span>,<span class="st">'val_RMSE'</span>],</span>
<span id="cb228-2"><a href="#cb228-2" aria-hidden="true" tabindex="-1"></a>              [<span class="st">'GRU'</span>,</span>
<span id="cb228-3"><a href="#cb228-3" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yt_stk, Ytp_stk),</span>
<span id="cb228-4"><a href="#cb228-4" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yt_stk, Ytp_stk),</span>
<span id="cb228-5"><a href="#cb228-5" aria-hidden="true" tabindex="-1"></a>               training_RMSE_stk,</span>
<span id="cb228-6"><a href="#cb228-6" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yv_stk, Yvp_stk),</span>
<span id="cb228-7"><a href="#cb228-7" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yv_stk, Yvp_stk),</span>
<span id="cb228-8"><a href="#cb228-8" aria-hidden="true" tabindex="-1"></a>               validation_RMSE_stk]]</span>
<span id="cb228-9"><a href="#cb228-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(error_table_stk_gru, headers<span class="op">=</span><span class="st">'firstrow'</span>, tablefmt<span class="op">=</span><span class="st">'fancy_grid'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>╒═════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model   │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞═════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ GRU     │  0.00248111 │   0.0379035 │    0.0498107 │  0.224071 │  0.260936 │   0.473361 │
╘═════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
</div>
<div id="tabset-9-7" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-7-tab">
<div class="cell" data-outputid="14215c47-9f70-49a4-a48c-c671405d0d46" data-execution_count="94">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb230"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW SIZES</span></span>
<span id="cb230-2"><a href="#cb230-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xt_emissions.shape, <span class="st">"--&gt;"</span>, Yt_emissions.shape)</span>
<span id="cb230-3"><a href="#cb230-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xv_emissions.shape, <span class="st">"--&gt;"</span>, Yv_emissions.shape)</span>
<span id="cb230-4"><a href="#cb230-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-5"><a href="#cb230-5" aria-hidden="true" tabindex="-1"></a><span class="co"># HYPERPARAMETERS</span></span>
<span id="cb230-6"><a href="#cb230-6" aria-hidden="true" tabindex="-1"></a>optimizer<span class="op">=</span><span class="st">"rmsprop"</span></span>
<span id="cb230-7"><a href="#cb230-7" aria-hidden="true" tabindex="-1"></a>loss_function<span class="op">=</span><span class="st">"MeanSquaredError"</span></span>
<span id="cb230-8"><a href="#cb230-8" aria-hidden="true" tabindex="-1"></a>learning_rate<span class="op">=</span><span class="fl">0.001</span></span>
<span id="cb230-9"><a href="#cb230-9" aria-hidden="true" tabindex="-1"></a>numbers_epochs<span class="op">=</span><span class="dv">200</span> <span class="co">#100</span></span>
<span id="cb230-10"><a href="#cb230-10" aria-hidden="true" tabindex="-1"></a>L2<span class="op">=</span><span class="dv">0</span> <span class="co">#1e-4</span></span>
<span id="cb230-11"><a href="#cb230-11" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>(Xt_emissions.shape[<span class="dv">1</span>],Xt_emissions.shape[<span class="dv">2</span>])</span>
<span id="cb230-12"><a href="#cb230-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-13"><a href="#cb230-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-14"><a href="#cb230-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ------ Choose the batch size ------</span></span>
<span id="cb230-15"><a href="#cb230-15" aria-hidden="true" tabindex="-1"></a><span class="co"># batch_size=1                       # stocastic training</span></span>
<span id="cb230-16"><a href="#cb230-16" aria-hidden="true" tabindex="-1"></a><span class="co"># # batch_size=int(len(x_train)/2.)    # mini-batch training</span></span>
<span id="cb230-17"><a href="#cb230-17" aria-hidden="true" tabindex="-1"></a>batch_size<span class="op">=</span><span class="bu">len</span>(Xt1_emissions)              <span class="co"># batch training</span></span>
<span id="cb230-18"><a href="#cb230-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-19"><a href="#cb230-19" aria-hidden="true" tabindex="-1"></a><span class="co"># BUILD MODEL</span></span>
<span id="cb230-20"><a href="#cb230-20" aria-hidden="true" tabindex="-1"></a>recurrent_hidden_units<span class="op">=</span><span class="dv">32</span></span>
<span id="cb230-21"><a href="#cb230-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-22"><a href="#cb230-22" aria-hidden="true" tabindex="-1"></a><span class="co"># CREATE MODEL</span></span>
<span id="cb230-23"><a href="#cb230-23" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> keras.Sequential()</span>
<span id="cb230-24"><a href="#cb230-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-25"><a href="#cb230-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ADD RECURRENT LAYER</span></span>
<span id="cb230-26"><a href="#cb230-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-27"><a href="#cb230-27" aria-hidden="true" tabindex="-1"></a><span class="co"># #COMMENT/UNCOMMENT TO USE RNN, LSTM,GRU</span></span>
<span id="cb230-28"><a href="#cb230-28" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(LSTM(</span></span>
<span id="cb230-29"><a href="#cb230-29" aria-hidden="true" tabindex="-1"></a>model.add(GRU(</span>
<span id="cb230-30"><a href="#cb230-30" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(SimpleRNN(</span></span>
<span id="cb230-31"><a href="#cb230-31" aria-hidden="true" tabindex="-1"></a>units<span class="op">=</span>recurrent_hidden_units,</span>
<span id="cb230-32"><a href="#cb230-32" aria-hidden="true" tabindex="-1"></a>return_sequences<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb230-33"><a href="#cb230-33" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>input_shape,</span>
<span id="cb230-34"><a href="#cb230-34" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_dropout=0.8,</span></span>
<span id="cb230-35"><a href="#cb230-35" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_regularizer=regularizers.L2(L2),</span></span>
<span id="cb230-36"><a href="#cb230-36" aria-hidden="true" tabindex="-1"></a><span class="co"># activation='relu'</span></span>
<span id="cb230-37"><a href="#cb230-37" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb230-38"><a href="#cb230-38" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb230-39"><a href="#cb230-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-40"><a href="#cb230-40" aria-hidden="true" tabindex="-1"></a><span class="co"># NEED TO TAKE THE OUTPUT RNN AND CONVERT TO SCALAR</span></span>
<span id="cb230-41"><a href="#cb230-41" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span><span class="st">'linear'</span>))</span>
<span id="cb230-42"><a href="#cb230-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-43"><a href="#cb230-43" aria-hidden="true" tabindex="-1"></a><span class="co"># MODEL SUMMARY</span></span>
<span id="cb230-44"><a href="#cb230-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())<span class="op">;</span> <span class="co">#print(x_train.shape,y_train.shape)</span></span>
<span id="cb230-45"><a href="#cb230-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-46"><a href="#cb230-46" aria-hidden="true" tabindex="-1"></a><span class="co"># # COMPILING THE MODEL</span></span>
<span id="cb230-47"><a href="#cb230-47" aria-hidden="true" tabindex="-1"></a>opt <span class="op">=</span> keras.optimizers.RMSprop(learning_rate<span class="op">=</span>learning_rate)</span>
<span id="cb230-48"><a href="#cb230-48" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>opt, loss<span class="op">=</span>loss_function)</span>
<span id="cb230-49"><a href="#cb230-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-50"><a href="#cb230-50" aria-hidden="true" tabindex="-1"></a><span class="co"># TRAINING YOUR MODEL</span></span>
<span id="cb230-51"><a href="#cb230-51" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(</span>
<span id="cb230-52"><a href="#cb230-52" aria-hidden="true" tabindex="-1"></a>    Xt_emissions,</span>
<span id="cb230-53"><a href="#cb230-53" aria-hidden="true" tabindex="-1"></a>    Yt_emissions,</span>
<span id="cb230-54"><a href="#cb230-54" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span>numbers_epochs,</span>
<span id="cb230-55"><a href="#cb230-55" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span>batch_size,</span>
<span id="cb230-56"><a href="#cb230-56" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb230-57"><a href="#cb230-57" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>(Xv_emissions, Yv_emissions),</span>
<span id="cb230-58"><a href="#cb230-58" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb230-59"><a href="#cb230-59" aria-hidden="true" tabindex="-1"></a><span class="co"># History plot</span></span>
<span id="cb230-60"><a href="#cb230-60" aria-hidden="true" tabindex="-1"></a>history_plot(history)</span>
<span id="cb230-61"><a href="#cb230-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-62"><a href="#cb230-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb230-63"><a href="#cb230-63" aria-hidden="true" tabindex="-1"></a>Ytp_emissions <span class="op">=</span> model.predict(Xt_emissions)</span>
<span id="cb230-64"><a href="#cb230-64" aria-hidden="true" tabindex="-1"></a>Yvp_emissions <span class="op">=</span> model.predict(Xv_emissions)</span>
<span id="cb230-65"><a href="#cb230-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-66"><a href="#cb230-66" aria-hidden="true" tabindex="-1"></a><span class="co"># REPORT</span></span>
<span id="cb230-67"><a href="#cb230-67" aria-hidden="true" tabindex="-1"></a>regression_report(Yt_emissions, Ytp_emissions, Yv_emissions, Yvp_emissions)</span>
<span id="cb230-68"><a href="#cb230-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-69"><a href="#cb230-69" aria-hidden="true" tabindex="-1"></a><span class="co"># compute RMSE using numpy</span></span>
<span id="cb230-70"><a href="#cb230-70" aria-hidden="true" tabindex="-1"></a>training_RMSE_emissions <span class="op">=</span> np.sqrt(mean_squared_error(Yt_emissions, Ytp_emissions))</span>
<span id="cb230-71"><a href="#cb230-71" aria-hidden="true" tabindex="-1"></a>validation_RMSE_emissions <span class="op">=</span> np.sqrt(mean_squared_error(Yv_emissions, Yvp_emissions))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(227, 5, 1) --&gt; (227, 1)
(73, 5, 1) --&gt; (73, 1)
Model: "sequential_20"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 gru_6 (GRU)                 (None, 32)                3360      
                                                                 
 dense_20 (Dense)            (None, 1)                 33        
                                                                 
=================================================================
Total params: 3393 (13.25 KB)
Trainable params: 3393 (13.25 KB)
Non-trainable params: 0 (0.00 Byte)
_________________________________________________________________
None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-93-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>8/8 [==============================] - 1s 4ms/step
3/3 [==============================] - 0s 8ms/step
---------- Regression report ----------
TRAINING:
 MSE: 0.826495245899882
 MAE: 0.4748150256824064</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-93-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-93-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>VALIDATION:
 MSE: 1.3218618767871289
 MAE: 0.4843349026939558</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-93-output-7.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-93-output-8.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Error Summary</strong></p>
<div class="cell" data-outputid="5a8c053d-5718-445e-e495-c7c9e87eb3c0" data-execution_count="95">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb234"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a>error_table_emissions_gru <span class="op">=</span> [[<span class="st">'Model'</span>,<span class="st">'train_MSE'</span>,<span class="st">'train_MAE'</span>,<span class="st">'train_RMSE'</span>,<span class="st">'val_MSE'</span>,<span class="st">'val_MAE'</span>,<span class="st">'val_RMSE'</span>],</span>
<span id="cb234-2"><a href="#cb234-2" aria-hidden="true" tabindex="-1"></a>              [<span class="st">'GRU'</span>,</span>
<span id="cb234-3"><a href="#cb234-3" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yt_emissions, Ytp_emissions),</span>
<span id="cb234-4"><a href="#cb234-4" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yt_emissions, Ytp_emissions),</span>
<span id="cb234-5"><a href="#cb234-5" aria-hidden="true" tabindex="-1"></a>               training_RMSE_emissions,</span>
<span id="cb234-6"><a href="#cb234-6" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yv_emissions, Yvp_emissions),</span>
<span id="cb234-7"><a href="#cb234-7" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yv_emissions, Yvp_emissions),</span>
<span id="cb234-8"><a href="#cb234-8" aria-hidden="true" tabindex="-1"></a>               validation_RMSE_emissions]]</span>
<span id="cb234-9"><a href="#cb234-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(error_table_emissions_gru, headers<span class="op">=</span><span class="st">'firstrow'</span>, tablefmt<span class="op">=</span><span class="st">'fancy_grid'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>╒═════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model   │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞═════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ GRU     │    0.826495 │    0.474815 │     0.909118 │   1.32186 │  0.484335 │    1.14972 │
╘═════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="gru-with-l2-regularization" class="level2">
<h2 class="anchored" data-anchor-id="gru-with-l2-regularization">GRU with L2 Regularization</h2>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-10-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-1" role="tab" aria-controls="tabset-10-1" aria-selected="true">Prices</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-2" role="tab" aria-controls="tabset-10-2" aria-selected="false">Consumption</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-3" role="tab" aria-controls="tabset-10-3" aria-selected="false">Production</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-4" role="tab" aria-controls="tabset-10-4" aria-selected="false">Imports</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-5" role="tab" aria-controls="tabset-10-5" aria-selected="false">Exports</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-6" role="tab" aria-controls="tabset-10-6" aria-selected="false">CVX Stocks</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-7-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-7" role="tab" aria-controls="tabset-10-7" aria-selected="false">CO2 Emissions</a></li></ul>
<div class="tab-content">
<div id="tabset-10-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-10-1-tab">
<div class="cell" data-outputid="f3c41051-f502-437b-ba79-e7a618b40e93" data-execution_count="96">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb236"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW SIZES</span></span>
<span id="cb236-2"><a href="#cb236-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xt.shape, <span class="st">"--&gt;"</span>, Yt.shape)</span>
<span id="cb236-3"><a href="#cb236-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xv.shape, <span class="st">"--&gt;"</span>, Yv.shape)</span>
<span id="cb236-4"><a href="#cb236-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-5"><a href="#cb236-5" aria-hidden="true" tabindex="-1"></a><span class="co"># HYPERPARAMETERS</span></span>
<span id="cb236-6"><a href="#cb236-6" aria-hidden="true" tabindex="-1"></a>optimizer<span class="op">=</span><span class="st">"rmsprop"</span></span>
<span id="cb236-7"><a href="#cb236-7" aria-hidden="true" tabindex="-1"></a>loss_function<span class="op">=</span><span class="st">"MeanSquaredError"</span></span>
<span id="cb236-8"><a href="#cb236-8" aria-hidden="true" tabindex="-1"></a>learning_rate<span class="op">=</span><span class="fl">0.001</span></span>
<span id="cb236-9"><a href="#cb236-9" aria-hidden="true" tabindex="-1"></a>numbers_epochs<span class="op">=</span><span class="dv">200</span> <span class="co">#100</span></span>
<span id="cb236-10"><a href="#cb236-10" aria-hidden="true" tabindex="-1"></a>L2<span class="op">=</span><span class="fl">1e-4</span></span>
<span id="cb236-11"><a href="#cb236-11" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>(Xt.shape[<span class="dv">1</span>],Xt.shape[<span class="dv">2</span>])</span>
<span id="cb236-12"><a href="#cb236-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-13"><a href="#cb236-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-14"><a href="#cb236-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ------ Choose the batch size ------</span></span>
<span id="cb236-15"><a href="#cb236-15" aria-hidden="true" tabindex="-1"></a><span class="co"># batch_size=1                       # stocastic training</span></span>
<span id="cb236-16"><a href="#cb236-16" aria-hidden="true" tabindex="-1"></a><span class="co"># # batch_size=int(len(x_train)/2.)    # mini-batch training</span></span>
<span id="cb236-17"><a href="#cb236-17" aria-hidden="true" tabindex="-1"></a>batch_size<span class="op">=</span><span class="bu">len</span>(Xt1)              <span class="co"># batch training</span></span>
<span id="cb236-18"><a href="#cb236-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-19"><a href="#cb236-19" aria-hidden="true" tabindex="-1"></a><span class="co"># BUILD MODEL</span></span>
<span id="cb236-20"><a href="#cb236-20" aria-hidden="true" tabindex="-1"></a>recurrent_hidden_units<span class="op">=</span><span class="dv">32</span></span>
<span id="cb236-21"><a href="#cb236-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-22"><a href="#cb236-22" aria-hidden="true" tabindex="-1"></a><span class="co"># CREATE MODEL</span></span>
<span id="cb236-23"><a href="#cb236-23" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> keras.Sequential()</span>
<span id="cb236-24"><a href="#cb236-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-25"><a href="#cb236-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ADD RECURRENT LAYER</span></span>
<span id="cb236-26"><a href="#cb236-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-27"><a href="#cb236-27" aria-hidden="true" tabindex="-1"></a><span class="co"># #COMMENT/UNCOMMENT TO USE RNN, LSTM,GRU</span></span>
<span id="cb236-28"><a href="#cb236-28" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(LSTM(</span></span>
<span id="cb236-29"><a href="#cb236-29" aria-hidden="true" tabindex="-1"></a>model.add(GRU(</span>
<span id="cb236-30"><a href="#cb236-30" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(SimpleRNN(</span></span>
<span id="cb236-31"><a href="#cb236-31" aria-hidden="true" tabindex="-1"></a>units<span class="op">=</span>recurrent_hidden_units,</span>
<span id="cb236-32"><a href="#cb236-32" aria-hidden="true" tabindex="-1"></a>return_sequences<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb236-33"><a href="#cb236-33" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>input_shape,</span>
<span id="cb236-34"><a href="#cb236-34" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_dropout=0.8,</span></span>
<span id="cb236-35"><a href="#cb236-35" aria-hidden="true" tabindex="-1"></a>recurrent_regularizer<span class="op">=</span>regularizers.L2(L2),</span>
<span id="cb236-36"><a href="#cb236-36" aria-hidden="true" tabindex="-1"></a>activation<span class="op">=</span><span class="st">'relu'</span>)</span>
<span id="cb236-37"><a href="#cb236-37" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb236-38"><a href="#cb236-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-39"><a href="#cb236-39" aria-hidden="true" tabindex="-1"></a><span class="co"># NEED TO TAKE THE OUTPUT RNN AND CONVERT TO SCALAR</span></span>
<span id="cb236-40"><a href="#cb236-40" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span><span class="st">'linear'</span>))</span>
<span id="cb236-41"><a href="#cb236-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-42"><a href="#cb236-42" aria-hidden="true" tabindex="-1"></a><span class="co"># MODEL SUMMARY</span></span>
<span id="cb236-43"><a href="#cb236-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())<span class="op">;</span> <span class="co">#print(x_train.shape,y_train.shape)</span></span>
<span id="cb236-44"><a href="#cb236-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-45"><a href="#cb236-45" aria-hidden="true" tabindex="-1"></a><span class="co"># # COMPILING THE MODEL</span></span>
<span id="cb236-46"><a href="#cb236-46" aria-hidden="true" tabindex="-1"></a>opt <span class="op">=</span> keras.optimizers.RMSprop(learning_rate<span class="op">=</span>learning_rate)</span>
<span id="cb236-47"><a href="#cb236-47" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>opt, loss<span class="op">=</span>loss_function)</span>
<span id="cb236-48"><a href="#cb236-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-49"><a href="#cb236-49" aria-hidden="true" tabindex="-1"></a><span class="co"># TRAINING YOUR MODEL</span></span>
<span id="cb236-50"><a href="#cb236-50" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(</span>
<span id="cb236-51"><a href="#cb236-51" aria-hidden="true" tabindex="-1"></a>    Xt,</span>
<span id="cb236-52"><a href="#cb236-52" aria-hidden="true" tabindex="-1"></a>    Yt,</span>
<span id="cb236-53"><a href="#cb236-53" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span>numbers_epochs,</span>
<span id="cb236-54"><a href="#cb236-54" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span>batch_size,</span>
<span id="cb236-55"><a href="#cb236-55" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb236-56"><a href="#cb236-56" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>(Xv, Yv),</span>
<span id="cb236-57"><a href="#cb236-57" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb236-58"><a href="#cb236-58" aria-hidden="true" tabindex="-1"></a><span class="co"># History plot</span></span>
<span id="cb236-59"><a href="#cb236-59" aria-hidden="true" tabindex="-1"></a>history_plot(history)</span>
<span id="cb236-60"><a href="#cb236-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-61"><a href="#cb236-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb236-62"><a href="#cb236-62" aria-hidden="true" tabindex="-1"></a>Ytp <span class="op">=</span> model.predict(Xt)</span>
<span id="cb236-63"><a href="#cb236-63" aria-hidden="true" tabindex="-1"></a>Yvp <span class="op">=</span> model.predict(Xv)</span>
<span id="cb236-64"><a href="#cb236-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-65"><a href="#cb236-65" aria-hidden="true" tabindex="-1"></a><span class="co"># REPORT</span></span>
<span id="cb236-66"><a href="#cb236-66" aria-hidden="true" tabindex="-1"></a>regression_report(Yt, Ytp, Yv, Yvp)</span>
<span id="cb236-67"><a href="#cb236-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-68"><a href="#cb236-68" aria-hidden="true" tabindex="-1"></a><span class="co"># compute RMSE using numpy</span></span>
<span id="cb236-69"><a href="#cb236-69" aria-hidden="true" tabindex="-1"></a>training_RMSE <span class="op">=</span> np.sqrt(mean_squared_error(Yt, Ytp))</span>
<span id="cb236-70"><a href="#cb236-70" aria-hidden="true" tabindex="-1"></a>validation_RMSE <span class="op">=</span> np.sqrt(mean_squared_error(Yv, Yvp))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(157, 5, 1) --&gt; (157, 1)
(49, 5, 1) --&gt; (49, 1)
Model: "sequential_21"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 gru_7 (GRU)                 (None, 32)                3360      
                                                                 
 dense_21 (Dense)            (None, 1)                 33        
                                                                 
=================================================================
Total params: 3393 (13.25 KB)
Trainable params: 3393 (13.25 KB)
Non-trainable params: 0 (0.00 Byte)
_________________________________________________________________
None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-95-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>5/5 [==============================] - 0s 3ms/step
2/2 [==============================] - 0s 6ms/step
---------- Regression report ----------
TRAINING:
 MSE: 0.09432739660797214
 MAE: 0.2136415814493819</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-95-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-95-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>VALIDATION:
 MSE: 0.1839333523380131
 MAE: 0.3036520450568859</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-95-output-7.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-95-output-8.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Error Summary</strong></p>
<div class="cell" data-outputid="488ed286-6832-4b97-b409-08fda50e6926" data-execution_count="97">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb240"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a>error_table_gru_l2 <span class="op">=</span> [[<span class="st">'Model'</span>,<span class="st">'train_MSE'</span>,<span class="st">'train_MAE'</span>,<span class="st">'train_RMSE'</span>,<span class="st">'val_MSE'</span>,<span class="st">'val_MAE'</span>,<span class="st">'val_RMSE'</span>],</span>
<span id="cb240-2"><a href="#cb240-2" aria-hidden="true" tabindex="-1"></a>              [<span class="st">'GRU(L2 Reg)'</span>,</span>
<span id="cb240-3"><a href="#cb240-3" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yt, Ytp),</span>
<span id="cb240-4"><a href="#cb240-4" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yt, Ytp),</span>
<span id="cb240-5"><a href="#cb240-5" aria-hidden="true" tabindex="-1"></a>              training_RMSE,</span>
<span id="cb240-6"><a href="#cb240-6" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yv, Yvp),</span>
<span id="cb240-7"><a href="#cb240-7" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yv, Yvp),</span>
<span id="cb240-8"><a href="#cb240-8" aria-hidden="true" tabindex="-1"></a>               validation_RMSE]]</span>
<span id="cb240-9"><a href="#cb240-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(error_table_gru_l2, headers<span class="op">=</span><span class="st">'firstrow'</span>, tablefmt<span class="op">=</span><span class="st">'fancy_grid'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>╒═════════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model       │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞═════════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ GRU(L2 Reg) │   0.0943274 │    0.213642 │     0.307128 │  0.183933 │  0.303652 │   0.428875 │
╘═════════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
</div>
<div id="tabset-10-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-2-tab">
<div class="cell" data-outputid="787c53f8-a2ed-4efd-a993-71e6251aee25" data-execution_count="98">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb242"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW SIZES</span></span>
<span id="cb242-2"><a href="#cb242-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xt_consump.shape, <span class="st">"--&gt;"</span>, Yt_consump.shape)</span>
<span id="cb242-3"><a href="#cb242-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xv_consump.shape, <span class="st">"--&gt;"</span>, Yv_consump.shape)</span>
<span id="cb242-4"><a href="#cb242-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-5"><a href="#cb242-5" aria-hidden="true" tabindex="-1"></a><span class="co"># HYPERPARAMETERS</span></span>
<span id="cb242-6"><a href="#cb242-6" aria-hidden="true" tabindex="-1"></a>optimizer<span class="op">=</span><span class="st">"rmsprop"</span></span>
<span id="cb242-7"><a href="#cb242-7" aria-hidden="true" tabindex="-1"></a>loss_function<span class="op">=</span><span class="st">"MeanSquaredError"</span></span>
<span id="cb242-8"><a href="#cb242-8" aria-hidden="true" tabindex="-1"></a>learning_rate<span class="op">=</span><span class="fl">0.001</span></span>
<span id="cb242-9"><a href="#cb242-9" aria-hidden="true" tabindex="-1"></a>numbers_epochs<span class="op">=</span><span class="dv">200</span> <span class="co">#100</span></span>
<span id="cb242-10"><a href="#cb242-10" aria-hidden="true" tabindex="-1"></a>L2<span class="op">=</span><span class="fl">1e-4</span></span>
<span id="cb242-11"><a href="#cb242-11" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>(Xt_consump.shape[<span class="dv">1</span>],Xt_consump.shape[<span class="dv">2</span>])</span>
<span id="cb242-12"><a href="#cb242-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-13"><a href="#cb242-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-14"><a href="#cb242-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ------ Choose the batch size ------</span></span>
<span id="cb242-15"><a href="#cb242-15" aria-hidden="true" tabindex="-1"></a><span class="co"># batch_size=1                       # stocastic training</span></span>
<span id="cb242-16"><a href="#cb242-16" aria-hidden="true" tabindex="-1"></a><span class="co"># # batch_size=int(len(x_train)/2.)    # mini-batch training</span></span>
<span id="cb242-17"><a href="#cb242-17" aria-hidden="true" tabindex="-1"></a>batch_size<span class="op">=</span><span class="bu">len</span>(Xt1_consump)              <span class="co"># batch training</span></span>
<span id="cb242-18"><a href="#cb242-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-19"><a href="#cb242-19" aria-hidden="true" tabindex="-1"></a><span class="co"># BUILD MODEL</span></span>
<span id="cb242-20"><a href="#cb242-20" aria-hidden="true" tabindex="-1"></a>recurrent_hidden_units<span class="op">=</span><span class="dv">32</span></span>
<span id="cb242-21"><a href="#cb242-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-22"><a href="#cb242-22" aria-hidden="true" tabindex="-1"></a><span class="co"># CREATE MODEL</span></span>
<span id="cb242-23"><a href="#cb242-23" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> keras.Sequential()</span>
<span id="cb242-24"><a href="#cb242-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-25"><a href="#cb242-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ADD RECURRENT LAYER</span></span>
<span id="cb242-26"><a href="#cb242-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-27"><a href="#cb242-27" aria-hidden="true" tabindex="-1"></a><span class="co"># #COMMENT/UNCOMMENT TO USE RNN, LSTM,GRU</span></span>
<span id="cb242-28"><a href="#cb242-28" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(LSTM(</span></span>
<span id="cb242-29"><a href="#cb242-29" aria-hidden="true" tabindex="-1"></a>model.add(GRU(</span>
<span id="cb242-30"><a href="#cb242-30" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(SimpleRNN(</span></span>
<span id="cb242-31"><a href="#cb242-31" aria-hidden="true" tabindex="-1"></a>units<span class="op">=</span>recurrent_hidden_units,</span>
<span id="cb242-32"><a href="#cb242-32" aria-hidden="true" tabindex="-1"></a>return_sequences<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb242-33"><a href="#cb242-33" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>input_shape,</span>
<span id="cb242-34"><a href="#cb242-34" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_dropout=0.8,</span></span>
<span id="cb242-35"><a href="#cb242-35" aria-hidden="true" tabindex="-1"></a>recurrent_regularizer<span class="op">=</span>regularizers.L2(L2),</span>
<span id="cb242-36"><a href="#cb242-36" aria-hidden="true" tabindex="-1"></a>activation<span class="op">=</span><span class="st">'relu'</span>)</span>
<span id="cb242-37"><a href="#cb242-37" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb242-38"><a href="#cb242-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-39"><a href="#cb242-39" aria-hidden="true" tabindex="-1"></a><span class="co"># NEED TO TAKE THE OUTPUT RNN AND CONVERT TO SCALAR</span></span>
<span id="cb242-40"><a href="#cb242-40" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span><span class="st">'linear'</span>))</span>
<span id="cb242-41"><a href="#cb242-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-42"><a href="#cb242-42" aria-hidden="true" tabindex="-1"></a><span class="co"># MODEL SUMMARY</span></span>
<span id="cb242-43"><a href="#cb242-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())<span class="op">;</span> <span class="co">#print(x_train.shape,y_train.shape)</span></span>
<span id="cb242-44"><a href="#cb242-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-45"><a href="#cb242-45" aria-hidden="true" tabindex="-1"></a><span class="co"># # COMPILING THE MODEL</span></span>
<span id="cb242-46"><a href="#cb242-46" aria-hidden="true" tabindex="-1"></a>opt <span class="op">=</span> keras.optimizers.RMSprop(learning_rate<span class="op">=</span>learning_rate)</span>
<span id="cb242-47"><a href="#cb242-47" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>opt, loss<span class="op">=</span>loss_function)</span>
<span id="cb242-48"><a href="#cb242-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-49"><a href="#cb242-49" aria-hidden="true" tabindex="-1"></a><span class="co"># TRAINING YOUR MODEL</span></span>
<span id="cb242-50"><a href="#cb242-50" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(</span>
<span id="cb242-51"><a href="#cb242-51" aria-hidden="true" tabindex="-1"></a>    Xt_consump,</span>
<span id="cb242-52"><a href="#cb242-52" aria-hidden="true" tabindex="-1"></a>    Yt_consump,</span>
<span id="cb242-53"><a href="#cb242-53" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span>numbers_epochs,</span>
<span id="cb242-54"><a href="#cb242-54" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span>batch_size,</span>
<span id="cb242-55"><a href="#cb242-55" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb242-56"><a href="#cb242-56" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>(Xv_consump, Yv_consump),</span>
<span id="cb242-57"><a href="#cb242-57" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb242-58"><a href="#cb242-58" aria-hidden="true" tabindex="-1"></a><span class="co"># History plot</span></span>
<span id="cb242-59"><a href="#cb242-59" aria-hidden="true" tabindex="-1"></a>history_plot(history)</span>
<span id="cb242-60"><a href="#cb242-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-61"><a href="#cb242-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb242-62"><a href="#cb242-62" aria-hidden="true" tabindex="-1"></a>Ytp_consump <span class="op">=</span> model.predict(Xt_consump)</span>
<span id="cb242-63"><a href="#cb242-63" aria-hidden="true" tabindex="-1"></a>Yvp_consump <span class="op">=</span> model.predict(Xv_consump)</span>
<span id="cb242-64"><a href="#cb242-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-65"><a href="#cb242-65" aria-hidden="true" tabindex="-1"></a><span class="co"># REPORT</span></span>
<span id="cb242-66"><a href="#cb242-66" aria-hidden="true" tabindex="-1"></a>regression_report(Yt_consump, Ytp_consump, Yv_consump, Yvp_consump)</span>
<span id="cb242-67"><a href="#cb242-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-68"><a href="#cb242-68" aria-hidden="true" tabindex="-1"></a><span class="co"># compute RMSE using numpy</span></span>
<span id="cb242-69"><a href="#cb242-69" aria-hidden="true" tabindex="-1"></a>training_RMSE_consump <span class="op">=</span> np.sqrt(mean_squared_error(Yt_consump, Ytp_consump))</span>
<span id="cb242-70"><a href="#cb242-70" aria-hidden="true" tabindex="-1"></a>validation_RMSE_consump <span class="op">=</span> np.sqrt(mean_squared_error(Yv_consump, Yvp_consump))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(157, 5, 1) --&gt; (157, 1)
(49, 5, 1) --&gt; (49, 1)
Model: "sequential_22"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 gru_8 (GRU)                 (None, 32)                3360      
                                                                 
 dense_22 (Dense)            (None, 1)                 33        
                                                                 
=================================================================
Total params: 3393 (13.25 KB)
Trainable params: 3393 (13.25 KB)
Non-trainable params: 0 (0.00 Byte)
_________________________________________________________________
None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-97-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>5/5 [==============================] - 0s 3ms/step
2/2 [==============================] - 0s 7ms/step
---------- Regression report ----------
TRAINING:
 MSE: 0.2995691196669474
 MAE: 0.4341264415337982</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-97-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-97-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>VALIDATION:
 MSE: 1.2107876513155427
 MAE: 0.8532101820645902</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-97-output-7.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-97-output-8.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Error Summary</strong></p>
<div class="cell" data-outputid="8068594c-1957-416c-b523-c38ed7572272" data-execution_count="99">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb246"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true" tabindex="-1"></a>error_table_consump_gru_l2 <span class="op">=</span> [[<span class="st">'Model'</span>,<span class="st">'train_MSE'</span>,<span class="st">'train_MAE'</span>,<span class="st">'train_RMSE'</span>,<span class="st">'val_MSE'</span>,<span class="st">'val_MAE'</span>,<span class="st">'val_RMSE'</span>],</span>
<span id="cb246-2"><a href="#cb246-2" aria-hidden="true" tabindex="-1"></a>              [<span class="st">'GRU(L2 Reg)'</span>,</span>
<span id="cb246-3"><a href="#cb246-3" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yt_consump, Ytp_consump),</span>
<span id="cb246-4"><a href="#cb246-4" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yt_consump, Ytp_consump),</span>
<span id="cb246-5"><a href="#cb246-5" aria-hidden="true" tabindex="-1"></a>              training_RMSE_consump,</span>
<span id="cb246-6"><a href="#cb246-6" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yv_consump, Yvp_consump),</span>
<span id="cb246-7"><a href="#cb246-7" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yv_consump, Yvp_consump),</span>
<span id="cb246-8"><a href="#cb246-8" aria-hidden="true" tabindex="-1"></a>               validation_RMSE_consump]]</span>
<span id="cb246-9"><a href="#cb246-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(error_table_consump_gru_l2, headers<span class="op">=</span><span class="st">'firstrow'</span>, tablefmt<span class="op">=</span><span class="st">'fancy_grid'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>╒═════════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model       │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞═════════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ GRU(L2 Reg) │    0.299569 │    0.434126 │     0.547329 │   1.21079 │   0.85321 │    1.10036 │
╘═════════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
</div>
<div id="tabset-10-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-3-tab">
<div class="cell" data-outputid="9657cbe3-a09b-49ee-d658-dd6d1966a1fc" data-execution_count="100">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb248"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW SIZES</span></span>
<span id="cb248-2"><a href="#cb248-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xt_prod.shape, <span class="st">"--&gt;"</span>, Yt_prod.shape)</span>
<span id="cb248-3"><a href="#cb248-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xv_prod.shape, <span class="st">"--&gt;"</span>, Yv_prod.shape)</span>
<span id="cb248-4"><a href="#cb248-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-5"><a href="#cb248-5" aria-hidden="true" tabindex="-1"></a><span class="co"># HYPERPARAMETERS</span></span>
<span id="cb248-6"><a href="#cb248-6" aria-hidden="true" tabindex="-1"></a>optimizer<span class="op">=</span><span class="st">"rmsprop"</span></span>
<span id="cb248-7"><a href="#cb248-7" aria-hidden="true" tabindex="-1"></a>loss_function<span class="op">=</span><span class="st">"MeanSquaredError"</span></span>
<span id="cb248-8"><a href="#cb248-8" aria-hidden="true" tabindex="-1"></a>learning_rate<span class="op">=</span><span class="fl">0.001</span></span>
<span id="cb248-9"><a href="#cb248-9" aria-hidden="true" tabindex="-1"></a>numbers_epochs<span class="op">=</span><span class="dv">200</span> <span class="co">#100</span></span>
<span id="cb248-10"><a href="#cb248-10" aria-hidden="true" tabindex="-1"></a>L2<span class="op">=</span><span class="fl">1e-4</span></span>
<span id="cb248-11"><a href="#cb248-11" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>(Xt_prod.shape[<span class="dv">1</span>],Xt_prod.shape[<span class="dv">2</span>])</span>
<span id="cb248-12"><a href="#cb248-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-13"><a href="#cb248-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-14"><a href="#cb248-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ------ Choose the batch size ------</span></span>
<span id="cb248-15"><a href="#cb248-15" aria-hidden="true" tabindex="-1"></a><span class="co"># batch_size=1                       # stocastic training</span></span>
<span id="cb248-16"><a href="#cb248-16" aria-hidden="true" tabindex="-1"></a><span class="co"># # batch_size=int(len(x_train)/2.)    # mini-batch training</span></span>
<span id="cb248-17"><a href="#cb248-17" aria-hidden="true" tabindex="-1"></a>batch_size<span class="op">=</span><span class="bu">len</span>(Xt1_prod)              <span class="co"># batch training</span></span>
<span id="cb248-18"><a href="#cb248-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-19"><a href="#cb248-19" aria-hidden="true" tabindex="-1"></a><span class="co"># BUILD MODEL</span></span>
<span id="cb248-20"><a href="#cb248-20" aria-hidden="true" tabindex="-1"></a>recurrent_hidden_units<span class="op">=</span><span class="dv">32</span></span>
<span id="cb248-21"><a href="#cb248-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-22"><a href="#cb248-22" aria-hidden="true" tabindex="-1"></a><span class="co"># CREATE MODEL</span></span>
<span id="cb248-23"><a href="#cb248-23" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> keras.Sequential()</span>
<span id="cb248-24"><a href="#cb248-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-25"><a href="#cb248-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ADD RECURRENT LAYER</span></span>
<span id="cb248-26"><a href="#cb248-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-27"><a href="#cb248-27" aria-hidden="true" tabindex="-1"></a><span class="co"># #COMMENT/UNCOMMENT TO USE RNN, LSTM,GRU</span></span>
<span id="cb248-28"><a href="#cb248-28" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(LSTM(</span></span>
<span id="cb248-29"><a href="#cb248-29" aria-hidden="true" tabindex="-1"></a>model.add(GRU(</span>
<span id="cb248-30"><a href="#cb248-30" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(SimpleRNN(</span></span>
<span id="cb248-31"><a href="#cb248-31" aria-hidden="true" tabindex="-1"></a>units<span class="op">=</span>recurrent_hidden_units,</span>
<span id="cb248-32"><a href="#cb248-32" aria-hidden="true" tabindex="-1"></a>return_sequences<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb248-33"><a href="#cb248-33" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>input_shape,</span>
<span id="cb248-34"><a href="#cb248-34" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_dropout=0.8,</span></span>
<span id="cb248-35"><a href="#cb248-35" aria-hidden="true" tabindex="-1"></a>recurrent_regularizer<span class="op">=</span>regularizers.L2(L2),</span>
<span id="cb248-36"><a href="#cb248-36" aria-hidden="true" tabindex="-1"></a>activation<span class="op">=</span><span class="st">'relu'</span>)</span>
<span id="cb248-37"><a href="#cb248-37" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb248-38"><a href="#cb248-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-39"><a href="#cb248-39" aria-hidden="true" tabindex="-1"></a><span class="co"># NEED TO TAKE THE OUTPUT RNN AND CONVERT TO SCALAR</span></span>
<span id="cb248-40"><a href="#cb248-40" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span><span class="st">'linear'</span>))</span>
<span id="cb248-41"><a href="#cb248-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-42"><a href="#cb248-42" aria-hidden="true" tabindex="-1"></a><span class="co"># MODEL SUMMARY</span></span>
<span id="cb248-43"><a href="#cb248-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())<span class="op">;</span> <span class="co">#print(x_train.shape,y_train.shape)</span></span>
<span id="cb248-44"><a href="#cb248-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-45"><a href="#cb248-45" aria-hidden="true" tabindex="-1"></a><span class="co"># # COMPILING THE MODEL</span></span>
<span id="cb248-46"><a href="#cb248-46" aria-hidden="true" tabindex="-1"></a>opt <span class="op">=</span> keras.optimizers.RMSprop(learning_rate<span class="op">=</span>learning_rate)</span>
<span id="cb248-47"><a href="#cb248-47" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>opt, loss<span class="op">=</span>loss_function)</span>
<span id="cb248-48"><a href="#cb248-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-49"><a href="#cb248-49" aria-hidden="true" tabindex="-1"></a><span class="co"># TRAINING YOUR MODEL</span></span>
<span id="cb248-50"><a href="#cb248-50" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(</span>
<span id="cb248-51"><a href="#cb248-51" aria-hidden="true" tabindex="-1"></a>    Xt_prod,</span>
<span id="cb248-52"><a href="#cb248-52" aria-hidden="true" tabindex="-1"></a>    Yt_prod,</span>
<span id="cb248-53"><a href="#cb248-53" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span>numbers_epochs,</span>
<span id="cb248-54"><a href="#cb248-54" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span>batch_size,</span>
<span id="cb248-55"><a href="#cb248-55" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb248-56"><a href="#cb248-56" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>(Xv_prod, Yv_prod),</span>
<span id="cb248-57"><a href="#cb248-57" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb248-58"><a href="#cb248-58" aria-hidden="true" tabindex="-1"></a><span class="co"># History plot</span></span>
<span id="cb248-59"><a href="#cb248-59" aria-hidden="true" tabindex="-1"></a>history_plot(history)</span>
<span id="cb248-60"><a href="#cb248-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-61"><a href="#cb248-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb248-62"><a href="#cb248-62" aria-hidden="true" tabindex="-1"></a>Ytp_prod <span class="op">=</span> model.predict(Xt_prod)</span>
<span id="cb248-63"><a href="#cb248-63" aria-hidden="true" tabindex="-1"></a>Yvp_prod <span class="op">=</span> model.predict(Xv_prod)</span>
<span id="cb248-64"><a href="#cb248-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-65"><a href="#cb248-65" aria-hidden="true" tabindex="-1"></a><span class="co"># REPORT</span></span>
<span id="cb248-66"><a href="#cb248-66" aria-hidden="true" tabindex="-1"></a>regression_report(Yt_prod, Ytp_prod, Yv_prod, Yvp_prod)</span>
<span id="cb248-67"><a href="#cb248-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-68"><a href="#cb248-68" aria-hidden="true" tabindex="-1"></a><span class="co"># compute RMSE using numpy</span></span>
<span id="cb248-69"><a href="#cb248-69" aria-hidden="true" tabindex="-1"></a>training_RMSE_prod <span class="op">=</span> np.sqrt(mean_squared_error(Yt_prod, Ytp_prod))</span>
<span id="cb248-70"><a href="#cb248-70" aria-hidden="true" tabindex="-1"></a>validation_RMSE_prod <span class="op">=</span> np.sqrt(mean_squared_error(Yv_prod, Yvp_prod))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(157, 5, 1) --&gt; (157, 1)
(49, 5, 1) --&gt; (49, 1)
Model: "sequential_23"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 gru_9 (GRU)                 (None, 32)                3360      
                                                                 
 dense_23 (Dense)            (None, 1)                 33        
                                                                 
=================================================================
Total params: 3393 (13.25 KB)
Trainable params: 3393 (13.25 KB)
Non-trainable params: 0 (0.00 Byte)
_________________________________________________________________
None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-99-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>5/5 [==============================] - 0s 5ms/step
2/2 [==============================] - 0s 8ms/step
---------- Regression report ----------
TRAINING:
 MSE: 0.02248999120633133
 MAE: 0.1125636691296517</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-99-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-99-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>VALIDATION:
 MSE: 0.2939585365374952
 MAE: 0.49880377964020967</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-99-output-7.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-99-output-8.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Error Summary</strong></p>
<div class="cell" data-outputid="29302d1e-dbbc-446c-930f-eb0cfef2edc4" data-execution_count="101">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb252"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a>error_table_prod_gru_l2 <span class="op">=</span> [[<span class="st">'Model'</span>,<span class="st">'train_MSE'</span>,<span class="st">'train_MAE'</span>,<span class="st">'train_RMSE'</span>,<span class="st">'val_MSE'</span>,<span class="st">'val_MAE'</span>,<span class="st">'val_RMSE'</span>],</span>
<span id="cb252-2"><a href="#cb252-2" aria-hidden="true" tabindex="-1"></a>              [<span class="st">'GRU(L2 Reg)'</span>,</span>
<span id="cb252-3"><a href="#cb252-3" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yt_prod, Ytp_prod),</span>
<span id="cb252-4"><a href="#cb252-4" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yt_prod, Ytp_prod),</span>
<span id="cb252-5"><a href="#cb252-5" aria-hidden="true" tabindex="-1"></a>              training_RMSE_prod,</span>
<span id="cb252-6"><a href="#cb252-6" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yv_prod, Yvp_prod),</span>
<span id="cb252-7"><a href="#cb252-7" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yv_prod, Yvp_prod),</span>
<span id="cb252-8"><a href="#cb252-8" aria-hidden="true" tabindex="-1"></a>               validation_RMSE_prod]]</span>
<span id="cb252-9"><a href="#cb252-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(error_table_prod_gru_l2, headers<span class="op">=</span><span class="st">'firstrow'</span>, tablefmt<span class="op">=</span><span class="st">'fancy_grid'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>╒═════════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model       │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞═════════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ GRU(L2 Reg) │     0.02249 │    0.112564 │     0.149967 │  0.293959 │  0.498804 │   0.542179 │
╘═════════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
</div>
<div id="tabset-10-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-4-tab">
<div class="cell" data-outputid="39f2a628-0eeb-4322-a73d-e1a6e459b411" data-execution_count="102">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb254"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW SIZES</span></span>
<span id="cb254-2"><a href="#cb254-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xt_imp.shape, <span class="st">"--&gt;"</span>, Yt_imp.shape)</span>
<span id="cb254-3"><a href="#cb254-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xv_imp.shape, <span class="st">"--&gt;"</span>, Yv_imp.shape)</span>
<span id="cb254-4"><a href="#cb254-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-5"><a href="#cb254-5" aria-hidden="true" tabindex="-1"></a><span class="co"># HYPERPARAMETERS</span></span>
<span id="cb254-6"><a href="#cb254-6" aria-hidden="true" tabindex="-1"></a>optimizer<span class="op">=</span><span class="st">"rmsprop"</span></span>
<span id="cb254-7"><a href="#cb254-7" aria-hidden="true" tabindex="-1"></a>loss_function<span class="op">=</span><span class="st">"MeanSquaredError"</span></span>
<span id="cb254-8"><a href="#cb254-8" aria-hidden="true" tabindex="-1"></a>learning_rate<span class="op">=</span><span class="fl">0.001</span></span>
<span id="cb254-9"><a href="#cb254-9" aria-hidden="true" tabindex="-1"></a>numbers_epochs<span class="op">=</span><span class="dv">200</span> <span class="co">#100</span></span>
<span id="cb254-10"><a href="#cb254-10" aria-hidden="true" tabindex="-1"></a>L2<span class="op">=</span><span class="fl">1e-4</span></span>
<span id="cb254-11"><a href="#cb254-11" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>(Xt_imp.shape[<span class="dv">1</span>],Xt_imp.shape[<span class="dv">2</span>])</span>
<span id="cb254-12"><a href="#cb254-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-13"><a href="#cb254-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-14"><a href="#cb254-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ------ Choose the batch size ------</span></span>
<span id="cb254-15"><a href="#cb254-15" aria-hidden="true" tabindex="-1"></a><span class="co"># batch_size=1                       # stocastic training</span></span>
<span id="cb254-16"><a href="#cb254-16" aria-hidden="true" tabindex="-1"></a><span class="co"># # batch_size=int(len(x_train)/2.)    # mini-batch training</span></span>
<span id="cb254-17"><a href="#cb254-17" aria-hidden="true" tabindex="-1"></a>batch_size<span class="op">=</span><span class="bu">len</span>(Xt1_imp)              <span class="co"># batch training</span></span>
<span id="cb254-18"><a href="#cb254-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-19"><a href="#cb254-19" aria-hidden="true" tabindex="-1"></a><span class="co"># BUILD MODEL</span></span>
<span id="cb254-20"><a href="#cb254-20" aria-hidden="true" tabindex="-1"></a>recurrent_hidden_units<span class="op">=</span><span class="dv">32</span></span>
<span id="cb254-21"><a href="#cb254-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-22"><a href="#cb254-22" aria-hidden="true" tabindex="-1"></a><span class="co"># CREATE MODEL</span></span>
<span id="cb254-23"><a href="#cb254-23" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> keras.Sequential()</span>
<span id="cb254-24"><a href="#cb254-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-25"><a href="#cb254-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ADD RECURRENT LAYER</span></span>
<span id="cb254-26"><a href="#cb254-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-27"><a href="#cb254-27" aria-hidden="true" tabindex="-1"></a><span class="co"># #COMMENT/UNCOMMENT TO USE RNN, LSTM,GRU</span></span>
<span id="cb254-28"><a href="#cb254-28" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(LSTM(</span></span>
<span id="cb254-29"><a href="#cb254-29" aria-hidden="true" tabindex="-1"></a>model.add(GRU(</span>
<span id="cb254-30"><a href="#cb254-30" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(SimpleRNN(</span></span>
<span id="cb254-31"><a href="#cb254-31" aria-hidden="true" tabindex="-1"></a>units<span class="op">=</span>recurrent_hidden_units,</span>
<span id="cb254-32"><a href="#cb254-32" aria-hidden="true" tabindex="-1"></a>return_sequences<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb254-33"><a href="#cb254-33" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>input_shape,</span>
<span id="cb254-34"><a href="#cb254-34" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_dropout=0.8,</span></span>
<span id="cb254-35"><a href="#cb254-35" aria-hidden="true" tabindex="-1"></a>recurrent_regularizer<span class="op">=</span>regularizers.L2(L2),</span>
<span id="cb254-36"><a href="#cb254-36" aria-hidden="true" tabindex="-1"></a>activation<span class="op">=</span><span class="st">'relu'</span>)</span>
<span id="cb254-37"><a href="#cb254-37" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb254-38"><a href="#cb254-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-39"><a href="#cb254-39" aria-hidden="true" tabindex="-1"></a><span class="co"># NEED TO TAKE THE OUTPUT RNN AND CONVERT TO SCALAR</span></span>
<span id="cb254-40"><a href="#cb254-40" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span><span class="st">'linear'</span>))</span>
<span id="cb254-41"><a href="#cb254-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-42"><a href="#cb254-42" aria-hidden="true" tabindex="-1"></a><span class="co"># MODEL SUMMARY</span></span>
<span id="cb254-43"><a href="#cb254-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())<span class="op">;</span> <span class="co">#print(x_train.shape,y_train.shape)</span></span>
<span id="cb254-44"><a href="#cb254-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-45"><a href="#cb254-45" aria-hidden="true" tabindex="-1"></a><span class="co"># # COMPILING THE MODEL</span></span>
<span id="cb254-46"><a href="#cb254-46" aria-hidden="true" tabindex="-1"></a>opt <span class="op">=</span> keras.optimizers.RMSprop(learning_rate<span class="op">=</span>learning_rate)</span>
<span id="cb254-47"><a href="#cb254-47" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>opt, loss<span class="op">=</span>loss_function)</span>
<span id="cb254-48"><a href="#cb254-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-49"><a href="#cb254-49" aria-hidden="true" tabindex="-1"></a><span class="co"># TRAINING YOUR MODEL</span></span>
<span id="cb254-50"><a href="#cb254-50" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(</span>
<span id="cb254-51"><a href="#cb254-51" aria-hidden="true" tabindex="-1"></a>    Xt_imp,</span>
<span id="cb254-52"><a href="#cb254-52" aria-hidden="true" tabindex="-1"></a>    Yt_imp,</span>
<span id="cb254-53"><a href="#cb254-53" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span>numbers_epochs,</span>
<span id="cb254-54"><a href="#cb254-54" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span>batch_size,</span>
<span id="cb254-55"><a href="#cb254-55" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb254-56"><a href="#cb254-56" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>(Xv_imp, Yv_imp),</span>
<span id="cb254-57"><a href="#cb254-57" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb254-58"><a href="#cb254-58" aria-hidden="true" tabindex="-1"></a><span class="co"># History plot</span></span>
<span id="cb254-59"><a href="#cb254-59" aria-hidden="true" tabindex="-1"></a>history_plot(history)</span>
<span id="cb254-60"><a href="#cb254-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-61"><a href="#cb254-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb254-62"><a href="#cb254-62" aria-hidden="true" tabindex="-1"></a>Ytp_imp <span class="op">=</span> model.predict(Xt_imp)</span>
<span id="cb254-63"><a href="#cb254-63" aria-hidden="true" tabindex="-1"></a>Yvp_imp <span class="op">=</span> model.predict(Xv_imp)</span>
<span id="cb254-64"><a href="#cb254-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-65"><a href="#cb254-65" aria-hidden="true" tabindex="-1"></a><span class="co"># REPORT</span></span>
<span id="cb254-66"><a href="#cb254-66" aria-hidden="true" tabindex="-1"></a>regression_report(Yt_imp, Ytp_imp, Yv_imp, Yvp_imp)</span>
<span id="cb254-67"><a href="#cb254-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-68"><a href="#cb254-68" aria-hidden="true" tabindex="-1"></a><span class="co"># compute RMSE using numpy</span></span>
<span id="cb254-69"><a href="#cb254-69" aria-hidden="true" tabindex="-1"></a>training_RMSE_imp <span class="op">=</span> np.sqrt(mean_squared_error(Yt_imp, Ytp_imp))</span>
<span id="cb254-70"><a href="#cb254-70" aria-hidden="true" tabindex="-1"></a>validation_RMSE_imp <span class="op">=</span> np.sqrt(mean_squared_error(Yv_imp, Yvp_imp))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(229, 5, 1) --&gt; (229, 1)
(73, 5, 1) --&gt; (73, 1)
Model: "sequential_24"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 gru_10 (GRU)                (None, 32)                3360      
                                                                 
 dense_24 (Dense)            (None, 1)                 33        
                                                                 
=================================================================
Total params: 3393 (13.25 KB)
Trainable params: 3393 (13.25 KB)
Non-trainable params: 0 (0.00 Byte)
_________________________________________________________________
None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-101-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>8/8 [==============================] - 0s 3ms/step
3/3 [==============================] - 0s 5ms/step
---------- Regression report ----------
TRAINING:
 MSE: 0.18782569642597555
 MAE: 0.3343330888733994</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-101-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-101-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>VALIDATION:
 MSE: 0.22834866097912995
 MAE: 0.37341519140814167</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-101-output-7.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-101-output-8.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Error Summary</strong></p>
<div class="cell" data-outputid="020567c8-4841-4556-cd6d-32615753d1d1" data-execution_count="103">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb258"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a>error_table_imp_gru_l2 <span class="op">=</span> [[<span class="st">'Model'</span>,<span class="st">'train_MSE'</span>,<span class="st">'train_MAE'</span>,<span class="st">'train_RMSE'</span>,<span class="st">'val_MSE'</span>,<span class="st">'val_MAE'</span>,<span class="st">'val_RMSE'</span>],</span>
<span id="cb258-2"><a href="#cb258-2" aria-hidden="true" tabindex="-1"></a>              [<span class="st">'GRU(L2 Reg)'</span>,</span>
<span id="cb258-3"><a href="#cb258-3" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yt_imp, Ytp_imp),</span>
<span id="cb258-4"><a href="#cb258-4" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yt_imp, Ytp_imp),</span>
<span id="cb258-5"><a href="#cb258-5" aria-hidden="true" tabindex="-1"></a>               training_RMSE_imp,</span>
<span id="cb258-6"><a href="#cb258-6" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yv_imp, Yvp_imp),</span>
<span id="cb258-7"><a href="#cb258-7" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yv_imp, Yvp_imp),</span>
<span id="cb258-8"><a href="#cb258-8" aria-hidden="true" tabindex="-1"></a>               validation_RMSE_imp]]</span>
<span id="cb258-9"><a href="#cb258-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(error_table_imp_gru_l2, headers<span class="op">=</span><span class="st">'firstrow'</span>, tablefmt<span class="op">=</span><span class="st">'fancy_grid'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>╒═════════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model       │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞═════════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ GRU(L2 Reg) │    0.187826 │    0.334333 │     0.433389 │  0.228349 │  0.373415 │   0.477858 │
╘═════════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
</div>
<div id="tabset-10-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-5-tab">
<div class="cell" data-outputid="5bcc02ce-580d-4a52-8ce2-14e0a6897b0e" data-execution_count="104">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb260"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW SIZES</span></span>
<span id="cb260-2"><a href="#cb260-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xt_exp.shape, <span class="st">"--&gt;"</span>, Yt_exp.shape)</span>
<span id="cb260-3"><a href="#cb260-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xv_exp.shape, <span class="st">"--&gt;"</span>, Yv_exp.shape)</span>
<span id="cb260-4"><a href="#cb260-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-5"><a href="#cb260-5" aria-hidden="true" tabindex="-1"></a><span class="co"># HYPERPARAMETERS</span></span>
<span id="cb260-6"><a href="#cb260-6" aria-hidden="true" tabindex="-1"></a>optimizer<span class="op">=</span><span class="st">"rmsprop"</span></span>
<span id="cb260-7"><a href="#cb260-7" aria-hidden="true" tabindex="-1"></a>loss_function<span class="op">=</span><span class="st">"MeanSquaredError"</span></span>
<span id="cb260-8"><a href="#cb260-8" aria-hidden="true" tabindex="-1"></a>learning_rate<span class="op">=</span><span class="fl">0.001</span></span>
<span id="cb260-9"><a href="#cb260-9" aria-hidden="true" tabindex="-1"></a>numbers_epochs<span class="op">=</span><span class="dv">200</span> <span class="co">#100</span></span>
<span id="cb260-10"><a href="#cb260-10" aria-hidden="true" tabindex="-1"></a>L2<span class="op">=</span><span class="fl">1e-4</span></span>
<span id="cb260-11"><a href="#cb260-11" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>(Xt_exp.shape[<span class="dv">1</span>],Xt_exp.shape[<span class="dv">2</span>])</span>
<span id="cb260-12"><a href="#cb260-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-13"><a href="#cb260-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-14"><a href="#cb260-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ------ Choose the batch size ------</span></span>
<span id="cb260-15"><a href="#cb260-15" aria-hidden="true" tabindex="-1"></a><span class="co"># batch_size=1                       # stocastic training</span></span>
<span id="cb260-16"><a href="#cb260-16" aria-hidden="true" tabindex="-1"></a><span class="co"># # batch_size=int(len(x_train)/2.)    # mini-batch training</span></span>
<span id="cb260-17"><a href="#cb260-17" aria-hidden="true" tabindex="-1"></a>batch_size<span class="op">=</span><span class="bu">len</span>(Xt1_exp)              <span class="co"># batch training</span></span>
<span id="cb260-18"><a href="#cb260-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-19"><a href="#cb260-19" aria-hidden="true" tabindex="-1"></a><span class="co"># BUILD MODEL</span></span>
<span id="cb260-20"><a href="#cb260-20" aria-hidden="true" tabindex="-1"></a>recurrent_hidden_units<span class="op">=</span><span class="dv">32</span></span>
<span id="cb260-21"><a href="#cb260-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-22"><a href="#cb260-22" aria-hidden="true" tabindex="-1"></a><span class="co"># CREATE MODEL</span></span>
<span id="cb260-23"><a href="#cb260-23" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> keras.Sequential()</span>
<span id="cb260-24"><a href="#cb260-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-25"><a href="#cb260-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ADD RECURRENT LAYER</span></span>
<span id="cb260-26"><a href="#cb260-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-27"><a href="#cb260-27" aria-hidden="true" tabindex="-1"></a><span class="co"># #COMMENT/UNCOMMENT TO USE RNN, LSTM,GRU</span></span>
<span id="cb260-28"><a href="#cb260-28" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(LSTM(</span></span>
<span id="cb260-29"><a href="#cb260-29" aria-hidden="true" tabindex="-1"></a>model.add(GRU(</span>
<span id="cb260-30"><a href="#cb260-30" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(SimpleRNN(</span></span>
<span id="cb260-31"><a href="#cb260-31" aria-hidden="true" tabindex="-1"></a>units<span class="op">=</span>recurrent_hidden_units,</span>
<span id="cb260-32"><a href="#cb260-32" aria-hidden="true" tabindex="-1"></a>return_sequences<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb260-33"><a href="#cb260-33" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>input_shape,</span>
<span id="cb260-34"><a href="#cb260-34" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_dropout=0.8,</span></span>
<span id="cb260-35"><a href="#cb260-35" aria-hidden="true" tabindex="-1"></a>recurrent_regularizer<span class="op">=</span>regularizers.L2(L2),</span>
<span id="cb260-36"><a href="#cb260-36" aria-hidden="true" tabindex="-1"></a>activation<span class="op">=</span><span class="st">'relu'</span>)</span>
<span id="cb260-37"><a href="#cb260-37" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb260-38"><a href="#cb260-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-39"><a href="#cb260-39" aria-hidden="true" tabindex="-1"></a><span class="co"># NEED TO TAKE THE OUTPUT RNN AND CONVERT TO SCALAR</span></span>
<span id="cb260-40"><a href="#cb260-40" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span><span class="st">'linear'</span>))</span>
<span id="cb260-41"><a href="#cb260-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-42"><a href="#cb260-42" aria-hidden="true" tabindex="-1"></a><span class="co"># MODEL SUMMARY</span></span>
<span id="cb260-43"><a href="#cb260-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())<span class="op">;</span> <span class="co">#print(x_train.shape,y_train.shape)</span></span>
<span id="cb260-44"><a href="#cb260-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-45"><a href="#cb260-45" aria-hidden="true" tabindex="-1"></a><span class="co"># # COMPILING THE MODEL</span></span>
<span id="cb260-46"><a href="#cb260-46" aria-hidden="true" tabindex="-1"></a>opt <span class="op">=</span> keras.optimizers.RMSprop(learning_rate<span class="op">=</span>learning_rate)</span>
<span id="cb260-47"><a href="#cb260-47" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>opt, loss<span class="op">=</span>loss_function)</span>
<span id="cb260-48"><a href="#cb260-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-49"><a href="#cb260-49" aria-hidden="true" tabindex="-1"></a><span class="co"># TRAINING YOUR MODEL</span></span>
<span id="cb260-50"><a href="#cb260-50" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(</span>
<span id="cb260-51"><a href="#cb260-51" aria-hidden="true" tabindex="-1"></a>    Xt_exp,</span>
<span id="cb260-52"><a href="#cb260-52" aria-hidden="true" tabindex="-1"></a>    Yt_exp,</span>
<span id="cb260-53"><a href="#cb260-53" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span>numbers_epochs,</span>
<span id="cb260-54"><a href="#cb260-54" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span>batch_size,</span>
<span id="cb260-55"><a href="#cb260-55" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb260-56"><a href="#cb260-56" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>(Xv_exp, Yv_exp),</span>
<span id="cb260-57"><a href="#cb260-57" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb260-58"><a href="#cb260-58" aria-hidden="true" tabindex="-1"></a><span class="co"># History plot</span></span>
<span id="cb260-59"><a href="#cb260-59" aria-hidden="true" tabindex="-1"></a>history_plot(history)</span>
<span id="cb260-60"><a href="#cb260-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-61"><a href="#cb260-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb260-62"><a href="#cb260-62" aria-hidden="true" tabindex="-1"></a>Ytp_exp <span class="op">=</span> model.predict(Xt_exp)</span>
<span id="cb260-63"><a href="#cb260-63" aria-hidden="true" tabindex="-1"></a>Yvp_exp <span class="op">=</span> model.predict(Xv_exp)</span>
<span id="cb260-64"><a href="#cb260-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-65"><a href="#cb260-65" aria-hidden="true" tabindex="-1"></a><span class="co"># REPORT</span></span>
<span id="cb260-66"><a href="#cb260-66" aria-hidden="true" tabindex="-1"></a>regression_report(Yt_exp, Ytp_exp, Yv_exp, Yvp_exp)</span>
<span id="cb260-67"><a href="#cb260-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-68"><a href="#cb260-68" aria-hidden="true" tabindex="-1"></a><span class="co"># compute RMSE using numpy</span></span>
<span id="cb260-69"><a href="#cb260-69" aria-hidden="true" tabindex="-1"></a>training_RMSE_exp <span class="op">=</span> np.sqrt(mean_squared_error(Yt_exp, Ytp_exp))</span>
<span id="cb260-70"><a href="#cb260-70" aria-hidden="true" tabindex="-1"></a>validation_RMSE_exp <span class="op">=</span> np.sqrt(mean_squared_error(Yv_exp, Yvp_exp))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(229, 5, 1) --&gt; (229, 1)
(73, 5, 1) --&gt; (73, 1)
Model: "sequential_25"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 gru_11 (GRU)                (None, 32)                3360      
                                                                 
 dense_25 (Dense)            (None, 1)                 33        
                                                                 
=================================================================
Total params: 3393 (13.25 KB)
Trainable params: 3393 (13.25 KB)
Non-trainable params: 0 (0.00 Byte)
_________________________________________________________________
None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-103-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>8/8 [==============================] - 0s 4ms/step
3/3 [==============================] - 0s 5ms/step
---------- Regression report ----------
TRAINING:
 MSE: 0.007668944289032949
 MAE: 0.06449698191446716</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-103-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-103-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>VALIDATION:
 MSE: 2.7026562417173494
 MAE: 1.4347720741135572</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-103-output-7.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-103-output-8.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Error Summary</strong></p>
<div class="cell" data-outputid="9f8a8f38-5e4b-4a4f-fda5-02b9b60dade4" data-execution_count="105">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb264"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a>error_table_exp_gru_l2 <span class="op">=</span> [[<span class="st">'Model'</span>,<span class="st">'train_MSE'</span>,<span class="st">'train_MAE'</span>,<span class="st">'train_RMSE'</span>,<span class="st">'val_MSE'</span>,<span class="st">'val_MAE'</span>,<span class="st">'val_RMSE'</span>],</span>
<span id="cb264-2"><a href="#cb264-2" aria-hidden="true" tabindex="-1"></a>              [<span class="st">'GRU(L2 Reg)'</span>,</span>
<span id="cb264-3"><a href="#cb264-3" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yt_exp, Ytp_exp),</span>
<span id="cb264-4"><a href="#cb264-4" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yt_exp, Ytp_exp),</span>
<span id="cb264-5"><a href="#cb264-5" aria-hidden="true" tabindex="-1"></a>               training_RMSE_exp,</span>
<span id="cb264-6"><a href="#cb264-6" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yv_exp, Yvp_exp),</span>
<span id="cb264-7"><a href="#cb264-7" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yv_exp, Yvp_exp),</span>
<span id="cb264-8"><a href="#cb264-8" aria-hidden="true" tabindex="-1"></a>               validation_RMSE_exp]]</span>
<span id="cb264-9"><a href="#cb264-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(error_table_exp_gru_l2, headers<span class="op">=</span><span class="st">'firstrow'</span>, tablefmt<span class="op">=</span><span class="st">'fancy_grid'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>╒═════════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model       │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞═════════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ GRU(L2 Reg) │  0.00766894 │    0.064497 │    0.0875725 │   2.70266 │   1.43477 │    1.64398 │
╘═════════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
</div>
<div id="tabset-10-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-6-tab">
<div class="cell" data-outputid="a4d6dfcb-230e-4964-b16e-8c6926cb327e" data-execution_count="106">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb266"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW SIZES</span></span>
<span id="cb266-2"><a href="#cb266-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xt_stk.shape, <span class="st">"--&gt;"</span>, Yt_stk.shape)</span>
<span id="cb266-3"><a href="#cb266-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xv_stk.shape, <span class="st">"--&gt;"</span>, Yv_stk.shape)</span>
<span id="cb266-4"><a href="#cb266-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-5"><a href="#cb266-5" aria-hidden="true" tabindex="-1"></a><span class="co"># HYPERPARAMETERS</span></span>
<span id="cb266-6"><a href="#cb266-6" aria-hidden="true" tabindex="-1"></a>optimizer<span class="op">=</span><span class="st">"rmsprop"</span></span>
<span id="cb266-7"><a href="#cb266-7" aria-hidden="true" tabindex="-1"></a>loss_function<span class="op">=</span><span class="st">"MeanSquaredError"</span></span>
<span id="cb266-8"><a href="#cb266-8" aria-hidden="true" tabindex="-1"></a>learning_rate<span class="op">=</span><span class="fl">0.001</span></span>
<span id="cb266-9"><a href="#cb266-9" aria-hidden="true" tabindex="-1"></a>numbers_epochs<span class="op">=</span><span class="dv">200</span> <span class="co">#100</span></span>
<span id="cb266-10"><a href="#cb266-10" aria-hidden="true" tabindex="-1"></a>L2<span class="op">=</span><span class="fl">1e-4</span></span>
<span id="cb266-11"><a href="#cb266-11" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>(Xt_stk.shape[<span class="dv">1</span>],Xt_stk.shape[<span class="dv">2</span>])</span>
<span id="cb266-12"><a href="#cb266-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-13"><a href="#cb266-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-14"><a href="#cb266-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ------ Choose the batch size ------</span></span>
<span id="cb266-15"><a href="#cb266-15" aria-hidden="true" tabindex="-1"></a><span class="co"># batch_size=1                       # stocastic training</span></span>
<span id="cb266-16"><a href="#cb266-16" aria-hidden="true" tabindex="-1"></a><span class="co"># # batch_size=int(len(x_train)/2.)    # mini-batch training</span></span>
<span id="cb266-17"><a href="#cb266-17" aria-hidden="true" tabindex="-1"></a>batch_size<span class="op">=</span><span class="bu">len</span>(Xt1_stk)              <span class="co"># batch training</span></span>
<span id="cb266-18"><a href="#cb266-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-19"><a href="#cb266-19" aria-hidden="true" tabindex="-1"></a><span class="co"># BUILD MODEL</span></span>
<span id="cb266-20"><a href="#cb266-20" aria-hidden="true" tabindex="-1"></a>recurrent_hidden_units<span class="op">=</span><span class="dv">32</span></span>
<span id="cb266-21"><a href="#cb266-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-22"><a href="#cb266-22" aria-hidden="true" tabindex="-1"></a><span class="co"># CREATE MODEL</span></span>
<span id="cb266-23"><a href="#cb266-23" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> keras.Sequential()</span>
<span id="cb266-24"><a href="#cb266-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-25"><a href="#cb266-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ADD RECURRENT LAYER</span></span>
<span id="cb266-26"><a href="#cb266-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-27"><a href="#cb266-27" aria-hidden="true" tabindex="-1"></a><span class="co"># #COMMENT/UNCOMMENT TO USE RNN, LSTM,GRU</span></span>
<span id="cb266-28"><a href="#cb266-28" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(LSTM(</span></span>
<span id="cb266-29"><a href="#cb266-29" aria-hidden="true" tabindex="-1"></a>model.add(GRU(</span>
<span id="cb266-30"><a href="#cb266-30" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(SimpleRNN(</span></span>
<span id="cb266-31"><a href="#cb266-31" aria-hidden="true" tabindex="-1"></a>units<span class="op">=</span>recurrent_hidden_units,</span>
<span id="cb266-32"><a href="#cb266-32" aria-hidden="true" tabindex="-1"></a>return_sequences<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb266-33"><a href="#cb266-33" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>input_shape,</span>
<span id="cb266-34"><a href="#cb266-34" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_dropout=0.8,</span></span>
<span id="cb266-35"><a href="#cb266-35" aria-hidden="true" tabindex="-1"></a>recurrent_regularizer<span class="op">=</span>regularizers.L2(L2),</span>
<span id="cb266-36"><a href="#cb266-36" aria-hidden="true" tabindex="-1"></a>activation<span class="op">=</span><span class="st">'relu'</span>)</span>
<span id="cb266-37"><a href="#cb266-37" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb266-38"><a href="#cb266-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-39"><a href="#cb266-39" aria-hidden="true" tabindex="-1"></a><span class="co"># NEED TO TAKE THE OUTPUT RNN AND CONVERT TO SCALAR</span></span>
<span id="cb266-40"><a href="#cb266-40" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span><span class="st">'linear'</span>))</span>
<span id="cb266-41"><a href="#cb266-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-42"><a href="#cb266-42" aria-hidden="true" tabindex="-1"></a><span class="co"># MODEL SUMMARY</span></span>
<span id="cb266-43"><a href="#cb266-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())<span class="op">;</span> <span class="co">#print(x_train.shape,y_train.shape)</span></span>
<span id="cb266-44"><a href="#cb266-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-45"><a href="#cb266-45" aria-hidden="true" tabindex="-1"></a><span class="co"># # COMPILING THE MODEL</span></span>
<span id="cb266-46"><a href="#cb266-46" aria-hidden="true" tabindex="-1"></a>opt <span class="op">=</span> keras.optimizers.RMSprop(learning_rate<span class="op">=</span>learning_rate)</span>
<span id="cb266-47"><a href="#cb266-47" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>opt, loss<span class="op">=</span>loss_function)</span>
<span id="cb266-48"><a href="#cb266-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-49"><a href="#cb266-49" aria-hidden="true" tabindex="-1"></a><span class="co"># TRAINING YOUR MODEL</span></span>
<span id="cb266-50"><a href="#cb266-50" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(</span>
<span id="cb266-51"><a href="#cb266-51" aria-hidden="true" tabindex="-1"></a>    Xt_stk,</span>
<span id="cb266-52"><a href="#cb266-52" aria-hidden="true" tabindex="-1"></a>    Yt_stk,</span>
<span id="cb266-53"><a href="#cb266-53" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span>numbers_epochs,</span>
<span id="cb266-54"><a href="#cb266-54" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span>batch_size,</span>
<span id="cb266-55"><a href="#cb266-55" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb266-56"><a href="#cb266-56" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>(Xv_stk, Yv_stk),</span>
<span id="cb266-57"><a href="#cb266-57" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb266-58"><a href="#cb266-58" aria-hidden="true" tabindex="-1"></a><span class="co"># History plot</span></span>
<span id="cb266-59"><a href="#cb266-59" aria-hidden="true" tabindex="-1"></a>history_plot(history)</span>
<span id="cb266-60"><a href="#cb266-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-61"><a href="#cb266-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb266-62"><a href="#cb266-62" aria-hidden="true" tabindex="-1"></a>Ytp_stk <span class="op">=</span> model.predict(Xt_stk)</span>
<span id="cb266-63"><a href="#cb266-63" aria-hidden="true" tabindex="-1"></a>Yvp_stk <span class="op">=</span> model.predict(Xv_stk)</span>
<span id="cb266-64"><a href="#cb266-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-65"><a href="#cb266-65" aria-hidden="true" tabindex="-1"></a><span class="co"># REPORT</span></span>
<span id="cb266-66"><a href="#cb266-66" aria-hidden="true" tabindex="-1"></a>regression_report(Yt_stk, Ytp_stk, Yv_stk, Yvp_stk)</span>
<span id="cb266-67"><a href="#cb266-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-68"><a href="#cb266-68" aria-hidden="true" tabindex="-1"></a><span class="co"># compute RMSE using numpy</span></span>
<span id="cb266-69"><a href="#cb266-69" aria-hidden="true" tabindex="-1"></a>training_RMSE_stk <span class="op">=</span> np.sqrt(mean_squared_error(Yt_stk, Ytp_stk))</span>
<span id="cb266-70"><a href="#cb266-70" aria-hidden="true" tabindex="-1"></a>validation_RMSE_stk <span class="op">=</span> np.sqrt(mean_squared_error(Yv_stk, Yvp_stk))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(3377, 5, 1) --&gt; (3377, 1)
(1123, 5, 1) --&gt; (1123, 1)
Model: "sequential_26"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 gru_12 (GRU)                (None, 32)                3360      
                                                                 
 dense_26 (Dense)            (None, 1)                 33        
                                                                 
=================================================================
Total params: 3393 (13.25 KB)
Trainable params: 3393 (13.25 KB)
Non-trainable params: 0 (0.00 Byte)
_________________________________________________________________
None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-105-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>106/106 [==============================] - 0s 2ms/step
36/36 [==============================] - 0s 2ms/step
---------- Regression report ----------
TRAINING:
 MSE: 0.0027459609912201706
 MAE: 0.038920349685540014</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-105-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-105-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>VALIDATION:
 MSE: 0.044396008253210044
 MAE: 0.13976088675590678</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-105-output-7.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-105-output-8.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Error Summary</strong></p>
<div class="cell" data-outputid="4a8b0c2e-52c4-4cae-8ad9-29b3646fb45e" data-execution_count="107">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb270"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb270-1"><a href="#cb270-1" aria-hidden="true" tabindex="-1"></a>error_table_stk_gru_l2 <span class="op">=</span> [[<span class="st">'Model'</span>,<span class="st">'train_MSE'</span>,<span class="st">'train_MAE'</span>,<span class="st">'train_RMSE'</span>,<span class="st">'val_MSE'</span>,<span class="st">'val_MAE'</span>,<span class="st">'val_RMSE'</span>],</span>
<span id="cb270-2"><a href="#cb270-2" aria-hidden="true" tabindex="-1"></a>              [<span class="st">'GRU(L2 Reg)'</span>,</span>
<span id="cb270-3"><a href="#cb270-3" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yt_stk, Ytp_stk),</span>
<span id="cb270-4"><a href="#cb270-4" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yt_stk, Ytp_stk),</span>
<span id="cb270-5"><a href="#cb270-5" aria-hidden="true" tabindex="-1"></a>               training_RMSE_stk,</span>
<span id="cb270-6"><a href="#cb270-6" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yv_stk, Yvp_stk),</span>
<span id="cb270-7"><a href="#cb270-7" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yv_stk, Yvp_stk),</span>
<span id="cb270-8"><a href="#cb270-8" aria-hidden="true" tabindex="-1"></a>               validation_RMSE_stk]]</span>
<span id="cb270-9"><a href="#cb270-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(error_table_stk_gru_l2, headers<span class="op">=</span><span class="st">'firstrow'</span>, tablefmt<span class="op">=</span><span class="st">'fancy_grid'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>╒═════════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model       │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞═════════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ GRU(L2 Reg) │  0.00274596 │   0.0389203 │    0.0524019 │  0.044396 │  0.139761 │   0.210704 │
╘═════════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
</div>
<div id="tabset-10-7" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-7-tab">
<div class="cell" data-outputid="604884bb-6b63-40da-c700-d531deabc06c" data-execution_count="108">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb272"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb272-1"><a href="#cb272-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW SIZES</span></span>
<span id="cb272-2"><a href="#cb272-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xt_emissions.shape, <span class="st">"--&gt;"</span>, Yt_emissions.shape)</span>
<span id="cb272-3"><a href="#cb272-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xv_emissions.shape, <span class="st">"--&gt;"</span>, Yv_emissions.shape)</span>
<span id="cb272-4"><a href="#cb272-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-5"><a href="#cb272-5" aria-hidden="true" tabindex="-1"></a><span class="co"># HYPERPARAMETERS</span></span>
<span id="cb272-6"><a href="#cb272-6" aria-hidden="true" tabindex="-1"></a>optimizer<span class="op">=</span><span class="st">"rmsprop"</span></span>
<span id="cb272-7"><a href="#cb272-7" aria-hidden="true" tabindex="-1"></a>loss_function<span class="op">=</span><span class="st">"MeanSquaredError"</span></span>
<span id="cb272-8"><a href="#cb272-8" aria-hidden="true" tabindex="-1"></a>learning_rate<span class="op">=</span><span class="fl">0.001</span></span>
<span id="cb272-9"><a href="#cb272-9" aria-hidden="true" tabindex="-1"></a>numbers_epochs<span class="op">=</span><span class="dv">200</span> <span class="co">#100</span></span>
<span id="cb272-10"><a href="#cb272-10" aria-hidden="true" tabindex="-1"></a>L2<span class="op">=</span><span class="fl">1e-4</span></span>
<span id="cb272-11"><a href="#cb272-11" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>(Xt_emissions.shape[<span class="dv">1</span>],Xt_emissions.shape[<span class="dv">2</span>])</span>
<span id="cb272-12"><a href="#cb272-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-13"><a href="#cb272-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-14"><a href="#cb272-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ------ Choose the batch size ------</span></span>
<span id="cb272-15"><a href="#cb272-15" aria-hidden="true" tabindex="-1"></a><span class="co"># batch_size=1                       # stocastic training</span></span>
<span id="cb272-16"><a href="#cb272-16" aria-hidden="true" tabindex="-1"></a><span class="co"># # batch_size=int(len(x_train)/2.)    # mini-batch training</span></span>
<span id="cb272-17"><a href="#cb272-17" aria-hidden="true" tabindex="-1"></a>batch_size<span class="op">=</span><span class="bu">len</span>(Xt1_emissions)              <span class="co"># batch training</span></span>
<span id="cb272-18"><a href="#cb272-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-19"><a href="#cb272-19" aria-hidden="true" tabindex="-1"></a><span class="co"># BUILD MODEL</span></span>
<span id="cb272-20"><a href="#cb272-20" aria-hidden="true" tabindex="-1"></a>recurrent_hidden_units<span class="op">=</span><span class="dv">32</span></span>
<span id="cb272-21"><a href="#cb272-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-22"><a href="#cb272-22" aria-hidden="true" tabindex="-1"></a><span class="co"># CREATE MODEL</span></span>
<span id="cb272-23"><a href="#cb272-23" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> keras.Sequential()</span>
<span id="cb272-24"><a href="#cb272-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-25"><a href="#cb272-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ADD RECURRENT LAYER</span></span>
<span id="cb272-26"><a href="#cb272-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-27"><a href="#cb272-27" aria-hidden="true" tabindex="-1"></a><span class="co"># #COMMENT/UNCOMMENT TO USE RNN, LSTM,GRU</span></span>
<span id="cb272-28"><a href="#cb272-28" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(LSTM(</span></span>
<span id="cb272-29"><a href="#cb272-29" aria-hidden="true" tabindex="-1"></a>model.add(GRU(</span>
<span id="cb272-30"><a href="#cb272-30" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(SimpleRNN(</span></span>
<span id="cb272-31"><a href="#cb272-31" aria-hidden="true" tabindex="-1"></a>units<span class="op">=</span>recurrent_hidden_units,</span>
<span id="cb272-32"><a href="#cb272-32" aria-hidden="true" tabindex="-1"></a>return_sequences<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb272-33"><a href="#cb272-33" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>input_shape,</span>
<span id="cb272-34"><a href="#cb272-34" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_dropout=0.8,</span></span>
<span id="cb272-35"><a href="#cb272-35" aria-hidden="true" tabindex="-1"></a>recurrent_regularizer<span class="op">=</span>regularizers.L2(L2),</span>
<span id="cb272-36"><a href="#cb272-36" aria-hidden="true" tabindex="-1"></a>activation<span class="op">=</span><span class="st">'relu'</span>)</span>
<span id="cb272-37"><a href="#cb272-37" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb272-38"><a href="#cb272-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-39"><a href="#cb272-39" aria-hidden="true" tabindex="-1"></a><span class="co"># NEED TO TAKE THE OUTPUT RNN AND CONVERT TO SCALAR</span></span>
<span id="cb272-40"><a href="#cb272-40" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span><span class="st">'linear'</span>))</span>
<span id="cb272-41"><a href="#cb272-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-42"><a href="#cb272-42" aria-hidden="true" tabindex="-1"></a><span class="co"># MODEL SUMMARY</span></span>
<span id="cb272-43"><a href="#cb272-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())<span class="op">;</span> <span class="co">#print(x_train.shape,y_train.shape)</span></span>
<span id="cb272-44"><a href="#cb272-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-45"><a href="#cb272-45" aria-hidden="true" tabindex="-1"></a><span class="co"># # COMPILING THE MODEL</span></span>
<span id="cb272-46"><a href="#cb272-46" aria-hidden="true" tabindex="-1"></a>opt <span class="op">=</span> keras.optimizers.RMSprop(learning_rate<span class="op">=</span>learning_rate)</span>
<span id="cb272-47"><a href="#cb272-47" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>opt, loss<span class="op">=</span>loss_function)</span>
<span id="cb272-48"><a href="#cb272-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-49"><a href="#cb272-49" aria-hidden="true" tabindex="-1"></a><span class="co"># TRAINING YOUR MODEL</span></span>
<span id="cb272-50"><a href="#cb272-50" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(</span>
<span id="cb272-51"><a href="#cb272-51" aria-hidden="true" tabindex="-1"></a>    Xt_emissions,</span>
<span id="cb272-52"><a href="#cb272-52" aria-hidden="true" tabindex="-1"></a>    Yt_emissions,</span>
<span id="cb272-53"><a href="#cb272-53" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span>numbers_epochs,</span>
<span id="cb272-54"><a href="#cb272-54" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span>batch_size,</span>
<span id="cb272-55"><a href="#cb272-55" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb272-56"><a href="#cb272-56" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>(Xv_emissions, Yv_emissions),</span>
<span id="cb272-57"><a href="#cb272-57" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb272-58"><a href="#cb272-58" aria-hidden="true" tabindex="-1"></a><span class="co"># History plot</span></span>
<span id="cb272-59"><a href="#cb272-59" aria-hidden="true" tabindex="-1"></a>history_plot(history)</span>
<span id="cb272-60"><a href="#cb272-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-61"><a href="#cb272-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb272-62"><a href="#cb272-62" aria-hidden="true" tabindex="-1"></a>Ytp_emissions <span class="op">=</span> model.predict(Xt_emissions)</span>
<span id="cb272-63"><a href="#cb272-63" aria-hidden="true" tabindex="-1"></a>Yvp_emissions <span class="op">=</span> model.predict(Xv_emissions)</span>
<span id="cb272-64"><a href="#cb272-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-65"><a href="#cb272-65" aria-hidden="true" tabindex="-1"></a><span class="co"># REPORT</span></span>
<span id="cb272-66"><a href="#cb272-66" aria-hidden="true" tabindex="-1"></a>regression_report(Yt_emissions, Ytp_emissions, Yv_emissions, Yvp_emissions)</span>
<span id="cb272-67"><a href="#cb272-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-68"><a href="#cb272-68" aria-hidden="true" tabindex="-1"></a><span class="co"># compute RMSE using numpy</span></span>
<span id="cb272-69"><a href="#cb272-69" aria-hidden="true" tabindex="-1"></a>training_RMSE_emissions <span class="op">=</span> np.sqrt(mean_squared_error(Yt_emissions, Ytp_emissions))</span>
<span id="cb272-70"><a href="#cb272-70" aria-hidden="true" tabindex="-1"></a>validation_RMSE_emissions <span class="op">=</span> np.sqrt(mean_squared_error(Yv_emissions, Yvp_emissions))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(227, 5, 1) --&gt; (227, 1)
(73, 5, 1) --&gt; (73, 1)
Model: "sequential_27"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 gru_13 (GRU)                (None, 32)                3360      
                                                                 
 dense_27 (Dense)            (None, 1)                 33        
                                                                 
=================================================================
Total params: 3393 (13.25 KB)
Trainable params: 3393 (13.25 KB)
Non-trainable params: 0 (0.00 Byte)
_________________________________________________________________
None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-107-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>8/8 [==============================] - 0s 4ms/step
3/3 [==============================] - 0s 5ms/step
---------- Regression report ----------
TRAINING:
 MSE: 0.7672829841706863
 MAE: 0.44492241023064333</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-107-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-107-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>VALIDATION:
 MSE: 1.2503476954706598
 MAE: 0.44037885242740576</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-107-output-7.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-107-output-8.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Error Summary</strong></p>
<div class="cell" data-outputid="7f3fd726-4d79-41ee-daf7-eb0f9ca07617" data-execution_count="109">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb276"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb276-1"><a href="#cb276-1" aria-hidden="true" tabindex="-1"></a>error_table_emissions_gru_l2 <span class="op">=</span> [[<span class="st">'Model'</span>,<span class="st">'train_MSE'</span>,<span class="st">'train_MAE'</span>,<span class="st">'train_RMSE'</span>,<span class="st">'val_MSE'</span>,<span class="st">'val_MAE'</span>,<span class="st">'val_RMSE'</span>],</span>
<span id="cb276-2"><a href="#cb276-2" aria-hidden="true" tabindex="-1"></a>              [<span class="st">'GRU(L2 Reg)'</span>,</span>
<span id="cb276-3"><a href="#cb276-3" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yt_emissions, Ytp_emissions),</span>
<span id="cb276-4"><a href="#cb276-4" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yt_emissions, Ytp_emissions),</span>
<span id="cb276-5"><a href="#cb276-5" aria-hidden="true" tabindex="-1"></a>               training_RMSE_emissions,</span>
<span id="cb276-6"><a href="#cb276-6" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yv_emissions, Yvp_emissions),</span>
<span id="cb276-7"><a href="#cb276-7" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yv_emissions, Yvp_emissions),</span>
<span id="cb276-8"><a href="#cb276-8" aria-hidden="true" tabindex="-1"></a>               validation_RMSE_emissions]]</span>
<span id="cb276-9"><a href="#cb276-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(error_table_emissions_gru_l2, headers<span class="op">=</span><span class="st">'firstrow'</span>, tablefmt<span class="op">=</span><span class="st">'fancy_grid'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>╒═════════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model       │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞═════════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ GRU(L2 Reg) │    0.767283 │    0.444922 │     0.875947 │   1.25035 │  0.440379 │    1.11819 │
╘═════════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="lstm" class="level2">
<h2 class="anchored" data-anchor-id="lstm">LSTM</h2>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-11-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-1" role="tab" aria-controls="tabset-11-1" aria-selected="true">Prices</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-2" role="tab" aria-controls="tabset-11-2" aria-selected="false">Consumption</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-3" role="tab" aria-controls="tabset-11-3" aria-selected="false">Production</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-4" role="tab" aria-controls="tabset-11-4" aria-selected="false">Imports</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-5" role="tab" aria-controls="tabset-11-5" aria-selected="false">Exports</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-6" role="tab" aria-controls="tabset-11-6" aria-selected="false">CVX Stocks</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-7-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-7" role="tab" aria-controls="tabset-11-7" aria-selected="false">CO2 Emissions</a></li></ul>
<div class="tab-content">
<div id="tabset-11-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-11-1-tab">
<div class="cell" data-outputid="03a26d02-202d-45e8-ae34-98b2e6e5e575" data-execution_count="110">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb278"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb278-1"><a href="#cb278-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW SIZES</span></span>
<span id="cb278-2"><a href="#cb278-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xt.shape, <span class="st">"--&gt;"</span>, Yt.shape)</span>
<span id="cb278-3"><a href="#cb278-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xv.shape, <span class="st">"--&gt;"</span>, Yv.shape)</span>
<span id="cb278-4"><a href="#cb278-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-5"><a href="#cb278-5" aria-hidden="true" tabindex="-1"></a><span class="co"># HYPERPARAMETERS</span></span>
<span id="cb278-6"><a href="#cb278-6" aria-hidden="true" tabindex="-1"></a>optimizer<span class="op">=</span><span class="st">"rmsprop"</span></span>
<span id="cb278-7"><a href="#cb278-7" aria-hidden="true" tabindex="-1"></a>loss_function<span class="op">=</span><span class="st">"MeanSquaredError"</span></span>
<span id="cb278-8"><a href="#cb278-8" aria-hidden="true" tabindex="-1"></a>learning_rate<span class="op">=</span><span class="fl">0.001</span></span>
<span id="cb278-9"><a href="#cb278-9" aria-hidden="true" tabindex="-1"></a>numbers_epochs<span class="op">=</span><span class="dv">200</span> <span class="co">#100</span></span>
<span id="cb278-10"><a href="#cb278-10" aria-hidden="true" tabindex="-1"></a>L2<span class="op">=</span><span class="dv">0</span> <span class="co">#1e-4</span></span>
<span id="cb278-11"><a href="#cb278-11" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>(Xt.shape[<span class="dv">1</span>],Xt.shape[<span class="dv">2</span>])</span>
<span id="cb278-12"><a href="#cb278-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-13"><a href="#cb278-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-14"><a href="#cb278-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ------ Choose the batch size ------</span></span>
<span id="cb278-15"><a href="#cb278-15" aria-hidden="true" tabindex="-1"></a><span class="co"># batch_size=1                       # stocastic training</span></span>
<span id="cb278-16"><a href="#cb278-16" aria-hidden="true" tabindex="-1"></a><span class="co"># # batch_size=int(len(x_train)/2.)    # mini-batch training</span></span>
<span id="cb278-17"><a href="#cb278-17" aria-hidden="true" tabindex="-1"></a>batch_size<span class="op">=</span><span class="bu">len</span>(Xt1)              <span class="co"># batch training</span></span>
<span id="cb278-18"><a href="#cb278-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-19"><a href="#cb278-19" aria-hidden="true" tabindex="-1"></a><span class="co"># BUILD MODEL</span></span>
<span id="cb278-20"><a href="#cb278-20" aria-hidden="true" tabindex="-1"></a>recurrent_hidden_units<span class="op">=</span><span class="dv">32</span></span>
<span id="cb278-21"><a href="#cb278-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-22"><a href="#cb278-22" aria-hidden="true" tabindex="-1"></a><span class="co"># CREATE MODEL</span></span>
<span id="cb278-23"><a href="#cb278-23" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> keras.Sequential()</span>
<span id="cb278-24"><a href="#cb278-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-25"><a href="#cb278-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ADD RECURRENT LAYER</span></span>
<span id="cb278-26"><a href="#cb278-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-27"><a href="#cb278-27" aria-hidden="true" tabindex="-1"></a><span class="co"># #COMMENT/UNCOMMENT TO USE RNN, LSTM,GRU</span></span>
<span id="cb278-28"><a href="#cb278-28" aria-hidden="true" tabindex="-1"></a>model.add(LSTM(</span>
<span id="cb278-29"><a href="#cb278-29" aria-hidden="true" tabindex="-1"></a><span class="co"># model.add(GRU(</span></span>
<span id="cb278-30"><a href="#cb278-30" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(SimpleRNN(</span></span>
<span id="cb278-31"><a href="#cb278-31" aria-hidden="true" tabindex="-1"></a>units<span class="op">=</span>recurrent_hidden_units,</span>
<span id="cb278-32"><a href="#cb278-32" aria-hidden="true" tabindex="-1"></a>return_sequences<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb278-33"><a href="#cb278-33" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>input_shape,</span>
<span id="cb278-34"><a href="#cb278-34" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_dropout=0.8,</span></span>
<span id="cb278-35"><a href="#cb278-35" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_regularizer=regularizers.L2(L2),</span></span>
<span id="cb278-36"><a href="#cb278-36" aria-hidden="true" tabindex="-1"></a><span class="co"># activation='relu'</span></span>
<span id="cb278-37"><a href="#cb278-37" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb278-38"><a href="#cb278-38" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb278-39"><a href="#cb278-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-40"><a href="#cb278-40" aria-hidden="true" tabindex="-1"></a><span class="co"># NEED TO TAKE THE OUTPUT RNN AND CONVERT TO SCALAR</span></span>
<span id="cb278-41"><a href="#cb278-41" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span><span class="st">'linear'</span>))</span>
<span id="cb278-42"><a href="#cb278-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-43"><a href="#cb278-43" aria-hidden="true" tabindex="-1"></a><span class="co"># MODEL SUMMARY</span></span>
<span id="cb278-44"><a href="#cb278-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())<span class="op">;</span> <span class="co">#print(x_train.shape,y_train.shape)</span></span>
<span id="cb278-45"><a href="#cb278-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-46"><a href="#cb278-46" aria-hidden="true" tabindex="-1"></a><span class="co"># # COMPILING THE MODEL</span></span>
<span id="cb278-47"><a href="#cb278-47" aria-hidden="true" tabindex="-1"></a>opt <span class="op">=</span> keras.optimizers.RMSprop(learning_rate<span class="op">=</span>learning_rate)</span>
<span id="cb278-48"><a href="#cb278-48" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>opt, loss<span class="op">=</span>loss_function)</span>
<span id="cb278-49"><a href="#cb278-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-50"><a href="#cb278-50" aria-hidden="true" tabindex="-1"></a><span class="co"># TRAINING YOUR MODEL</span></span>
<span id="cb278-51"><a href="#cb278-51" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(</span>
<span id="cb278-52"><a href="#cb278-52" aria-hidden="true" tabindex="-1"></a>    Xt,</span>
<span id="cb278-53"><a href="#cb278-53" aria-hidden="true" tabindex="-1"></a>    Yt,</span>
<span id="cb278-54"><a href="#cb278-54" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span>numbers_epochs,</span>
<span id="cb278-55"><a href="#cb278-55" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span>batch_size,</span>
<span id="cb278-56"><a href="#cb278-56" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb278-57"><a href="#cb278-57" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>(Xv, Yv),</span>
<span id="cb278-58"><a href="#cb278-58" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb278-59"><a href="#cb278-59" aria-hidden="true" tabindex="-1"></a><span class="co"># History plot</span></span>
<span id="cb278-60"><a href="#cb278-60" aria-hidden="true" tabindex="-1"></a>history_plot(history)</span>
<span id="cb278-61"><a href="#cb278-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-62"><a href="#cb278-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb278-63"><a href="#cb278-63" aria-hidden="true" tabindex="-1"></a>Ytp <span class="op">=</span> model.predict(Xt)</span>
<span id="cb278-64"><a href="#cb278-64" aria-hidden="true" tabindex="-1"></a>Yvp <span class="op">=</span> model.predict(Xv)</span>
<span id="cb278-65"><a href="#cb278-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-66"><a href="#cb278-66" aria-hidden="true" tabindex="-1"></a><span class="co"># REPORT</span></span>
<span id="cb278-67"><a href="#cb278-67" aria-hidden="true" tabindex="-1"></a>regression_report(Yt, Ytp, Yv, Yvp)</span>
<span id="cb278-68"><a href="#cb278-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-69"><a href="#cb278-69" aria-hidden="true" tabindex="-1"></a><span class="co"># compute RMSE using numpy</span></span>
<span id="cb278-70"><a href="#cb278-70" aria-hidden="true" tabindex="-1"></a>training_RMSE <span class="op">=</span> np.sqrt(mean_squared_error(Yt, Ytp))</span>
<span id="cb278-71"><a href="#cb278-71" aria-hidden="true" tabindex="-1"></a>validation_RMSE <span class="op">=</span> np.sqrt(mean_squared_error(Yv, Yvp))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(157, 5, 1) --&gt; (157, 1)
(49, 5, 1) --&gt; (49, 1)
Model: "sequential_28"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 lstm (LSTM)                 (None, 32)                4352      
                                                                 
 dense_28 (Dense)            (None, 1)                 33        
                                                                 
=================================================================
Total params: 4385 (17.13 KB)
Trainable params: 4385 (17.13 KB)
Non-trainable params: 0 (0.00 Byte)
_________________________________________________________________
None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-109-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>5/5 [==============================] - 0s 4ms/step
2/2 [==============================] - 0s 6ms/step
---------- Regression report ----------
TRAINING:
 MSE: 0.09286728965267183
 MAE: 0.2154747499972604</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-109-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-109-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>VALIDATION:
 MSE: 0.20651359469214828
 MAE: 0.33671482100973527</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-109-output-7.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-109-output-8.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Error Summary</strong></p>
<div class="cell" data-outputid="70133560-fef0-4ba3-c717-405189fb87ca" data-execution_count="111">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb282"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb282-1"><a href="#cb282-1" aria-hidden="true" tabindex="-1"></a>error_table_lstm <span class="op">=</span> [[<span class="st">'Model'</span>,<span class="st">'train_MSE'</span>,<span class="st">'train_MAE'</span>,<span class="st">'train_RMSE'</span>,<span class="st">'val_MSE'</span>,<span class="st">'val_MAE'</span>,<span class="st">'val_RMSE'</span>],</span>
<span id="cb282-2"><a href="#cb282-2" aria-hidden="true" tabindex="-1"></a>              [<span class="st">'LSTM'</span>,</span>
<span id="cb282-3"><a href="#cb282-3" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yt, Ytp),</span>
<span id="cb282-4"><a href="#cb282-4" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yt, Ytp),</span>
<span id="cb282-5"><a href="#cb282-5" aria-hidden="true" tabindex="-1"></a>              training_RMSE,</span>
<span id="cb282-6"><a href="#cb282-6" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yv, Yvp),</span>
<span id="cb282-7"><a href="#cb282-7" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yv, Yvp),</span>
<span id="cb282-8"><a href="#cb282-8" aria-hidden="true" tabindex="-1"></a>               validation_RMSE]]</span>
<span id="cb282-9"><a href="#cb282-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(error_table_lstm, headers<span class="op">=</span><span class="st">'firstrow'</span>, tablefmt<span class="op">=</span><span class="st">'fancy_grid'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>╒═════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model   │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞═════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ LSTM    │   0.0928673 │    0.215475 │     0.304741 │  0.206514 │  0.336715 │   0.454438 │
╘═════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
</div>
<div id="tabset-11-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-2-tab">
<div class="cell" data-outputid="83e91d7a-9164-4451-de22-4c2c9f409f3a" data-execution_count="112">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb284"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb284-1"><a href="#cb284-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW SIZES</span></span>
<span id="cb284-2"><a href="#cb284-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xt_consump.shape, <span class="st">"--&gt;"</span>, Yt_consump.shape)</span>
<span id="cb284-3"><a href="#cb284-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xv_consump.shape, <span class="st">"--&gt;"</span>, Yv_consump.shape)</span>
<span id="cb284-4"><a href="#cb284-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-5"><a href="#cb284-5" aria-hidden="true" tabindex="-1"></a><span class="co"># HYPERPARAMETERS</span></span>
<span id="cb284-6"><a href="#cb284-6" aria-hidden="true" tabindex="-1"></a>optimizer<span class="op">=</span><span class="st">"rmsprop"</span></span>
<span id="cb284-7"><a href="#cb284-7" aria-hidden="true" tabindex="-1"></a>loss_function<span class="op">=</span><span class="st">"MeanSquaredError"</span></span>
<span id="cb284-8"><a href="#cb284-8" aria-hidden="true" tabindex="-1"></a>learning_rate<span class="op">=</span><span class="fl">0.001</span></span>
<span id="cb284-9"><a href="#cb284-9" aria-hidden="true" tabindex="-1"></a>numbers_epochs<span class="op">=</span><span class="dv">200</span> <span class="co">#100</span></span>
<span id="cb284-10"><a href="#cb284-10" aria-hidden="true" tabindex="-1"></a>L2<span class="op">=</span><span class="dv">0</span> <span class="co">#1e-4</span></span>
<span id="cb284-11"><a href="#cb284-11" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>(Xt_consump.shape[<span class="dv">1</span>],Xt_consump.shape[<span class="dv">2</span>])</span>
<span id="cb284-12"><a href="#cb284-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-13"><a href="#cb284-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-14"><a href="#cb284-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ------ Choose the batch size ------</span></span>
<span id="cb284-15"><a href="#cb284-15" aria-hidden="true" tabindex="-1"></a><span class="co"># batch_size=1                       # stocastic training</span></span>
<span id="cb284-16"><a href="#cb284-16" aria-hidden="true" tabindex="-1"></a><span class="co"># # batch_size=int(len(x_train)/2.)    # mini-batch training</span></span>
<span id="cb284-17"><a href="#cb284-17" aria-hidden="true" tabindex="-1"></a>batch_size<span class="op">=</span><span class="bu">len</span>(Xt1_consump)              <span class="co"># batch training</span></span>
<span id="cb284-18"><a href="#cb284-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-19"><a href="#cb284-19" aria-hidden="true" tabindex="-1"></a><span class="co"># BUILD MODEL</span></span>
<span id="cb284-20"><a href="#cb284-20" aria-hidden="true" tabindex="-1"></a>recurrent_hidden_units<span class="op">=</span><span class="dv">32</span></span>
<span id="cb284-21"><a href="#cb284-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-22"><a href="#cb284-22" aria-hidden="true" tabindex="-1"></a><span class="co"># CREATE MODEL</span></span>
<span id="cb284-23"><a href="#cb284-23" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> keras.Sequential()</span>
<span id="cb284-24"><a href="#cb284-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-25"><a href="#cb284-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ADD RECURRENT LAYER</span></span>
<span id="cb284-26"><a href="#cb284-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-27"><a href="#cb284-27" aria-hidden="true" tabindex="-1"></a><span class="co"># #COMMENT/UNCOMMENT TO USE RNN, LSTM,GRU</span></span>
<span id="cb284-28"><a href="#cb284-28" aria-hidden="true" tabindex="-1"></a>model.add(LSTM(</span>
<span id="cb284-29"><a href="#cb284-29" aria-hidden="true" tabindex="-1"></a><span class="co"># model.add(GRU(</span></span>
<span id="cb284-30"><a href="#cb284-30" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(SimpleRNN(</span></span>
<span id="cb284-31"><a href="#cb284-31" aria-hidden="true" tabindex="-1"></a>units<span class="op">=</span>recurrent_hidden_units,</span>
<span id="cb284-32"><a href="#cb284-32" aria-hidden="true" tabindex="-1"></a>return_sequences<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb284-33"><a href="#cb284-33" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>input_shape,</span>
<span id="cb284-34"><a href="#cb284-34" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_dropout=0.8,</span></span>
<span id="cb284-35"><a href="#cb284-35" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_regularizer=regularizers.L2(L2),</span></span>
<span id="cb284-36"><a href="#cb284-36" aria-hidden="true" tabindex="-1"></a><span class="co"># activation='relu'</span></span>
<span id="cb284-37"><a href="#cb284-37" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb284-38"><a href="#cb284-38" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb284-39"><a href="#cb284-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-40"><a href="#cb284-40" aria-hidden="true" tabindex="-1"></a><span class="co"># NEED TO TAKE THE OUTPUT RNN AND CONVERT TO SCALAR</span></span>
<span id="cb284-41"><a href="#cb284-41" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span><span class="st">'linear'</span>))</span>
<span id="cb284-42"><a href="#cb284-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-43"><a href="#cb284-43" aria-hidden="true" tabindex="-1"></a><span class="co"># MODEL SUMMARY</span></span>
<span id="cb284-44"><a href="#cb284-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())<span class="op">;</span> <span class="co">#print(x_train.shape,y_train.shape)</span></span>
<span id="cb284-45"><a href="#cb284-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-46"><a href="#cb284-46" aria-hidden="true" tabindex="-1"></a><span class="co"># # COMPILING THE MODEL</span></span>
<span id="cb284-47"><a href="#cb284-47" aria-hidden="true" tabindex="-1"></a>opt <span class="op">=</span> keras.optimizers.RMSprop(learning_rate<span class="op">=</span>learning_rate)</span>
<span id="cb284-48"><a href="#cb284-48" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>opt, loss<span class="op">=</span>loss_function)</span>
<span id="cb284-49"><a href="#cb284-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-50"><a href="#cb284-50" aria-hidden="true" tabindex="-1"></a><span class="co"># TRAINING YOUR MODEL</span></span>
<span id="cb284-51"><a href="#cb284-51" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(</span>
<span id="cb284-52"><a href="#cb284-52" aria-hidden="true" tabindex="-1"></a>    Xt_consump,</span>
<span id="cb284-53"><a href="#cb284-53" aria-hidden="true" tabindex="-1"></a>    Yt_consump,</span>
<span id="cb284-54"><a href="#cb284-54" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span>numbers_epochs,</span>
<span id="cb284-55"><a href="#cb284-55" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span>batch_size,</span>
<span id="cb284-56"><a href="#cb284-56" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb284-57"><a href="#cb284-57" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>(Xv_consump, Yv_consump),</span>
<span id="cb284-58"><a href="#cb284-58" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb284-59"><a href="#cb284-59" aria-hidden="true" tabindex="-1"></a><span class="co"># History plot</span></span>
<span id="cb284-60"><a href="#cb284-60" aria-hidden="true" tabindex="-1"></a>history_plot(history)</span>
<span id="cb284-61"><a href="#cb284-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-62"><a href="#cb284-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb284-63"><a href="#cb284-63" aria-hidden="true" tabindex="-1"></a>Ytp_consump <span class="op">=</span> model.predict(Xt_consump)</span>
<span id="cb284-64"><a href="#cb284-64" aria-hidden="true" tabindex="-1"></a>Yvp_consump <span class="op">=</span> model.predict(Xv_consump)</span>
<span id="cb284-65"><a href="#cb284-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-66"><a href="#cb284-66" aria-hidden="true" tabindex="-1"></a><span class="co"># REPORT</span></span>
<span id="cb284-67"><a href="#cb284-67" aria-hidden="true" tabindex="-1"></a>regression_report(Yt_consump, Ytp_consump, Yv_consump, Yvp_consump)</span>
<span id="cb284-68"><a href="#cb284-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-69"><a href="#cb284-69" aria-hidden="true" tabindex="-1"></a><span class="co"># compute RMSE using numpy</span></span>
<span id="cb284-70"><a href="#cb284-70" aria-hidden="true" tabindex="-1"></a>training_RMSE_consump <span class="op">=</span> np.sqrt(mean_squared_error(Yt_consump, Ytp_consump))</span>
<span id="cb284-71"><a href="#cb284-71" aria-hidden="true" tabindex="-1"></a>validation_RMSE_consump <span class="op">=</span> np.sqrt(mean_squared_error(Yv_consump, Yvp_consump))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(157, 5, 1) --&gt; (157, 1)
(49, 5, 1) --&gt; (49, 1)
Model: "sequential_29"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 lstm_1 (LSTM)               (None, 32)                4352      
                                                                 
 dense_29 (Dense)            (None, 1)                 33        
                                                                 
=================================================================
Total params: 4385 (17.13 KB)
Trainable params: 4385 (17.13 KB)
Non-trainable params: 0 (0.00 Byte)
_________________________________________________________________
None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-111-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>5/5 [==============================] - 0s 3ms/step
2/2 [==============================] - 0s 6ms/step
---------- Regression report ----------
TRAINING:
 MSE: 0.2970955864641625
 MAE: 0.437726763197135</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-111-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-111-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>VALIDATION:
 MSE: 1.0437340892837863
 MAE: 0.8793948418476977</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-111-output-7.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-111-output-8.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Error Summary</strong></p>
<div class="cell" data-outputid="cb5719b2-ec33-4b0a-b362-dc8053a997d6" data-execution_count="113">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb288"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb288-1"><a href="#cb288-1" aria-hidden="true" tabindex="-1"></a>error_table_consump_lstm <span class="op">=</span> [[<span class="st">'Model'</span>,<span class="st">'train_MSE'</span>,<span class="st">'train_MAE'</span>,<span class="st">'train_RMSE'</span>,<span class="st">'val_MSE'</span>,<span class="st">'val_MAE'</span>,<span class="st">'val_RMSE'</span>],</span>
<span id="cb288-2"><a href="#cb288-2" aria-hidden="true" tabindex="-1"></a>              [<span class="st">'LSTM'</span>,</span>
<span id="cb288-3"><a href="#cb288-3" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yt_consump, Ytp_consump),</span>
<span id="cb288-4"><a href="#cb288-4" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yt_consump, Ytp_consump),</span>
<span id="cb288-5"><a href="#cb288-5" aria-hidden="true" tabindex="-1"></a>              training_RMSE_consump,</span>
<span id="cb288-6"><a href="#cb288-6" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yv_consump, Yvp_consump),</span>
<span id="cb288-7"><a href="#cb288-7" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yv_consump, Yvp_consump),</span>
<span id="cb288-8"><a href="#cb288-8" aria-hidden="true" tabindex="-1"></a>               validation_RMSE_consump]]</span>
<span id="cb288-9"><a href="#cb288-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(error_table_consump_lstm, headers<span class="op">=</span><span class="st">'firstrow'</span>, tablefmt<span class="op">=</span><span class="st">'fancy_grid'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>╒═════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model   │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞═════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ LSTM    │    0.297096 │    0.437727 │     0.545065 │   1.04373 │  0.879395 │    1.02163 │
╘═════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
</div>
<div id="tabset-11-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-3-tab">
<div class="cell" data-outputid="2cc7e633-665a-4693-e70b-1b76506725a3" data-execution_count="114">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb290"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb290-1"><a href="#cb290-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW SIZES</span></span>
<span id="cb290-2"><a href="#cb290-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xt_prod.shape, <span class="st">"--&gt;"</span>, Yt_prod.shape)</span>
<span id="cb290-3"><a href="#cb290-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xv_prod.shape, <span class="st">"--&gt;"</span>, Yv_prod.shape)</span>
<span id="cb290-4"><a href="#cb290-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb290-5"><a href="#cb290-5" aria-hidden="true" tabindex="-1"></a><span class="co"># HYPERPARAMETERS</span></span>
<span id="cb290-6"><a href="#cb290-6" aria-hidden="true" tabindex="-1"></a>optimizer<span class="op">=</span><span class="st">"rmsprop"</span></span>
<span id="cb290-7"><a href="#cb290-7" aria-hidden="true" tabindex="-1"></a>loss_function<span class="op">=</span><span class="st">"MeanSquaredError"</span></span>
<span id="cb290-8"><a href="#cb290-8" aria-hidden="true" tabindex="-1"></a>learning_rate<span class="op">=</span><span class="fl">0.001</span></span>
<span id="cb290-9"><a href="#cb290-9" aria-hidden="true" tabindex="-1"></a>numbers_epochs<span class="op">=</span><span class="dv">200</span> <span class="co">#100</span></span>
<span id="cb290-10"><a href="#cb290-10" aria-hidden="true" tabindex="-1"></a>L2<span class="op">=</span><span class="dv">0</span> <span class="co">#1e-4</span></span>
<span id="cb290-11"><a href="#cb290-11" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>(Xt_prod.shape[<span class="dv">1</span>],Xt_prod.shape[<span class="dv">2</span>])</span>
<span id="cb290-12"><a href="#cb290-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb290-13"><a href="#cb290-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb290-14"><a href="#cb290-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ------ Choose the batch size ------</span></span>
<span id="cb290-15"><a href="#cb290-15" aria-hidden="true" tabindex="-1"></a><span class="co"># batch_size=1                       # stocastic training</span></span>
<span id="cb290-16"><a href="#cb290-16" aria-hidden="true" tabindex="-1"></a><span class="co"># # batch_size=int(len(x_train)/2.)    # mini-batch training</span></span>
<span id="cb290-17"><a href="#cb290-17" aria-hidden="true" tabindex="-1"></a>batch_size<span class="op">=</span><span class="bu">len</span>(Xt1_prod)              <span class="co"># batch training</span></span>
<span id="cb290-18"><a href="#cb290-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb290-19"><a href="#cb290-19" aria-hidden="true" tabindex="-1"></a><span class="co"># BUILD MODEL</span></span>
<span id="cb290-20"><a href="#cb290-20" aria-hidden="true" tabindex="-1"></a>recurrent_hidden_units<span class="op">=</span><span class="dv">32</span></span>
<span id="cb290-21"><a href="#cb290-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb290-22"><a href="#cb290-22" aria-hidden="true" tabindex="-1"></a><span class="co"># CREATE MODEL</span></span>
<span id="cb290-23"><a href="#cb290-23" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> keras.Sequential()</span>
<span id="cb290-24"><a href="#cb290-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb290-25"><a href="#cb290-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ADD RECURRENT LAYER</span></span>
<span id="cb290-26"><a href="#cb290-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb290-27"><a href="#cb290-27" aria-hidden="true" tabindex="-1"></a><span class="co"># #COMMENT/UNCOMMENT TO USE RNN, LSTM,GRU</span></span>
<span id="cb290-28"><a href="#cb290-28" aria-hidden="true" tabindex="-1"></a>model.add(LSTM(</span>
<span id="cb290-29"><a href="#cb290-29" aria-hidden="true" tabindex="-1"></a><span class="co"># model.add(GRU(</span></span>
<span id="cb290-30"><a href="#cb290-30" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(SimpleRNN(</span></span>
<span id="cb290-31"><a href="#cb290-31" aria-hidden="true" tabindex="-1"></a>units<span class="op">=</span>recurrent_hidden_units,</span>
<span id="cb290-32"><a href="#cb290-32" aria-hidden="true" tabindex="-1"></a>return_sequences<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb290-33"><a href="#cb290-33" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>input_shape,</span>
<span id="cb290-34"><a href="#cb290-34" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_dropout=0.8,</span></span>
<span id="cb290-35"><a href="#cb290-35" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_regularizer=regularizers.L2(L2),</span></span>
<span id="cb290-36"><a href="#cb290-36" aria-hidden="true" tabindex="-1"></a><span class="co"># activation='relu'</span></span>
<span id="cb290-37"><a href="#cb290-37" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb290-38"><a href="#cb290-38" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb290-39"><a href="#cb290-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb290-40"><a href="#cb290-40" aria-hidden="true" tabindex="-1"></a><span class="co"># NEED TO TAKE THE OUTPUT RNN AND CONVERT TO SCALAR</span></span>
<span id="cb290-41"><a href="#cb290-41" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span><span class="st">'linear'</span>))</span>
<span id="cb290-42"><a href="#cb290-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb290-43"><a href="#cb290-43" aria-hidden="true" tabindex="-1"></a><span class="co"># MODEL SUMMARY</span></span>
<span id="cb290-44"><a href="#cb290-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())<span class="op">;</span> <span class="co">#print(x_train.shape,y_train.shape)</span></span>
<span id="cb290-45"><a href="#cb290-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb290-46"><a href="#cb290-46" aria-hidden="true" tabindex="-1"></a><span class="co"># # COMPILING THE MODEL</span></span>
<span id="cb290-47"><a href="#cb290-47" aria-hidden="true" tabindex="-1"></a>opt <span class="op">=</span> keras.optimizers.RMSprop(learning_rate<span class="op">=</span>learning_rate)</span>
<span id="cb290-48"><a href="#cb290-48" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>opt, loss<span class="op">=</span>loss_function)</span>
<span id="cb290-49"><a href="#cb290-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb290-50"><a href="#cb290-50" aria-hidden="true" tabindex="-1"></a><span class="co"># TRAINING YOUR MODEL</span></span>
<span id="cb290-51"><a href="#cb290-51" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(</span>
<span id="cb290-52"><a href="#cb290-52" aria-hidden="true" tabindex="-1"></a>    Xt_prod,</span>
<span id="cb290-53"><a href="#cb290-53" aria-hidden="true" tabindex="-1"></a>    Yt_prod,</span>
<span id="cb290-54"><a href="#cb290-54" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span>numbers_epochs,</span>
<span id="cb290-55"><a href="#cb290-55" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span>batch_size,</span>
<span id="cb290-56"><a href="#cb290-56" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb290-57"><a href="#cb290-57" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>(Xv_prod, Yv_prod),</span>
<span id="cb290-58"><a href="#cb290-58" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb290-59"><a href="#cb290-59" aria-hidden="true" tabindex="-1"></a><span class="co"># History plot</span></span>
<span id="cb290-60"><a href="#cb290-60" aria-hidden="true" tabindex="-1"></a>history_plot(history)</span>
<span id="cb290-61"><a href="#cb290-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb290-62"><a href="#cb290-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb290-63"><a href="#cb290-63" aria-hidden="true" tabindex="-1"></a>Ytp_prod <span class="op">=</span> model.predict(Xt_prod)</span>
<span id="cb290-64"><a href="#cb290-64" aria-hidden="true" tabindex="-1"></a>Yvp_prod <span class="op">=</span> model.predict(Xv_prod)</span>
<span id="cb290-65"><a href="#cb290-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb290-66"><a href="#cb290-66" aria-hidden="true" tabindex="-1"></a><span class="co"># REPORT</span></span>
<span id="cb290-67"><a href="#cb290-67" aria-hidden="true" tabindex="-1"></a>regression_report(Yt_prod, Ytp_prod, Yv_prod, Yvp_prod)</span>
<span id="cb290-68"><a href="#cb290-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb290-69"><a href="#cb290-69" aria-hidden="true" tabindex="-1"></a><span class="co"># compute RMSE using numpy</span></span>
<span id="cb290-70"><a href="#cb290-70" aria-hidden="true" tabindex="-1"></a>training_RMSE_prod <span class="op">=</span> np.sqrt(mean_squared_error(Yt_prod, Ytp_prod))</span>
<span id="cb290-71"><a href="#cb290-71" aria-hidden="true" tabindex="-1"></a>validation_RMSE_prod <span class="op">=</span> np.sqrt(mean_squared_error(Yv_prod, Yvp_prod))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(157, 5, 1) --&gt; (157, 1)
(49, 5, 1) --&gt; (49, 1)
Model: "sequential_30"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 lstm_2 (LSTM)               (None, 32)                4352      
                                                                 
 dense_30 (Dense)            (None, 1)                 33        
                                                                 
=================================================================
Total params: 4385 (17.13 KB)
Trainable params: 4385 (17.13 KB)
Non-trainable params: 0 (0.00 Byte)
_________________________________________________________________
None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-113-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>5/5 [==============================] - 0s 3ms/step
2/2 [==============================] - 0s 7ms/step
---------- Regression report ----------
TRAINING:
 MSE: 0.023363330218405497
 MAE: 0.11192040423436898</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-113-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-113-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>VALIDATION:
 MSE: 0.2358212359149498
 MAE: 0.4440431106812732</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-113-output-7.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-113-output-8.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Error Summary</strong></p>
<div class="cell" data-outputid="e6426473-f41f-4750-b48c-40214168891e" data-execution_count="115">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb294"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb294-1"><a href="#cb294-1" aria-hidden="true" tabindex="-1"></a>error_table_prod_lstm <span class="op">=</span> [[<span class="st">'Model'</span>,<span class="st">'train_MSE'</span>,<span class="st">'train_MAE'</span>,<span class="st">'train_RMSE'</span>,<span class="st">'val_MSE'</span>,<span class="st">'val_MAE'</span>,<span class="st">'val_RMSE'</span>],</span>
<span id="cb294-2"><a href="#cb294-2" aria-hidden="true" tabindex="-1"></a>              [<span class="st">'LSTM'</span>,</span>
<span id="cb294-3"><a href="#cb294-3" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yt_prod, Ytp_prod),</span>
<span id="cb294-4"><a href="#cb294-4" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yt_prod, Ytp_prod),</span>
<span id="cb294-5"><a href="#cb294-5" aria-hidden="true" tabindex="-1"></a>              training_RMSE_prod,</span>
<span id="cb294-6"><a href="#cb294-6" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yv_prod, Yvp_prod),</span>
<span id="cb294-7"><a href="#cb294-7" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yv_prod, Yvp_prod),</span>
<span id="cb294-8"><a href="#cb294-8" aria-hidden="true" tabindex="-1"></a>               validation_RMSE_prod]]</span>
<span id="cb294-9"><a href="#cb294-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(error_table_prod_lstm, headers<span class="op">=</span><span class="st">'firstrow'</span>, tablefmt<span class="op">=</span><span class="st">'fancy_grid'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>╒═════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model   │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞═════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ LSTM    │   0.0233633 │     0.11192 │     0.152851 │  0.235821 │  0.444043 │   0.485614 │
╘═════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
</div>
<div id="tabset-11-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-4-tab">
<div class="cell" data-outputid="690cf7a8-3cda-433f-97f6-68702161c835" data-execution_count="116">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb296"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb296-1"><a href="#cb296-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW SIZES</span></span>
<span id="cb296-2"><a href="#cb296-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xt_imp.shape, <span class="st">"--&gt;"</span>, Yt_imp.shape)</span>
<span id="cb296-3"><a href="#cb296-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xv_imp.shape, <span class="st">"--&gt;"</span>, Yv_imp.shape)</span>
<span id="cb296-4"><a href="#cb296-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb296-5"><a href="#cb296-5" aria-hidden="true" tabindex="-1"></a><span class="co"># HYPERPARAMETERS</span></span>
<span id="cb296-6"><a href="#cb296-6" aria-hidden="true" tabindex="-1"></a>optimizer<span class="op">=</span><span class="st">"rmsprop"</span></span>
<span id="cb296-7"><a href="#cb296-7" aria-hidden="true" tabindex="-1"></a>loss_function<span class="op">=</span><span class="st">"MeanSquaredError"</span></span>
<span id="cb296-8"><a href="#cb296-8" aria-hidden="true" tabindex="-1"></a>learning_rate<span class="op">=</span><span class="fl">0.001</span></span>
<span id="cb296-9"><a href="#cb296-9" aria-hidden="true" tabindex="-1"></a>numbers_epochs<span class="op">=</span><span class="dv">200</span> <span class="co">#100</span></span>
<span id="cb296-10"><a href="#cb296-10" aria-hidden="true" tabindex="-1"></a>L2<span class="op">=</span><span class="dv">0</span> <span class="co">#1e-4</span></span>
<span id="cb296-11"><a href="#cb296-11" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>(Xt_imp.shape[<span class="dv">1</span>],Xt_imp.shape[<span class="dv">2</span>])</span>
<span id="cb296-12"><a href="#cb296-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb296-13"><a href="#cb296-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb296-14"><a href="#cb296-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ------ Choose the batch size ------</span></span>
<span id="cb296-15"><a href="#cb296-15" aria-hidden="true" tabindex="-1"></a><span class="co"># batch_size=1                       # stocastic training</span></span>
<span id="cb296-16"><a href="#cb296-16" aria-hidden="true" tabindex="-1"></a><span class="co"># # batch_size=int(len(x_train)/2.)    # mini-batch training</span></span>
<span id="cb296-17"><a href="#cb296-17" aria-hidden="true" tabindex="-1"></a>batch_size<span class="op">=</span><span class="bu">len</span>(Xt1_imp)              <span class="co"># batch training</span></span>
<span id="cb296-18"><a href="#cb296-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb296-19"><a href="#cb296-19" aria-hidden="true" tabindex="-1"></a><span class="co"># BUILD MODEL</span></span>
<span id="cb296-20"><a href="#cb296-20" aria-hidden="true" tabindex="-1"></a>recurrent_hidden_units<span class="op">=</span><span class="dv">32</span></span>
<span id="cb296-21"><a href="#cb296-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb296-22"><a href="#cb296-22" aria-hidden="true" tabindex="-1"></a><span class="co"># CREATE MODEL</span></span>
<span id="cb296-23"><a href="#cb296-23" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> keras.Sequential()</span>
<span id="cb296-24"><a href="#cb296-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb296-25"><a href="#cb296-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ADD RECURRENT LAYER</span></span>
<span id="cb296-26"><a href="#cb296-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb296-27"><a href="#cb296-27" aria-hidden="true" tabindex="-1"></a><span class="co"># #COMMENT/UNCOMMENT TO USE RNN, LSTM,GRU</span></span>
<span id="cb296-28"><a href="#cb296-28" aria-hidden="true" tabindex="-1"></a>model.add(LSTM(</span>
<span id="cb296-29"><a href="#cb296-29" aria-hidden="true" tabindex="-1"></a><span class="co"># model.add(GRU(</span></span>
<span id="cb296-30"><a href="#cb296-30" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(SimpleRNN(</span></span>
<span id="cb296-31"><a href="#cb296-31" aria-hidden="true" tabindex="-1"></a>units<span class="op">=</span>recurrent_hidden_units,</span>
<span id="cb296-32"><a href="#cb296-32" aria-hidden="true" tabindex="-1"></a>return_sequences<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb296-33"><a href="#cb296-33" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>input_shape,</span>
<span id="cb296-34"><a href="#cb296-34" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_dropout=0.8,</span></span>
<span id="cb296-35"><a href="#cb296-35" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_regularizer=regularizers.L2(L2),</span></span>
<span id="cb296-36"><a href="#cb296-36" aria-hidden="true" tabindex="-1"></a><span class="co"># activation='relu'</span></span>
<span id="cb296-37"><a href="#cb296-37" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb296-38"><a href="#cb296-38" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb296-39"><a href="#cb296-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb296-40"><a href="#cb296-40" aria-hidden="true" tabindex="-1"></a><span class="co"># NEED TO TAKE THE OUTPUT RNN AND CONVERT TO SCALAR</span></span>
<span id="cb296-41"><a href="#cb296-41" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span><span class="st">'linear'</span>))</span>
<span id="cb296-42"><a href="#cb296-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb296-43"><a href="#cb296-43" aria-hidden="true" tabindex="-1"></a><span class="co"># MODEL SUMMARY</span></span>
<span id="cb296-44"><a href="#cb296-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())<span class="op">;</span> <span class="co">#print(x_train.shape,y_train.shape)</span></span>
<span id="cb296-45"><a href="#cb296-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb296-46"><a href="#cb296-46" aria-hidden="true" tabindex="-1"></a><span class="co"># # COMPILING THE MODEL</span></span>
<span id="cb296-47"><a href="#cb296-47" aria-hidden="true" tabindex="-1"></a>opt <span class="op">=</span> keras.optimizers.RMSprop(learning_rate<span class="op">=</span>learning_rate)</span>
<span id="cb296-48"><a href="#cb296-48" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>opt, loss<span class="op">=</span>loss_function)</span>
<span id="cb296-49"><a href="#cb296-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb296-50"><a href="#cb296-50" aria-hidden="true" tabindex="-1"></a><span class="co"># TRAINING YOUR MODEL</span></span>
<span id="cb296-51"><a href="#cb296-51" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(</span>
<span id="cb296-52"><a href="#cb296-52" aria-hidden="true" tabindex="-1"></a>    Xt_imp,</span>
<span id="cb296-53"><a href="#cb296-53" aria-hidden="true" tabindex="-1"></a>    Yt_imp,</span>
<span id="cb296-54"><a href="#cb296-54" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span>numbers_epochs,</span>
<span id="cb296-55"><a href="#cb296-55" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span>batch_size,</span>
<span id="cb296-56"><a href="#cb296-56" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb296-57"><a href="#cb296-57" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>(Xv_imp, Yv_imp),</span>
<span id="cb296-58"><a href="#cb296-58" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb296-59"><a href="#cb296-59" aria-hidden="true" tabindex="-1"></a><span class="co"># History plot</span></span>
<span id="cb296-60"><a href="#cb296-60" aria-hidden="true" tabindex="-1"></a>history_plot(history)</span>
<span id="cb296-61"><a href="#cb296-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb296-62"><a href="#cb296-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb296-63"><a href="#cb296-63" aria-hidden="true" tabindex="-1"></a>Ytp_imp <span class="op">=</span> model.predict(Xt_imp)</span>
<span id="cb296-64"><a href="#cb296-64" aria-hidden="true" tabindex="-1"></a>Yvp_imp <span class="op">=</span> model.predict(Xv_imp)</span>
<span id="cb296-65"><a href="#cb296-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb296-66"><a href="#cb296-66" aria-hidden="true" tabindex="-1"></a><span class="co"># REPORT</span></span>
<span id="cb296-67"><a href="#cb296-67" aria-hidden="true" tabindex="-1"></a>regression_report(Yt_imp, Ytp_imp, Yv_imp, Yvp_imp)</span>
<span id="cb296-68"><a href="#cb296-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb296-69"><a href="#cb296-69" aria-hidden="true" tabindex="-1"></a><span class="co"># compute RMSE using numpy</span></span>
<span id="cb296-70"><a href="#cb296-70" aria-hidden="true" tabindex="-1"></a>training_RMSE_imp <span class="op">=</span> np.sqrt(mean_squared_error(Yt_imp, Ytp_imp))</span>
<span id="cb296-71"><a href="#cb296-71" aria-hidden="true" tabindex="-1"></a>validation_RMSE_imp <span class="op">=</span> np.sqrt(mean_squared_error(Yv_imp, Yvp_imp))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(229, 5, 1) --&gt; (229, 1)
(73, 5, 1) --&gt; (73, 1)
Model: "sequential_31"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 lstm_3 (LSTM)               (None, 32)                4352      
                                                                 
 dense_31 (Dense)            (None, 1)                 33        
                                                                 
=================================================================
Total params: 4385 (17.13 KB)
Trainable params: 4385 (17.13 KB)
Non-trainable params: 0 (0.00 Byte)
_________________________________________________________________
None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-115-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>8/8 [==============================] - 0s 3ms/step
3/3 [==============================] - 0s 5ms/step
---------- Regression report ----------
TRAINING:
 MSE: 0.19351637543097616
 MAE: 0.34250260930648363</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-115-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-115-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>VALIDATION:
 MSE: 0.21958086049481404
 MAE: 0.3749440361272188</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-115-output-7.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-115-output-8.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Error Summary</strong></p>
<div class="cell" data-outputid="0f174873-536a-4375-9012-ac86c4caae07" data-execution_count="117">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb300"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb300-1"><a href="#cb300-1" aria-hidden="true" tabindex="-1"></a>error_table_imp_lstm <span class="op">=</span> [[<span class="st">'Model'</span>,<span class="st">'train_MSE'</span>,<span class="st">'train_MAE'</span>,<span class="st">'train_RMSE'</span>,<span class="st">'val_MSE'</span>,<span class="st">'val_MAE'</span>,<span class="st">'val_RMSE'</span>],</span>
<span id="cb300-2"><a href="#cb300-2" aria-hidden="true" tabindex="-1"></a>              [<span class="st">'LSTM'</span>,</span>
<span id="cb300-3"><a href="#cb300-3" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yt_imp, Ytp_imp),</span>
<span id="cb300-4"><a href="#cb300-4" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yt_imp, Ytp_imp),</span>
<span id="cb300-5"><a href="#cb300-5" aria-hidden="true" tabindex="-1"></a>               training_RMSE_imp,</span>
<span id="cb300-6"><a href="#cb300-6" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yv_imp, Yvp_imp),</span>
<span id="cb300-7"><a href="#cb300-7" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yv_imp, Yvp_imp),</span>
<span id="cb300-8"><a href="#cb300-8" aria-hidden="true" tabindex="-1"></a>               validation_RMSE_imp]]</span>
<span id="cb300-9"><a href="#cb300-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(error_table_imp_lstm, headers<span class="op">=</span><span class="st">'firstrow'</span>, tablefmt<span class="op">=</span><span class="st">'fancy_grid'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>╒═════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model   │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞═════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ LSTM    │    0.193516 │    0.342503 │     0.439905 │  0.219581 │  0.374944 │   0.468595 │
╘═════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
</div>
<div id="tabset-11-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-5-tab">
<div class="cell" data-outputid="527c12af-70be-4f70-80d0-6caa9ee343bd" data-execution_count="118">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb302"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb302-1"><a href="#cb302-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW SIZES</span></span>
<span id="cb302-2"><a href="#cb302-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xt_imp.shape, <span class="st">"--&gt;"</span>, Yt_imp.shape)</span>
<span id="cb302-3"><a href="#cb302-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xv_imp.shape, <span class="st">"--&gt;"</span>, Yv_imp.shape)</span>
<span id="cb302-4"><a href="#cb302-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb302-5"><a href="#cb302-5" aria-hidden="true" tabindex="-1"></a><span class="co"># HYPERPARAMETERS</span></span>
<span id="cb302-6"><a href="#cb302-6" aria-hidden="true" tabindex="-1"></a>optimizer<span class="op">=</span><span class="st">"rmsprop"</span></span>
<span id="cb302-7"><a href="#cb302-7" aria-hidden="true" tabindex="-1"></a>loss_function<span class="op">=</span><span class="st">"MeanSquaredError"</span></span>
<span id="cb302-8"><a href="#cb302-8" aria-hidden="true" tabindex="-1"></a>learning_rate<span class="op">=</span><span class="fl">0.001</span></span>
<span id="cb302-9"><a href="#cb302-9" aria-hidden="true" tabindex="-1"></a>numbers_epochs<span class="op">=</span><span class="dv">200</span> <span class="co">#100</span></span>
<span id="cb302-10"><a href="#cb302-10" aria-hidden="true" tabindex="-1"></a>L2<span class="op">=</span><span class="dv">0</span> <span class="co">#1e-4</span></span>
<span id="cb302-11"><a href="#cb302-11" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>(Xt_imp.shape[<span class="dv">1</span>],Xt_imp.shape[<span class="dv">2</span>])</span>
<span id="cb302-12"><a href="#cb302-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb302-13"><a href="#cb302-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb302-14"><a href="#cb302-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ------ Choose the batch size ------</span></span>
<span id="cb302-15"><a href="#cb302-15" aria-hidden="true" tabindex="-1"></a><span class="co"># batch_size=1                       # stocastic training</span></span>
<span id="cb302-16"><a href="#cb302-16" aria-hidden="true" tabindex="-1"></a><span class="co"># # batch_size=int(len(x_train)/2.)    # mini-batch training</span></span>
<span id="cb302-17"><a href="#cb302-17" aria-hidden="true" tabindex="-1"></a>batch_size<span class="op">=</span><span class="bu">len</span>(Xt1_imp)              <span class="co"># batch training</span></span>
<span id="cb302-18"><a href="#cb302-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb302-19"><a href="#cb302-19" aria-hidden="true" tabindex="-1"></a><span class="co"># BUILD MODEL</span></span>
<span id="cb302-20"><a href="#cb302-20" aria-hidden="true" tabindex="-1"></a>recurrent_hidden_units<span class="op">=</span><span class="dv">32</span></span>
<span id="cb302-21"><a href="#cb302-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb302-22"><a href="#cb302-22" aria-hidden="true" tabindex="-1"></a><span class="co"># CREATE MODEL</span></span>
<span id="cb302-23"><a href="#cb302-23" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> keras.Sequential()</span>
<span id="cb302-24"><a href="#cb302-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb302-25"><a href="#cb302-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ADD RECURRENT LAYER</span></span>
<span id="cb302-26"><a href="#cb302-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb302-27"><a href="#cb302-27" aria-hidden="true" tabindex="-1"></a><span class="co"># #COMMENT/UNCOMMENT TO USE RNN, LSTM,GRU</span></span>
<span id="cb302-28"><a href="#cb302-28" aria-hidden="true" tabindex="-1"></a>model.add(LSTM(</span>
<span id="cb302-29"><a href="#cb302-29" aria-hidden="true" tabindex="-1"></a><span class="co"># model.add(GRU(</span></span>
<span id="cb302-30"><a href="#cb302-30" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(SimpleRNN(</span></span>
<span id="cb302-31"><a href="#cb302-31" aria-hidden="true" tabindex="-1"></a>units<span class="op">=</span>recurrent_hidden_units,</span>
<span id="cb302-32"><a href="#cb302-32" aria-hidden="true" tabindex="-1"></a>return_sequences<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb302-33"><a href="#cb302-33" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>input_shape,</span>
<span id="cb302-34"><a href="#cb302-34" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_dropout=0.8,</span></span>
<span id="cb302-35"><a href="#cb302-35" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_regularizer=regularizers.L2(L2),</span></span>
<span id="cb302-36"><a href="#cb302-36" aria-hidden="true" tabindex="-1"></a><span class="co"># activation='relu'</span></span>
<span id="cb302-37"><a href="#cb302-37" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb302-38"><a href="#cb302-38" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb302-39"><a href="#cb302-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb302-40"><a href="#cb302-40" aria-hidden="true" tabindex="-1"></a><span class="co"># NEED TO TAKE THE OUTPUT RNN AND CONVERT TO SCALAR</span></span>
<span id="cb302-41"><a href="#cb302-41" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span><span class="st">'linear'</span>))</span>
<span id="cb302-42"><a href="#cb302-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb302-43"><a href="#cb302-43" aria-hidden="true" tabindex="-1"></a><span class="co"># MODEL SUMMARY</span></span>
<span id="cb302-44"><a href="#cb302-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())<span class="op">;</span> <span class="co">#print(x_train.shape,y_train.shape)</span></span>
<span id="cb302-45"><a href="#cb302-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb302-46"><a href="#cb302-46" aria-hidden="true" tabindex="-1"></a><span class="co"># # COMPILING THE MODEL</span></span>
<span id="cb302-47"><a href="#cb302-47" aria-hidden="true" tabindex="-1"></a>opt <span class="op">=</span> keras.optimizers.RMSprop(learning_rate<span class="op">=</span>learning_rate)</span>
<span id="cb302-48"><a href="#cb302-48" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>opt, loss<span class="op">=</span>loss_function)</span>
<span id="cb302-49"><a href="#cb302-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb302-50"><a href="#cb302-50" aria-hidden="true" tabindex="-1"></a><span class="co"># TRAINING YOUR MODEL</span></span>
<span id="cb302-51"><a href="#cb302-51" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(</span>
<span id="cb302-52"><a href="#cb302-52" aria-hidden="true" tabindex="-1"></a>    Xt_imp,</span>
<span id="cb302-53"><a href="#cb302-53" aria-hidden="true" tabindex="-1"></a>    Yt_imp,</span>
<span id="cb302-54"><a href="#cb302-54" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span>numbers_epochs,</span>
<span id="cb302-55"><a href="#cb302-55" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span>batch_size,</span>
<span id="cb302-56"><a href="#cb302-56" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb302-57"><a href="#cb302-57" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>(Xv_imp, Yv_imp),</span>
<span id="cb302-58"><a href="#cb302-58" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb302-59"><a href="#cb302-59" aria-hidden="true" tabindex="-1"></a><span class="co"># History plot</span></span>
<span id="cb302-60"><a href="#cb302-60" aria-hidden="true" tabindex="-1"></a>history_plot(history)</span>
<span id="cb302-61"><a href="#cb302-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb302-62"><a href="#cb302-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb302-63"><a href="#cb302-63" aria-hidden="true" tabindex="-1"></a>Ytp_imp <span class="op">=</span> model.predict(Xt_imp)</span>
<span id="cb302-64"><a href="#cb302-64" aria-hidden="true" tabindex="-1"></a>Yvp_imp <span class="op">=</span> model.predict(Xv_imp)</span>
<span id="cb302-65"><a href="#cb302-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb302-66"><a href="#cb302-66" aria-hidden="true" tabindex="-1"></a><span class="co"># REPORT</span></span>
<span id="cb302-67"><a href="#cb302-67" aria-hidden="true" tabindex="-1"></a>regression_report(Yt_imp, Ytp_imp, Yv_imp, Yvp_imp)</span>
<span id="cb302-68"><a href="#cb302-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb302-69"><a href="#cb302-69" aria-hidden="true" tabindex="-1"></a><span class="co"># compute RMSE using numpy</span></span>
<span id="cb302-70"><a href="#cb302-70" aria-hidden="true" tabindex="-1"></a>training_RMSE_imp <span class="op">=</span> np.sqrt(mean_squared_error(Yt_imp, Ytp_imp))</span>
<span id="cb302-71"><a href="#cb302-71" aria-hidden="true" tabindex="-1"></a>validation_RMSE_imp <span class="op">=</span> np.sqrt(mean_squared_error(Yv_imp, Yvp_imp))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(229, 5, 1) --&gt; (229, 1)
(73, 5, 1) --&gt; (73, 1)
Model: "sequential_32"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 lstm_4 (LSTM)               (None, 32)                4352      
                                                                 
 dense_32 (Dense)            (None, 1)                 33        
                                                                 
=================================================================
Total params: 4385 (17.13 KB)
Trainable params: 4385 (17.13 KB)
Non-trainable params: 0 (0.00 Byte)
_________________________________________________________________
None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-117-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>8/8 [==============================] - 1s 4ms/step
3/3 [==============================] - 0s 9ms/step
---------- Regression report ----------
TRAINING:
 MSE: 0.19189830266937993
 MAE: 0.34543021324045875</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-117-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-117-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>VALIDATION:
 MSE: 0.220367624040603
 MAE: 0.3758999369201629</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-117-output-7.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-117-output-8.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Error Summary</strong></p>
<div class="cell" data-outputid="150fc7f1-823d-408f-bebf-171a4c2bfc3b" data-execution_count="119">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb306"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb306-1"><a href="#cb306-1" aria-hidden="true" tabindex="-1"></a>error_table_exp_lstm <span class="op">=</span> [[<span class="st">'Model'</span>,<span class="st">'train_MSE'</span>,<span class="st">'train_MAE'</span>,<span class="st">'train_RMSE'</span>,<span class="st">'val_MSE'</span>,<span class="st">'val_MAE'</span>,<span class="st">'val_RMSE'</span>],</span>
<span id="cb306-2"><a href="#cb306-2" aria-hidden="true" tabindex="-1"></a>              [<span class="st">'LSTM'</span>,</span>
<span id="cb306-3"><a href="#cb306-3" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yt_exp, Ytp_exp),</span>
<span id="cb306-4"><a href="#cb306-4" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yt_exp, Ytp_exp),</span>
<span id="cb306-5"><a href="#cb306-5" aria-hidden="true" tabindex="-1"></a>               training_RMSE_exp,</span>
<span id="cb306-6"><a href="#cb306-6" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yv_exp, Yvp_exp),</span>
<span id="cb306-7"><a href="#cb306-7" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yv_exp, Yvp_exp),</span>
<span id="cb306-8"><a href="#cb306-8" aria-hidden="true" tabindex="-1"></a>               validation_RMSE_exp]]</span>
<span id="cb306-9"><a href="#cb306-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(error_table_exp_lstm, headers<span class="op">=</span><span class="st">'firstrow'</span>, tablefmt<span class="op">=</span><span class="st">'fancy_grid'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>╒═════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model   │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞═════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ LSTM    │  0.00766894 │    0.064497 │    0.0875725 │   2.70266 │   1.43477 │    1.64398 │
╘═════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
</div>
<div id="tabset-11-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-6-tab">
<div class="cell" data-outputid="3efd256e-c793-4062-c74c-021e5aa75853" data-execution_count="120">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb308"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb308-1"><a href="#cb308-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW SIZES</span></span>
<span id="cb308-2"><a href="#cb308-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xt_stk.shape, <span class="st">"--&gt;"</span>, Yt_stk.shape)</span>
<span id="cb308-3"><a href="#cb308-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xv_stk.shape, <span class="st">"--&gt;"</span>, Yv_stk.shape)</span>
<span id="cb308-4"><a href="#cb308-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-5"><a href="#cb308-5" aria-hidden="true" tabindex="-1"></a><span class="co"># HYPERPARAMETERS</span></span>
<span id="cb308-6"><a href="#cb308-6" aria-hidden="true" tabindex="-1"></a>optimizer<span class="op">=</span><span class="st">"rmsprop"</span></span>
<span id="cb308-7"><a href="#cb308-7" aria-hidden="true" tabindex="-1"></a>loss_function<span class="op">=</span><span class="st">"MeanSquaredError"</span></span>
<span id="cb308-8"><a href="#cb308-8" aria-hidden="true" tabindex="-1"></a>learning_rate<span class="op">=</span><span class="fl">0.001</span></span>
<span id="cb308-9"><a href="#cb308-9" aria-hidden="true" tabindex="-1"></a>numbers_epochs<span class="op">=</span><span class="dv">200</span> <span class="co">#100</span></span>
<span id="cb308-10"><a href="#cb308-10" aria-hidden="true" tabindex="-1"></a>L2<span class="op">=</span><span class="dv">0</span> <span class="co">#1e-4</span></span>
<span id="cb308-11"><a href="#cb308-11" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>(Xt_stk.shape[<span class="dv">1</span>],Xt_stk.shape[<span class="dv">2</span>])</span>
<span id="cb308-12"><a href="#cb308-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-13"><a href="#cb308-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-14"><a href="#cb308-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ------ Choose the batch size ------</span></span>
<span id="cb308-15"><a href="#cb308-15" aria-hidden="true" tabindex="-1"></a><span class="co"># batch_size=1                       # stocastic training</span></span>
<span id="cb308-16"><a href="#cb308-16" aria-hidden="true" tabindex="-1"></a><span class="co"># # batch_size=int(len(x_train)/2.)    # mini-batch training</span></span>
<span id="cb308-17"><a href="#cb308-17" aria-hidden="true" tabindex="-1"></a>batch_size<span class="op">=</span><span class="bu">len</span>(Xt1_stk)              <span class="co"># batch training</span></span>
<span id="cb308-18"><a href="#cb308-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-19"><a href="#cb308-19" aria-hidden="true" tabindex="-1"></a><span class="co"># BUILD MODEL</span></span>
<span id="cb308-20"><a href="#cb308-20" aria-hidden="true" tabindex="-1"></a>recurrent_hidden_units<span class="op">=</span><span class="dv">32</span></span>
<span id="cb308-21"><a href="#cb308-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-22"><a href="#cb308-22" aria-hidden="true" tabindex="-1"></a><span class="co"># CREATE MODEL</span></span>
<span id="cb308-23"><a href="#cb308-23" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> keras.Sequential()</span>
<span id="cb308-24"><a href="#cb308-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-25"><a href="#cb308-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ADD RECURRENT LAYER</span></span>
<span id="cb308-26"><a href="#cb308-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-27"><a href="#cb308-27" aria-hidden="true" tabindex="-1"></a><span class="co"># #COMMENT/UNCOMMENT TO USE RNN, LSTM,GRU</span></span>
<span id="cb308-28"><a href="#cb308-28" aria-hidden="true" tabindex="-1"></a>model.add(LSTM(</span>
<span id="cb308-29"><a href="#cb308-29" aria-hidden="true" tabindex="-1"></a><span class="co"># model.add(GRU(</span></span>
<span id="cb308-30"><a href="#cb308-30" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(SimpleRNN(</span></span>
<span id="cb308-31"><a href="#cb308-31" aria-hidden="true" tabindex="-1"></a>units<span class="op">=</span>recurrent_hidden_units,</span>
<span id="cb308-32"><a href="#cb308-32" aria-hidden="true" tabindex="-1"></a>return_sequences<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb308-33"><a href="#cb308-33" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>input_shape,</span>
<span id="cb308-34"><a href="#cb308-34" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_dropout=0.8,</span></span>
<span id="cb308-35"><a href="#cb308-35" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_regularizer=regularizers.L2(L2),</span></span>
<span id="cb308-36"><a href="#cb308-36" aria-hidden="true" tabindex="-1"></a><span class="co"># activation='relu'</span></span>
<span id="cb308-37"><a href="#cb308-37" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb308-38"><a href="#cb308-38" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb308-39"><a href="#cb308-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-40"><a href="#cb308-40" aria-hidden="true" tabindex="-1"></a><span class="co"># NEED TO TAKE THE OUTPUT RNN AND CONVERT TO SCALAR</span></span>
<span id="cb308-41"><a href="#cb308-41" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span><span class="st">'linear'</span>))</span>
<span id="cb308-42"><a href="#cb308-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-43"><a href="#cb308-43" aria-hidden="true" tabindex="-1"></a><span class="co"># MODEL SUMMARY</span></span>
<span id="cb308-44"><a href="#cb308-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())<span class="op">;</span> <span class="co">#print(x_train.shape,y_train.shape)</span></span>
<span id="cb308-45"><a href="#cb308-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-46"><a href="#cb308-46" aria-hidden="true" tabindex="-1"></a><span class="co"># # COMPILING THE MODEL</span></span>
<span id="cb308-47"><a href="#cb308-47" aria-hidden="true" tabindex="-1"></a>opt <span class="op">=</span> keras.optimizers.RMSprop(learning_rate<span class="op">=</span>learning_rate)</span>
<span id="cb308-48"><a href="#cb308-48" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>opt, loss<span class="op">=</span>loss_function)</span>
<span id="cb308-49"><a href="#cb308-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-50"><a href="#cb308-50" aria-hidden="true" tabindex="-1"></a><span class="co"># TRAINING YOUR MODEL</span></span>
<span id="cb308-51"><a href="#cb308-51" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(</span>
<span id="cb308-52"><a href="#cb308-52" aria-hidden="true" tabindex="-1"></a>    Xt_stk,</span>
<span id="cb308-53"><a href="#cb308-53" aria-hidden="true" tabindex="-1"></a>    Yt_stk,</span>
<span id="cb308-54"><a href="#cb308-54" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span>numbers_epochs,</span>
<span id="cb308-55"><a href="#cb308-55" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span>batch_size,</span>
<span id="cb308-56"><a href="#cb308-56" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb308-57"><a href="#cb308-57" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>(Xv_stk, Yv_stk),</span>
<span id="cb308-58"><a href="#cb308-58" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb308-59"><a href="#cb308-59" aria-hidden="true" tabindex="-1"></a><span class="co"># History plot</span></span>
<span id="cb308-60"><a href="#cb308-60" aria-hidden="true" tabindex="-1"></a>history_plot(history)</span>
<span id="cb308-61"><a href="#cb308-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-62"><a href="#cb308-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb308-63"><a href="#cb308-63" aria-hidden="true" tabindex="-1"></a>Ytp_stk <span class="op">=</span> model.predict(Xt_stk)</span>
<span id="cb308-64"><a href="#cb308-64" aria-hidden="true" tabindex="-1"></a>Yvp_stk <span class="op">=</span> model.predict(Xv_stk)</span>
<span id="cb308-65"><a href="#cb308-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-66"><a href="#cb308-66" aria-hidden="true" tabindex="-1"></a><span class="co"># REPORT</span></span>
<span id="cb308-67"><a href="#cb308-67" aria-hidden="true" tabindex="-1"></a>regression_report(Yt_stk, Ytp_stk, Yv_stk, Yvp_stk)</span>
<span id="cb308-68"><a href="#cb308-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-69"><a href="#cb308-69" aria-hidden="true" tabindex="-1"></a><span class="co"># compute RMSE using numpy</span></span>
<span id="cb308-70"><a href="#cb308-70" aria-hidden="true" tabindex="-1"></a>training_RMSE_stk <span class="op">=</span> np.sqrt(mean_squared_error(Yt_stk, Ytp_stk))</span>
<span id="cb308-71"><a href="#cb308-71" aria-hidden="true" tabindex="-1"></a>validation_RMSE_stk <span class="op">=</span> np.sqrt(mean_squared_error(Yv_stk, Yvp_stk))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(3377, 5, 1) --&gt; (3377, 1)
(1123, 5, 1) --&gt; (1123, 1)
Model: "sequential_33"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 lstm_5 (LSTM)               (None, 32)                4352      
                                                                 
 dense_33 (Dense)            (None, 1)                 33        
                                                                 
=================================================================
Total params: 4385 (17.13 KB)
Trainable params: 4385 (17.13 KB)
Non-trainable params: 0 (0.00 Byte)
_________________________________________________________________
None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-119-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>106/106 [==============================] - 1s 4ms/step
36/36 [==============================] - 0s 3ms/step
---------- Regression report ----------
TRAINING:
 MSE: 0.002367399844141305
 MAE: 0.03738482228573484</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-119-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-119-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>VALIDATION:
 MSE: 0.3444546925410365
 MAE: 0.3127807659043008</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-119-output-7.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-119-output-8.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Error Summary</strong></p>
<div class="cell" data-outputid="f918b79e-4d10-4962-d1d0-dbf4b33be04d" data-execution_count="121">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb312"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb312-1"><a href="#cb312-1" aria-hidden="true" tabindex="-1"></a>error_table_stk_lstm <span class="op">=</span> [[<span class="st">'Model'</span>,<span class="st">'train_MSE'</span>,<span class="st">'train_MAE'</span>,<span class="st">'train_RMSE'</span>,<span class="st">'val_MSE'</span>,<span class="st">'val_MAE'</span>,<span class="st">'val_RMSE'</span>],</span>
<span id="cb312-2"><a href="#cb312-2" aria-hidden="true" tabindex="-1"></a>              [<span class="st">'LSTM'</span>,</span>
<span id="cb312-3"><a href="#cb312-3" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yt_stk, Ytp_stk),</span>
<span id="cb312-4"><a href="#cb312-4" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yt_stk, Ytp_stk),</span>
<span id="cb312-5"><a href="#cb312-5" aria-hidden="true" tabindex="-1"></a>               training_RMSE_stk,</span>
<span id="cb312-6"><a href="#cb312-6" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yv_stk, Yvp_stk),</span>
<span id="cb312-7"><a href="#cb312-7" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yv_stk, Yvp_stk),</span>
<span id="cb312-8"><a href="#cb312-8" aria-hidden="true" tabindex="-1"></a>               validation_RMSE_stk]]</span>
<span id="cb312-9"><a href="#cb312-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(error_table_stk_lstm, headers<span class="op">=</span><span class="st">'firstrow'</span>, tablefmt<span class="op">=</span><span class="st">'fancy_grid'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>╒═════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model   │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞═════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ LSTM    │   0.0023674 │   0.0373848 │    0.0486559 │  0.344455 │  0.312781 │   0.586903 │
╘═════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
</div>
<div id="tabset-11-7" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-7-tab">
<div class="cell" data-outputid="c28c5647-9a95-4422-ad60-c595ab3fd2b3" data-execution_count="122">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb314"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb314-1"><a href="#cb314-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW SIZES</span></span>
<span id="cb314-2"><a href="#cb314-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xt_emissions.shape, <span class="st">"--&gt;"</span>, Yt_emissions.shape)</span>
<span id="cb314-3"><a href="#cb314-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xv_emissions.shape, <span class="st">"--&gt;"</span>, Yv_emissions.shape)</span>
<span id="cb314-4"><a href="#cb314-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb314-5"><a href="#cb314-5" aria-hidden="true" tabindex="-1"></a><span class="co"># HYPERPARAMETERS</span></span>
<span id="cb314-6"><a href="#cb314-6" aria-hidden="true" tabindex="-1"></a>optimizer<span class="op">=</span><span class="st">"rmsprop"</span></span>
<span id="cb314-7"><a href="#cb314-7" aria-hidden="true" tabindex="-1"></a>loss_function<span class="op">=</span><span class="st">"MeanSquaredError"</span></span>
<span id="cb314-8"><a href="#cb314-8" aria-hidden="true" tabindex="-1"></a>learning_rate<span class="op">=</span><span class="fl">0.001</span></span>
<span id="cb314-9"><a href="#cb314-9" aria-hidden="true" tabindex="-1"></a>numbers_epochs<span class="op">=</span><span class="dv">200</span> <span class="co">#100</span></span>
<span id="cb314-10"><a href="#cb314-10" aria-hidden="true" tabindex="-1"></a>L2<span class="op">=</span><span class="dv">0</span> <span class="co">#1e-4</span></span>
<span id="cb314-11"><a href="#cb314-11" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>(Xt_emissions.shape[<span class="dv">1</span>],Xt_emissions.shape[<span class="dv">2</span>])</span>
<span id="cb314-12"><a href="#cb314-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb314-13"><a href="#cb314-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb314-14"><a href="#cb314-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ------ Choose the batch size ------</span></span>
<span id="cb314-15"><a href="#cb314-15" aria-hidden="true" tabindex="-1"></a><span class="co"># batch_size=1                       # stocastic training</span></span>
<span id="cb314-16"><a href="#cb314-16" aria-hidden="true" tabindex="-1"></a><span class="co"># # batch_size=int(len(x_train)/2.)    # mini-batch training</span></span>
<span id="cb314-17"><a href="#cb314-17" aria-hidden="true" tabindex="-1"></a>batch_size<span class="op">=</span><span class="bu">len</span>(Xt1_emissions)              <span class="co"># batch training</span></span>
<span id="cb314-18"><a href="#cb314-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb314-19"><a href="#cb314-19" aria-hidden="true" tabindex="-1"></a><span class="co"># BUILD MODEL</span></span>
<span id="cb314-20"><a href="#cb314-20" aria-hidden="true" tabindex="-1"></a>recurrent_hidden_units<span class="op">=</span><span class="dv">32</span></span>
<span id="cb314-21"><a href="#cb314-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb314-22"><a href="#cb314-22" aria-hidden="true" tabindex="-1"></a><span class="co"># CREATE MODEL</span></span>
<span id="cb314-23"><a href="#cb314-23" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> keras.Sequential()</span>
<span id="cb314-24"><a href="#cb314-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb314-25"><a href="#cb314-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ADD RECURRENT LAYER</span></span>
<span id="cb314-26"><a href="#cb314-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb314-27"><a href="#cb314-27" aria-hidden="true" tabindex="-1"></a><span class="co"># #COMMENT/UNCOMMENT TO USE RNN, LSTM,GRU</span></span>
<span id="cb314-28"><a href="#cb314-28" aria-hidden="true" tabindex="-1"></a>model.add(LSTM(</span>
<span id="cb314-29"><a href="#cb314-29" aria-hidden="true" tabindex="-1"></a><span class="co"># model.add(GRU(</span></span>
<span id="cb314-30"><a href="#cb314-30" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(SimpleRNN(</span></span>
<span id="cb314-31"><a href="#cb314-31" aria-hidden="true" tabindex="-1"></a>units<span class="op">=</span>recurrent_hidden_units,</span>
<span id="cb314-32"><a href="#cb314-32" aria-hidden="true" tabindex="-1"></a>return_sequences<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb314-33"><a href="#cb314-33" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>input_shape,</span>
<span id="cb314-34"><a href="#cb314-34" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_dropout=0.8,</span></span>
<span id="cb314-35"><a href="#cb314-35" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_regularizer=regularizers.L2(L2),</span></span>
<span id="cb314-36"><a href="#cb314-36" aria-hidden="true" tabindex="-1"></a><span class="co"># activation='relu'</span></span>
<span id="cb314-37"><a href="#cb314-37" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb314-38"><a href="#cb314-38" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb314-39"><a href="#cb314-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb314-40"><a href="#cb314-40" aria-hidden="true" tabindex="-1"></a><span class="co"># NEED TO TAKE THE OUTPUT RNN AND CONVERT TO SCALAR</span></span>
<span id="cb314-41"><a href="#cb314-41" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span><span class="st">'linear'</span>))</span>
<span id="cb314-42"><a href="#cb314-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb314-43"><a href="#cb314-43" aria-hidden="true" tabindex="-1"></a><span class="co"># MODEL SUMMARY</span></span>
<span id="cb314-44"><a href="#cb314-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())<span class="op">;</span> <span class="co">#print(x_train.shape,y_train.shape)</span></span>
<span id="cb314-45"><a href="#cb314-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb314-46"><a href="#cb314-46" aria-hidden="true" tabindex="-1"></a><span class="co"># # COMPILING THE MODEL</span></span>
<span id="cb314-47"><a href="#cb314-47" aria-hidden="true" tabindex="-1"></a>opt <span class="op">=</span> keras.optimizers.RMSprop(learning_rate<span class="op">=</span>learning_rate)</span>
<span id="cb314-48"><a href="#cb314-48" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>opt, loss<span class="op">=</span>loss_function)</span>
<span id="cb314-49"><a href="#cb314-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb314-50"><a href="#cb314-50" aria-hidden="true" tabindex="-1"></a><span class="co"># TRAINING YOUR MODEL</span></span>
<span id="cb314-51"><a href="#cb314-51" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(</span>
<span id="cb314-52"><a href="#cb314-52" aria-hidden="true" tabindex="-1"></a>    Xt_emissions,</span>
<span id="cb314-53"><a href="#cb314-53" aria-hidden="true" tabindex="-1"></a>    Yt_emissions,</span>
<span id="cb314-54"><a href="#cb314-54" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span>numbers_epochs,</span>
<span id="cb314-55"><a href="#cb314-55" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span>batch_size,</span>
<span id="cb314-56"><a href="#cb314-56" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb314-57"><a href="#cb314-57" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>(Xv_emissions, Yv_emissions),</span>
<span id="cb314-58"><a href="#cb314-58" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb314-59"><a href="#cb314-59" aria-hidden="true" tabindex="-1"></a><span class="co"># History plot</span></span>
<span id="cb314-60"><a href="#cb314-60" aria-hidden="true" tabindex="-1"></a>history_plot(history)</span>
<span id="cb314-61"><a href="#cb314-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb314-62"><a href="#cb314-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb314-63"><a href="#cb314-63" aria-hidden="true" tabindex="-1"></a>Ytp_emissions <span class="op">=</span> model.predict(Xt_emissions)</span>
<span id="cb314-64"><a href="#cb314-64" aria-hidden="true" tabindex="-1"></a>Yvp_emissions <span class="op">=</span> model.predict(Xv_emissions)</span>
<span id="cb314-65"><a href="#cb314-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb314-66"><a href="#cb314-66" aria-hidden="true" tabindex="-1"></a><span class="co"># REPORT</span></span>
<span id="cb314-67"><a href="#cb314-67" aria-hidden="true" tabindex="-1"></a>regression_report(Yt_emissions, Ytp_emissions, Yv_emissions, Yvp_emissions)</span>
<span id="cb314-68"><a href="#cb314-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb314-69"><a href="#cb314-69" aria-hidden="true" tabindex="-1"></a><span class="co"># compute RMSE using numpy</span></span>
<span id="cb314-70"><a href="#cb314-70" aria-hidden="true" tabindex="-1"></a>training_RMSE_emissions <span class="op">=</span> np.sqrt(mean_squared_error(Yt_emissions, Ytp_emissions))</span>
<span id="cb314-71"><a href="#cb314-71" aria-hidden="true" tabindex="-1"></a>validation_RMSE_emissions <span class="op">=</span> np.sqrt(mean_squared_error(Yv_emissions, Yvp_emissions))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(227, 5, 1) --&gt; (227, 1)
(73, 5, 1) --&gt; (73, 1)
Model: "sequential_34"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 lstm_6 (LSTM)               (None, 32)                4352      
                                                                 
 dense_34 (Dense)            (None, 1)                 33        
                                                                 
=================================================================
Total params: 4385 (17.13 KB)
Trainable params: 4385 (17.13 KB)
Non-trainable params: 0 (0.00 Byte)
_________________________________________________________________
None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-121-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>8/8 [==============================] - 1s 4ms/step
3/3 [==============================] - 0s 5ms/step
---------- Regression report ----------
TRAINING:
 MSE: 0.8239359829777397
 MAE: 0.47986576628663985</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-121-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-121-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>VALIDATION:
 MSE: 1.3089513655204494
 MAE: 0.49688676717475977</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-121-output-7.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-121-output-8.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Error Summary</strong></p>
<div class="cell" data-outputid="b6975fa6-db59-4a20-c436-fa94fdc42ce0" data-execution_count="123">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb318"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb318-1"><a href="#cb318-1" aria-hidden="true" tabindex="-1"></a>error_table_emissions_lstm <span class="op">=</span> [[<span class="st">'Model'</span>,<span class="st">'train_MSE'</span>,<span class="st">'train_MAE'</span>,<span class="st">'train_RMSE'</span>,<span class="st">'val_MSE'</span>,<span class="st">'val_MAE'</span>,<span class="st">'val_RMSE'</span>],</span>
<span id="cb318-2"><a href="#cb318-2" aria-hidden="true" tabindex="-1"></a>              [<span class="st">'LSTM'</span>,</span>
<span id="cb318-3"><a href="#cb318-3" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yt_emissions, Ytp_emissions),</span>
<span id="cb318-4"><a href="#cb318-4" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yt_emissions, Ytp_emissions),</span>
<span id="cb318-5"><a href="#cb318-5" aria-hidden="true" tabindex="-1"></a>               training_RMSE_emissions,</span>
<span id="cb318-6"><a href="#cb318-6" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yv_emissions, Yvp_emissions),</span>
<span id="cb318-7"><a href="#cb318-7" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yv_emissions, Yvp_emissions),</span>
<span id="cb318-8"><a href="#cb318-8" aria-hidden="true" tabindex="-1"></a>               validation_RMSE_emissions]]</span>
<span id="cb318-9"><a href="#cb318-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(error_table_emissions_lstm, headers<span class="op">=</span><span class="st">'firstrow'</span>, tablefmt<span class="op">=</span><span class="st">'fancy_grid'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>╒═════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model   │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞═════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ LSTM    │    0.823936 │    0.479866 │     0.907709 │   1.30895 │  0.496887 │    1.14409 │
╘═════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="lstm-with-l2-regularization" class="level2">
<h2 class="anchored" data-anchor-id="lstm-with-l2-regularization">LSTM with L2 Regularization</h2>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-12-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-1" role="tab" aria-controls="tabset-12-1" aria-selected="true">Prices</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-2" role="tab" aria-controls="tabset-12-2" aria-selected="false">Consumption</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-3" role="tab" aria-controls="tabset-12-3" aria-selected="false">Production</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-4" role="tab" aria-controls="tabset-12-4" aria-selected="false">Imports</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-5" role="tab" aria-controls="tabset-12-5" aria-selected="false">Exports</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-6" role="tab" aria-controls="tabset-12-6" aria-selected="false">CVX Stocks</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-7-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-7" role="tab" aria-controls="tabset-12-7" aria-selected="false">CO2 Emissions</a></li></ul>
<div class="tab-content">
<div id="tabset-12-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-12-1-tab">
<div class="cell" data-outputid="67ae7655-2aa8-41f5-c91b-620b594d865f" data-execution_count="124">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb320"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb320-1"><a href="#cb320-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW SIZES</span></span>
<span id="cb320-2"><a href="#cb320-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xt.shape, <span class="st">"--&gt;"</span>, Yt.shape)</span>
<span id="cb320-3"><a href="#cb320-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xv.shape, <span class="st">"--&gt;"</span>, Yv.shape)</span>
<span id="cb320-4"><a href="#cb320-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-5"><a href="#cb320-5" aria-hidden="true" tabindex="-1"></a><span class="co"># HYPERPARAMETERS</span></span>
<span id="cb320-6"><a href="#cb320-6" aria-hidden="true" tabindex="-1"></a>optimizer<span class="op">=</span><span class="st">"rmsprop"</span></span>
<span id="cb320-7"><a href="#cb320-7" aria-hidden="true" tabindex="-1"></a>loss_function<span class="op">=</span><span class="st">"MeanSquaredError"</span></span>
<span id="cb320-8"><a href="#cb320-8" aria-hidden="true" tabindex="-1"></a>learning_rate<span class="op">=</span><span class="fl">0.001</span></span>
<span id="cb320-9"><a href="#cb320-9" aria-hidden="true" tabindex="-1"></a>numbers_epochs<span class="op">=</span><span class="dv">200</span> <span class="co">#100</span></span>
<span id="cb320-10"><a href="#cb320-10" aria-hidden="true" tabindex="-1"></a>L2<span class="op">=</span><span class="fl">1e-4</span></span>
<span id="cb320-11"><a href="#cb320-11" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>(Xt.shape[<span class="dv">1</span>],Xt.shape[<span class="dv">2</span>])</span>
<span id="cb320-12"><a href="#cb320-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-13"><a href="#cb320-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-14"><a href="#cb320-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ------ Choose the batch size ------</span></span>
<span id="cb320-15"><a href="#cb320-15" aria-hidden="true" tabindex="-1"></a><span class="co"># batch_size=1                       # stocastic training</span></span>
<span id="cb320-16"><a href="#cb320-16" aria-hidden="true" tabindex="-1"></a><span class="co"># # batch_size=int(len(x_train)/2.)    # mini-batch training</span></span>
<span id="cb320-17"><a href="#cb320-17" aria-hidden="true" tabindex="-1"></a>batch_size<span class="op">=</span><span class="bu">len</span>(Xt1)              <span class="co"># batch training</span></span>
<span id="cb320-18"><a href="#cb320-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-19"><a href="#cb320-19" aria-hidden="true" tabindex="-1"></a><span class="co"># BUILD MODEL</span></span>
<span id="cb320-20"><a href="#cb320-20" aria-hidden="true" tabindex="-1"></a>recurrent_hidden_units<span class="op">=</span><span class="dv">32</span></span>
<span id="cb320-21"><a href="#cb320-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-22"><a href="#cb320-22" aria-hidden="true" tabindex="-1"></a><span class="co"># CREATE MODEL</span></span>
<span id="cb320-23"><a href="#cb320-23" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> keras.Sequential()</span>
<span id="cb320-24"><a href="#cb320-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-25"><a href="#cb320-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ADD RECURRENT LAYER</span></span>
<span id="cb320-26"><a href="#cb320-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-27"><a href="#cb320-27" aria-hidden="true" tabindex="-1"></a><span class="co"># #COMMENT/UNCOMMENT TO USE RNN, LSTM,GRU</span></span>
<span id="cb320-28"><a href="#cb320-28" aria-hidden="true" tabindex="-1"></a>model.add(LSTM(</span>
<span id="cb320-29"><a href="#cb320-29" aria-hidden="true" tabindex="-1"></a><span class="co"># model.add(GRU(</span></span>
<span id="cb320-30"><a href="#cb320-30" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(SimpleRNN(</span></span>
<span id="cb320-31"><a href="#cb320-31" aria-hidden="true" tabindex="-1"></a>units<span class="op">=</span>recurrent_hidden_units,</span>
<span id="cb320-32"><a href="#cb320-32" aria-hidden="true" tabindex="-1"></a>return_sequences<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb320-33"><a href="#cb320-33" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>input_shape,</span>
<span id="cb320-34"><a href="#cb320-34" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_dropout=0.8,</span></span>
<span id="cb320-35"><a href="#cb320-35" aria-hidden="true" tabindex="-1"></a>recurrent_regularizer<span class="op">=</span>regularizers.L2(L2),</span>
<span id="cb320-36"><a href="#cb320-36" aria-hidden="true" tabindex="-1"></a>activation<span class="op">=</span><span class="st">'relu'</span>)</span>
<span id="cb320-37"><a href="#cb320-37" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb320-38"><a href="#cb320-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-39"><a href="#cb320-39" aria-hidden="true" tabindex="-1"></a><span class="co"># NEED TO TAKE THE OUTPUT RNN AND CONVERT TO SCALAR</span></span>
<span id="cb320-40"><a href="#cb320-40" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span><span class="st">'linear'</span>))</span>
<span id="cb320-41"><a href="#cb320-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-42"><a href="#cb320-42" aria-hidden="true" tabindex="-1"></a><span class="co"># MODEL SUMMARY</span></span>
<span id="cb320-43"><a href="#cb320-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())<span class="op">;</span> <span class="co">#print(x_train.shape,y_train.shape)</span></span>
<span id="cb320-44"><a href="#cb320-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-45"><a href="#cb320-45" aria-hidden="true" tabindex="-1"></a><span class="co"># # COMPILING THE MODEL</span></span>
<span id="cb320-46"><a href="#cb320-46" aria-hidden="true" tabindex="-1"></a>opt <span class="op">=</span> keras.optimizers.RMSprop(learning_rate<span class="op">=</span>learning_rate)</span>
<span id="cb320-47"><a href="#cb320-47" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>opt, loss<span class="op">=</span>loss_function)</span>
<span id="cb320-48"><a href="#cb320-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-49"><a href="#cb320-49" aria-hidden="true" tabindex="-1"></a><span class="co"># TRAINING YOUR MODEL</span></span>
<span id="cb320-50"><a href="#cb320-50" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(</span>
<span id="cb320-51"><a href="#cb320-51" aria-hidden="true" tabindex="-1"></a>    Xt,</span>
<span id="cb320-52"><a href="#cb320-52" aria-hidden="true" tabindex="-1"></a>    Yt,</span>
<span id="cb320-53"><a href="#cb320-53" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span>numbers_epochs,</span>
<span id="cb320-54"><a href="#cb320-54" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span>batch_size,</span>
<span id="cb320-55"><a href="#cb320-55" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb320-56"><a href="#cb320-56" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>(Xv, Yv),</span>
<span id="cb320-57"><a href="#cb320-57" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb320-58"><a href="#cb320-58" aria-hidden="true" tabindex="-1"></a><span class="co"># History plot</span></span>
<span id="cb320-59"><a href="#cb320-59" aria-hidden="true" tabindex="-1"></a>history_plot(history)</span>
<span id="cb320-60"><a href="#cb320-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-61"><a href="#cb320-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb320-62"><a href="#cb320-62" aria-hidden="true" tabindex="-1"></a>Ytp <span class="op">=</span> model.predict(Xt)</span>
<span id="cb320-63"><a href="#cb320-63" aria-hidden="true" tabindex="-1"></a>Yvp <span class="op">=</span> model.predict(Xv)</span>
<span id="cb320-64"><a href="#cb320-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-65"><a href="#cb320-65" aria-hidden="true" tabindex="-1"></a><span class="co"># REPORT</span></span>
<span id="cb320-66"><a href="#cb320-66" aria-hidden="true" tabindex="-1"></a>regression_report(Yt, Ytp, Yv, Yvp)</span>
<span id="cb320-67"><a href="#cb320-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-68"><a href="#cb320-68" aria-hidden="true" tabindex="-1"></a><span class="co"># compute RMSE using numpy</span></span>
<span id="cb320-69"><a href="#cb320-69" aria-hidden="true" tabindex="-1"></a>training_RMSE <span class="op">=</span> np.sqrt(mean_squared_error(Yt, Ytp))</span>
<span id="cb320-70"><a href="#cb320-70" aria-hidden="true" tabindex="-1"></a>validation_RMSE <span class="op">=</span> np.sqrt(mean_squared_error(Yv, Yvp))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(157, 5, 1) --&gt; (157, 1)
(49, 5, 1) --&gt; (49, 1)
Model: "sequential_35"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 lstm_7 (LSTM)               (None, 32)                4352      
                                                                 
 dense_35 (Dense)            (None, 1)                 33        
                                                                 
=================================================================
Total params: 4385 (17.13 KB)
Trainable params: 4385 (17.13 KB)
Non-trainable params: 0 (0.00 Byte)
_________________________________________________________________
None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-123-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>5/5 [==============================] - 0s 4ms/step
2/2 [==============================] - 0s 10ms/step
---------- Regression report ----------
TRAINING:
 MSE: 0.09697849098699898
 MAE: 0.2159713205718824</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-123-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-123-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>VALIDATION:
 MSE: 0.18647708992320702
 MAE: 0.3025485515171489</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-123-output-7.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-123-output-8.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Error Summary</strong></p>
<div class="cell" data-outputid="ca663452-5c01-4450-c32a-91ed0ad1aa67" data-execution_count="125">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb324"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb324-1"><a href="#cb324-1" aria-hidden="true" tabindex="-1"></a>error_table_lstm_l2 <span class="op">=</span> [[<span class="st">'Model'</span>,<span class="st">'train_MSE'</span>,<span class="st">'train_MAE'</span>,<span class="st">'train_RMSE'</span>,<span class="st">'val_MSE'</span>,<span class="st">'val_MAE'</span>,<span class="st">'val_RMSE'</span>],</span>
<span id="cb324-2"><a href="#cb324-2" aria-hidden="true" tabindex="-1"></a>              [<span class="st">'LSTM(L2 Reg)'</span>,</span>
<span id="cb324-3"><a href="#cb324-3" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yt, Ytp),</span>
<span id="cb324-4"><a href="#cb324-4" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yt, Ytp),</span>
<span id="cb324-5"><a href="#cb324-5" aria-hidden="true" tabindex="-1"></a>               training_RMSE,</span>
<span id="cb324-6"><a href="#cb324-6" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yv, Yvp),</span>
<span id="cb324-7"><a href="#cb324-7" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yv, Yvp),</span>
<span id="cb324-8"><a href="#cb324-8" aria-hidden="true" tabindex="-1"></a>               validation_RMSE]]</span>
<span id="cb324-9"><a href="#cb324-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(error_table_lstm_l2, headers<span class="op">=</span><span class="st">'firstrow'</span>, tablefmt<span class="op">=</span><span class="st">'fancy_grid'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>╒══════════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model        │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞══════════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ LSTM(L2 Reg) │   0.0969785 │    0.215971 │     0.311414 │  0.186477 │  0.302549 │    0.43183 │
╘══════════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
</div>
<div id="tabset-12-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-12-2-tab">
<div class="cell" data-outputid="6a2cb929-8ec6-4036-e78f-95e12cc4070f" data-execution_count="126">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb326"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb326-1"><a href="#cb326-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW SIZES</span></span>
<span id="cb326-2"><a href="#cb326-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xt_consump.shape, <span class="st">"--&gt;"</span>, Yt_consump.shape)</span>
<span id="cb326-3"><a href="#cb326-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xv_consump.shape, <span class="st">"--&gt;"</span>, Yv_consump.shape)</span>
<span id="cb326-4"><a href="#cb326-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb326-5"><a href="#cb326-5" aria-hidden="true" tabindex="-1"></a><span class="co"># HYPERPARAMETERS</span></span>
<span id="cb326-6"><a href="#cb326-6" aria-hidden="true" tabindex="-1"></a>optimizer<span class="op">=</span><span class="st">"rmsprop"</span></span>
<span id="cb326-7"><a href="#cb326-7" aria-hidden="true" tabindex="-1"></a>loss_function<span class="op">=</span><span class="st">"MeanSquaredError"</span></span>
<span id="cb326-8"><a href="#cb326-8" aria-hidden="true" tabindex="-1"></a>learning_rate<span class="op">=</span><span class="fl">0.001</span></span>
<span id="cb326-9"><a href="#cb326-9" aria-hidden="true" tabindex="-1"></a>numbers_epochs<span class="op">=</span><span class="dv">200</span> <span class="co">#100</span></span>
<span id="cb326-10"><a href="#cb326-10" aria-hidden="true" tabindex="-1"></a>L2<span class="op">=</span><span class="fl">1e-4</span></span>
<span id="cb326-11"><a href="#cb326-11" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>(Xt_consump.shape[<span class="dv">1</span>],Xt_consump.shape[<span class="dv">2</span>])</span>
<span id="cb326-12"><a href="#cb326-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb326-13"><a href="#cb326-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb326-14"><a href="#cb326-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ------ Choose the batch size ------</span></span>
<span id="cb326-15"><a href="#cb326-15" aria-hidden="true" tabindex="-1"></a><span class="co"># batch_size=1                       # stocastic training</span></span>
<span id="cb326-16"><a href="#cb326-16" aria-hidden="true" tabindex="-1"></a><span class="co"># # batch_size=int(len(x_train)/2.)    # mini-batch training</span></span>
<span id="cb326-17"><a href="#cb326-17" aria-hidden="true" tabindex="-1"></a>batch_size<span class="op">=</span><span class="bu">len</span>(Xt1_consump)              <span class="co"># batch training</span></span>
<span id="cb326-18"><a href="#cb326-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb326-19"><a href="#cb326-19" aria-hidden="true" tabindex="-1"></a><span class="co"># BUILD MODEL</span></span>
<span id="cb326-20"><a href="#cb326-20" aria-hidden="true" tabindex="-1"></a>recurrent_hidden_units<span class="op">=</span><span class="dv">32</span></span>
<span id="cb326-21"><a href="#cb326-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb326-22"><a href="#cb326-22" aria-hidden="true" tabindex="-1"></a><span class="co"># CREATE MODEL</span></span>
<span id="cb326-23"><a href="#cb326-23" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> keras.Sequential()</span>
<span id="cb326-24"><a href="#cb326-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb326-25"><a href="#cb326-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ADD RECURRENT LAYER</span></span>
<span id="cb326-26"><a href="#cb326-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb326-27"><a href="#cb326-27" aria-hidden="true" tabindex="-1"></a><span class="co"># #COMMENT/UNCOMMENT TO USE RNN, LSTM,GRU</span></span>
<span id="cb326-28"><a href="#cb326-28" aria-hidden="true" tabindex="-1"></a>model.add(LSTM(</span>
<span id="cb326-29"><a href="#cb326-29" aria-hidden="true" tabindex="-1"></a><span class="co"># model.add(GRU(</span></span>
<span id="cb326-30"><a href="#cb326-30" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(SimpleRNN(</span></span>
<span id="cb326-31"><a href="#cb326-31" aria-hidden="true" tabindex="-1"></a>units<span class="op">=</span>recurrent_hidden_units,</span>
<span id="cb326-32"><a href="#cb326-32" aria-hidden="true" tabindex="-1"></a>return_sequences<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb326-33"><a href="#cb326-33" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>input_shape,</span>
<span id="cb326-34"><a href="#cb326-34" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_dropout=0.8,</span></span>
<span id="cb326-35"><a href="#cb326-35" aria-hidden="true" tabindex="-1"></a>recurrent_regularizer<span class="op">=</span>regularizers.L2(L2),</span>
<span id="cb326-36"><a href="#cb326-36" aria-hidden="true" tabindex="-1"></a>activation<span class="op">=</span><span class="st">'relu'</span>)</span>
<span id="cb326-37"><a href="#cb326-37" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb326-38"><a href="#cb326-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb326-39"><a href="#cb326-39" aria-hidden="true" tabindex="-1"></a><span class="co"># NEED TO TAKE THE OUTPUT RNN AND CONVERT TO SCALAR</span></span>
<span id="cb326-40"><a href="#cb326-40" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span><span class="st">'linear'</span>))</span>
<span id="cb326-41"><a href="#cb326-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb326-42"><a href="#cb326-42" aria-hidden="true" tabindex="-1"></a><span class="co"># MODEL SUMMARY</span></span>
<span id="cb326-43"><a href="#cb326-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())<span class="op">;</span> <span class="co">#print(x_train.shape,y_train.shape)</span></span>
<span id="cb326-44"><a href="#cb326-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb326-45"><a href="#cb326-45" aria-hidden="true" tabindex="-1"></a><span class="co"># # COMPILING THE MODEL</span></span>
<span id="cb326-46"><a href="#cb326-46" aria-hidden="true" tabindex="-1"></a>opt <span class="op">=</span> keras.optimizers.RMSprop(learning_rate<span class="op">=</span>learning_rate)</span>
<span id="cb326-47"><a href="#cb326-47" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>opt, loss<span class="op">=</span>loss_function)</span>
<span id="cb326-48"><a href="#cb326-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb326-49"><a href="#cb326-49" aria-hidden="true" tabindex="-1"></a><span class="co"># TRAINING YOUR MODEL</span></span>
<span id="cb326-50"><a href="#cb326-50" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(</span>
<span id="cb326-51"><a href="#cb326-51" aria-hidden="true" tabindex="-1"></a>    Xt_consump,</span>
<span id="cb326-52"><a href="#cb326-52" aria-hidden="true" tabindex="-1"></a>    Yt_consump,</span>
<span id="cb326-53"><a href="#cb326-53" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span>numbers_epochs,</span>
<span id="cb326-54"><a href="#cb326-54" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span>batch_size,</span>
<span id="cb326-55"><a href="#cb326-55" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb326-56"><a href="#cb326-56" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>(Xv_consump, Yv_consump),</span>
<span id="cb326-57"><a href="#cb326-57" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb326-58"><a href="#cb326-58" aria-hidden="true" tabindex="-1"></a><span class="co"># History plot</span></span>
<span id="cb326-59"><a href="#cb326-59" aria-hidden="true" tabindex="-1"></a>history_plot(history)</span>
<span id="cb326-60"><a href="#cb326-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb326-61"><a href="#cb326-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb326-62"><a href="#cb326-62" aria-hidden="true" tabindex="-1"></a>Ytp_consump <span class="op">=</span> model.predict(Xt_consump)</span>
<span id="cb326-63"><a href="#cb326-63" aria-hidden="true" tabindex="-1"></a>Yvp_consump <span class="op">=</span> model.predict(Xv_consump)</span>
<span id="cb326-64"><a href="#cb326-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb326-65"><a href="#cb326-65" aria-hidden="true" tabindex="-1"></a><span class="co"># REPORT</span></span>
<span id="cb326-66"><a href="#cb326-66" aria-hidden="true" tabindex="-1"></a>regression_report(Yt_consump, Ytp_consump, Yv_consump, Yvp_consump)</span>
<span id="cb326-67"><a href="#cb326-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb326-68"><a href="#cb326-68" aria-hidden="true" tabindex="-1"></a><span class="co"># compute RMSE using numpy</span></span>
<span id="cb326-69"><a href="#cb326-69" aria-hidden="true" tabindex="-1"></a>training_RMSE_consump <span class="op">=</span> np.sqrt(mean_squared_error(Yt_consump, Ytp_consump))</span>
<span id="cb326-70"><a href="#cb326-70" aria-hidden="true" tabindex="-1"></a>validation_RMSE_consump <span class="op">=</span> np.sqrt(mean_squared_error(Yv_consump, Yvp_consump))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(157, 5, 1) --&gt; (157, 1)
(49, 5, 1) --&gt; (49, 1)
Model: "sequential_36"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 lstm_8 (LSTM)               (None, 32)                4352      
                                                                 
 dense_36 (Dense)            (None, 1)                 33        
                                                                 
=================================================================
Total params: 4385 (17.13 KB)
Trainable params: 4385 (17.13 KB)
Non-trainable params: 0 (0.00 Byte)
_________________________________________________________________
None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-125-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>5/5 [==============================] - 0s 4ms/step
2/2 [==============================] - 0s 7ms/step
---------- Regression report ----------
TRAINING:
 MSE: 0.2747615144003193
 MAE: 0.4093043864536077</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-125-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-125-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>VALIDATION:
 MSE: 1.2416227791187402
 MAE: 0.896378661044941</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-125-output-7.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-125-output-8.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Error Summary</strong></p>
<div class="cell" data-outputid="32567c98-6909-4853-b4a5-ccadd73d2a13" data-execution_count="127">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb330"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb330-1"><a href="#cb330-1" aria-hidden="true" tabindex="-1"></a>error_table_consump_lstm_l2 <span class="op">=</span> [[<span class="st">'Model'</span>,<span class="st">'train_MSE'</span>,<span class="st">'train_MAE'</span>,<span class="st">'train_RMSE'</span>,<span class="st">'val_MSE'</span>,<span class="st">'val_MAE'</span>,<span class="st">'val_RMSE'</span>],</span>
<span id="cb330-2"><a href="#cb330-2" aria-hidden="true" tabindex="-1"></a>              [<span class="st">'LSTM(L2 Reg)'</span>,</span>
<span id="cb330-3"><a href="#cb330-3" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yt_consump, Ytp_consump),</span>
<span id="cb330-4"><a href="#cb330-4" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yt_consump, Ytp_consump),</span>
<span id="cb330-5"><a href="#cb330-5" aria-hidden="true" tabindex="-1"></a>              training_RMSE_consump,</span>
<span id="cb330-6"><a href="#cb330-6" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yv_consump, Yvp_consump),</span>
<span id="cb330-7"><a href="#cb330-7" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yv_consump, Yvp_consump),</span>
<span id="cb330-8"><a href="#cb330-8" aria-hidden="true" tabindex="-1"></a>               validation_RMSE_consump]]</span>
<span id="cb330-9"><a href="#cb330-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(error_table_consump_lstm_l2, headers<span class="op">=</span><span class="st">'firstrow'</span>, tablefmt<span class="op">=</span><span class="st">'fancy_grid'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>╒══════════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model        │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞══════════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ LSTM(L2 Reg) │    0.274762 │    0.409304 │     0.524177 │   1.24162 │  0.896379 │    1.11428 │
╘══════════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
</div>
<div id="tabset-12-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-12-3-tab">
<div class="cell" data-outputid="cd44f1db-1fd6-4bee-fa23-097630979861" data-execution_count="128">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb332"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb332-1"><a href="#cb332-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW SIZES</span></span>
<span id="cb332-2"><a href="#cb332-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xt_prod.shape, <span class="st">"--&gt;"</span>, Yt_prod.shape)</span>
<span id="cb332-3"><a href="#cb332-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xv_prod.shape, <span class="st">"--&gt;"</span>, Yv_prod.shape)</span>
<span id="cb332-4"><a href="#cb332-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb332-5"><a href="#cb332-5" aria-hidden="true" tabindex="-1"></a><span class="co"># HYPERPARAMETERS</span></span>
<span id="cb332-6"><a href="#cb332-6" aria-hidden="true" tabindex="-1"></a>optimizer<span class="op">=</span><span class="st">"rmsprop"</span></span>
<span id="cb332-7"><a href="#cb332-7" aria-hidden="true" tabindex="-1"></a>loss_function<span class="op">=</span><span class="st">"MeanSquaredError"</span></span>
<span id="cb332-8"><a href="#cb332-8" aria-hidden="true" tabindex="-1"></a>learning_rate<span class="op">=</span><span class="fl">0.001</span></span>
<span id="cb332-9"><a href="#cb332-9" aria-hidden="true" tabindex="-1"></a>numbers_epochs<span class="op">=</span><span class="dv">200</span> <span class="co">#100</span></span>
<span id="cb332-10"><a href="#cb332-10" aria-hidden="true" tabindex="-1"></a>L2<span class="op">=</span><span class="fl">1e-4</span></span>
<span id="cb332-11"><a href="#cb332-11" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>(Xt_prod.shape[<span class="dv">1</span>],Xt_prod.shape[<span class="dv">2</span>])</span>
<span id="cb332-12"><a href="#cb332-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb332-13"><a href="#cb332-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb332-14"><a href="#cb332-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ------ Choose the batch size ------</span></span>
<span id="cb332-15"><a href="#cb332-15" aria-hidden="true" tabindex="-1"></a><span class="co"># batch_size=1                       # stocastic training</span></span>
<span id="cb332-16"><a href="#cb332-16" aria-hidden="true" tabindex="-1"></a><span class="co"># # batch_size=int(len(x_train)/2.)    # mini-batch training</span></span>
<span id="cb332-17"><a href="#cb332-17" aria-hidden="true" tabindex="-1"></a>batch_size<span class="op">=</span><span class="bu">len</span>(Xt1_prod)              <span class="co"># batch training</span></span>
<span id="cb332-18"><a href="#cb332-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb332-19"><a href="#cb332-19" aria-hidden="true" tabindex="-1"></a><span class="co"># BUILD MODEL</span></span>
<span id="cb332-20"><a href="#cb332-20" aria-hidden="true" tabindex="-1"></a>recurrent_hidden_units<span class="op">=</span><span class="dv">32</span></span>
<span id="cb332-21"><a href="#cb332-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb332-22"><a href="#cb332-22" aria-hidden="true" tabindex="-1"></a><span class="co"># CREATE MODEL</span></span>
<span id="cb332-23"><a href="#cb332-23" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> keras.Sequential()</span>
<span id="cb332-24"><a href="#cb332-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb332-25"><a href="#cb332-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ADD RECURRENT LAYER</span></span>
<span id="cb332-26"><a href="#cb332-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb332-27"><a href="#cb332-27" aria-hidden="true" tabindex="-1"></a><span class="co"># #COMMENT/UNCOMMENT TO USE RNN, LSTM,GRU</span></span>
<span id="cb332-28"><a href="#cb332-28" aria-hidden="true" tabindex="-1"></a>model.add(LSTM(</span>
<span id="cb332-29"><a href="#cb332-29" aria-hidden="true" tabindex="-1"></a><span class="co"># model.add(GRU(</span></span>
<span id="cb332-30"><a href="#cb332-30" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(SimpleRNN(</span></span>
<span id="cb332-31"><a href="#cb332-31" aria-hidden="true" tabindex="-1"></a>units<span class="op">=</span>recurrent_hidden_units,</span>
<span id="cb332-32"><a href="#cb332-32" aria-hidden="true" tabindex="-1"></a>return_sequences<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb332-33"><a href="#cb332-33" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>input_shape,</span>
<span id="cb332-34"><a href="#cb332-34" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_dropout=0.8,</span></span>
<span id="cb332-35"><a href="#cb332-35" aria-hidden="true" tabindex="-1"></a>recurrent_regularizer<span class="op">=</span>regularizers.L2(L2),</span>
<span id="cb332-36"><a href="#cb332-36" aria-hidden="true" tabindex="-1"></a>activation<span class="op">=</span><span class="st">'relu'</span>)</span>
<span id="cb332-37"><a href="#cb332-37" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb332-38"><a href="#cb332-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb332-39"><a href="#cb332-39" aria-hidden="true" tabindex="-1"></a><span class="co"># NEED TO TAKE THE OUTPUT RNN AND CONVERT TO SCALAR</span></span>
<span id="cb332-40"><a href="#cb332-40" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span><span class="st">'linear'</span>))</span>
<span id="cb332-41"><a href="#cb332-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb332-42"><a href="#cb332-42" aria-hidden="true" tabindex="-1"></a><span class="co"># MODEL SUMMARY</span></span>
<span id="cb332-43"><a href="#cb332-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())<span class="op">;</span> <span class="co">#print(x_train.shape,y_train.shape)</span></span>
<span id="cb332-44"><a href="#cb332-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb332-45"><a href="#cb332-45" aria-hidden="true" tabindex="-1"></a><span class="co"># # COMPILING THE MODEL</span></span>
<span id="cb332-46"><a href="#cb332-46" aria-hidden="true" tabindex="-1"></a>opt <span class="op">=</span> keras.optimizers.RMSprop(learning_rate<span class="op">=</span>learning_rate)</span>
<span id="cb332-47"><a href="#cb332-47" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>opt, loss<span class="op">=</span>loss_function)</span>
<span id="cb332-48"><a href="#cb332-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb332-49"><a href="#cb332-49" aria-hidden="true" tabindex="-1"></a><span class="co"># TRAINING YOUR MODEL</span></span>
<span id="cb332-50"><a href="#cb332-50" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(</span>
<span id="cb332-51"><a href="#cb332-51" aria-hidden="true" tabindex="-1"></a>    Xt_prod,</span>
<span id="cb332-52"><a href="#cb332-52" aria-hidden="true" tabindex="-1"></a>    Yt_prod,</span>
<span id="cb332-53"><a href="#cb332-53" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span>numbers_epochs,</span>
<span id="cb332-54"><a href="#cb332-54" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span>batch_size,</span>
<span id="cb332-55"><a href="#cb332-55" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb332-56"><a href="#cb332-56" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>(Xv_prod, Yv_prod),</span>
<span id="cb332-57"><a href="#cb332-57" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb332-58"><a href="#cb332-58" aria-hidden="true" tabindex="-1"></a><span class="co"># History plot</span></span>
<span id="cb332-59"><a href="#cb332-59" aria-hidden="true" tabindex="-1"></a>history_plot(history)</span>
<span id="cb332-60"><a href="#cb332-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb332-61"><a href="#cb332-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb332-62"><a href="#cb332-62" aria-hidden="true" tabindex="-1"></a>Ytp_prod <span class="op">=</span> model.predict(Xt_prod)</span>
<span id="cb332-63"><a href="#cb332-63" aria-hidden="true" tabindex="-1"></a>Yvp_prod <span class="op">=</span> model.predict(Xv_prod)</span>
<span id="cb332-64"><a href="#cb332-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb332-65"><a href="#cb332-65" aria-hidden="true" tabindex="-1"></a><span class="co"># REPORT</span></span>
<span id="cb332-66"><a href="#cb332-66" aria-hidden="true" tabindex="-1"></a>regression_report(Yt_prod, Ytp_prod, Yv_prod, Yvp_prod)</span>
<span id="cb332-67"><a href="#cb332-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb332-68"><a href="#cb332-68" aria-hidden="true" tabindex="-1"></a><span class="co"># compute RMSE using numpy</span></span>
<span id="cb332-69"><a href="#cb332-69" aria-hidden="true" tabindex="-1"></a>training_RMSE_prod <span class="op">=</span> np.sqrt(mean_squared_error(Yt_prod, Ytp_prod))</span>
<span id="cb332-70"><a href="#cb332-70" aria-hidden="true" tabindex="-1"></a>validation_RMSE_prod <span class="op">=</span> np.sqrt(mean_squared_error(Yv_prod, Yvp_prod))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(157, 5, 1) --&gt; (157, 1)
(49, 5, 1) --&gt; (49, 1)
Model: "sequential_37"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 lstm_9 (LSTM)               (None, 32)                4352      
                                                                 
 dense_37 (Dense)            (None, 1)                 33        
                                                                 
=================================================================
Total params: 4385 (17.13 KB)
Trainable params: 4385 (17.13 KB)
Non-trainable params: 0 (0.00 Byte)
_________________________________________________________________
None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-127-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>5/5 [==============================] - 0s 5ms/step
2/2 [==============================] - 0s 11ms/step
---------- Regression report ----------
TRAINING:
 MSE: 0.02313670990047248
 MAE: 0.11270792557147112</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-127-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-127-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>VALIDATION:
 MSE: 0.09841399937359264
 MAE: 0.28298587442587786</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-127-output-7.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-127-output-8.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Error Summary</strong></p>
<div class="cell" data-outputid="1f13ebf4-8fcd-4879-f204-297b8d6013d7" data-execution_count="129">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb336"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb336-1"><a href="#cb336-1" aria-hidden="true" tabindex="-1"></a>error_table_prod_lstm_l2 <span class="op">=</span> [[<span class="st">'Model'</span>,<span class="st">'train_MSE'</span>,<span class="st">'train_MAE'</span>,<span class="st">'train_RMSE'</span>,<span class="st">'val_MSE'</span>,<span class="st">'val_MAE'</span>,<span class="st">'val_RMSE'</span>],</span>
<span id="cb336-2"><a href="#cb336-2" aria-hidden="true" tabindex="-1"></a>              [<span class="st">'LSTM(L2 Reg)'</span>,</span>
<span id="cb336-3"><a href="#cb336-3" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yt_prod, Ytp_prod),</span>
<span id="cb336-4"><a href="#cb336-4" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yt_prod, Ytp_prod),</span>
<span id="cb336-5"><a href="#cb336-5" aria-hidden="true" tabindex="-1"></a>              training_RMSE_prod,</span>
<span id="cb336-6"><a href="#cb336-6" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yv_prod, Yvp_prod),</span>
<span id="cb336-7"><a href="#cb336-7" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yv_prod, Yvp_prod),</span>
<span id="cb336-8"><a href="#cb336-8" aria-hidden="true" tabindex="-1"></a>               validation_RMSE_prod]]</span>
<span id="cb336-9"><a href="#cb336-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(error_table_prod_lstm_l2, headers<span class="op">=</span><span class="st">'firstrow'</span>, tablefmt<span class="op">=</span><span class="st">'fancy_grid'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>╒══════════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model        │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞══════════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ LSTM(L2 Reg) │   0.0231367 │    0.112708 │     0.152108 │  0.098414 │  0.282986 │    0.31371 │
╘══════════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
</div>
<div id="tabset-12-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-12-4-tab">
<div class="cell" data-outputid="0633b389-e5f2-462a-b362-b411d764e4d4" data-execution_count="130">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb338"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb338-1"><a href="#cb338-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW SIZES</span></span>
<span id="cb338-2"><a href="#cb338-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xt_imp.shape, <span class="st">"--&gt;"</span>, Yt_imp.shape)</span>
<span id="cb338-3"><a href="#cb338-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xv_imp.shape, <span class="st">"--&gt;"</span>, Yv_imp.shape)</span>
<span id="cb338-4"><a href="#cb338-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb338-5"><a href="#cb338-5" aria-hidden="true" tabindex="-1"></a><span class="co"># HYPERPARAMETERS</span></span>
<span id="cb338-6"><a href="#cb338-6" aria-hidden="true" tabindex="-1"></a>optimizer<span class="op">=</span><span class="st">"rmsprop"</span></span>
<span id="cb338-7"><a href="#cb338-7" aria-hidden="true" tabindex="-1"></a>loss_function<span class="op">=</span><span class="st">"MeanSquaredError"</span></span>
<span id="cb338-8"><a href="#cb338-8" aria-hidden="true" tabindex="-1"></a>learning_rate<span class="op">=</span><span class="fl">0.001</span></span>
<span id="cb338-9"><a href="#cb338-9" aria-hidden="true" tabindex="-1"></a>numbers_epochs<span class="op">=</span><span class="dv">200</span> <span class="co">#100</span></span>
<span id="cb338-10"><a href="#cb338-10" aria-hidden="true" tabindex="-1"></a>L2<span class="op">=</span><span class="fl">1e-4</span></span>
<span id="cb338-11"><a href="#cb338-11" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>(Xt_imp.shape[<span class="dv">1</span>],Xt_imp.shape[<span class="dv">2</span>])</span>
<span id="cb338-12"><a href="#cb338-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb338-13"><a href="#cb338-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb338-14"><a href="#cb338-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ------ Choose the batch size ------</span></span>
<span id="cb338-15"><a href="#cb338-15" aria-hidden="true" tabindex="-1"></a><span class="co"># batch_size=1                       # stocastic training</span></span>
<span id="cb338-16"><a href="#cb338-16" aria-hidden="true" tabindex="-1"></a><span class="co"># # batch_size=int(len(x_train)/2.)    # mini-batch training</span></span>
<span id="cb338-17"><a href="#cb338-17" aria-hidden="true" tabindex="-1"></a>batch_size<span class="op">=</span><span class="bu">len</span>(Xt1_imp)              <span class="co"># batch training</span></span>
<span id="cb338-18"><a href="#cb338-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb338-19"><a href="#cb338-19" aria-hidden="true" tabindex="-1"></a><span class="co"># BUILD MODEL</span></span>
<span id="cb338-20"><a href="#cb338-20" aria-hidden="true" tabindex="-1"></a>recurrent_hidden_units<span class="op">=</span><span class="dv">32</span></span>
<span id="cb338-21"><a href="#cb338-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb338-22"><a href="#cb338-22" aria-hidden="true" tabindex="-1"></a><span class="co"># CREATE MODEL</span></span>
<span id="cb338-23"><a href="#cb338-23" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> keras.Sequential()</span>
<span id="cb338-24"><a href="#cb338-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb338-25"><a href="#cb338-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ADD RECURRENT LAYER</span></span>
<span id="cb338-26"><a href="#cb338-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb338-27"><a href="#cb338-27" aria-hidden="true" tabindex="-1"></a><span class="co"># #COMMENT/UNCOMMENT TO USE RNN, LSTM,GRU</span></span>
<span id="cb338-28"><a href="#cb338-28" aria-hidden="true" tabindex="-1"></a>model.add(LSTM(</span>
<span id="cb338-29"><a href="#cb338-29" aria-hidden="true" tabindex="-1"></a><span class="co"># model.add(GRU(</span></span>
<span id="cb338-30"><a href="#cb338-30" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(SimpleRNN(</span></span>
<span id="cb338-31"><a href="#cb338-31" aria-hidden="true" tabindex="-1"></a>units<span class="op">=</span>recurrent_hidden_units,</span>
<span id="cb338-32"><a href="#cb338-32" aria-hidden="true" tabindex="-1"></a>return_sequences<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb338-33"><a href="#cb338-33" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>input_shape,</span>
<span id="cb338-34"><a href="#cb338-34" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_dropout=0.8,</span></span>
<span id="cb338-35"><a href="#cb338-35" aria-hidden="true" tabindex="-1"></a>recurrent_regularizer<span class="op">=</span>regularizers.L2(L2),</span>
<span id="cb338-36"><a href="#cb338-36" aria-hidden="true" tabindex="-1"></a>activation<span class="op">=</span><span class="st">'relu'</span>)</span>
<span id="cb338-37"><a href="#cb338-37" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb338-38"><a href="#cb338-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb338-39"><a href="#cb338-39" aria-hidden="true" tabindex="-1"></a><span class="co"># NEED TO TAKE THE OUTPUT RNN AND CONVERT TO SCALAR</span></span>
<span id="cb338-40"><a href="#cb338-40" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span><span class="st">'linear'</span>))</span>
<span id="cb338-41"><a href="#cb338-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb338-42"><a href="#cb338-42" aria-hidden="true" tabindex="-1"></a><span class="co"># MODEL SUMMARY</span></span>
<span id="cb338-43"><a href="#cb338-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())<span class="op">;</span> <span class="co">#print(x_train.shape,y_train.shape)</span></span>
<span id="cb338-44"><a href="#cb338-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb338-45"><a href="#cb338-45" aria-hidden="true" tabindex="-1"></a><span class="co"># # COMPILING THE MODEL</span></span>
<span id="cb338-46"><a href="#cb338-46" aria-hidden="true" tabindex="-1"></a>opt <span class="op">=</span> keras.optimizers.RMSprop(learning_rate<span class="op">=</span>learning_rate)</span>
<span id="cb338-47"><a href="#cb338-47" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>opt, loss<span class="op">=</span>loss_function)</span>
<span id="cb338-48"><a href="#cb338-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb338-49"><a href="#cb338-49" aria-hidden="true" tabindex="-1"></a><span class="co"># TRAINING YOUR MODEL</span></span>
<span id="cb338-50"><a href="#cb338-50" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(</span>
<span id="cb338-51"><a href="#cb338-51" aria-hidden="true" tabindex="-1"></a>    Xt_imp,</span>
<span id="cb338-52"><a href="#cb338-52" aria-hidden="true" tabindex="-1"></a>    Yt_imp,</span>
<span id="cb338-53"><a href="#cb338-53" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span>numbers_epochs,</span>
<span id="cb338-54"><a href="#cb338-54" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span>batch_size,</span>
<span id="cb338-55"><a href="#cb338-55" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb338-56"><a href="#cb338-56" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>(Xv_imp, Yv_imp),</span>
<span id="cb338-57"><a href="#cb338-57" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb338-58"><a href="#cb338-58" aria-hidden="true" tabindex="-1"></a><span class="co"># History plot</span></span>
<span id="cb338-59"><a href="#cb338-59" aria-hidden="true" tabindex="-1"></a>history_plot(history)</span>
<span id="cb338-60"><a href="#cb338-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb338-61"><a href="#cb338-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb338-62"><a href="#cb338-62" aria-hidden="true" tabindex="-1"></a>Ytp_imp <span class="op">=</span> model.predict(Xt_imp)</span>
<span id="cb338-63"><a href="#cb338-63" aria-hidden="true" tabindex="-1"></a>Yvp_imp <span class="op">=</span> model.predict(Xv_imp)</span>
<span id="cb338-64"><a href="#cb338-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb338-65"><a href="#cb338-65" aria-hidden="true" tabindex="-1"></a><span class="co"># REPORT</span></span>
<span id="cb338-66"><a href="#cb338-66" aria-hidden="true" tabindex="-1"></a>regression_report(Yt_imp, Ytp_imp, Yv_imp, Yvp_imp)</span>
<span id="cb338-67"><a href="#cb338-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb338-68"><a href="#cb338-68" aria-hidden="true" tabindex="-1"></a><span class="co"># compute RMSE using numpy</span></span>
<span id="cb338-69"><a href="#cb338-69" aria-hidden="true" tabindex="-1"></a>training_RMSE_imp <span class="op">=</span> np.sqrt(mean_squared_error(Yt_imp, Ytp_imp))</span>
<span id="cb338-70"><a href="#cb338-70" aria-hidden="true" tabindex="-1"></a>validation_RMSE_imp <span class="op">=</span> np.sqrt(mean_squared_error(Yv_imp, Yvp_imp))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(229, 5, 1) --&gt; (229, 1)
(73, 5, 1) --&gt; (73, 1)
Model: "sequential_38"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 lstm_10 (LSTM)              (None, 32)                4352      
                                                                 
 dense_38 (Dense)            (None, 1)                 33        
                                                                 
=================================================================
Total params: 4385 (17.13 KB)
Trainable params: 4385 (17.13 KB)
Non-trainable params: 0 (0.00 Byte)
_________________________________________________________________
None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-129-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>8/8 [==============================] - 0s 4ms/step
3/3 [==============================] - 0s 7ms/step
---------- Regression report ----------
TRAINING:
 MSE: 0.1936177343659908
 MAE: 0.3472881397126535</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-129-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-129-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>VALIDATION:
 MSE: 0.22782918880664482
 MAE: 0.37552213994911376</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-129-output-7.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-129-output-8.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Error Summary</strong></p>
<div class="cell" data-outputid="fc33685a-daf6-407a-9635-5aa02072988f" data-execution_count="131">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb342"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb342-1"><a href="#cb342-1" aria-hidden="true" tabindex="-1"></a>error_table_imp_lstm_l2 <span class="op">=</span> [[<span class="st">'Model'</span>,<span class="st">'train_MSE'</span>,<span class="st">'train_MAE'</span>,<span class="st">'train_RMSE'</span>,<span class="st">'val_MSE'</span>,<span class="st">'val_MAE'</span>,<span class="st">'val_RMSE'</span>],</span>
<span id="cb342-2"><a href="#cb342-2" aria-hidden="true" tabindex="-1"></a>              [<span class="st">'LSTM(L2 Reg)'</span>,</span>
<span id="cb342-3"><a href="#cb342-3" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yt_imp, Ytp_imp),</span>
<span id="cb342-4"><a href="#cb342-4" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yt_imp, Ytp_imp),</span>
<span id="cb342-5"><a href="#cb342-5" aria-hidden="true" tabindex="-1"></a>               training_RMSE_imp,</span>
<span id="cb342-6"><a href="#cb342-6" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yv_imp, Yvp_imp),</span>
<span id="cb342-7"><a href="#cb342-7" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yv_imp, Yvp_imp),</span>
<span id="cb342-8"><a href="#cb342-8" aria-hidden="true" tabindex="-1"></a>               validation_RMSE_imp]]</span>
<span id="cb342-9"><a href="#cb342-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(error_table_imp_lstm_l2, headers<span class="op">=</span><span class="st">'firstrow'</span>, tablefmt<span class="op">=</span><span class="st">'fancy_grid'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>╒══════════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model        │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞══════════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ LSTM(L2 Reg) │    0.193618 │    0.347288 │      0.44002 │  0.227829 │  0.375522 │   0.477315 │
╘══════════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
</div>
<div id="tabset-12-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-12-5-tab">
<div class="cell" data-outputid="a258421e-5204-462a-f8fe-971735fc6ec8" data-execution_count="132">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb344"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb344-1"><a href="#cb344-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW SIZES</span></span>
<span id="cb344-2"><a href="#cb344-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xt_exp.shape, <span class="st">"--&gt;"</span>, Yt_exp.shape)</span>
<span id="cb344-3"><a href="#cb344-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xv_exp.shape, <span class="st">"--&gt;"</span>, Yv_exp.shape)</span>
<span id="cb344-4"><a href="#cb344-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb344-5"><a href="#cb344-5" aria-hidden="true" tabindex="-1"></a><span class="co"># HYPERPARAMETERS</span></span>
<span id="cb344-6"><a href="#cb344-6" aria-hidden="true" tabindex="-1"></a>optimizer<span class="op">=</span><span class="st">"rmsprop"</span></span>
<span id="cb344-7"><a href="#cb344-7" aria-hidden="true" tabindex="-1"></a>loss_function<span class="op">=</span><span class="st">"MeanSquaredError"</span></span>
<span id="cb344-8"><a href="#cb344-8" aria-hidden="true" tabindex="-1"></a>learning_rate<span class="op">=</span><span class="fl">0.001</span></span>
<span id="cb344-9"><a href="#cb344-9" aria-hidden="true" tabindex="-1"></a>numbers_epochs<span class="op">=</span><span class="dv">200</span> <span class="co">#100</span></span>
<span id="cb344-10"><a href="#cb344-10" aria-hidden="true" tabindex="-1"></a>L2<span class="op">=</span><span class="fl">1e-4</span></span>
<span id="cb344-11"><a href="#cb344-11" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>(Xt_exp.shape[<span class="dv">1</span>],Xt_exp.shape[<span class="dv">2</span>])</span>
<span id="cb344-12"><a href="#cb344-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb344-13"><a href="#cb344-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb344-14"><a href="#cb344-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ------ Choose the batch size ------</span></span>
<span id="cb344-15"><a href="#cb344-15" aria-hidden="true" tabindex="-1"></a><span class="co"># batch_size=1                       # stocastic training</span></span>
<span id="cb344-16"><a href="#cb344-16" aria-hidden="true" tabindex="-1"></a><span class="co"># # batch_size=int(len(x_train)/2.)    # mini-batch training</span></span>
<span id="cb344-17"><a href="#cb344-17" aria-hidden="true" tabindex="-1"></a>batch_size<span class="op">=</span><span class="bu">len</span>(Xt1_exp)              <span class="co"># batch training</span></span>
<span id="cb344-18"><a href="#cb344-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb344-19"><a href="#cb344-19" aria-hidden="true" tabindex="-1"></a><span class="co"># BUILD MODEL</span></span>
<span id="cb344-20"><a href="#cb344-20" aria-hidden="true" tabindex="-1"></a>recurrent_hidden_units<span class="op">=</span><span class="dv">32</span></span>
<span id="cb344-21"><a href="#cb344-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb344-22"><a href="#cb344-22" aria-hidden="true" tabindex="-1"></a><span class="co"># CREATE MODEL</span></span>
<span id="cb344-23"><a href="#cb344-23" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> keras.Sequential()</span>
<span id="cb344-24"><a href="#cb344-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb344-25"><a href="#cb344-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ADD RECURRENT LAYER</span></span>
<span id="cb344-26"><a href="#cb344-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb344-27"><a href="#cb344-27" aria-hidden="true" tabindex="-1"></a><span class="co"># #COMMENT/UNCOMMENT TO USE RNN, LSTM,GRU</span></span>
<span id="cb344-28"><a href="#cb344-28" aria-hidden="true" tabindex="-1"></a>model.add(LSTM(</span>
<span id="cb344-29"><a href="#cb344-29" aria-hidden="true" tabindex="-1"></a><span class="co"># model.add(GRU(</span></span>
<span id="cb344-30"><a href="#cb344-30" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(SimpleRNN(</span></span>
<span id="cb344-31"><a href="#cb344-31" aria-hidden="true" tabindex="-1"></a>units<span class="op">=</span>recurrent_hidden_units,</span>
<span id="cb344-32"><a href="#cb344-32" aria-hidden="true" tabindex="-1"></a>return_sequences<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb344-33"><a href="#cb344-33" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>input_shape,</span>
<span id="cb344-34"><a href="#cb344-34" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_dropout=0.8,</span></span>
<span id="cb344-35"><a href="#cb344-35" aria-hidden="true" tabindex="-1"></a>recurrent_regularizer<span class="op">=</span>regularizers.L2(L2),</span>
<span id="cb344-36"><a href="#cb344-36" aria-hidden="true" tabindex="-1"></a>activation<span class="op">=</span><span class="st">'relu'</span>)</span>
<span id="cb344-37"><a href="#cb344-37" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb344-38"><a href="#cb344-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb344-39"><a href="#cb344-39" aria-hidden="true" tabindex="-1"></a><span class="co"># NEED TO TAKE THE OUTPUT RNN AND CONVERT TO SCALAR</span></span>
<span id="cb344-40"><a href="#cb344-40" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span><span class="st">'linear'</span>))</span>
<span id="cb344-41"><a href="#cb344-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb344-42"><a href="#cb344-42" aria-hidden="true" tabindex="-1"></a><span class="co"># MODEL SUMMARY</span></span>
<span id="cb344-43"><a href="#cb344-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())<span class="op">;</span> <span class="co">#print(x_train.shape,y_train.shape)</span></span>
<span id="cb344-44"><a href="#cb344-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb344-45"><a href="#cb344-45" aria-hidden="true" tabindex="-1"></a><span class="co"># # COMPILING THE MODEL</span></span>
<span id="cb344-46"><a href="#cb344-46" aria-hidden="true" tabindex="-1"></a>opt <span class="op">=</span> keras.optimizers.RMSprop(learning_rate<span class="op">=</span>learning_rate)</span>
<span id="cb344-47"><a href="#cb344-47" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>opt, loss<span class="op">=</span>loss_function)</span>
<span id="cb344-48"><a href="#cb344-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb344-49"><a href="#cb344-49" aria-hidden="true" tabindex="-1"></a><span class="co"># TRAINING YOUR MODEL</span></span>
<span id="cb344-50"><a href="#cb344-50" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(</span>
<span id="cb344-51"><a href="#cb344-51" aria-hidden="true" tabindex="-1"></a>    Xt_exp,</span>
<span id="cb344-52"><a href="#cb344-52" aria-hidden="true" tabindex="-1"></a>    Yt_exp,</span>
<span id="cb344-53"><a href="#cb344-53" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span>numbers_epochs,</span>
<span id="cb344-54"><a href="#cb344-54" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span>batch_size,</span>
<span id="cb344-55"><a href="#cb344-55" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb344-56"><a href="#cb344-56" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>(Xv_exp, Yv_exp),</span>
<span id="cb344-57"><a href="#cb344-57" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb344-58"><a href="#cb344-58" aria-hidden="true" tabindex="-1"></a><span class="co"># History plot</span></span>
<span id="cb344-59"><a href="#cb344-59" aria-hidden="true" tabindex="-1"></a>history_plot(history)</span>
<span id="cb344-60"><a href="#cb344-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb344-61"><a href="#cb344-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb344-62"><a href="#cb344-62" aria-hidden="true" tabindex="-1"></a>Ytp_exp <span class="op">=</span> model.predict(Xt_exp)</span>
<span id="cb344-63"><a href="#cb344-63" aria-hidden="true" tabindex="-1"></a>Yvp_exp <span class="op">=</span> model.predict(Xv_exp)</span>
<span id="cb344-64"><a href="#cb344-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb344-65"><a href="#cb344-65" aria-hidden="true" tabindex="-1"></a><span class="co"># REPORT</span></span>
<span id="cb344-66"><a href="#cb344-66" aria-hidden="true" tabindex="-1"></a>regression_report(Yt_exp, Ytp_exp, Yv_exp, Yvp_exp)</span>
<span id="cb344-67"><a href="#cb344-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb344-68"><a href="#cb344-68" aria-hidden="true" tabindex="-1"></a><span class="co"># compute RMSE using numpy</span></span>
<span id="cb344-69"><a href="#cb344-69" aria-hidden="true" tabindex="-1"></a>training_RMSE_exp <span class="op">=</span> np.sqrt(mean_squared_error(Yt_exp, Ytp_exp))</span>
<span id="cb344-70"><a href="#cb344-70" aria-hidden="true" tabindex="-1"></a>validation_RMSE_exp <span class="op">=</span> np.sqrt(mean_squared_error(Yv_exp, Yvp_exp))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(229, 5, 1) --&gt; (229, 1)
(73, 5, 1) --&gt; (73, 1)
Model: "sequential_39"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 lstm_11 (LSTM)              (None, 32)                4352      
                                                                 
 dense_39 (Dense)            (None, 1)                 33        
                                                                 
=================================================================
Total params: 4385 (17.13 KB)
Trainable params: 4385 (17.13 KB)
Non-trainable params: 0 (0.00 Byte)
_________________________________________________________________
None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-131-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>8/8 [==============================] - 0s 3ms/step
3/3 [==============================] - 0s 4ms/step
---------- Regression report ----------
TRAINING:
 MSE: 0.006405860351627613
 MAE: 0.05985329218919866</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-131-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-131-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>VALIDATION:
 MSE: 2.236326883072915
 MAE: 1.305820683189038</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-131-output-7.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-131-output-8.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Error Summary</strong></p>
<div class="cell" data-outputid="1a94d34c-f766-4775-8cb0-6bbfc3f07114" data-execution_count="133">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb348"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb348-1"><a href="#cb348-1" aria-hidden="true" tabindex="-1"></a>error_table_exp_lstm_l2 <span class="op">=</span> [[<span class="st">'Model'</span>,<span class="st">'train_MSE'</span>,<span class="st">'train_MAE'</span>,<span class="st">'train_RMSE'</span>,<span class="st">'val_MSE'</span>,<span class="st">'val_MAE'</span>,<span class="st">'val_RMSE'</span>],</span>
<span id="cb348-2"><a href="#cb348-2" aria-hidden="true" tabindex="-1"></a>              [<span class="st">'LSTM(L2 Reg)'</span>,</span>
<span id="cb348-3"><a href="#cb348-3" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yt_exp, Ytp_exp),</span>
<span id="cb348-4"><a href="#cb348-4" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yt_exp, Ytp_exp),</span>
<span id="cb348-5"><a href="#cb348-5" aria-hidden="true" tabindex="-1"></a>               training_RMSE_exp,</span>
<span id="cb348-6"><a href="#cb348-6" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yv_exp, Yvp_exp),</span>
<span id="cb348-7"><a href="#cb348-7" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yv_exp, Yvp_exp),</span>
<span id="cb348-8"><a href="#cb348-8" aria-hidden="true" tabindex="-1"></a>               validation_RMSE_exp]]</span>
<span id="cb348-9"><a href="#cb348-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(error_table_exp_lstm_l2, headers<span class="op">=</span><span class="st">'firstrow'</span>, tablefmt<span class="op">=</span><span class="st">'fancy_grid'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>╒══════════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model        │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞══════════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ LSTM(L2 Reg) │  0.00640586 │   0.0598533 │    0.0800366 │   2.23633 │   1.30582 │    1.49544 │
╘══════════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
</div>
<div id="tabset-12-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-12-6-tab">
<div class="cell" data-outputid="1984904c-2ce0-4e82-cf64-74095673d805" data-execution_count="134">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb350"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb350-1"><a href="#cb350-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW SIZES</span></span>
<span id="cb350-2"><a href="#cb350-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xt_stk.shape, <span class="st">"--&gt;"</span>, Yt_stk.shape)</span>
<span id="cb350-3"><a href="#cb350-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xv_stk.shape, <span class="st">"--&gt;"</span>, Yv_stk.shape)</span>
<span id="cb350-4"><a href="#cb350-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb350-5"><a href="#cb350-5" aria-hidden="true" tabindex="-1"></a><span class="co"># HYPERPARAMETERS</span></span>
<span id="cb350-6"><a href="#cb350-6" aria-hidden="true" tabindex="-1"></a>optimizer<span class="op">=</span><span class="st">"rmsprop"</span></span>
<span id="cb350-7"><a href="#cb350-7" aria-hidden="true" tabindex="-1"></a>loss_function<span class="op">=</span><span class="st">"MeanSquaredError"</span></span>
<span id="cb350-8"><a href="#cb350-8" aria-hidden="true" tabindex="-1"></a>learning_rate<span class="op">=</span><span class="fl">0.001</span></span>
<span id="cb350-9"><a href="#cb350-9" aria-hidden="true" tabindex="-1"></a>numbers_epochs<span class="op">=</span><span class="dv">200</span> <span class="co">#100</span></span>
<span id="cb350-10"><a href="#cb350-10" aria-hidden="true" tabindex="-1"></a>L2<span class="op">=</span><span class="fl">1e-4</span></span>
<span id="cb350-11"><a href="#cb350-11" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>(Xt_stk.shape[<span class="dv">1</span>],Xt_stk.shape[<span class="dv">2</span>])</span>
<span id="cb350-12"><a href="#cb350-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb350-13"><a href="#cb350-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb350-14"><a href="#cb350-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ------ Choose the batch size ------</span></span>
<span id="cb350-15"><a href="#cb350-15" aria-hidden="true" tabindex="-1"></a><span class="co"># batch_size=1                       # stocastic training</span></span>
<span id="cb350-16"><a href="#cb350-16" aria-hidden="true" tabindex="-1"></a><span class="co"># # batch_size=int(len(x_train)/2.)    # mini-batch training</span></span>
<span id="cb350-17"><a href="#cb350-17" aria-hidden="true" tabindex="-1"></a>batch_size<span class="op">=</span><span class="bu">len</span>(Xt1_stk)              <span class="co"># batch training</span></span>
<span id="cb350-18"><a href="#cb350-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb350-19"><a href="#cb350-19" aria-hidden="true" tabindex="-1"></a><span class="co"># BUILD MODEL</span></span>
<span id="cb350-20"><a href="#cb350-20" aria-hidden="true" tabindex="-1"></a>recurrent_hidden_units<span class="op">=</span><span class="dv">32</span></span>
<span id="cb350-21"><a href="#cb350-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb350-22"><a href="#cb350-22" aria-hidden="true" tabindex="-1"></a><span class="co"># CREATE MODEL</span></span>
<span id="cb350-23"><a href="#cb350-23" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> keras.Sequential()</span>
<span id="cb350-24"><a href="#cb350-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb350-25"><a href="#cb350-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ADD RECURRENT LAYER</span></span>
<span id="cb350-26"><a href="#cb350-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb350-27"><a href="#cb350-27" aria-hidden="true" tabindex="-1"></a><span class="co"># #COMMENT/UNCOMMENT TO USE RNN, LSTM,GRU</span></span>
<span id="cb350-28"><a href="#cb350-28" aria-hidden="true" tabindex="-1"></a>model.add(LSTM(</span>
<span id="cb350-29"><a href="#cb350-29" aria-hidden="true" tabindex="-1"></a><span class="co"># model.add(GRU(</span></span>
<span id="cb350-30"><a href="#cb350-30" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(SimpleRNN(</span></span>
<span id="cb350-31"><a href="#cb350-31" aria-hidden="true" tabindex="-1"></a>units<span class="op">=</span>recurrent_hidden_units,</span>
<span id="cb350-32"><a href="#cb350-32" aria-hidden="true" tabindex="-1"></a>return_sequences<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb350-33"><a href="#cb350-33" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>input_shape,</span>
<span id="cb350-34"><a href="#cb350-34" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_dropout=0.8,</span></span>
<span id="cb350-35"><a href="#cb350-35" aria-hidden="true" tabindex="-1"></a>recurrent_regularizer<span class="op">=</span>regularizers.L2(L2),</span>
<span id="cb350-36"><a href="#cb350-36" aria-hidden="true" tabindex="-1"></a>activation<span class="op">=</span><span class="st">'relu'</span>)</span>
<span id="cb350-37"><a href="#cb350-37" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb350-38"><a href="#cb350-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb350-39"><a href="#cb350-39" aria-hidden="true" tabindex="-1"></a><span class="co"># NEED TO TAKE THE OUTPUT RNN AND CONVERT TO SCALAR</span></span>
<span id="cb350-40"><a href="#cb350-40" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span><span class="st">'linear'</span>))</span>
<span id="cb350-41"><a href="#cb350-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb350-42"><a href="#cb350-42" aria-hidden="true" tabindex="-1"></a><span class="co"># MODEL SUMMARY</span></span>
<span id="cb350-43"><a href="#cb350-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())<span class="op">;</span> <span class="co">#print(x_train.shape,y_train.shape)</span></span>
<span id="cb350-44"><a href="#cb350-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb350-45"><a href="#cb350-45" aria-hidden="true" tabindex="-1"></a><span class="co"># # COMPILING THE MODEL</span></span>
<span id="cb350-46"><a href="#cb350-46" aria-hidden="true" tabindex="-1"></a>opt <span class="op">=</span> keras.optimizers.RMSprop(learning_rate<span class="op">=</span>learning_rate)</span>
<span id="cb350-47"><a href="#cb350-47" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>opt, loss<span class="op">=</span>loss_function)</span>
<span id="cb350-48"><a href="#cb350-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb350-49"><a href="#cb350-49" aria-hidden="true" tabindex="-1"></a><span class="co"># TRAINING YOUR MODEL</span></span>
<span id="cb350-50"><a href="#cb350-50" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(</span>
<span id="cb350-51"><a href="#cb350-51" aria-hidden="true" tabindex="-1"></a>    Xt_stk,</span>
<span id="cb350-52"><a href="#cb350-52" aria-hidden="true" tabindex="-1"></a>    Yt_stk,</span>
<span id="cb350-53"><a href="#cb350-53" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span>numbers_epochs,</span>
<span id="cb350-54"><a href="#cb350-54" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span>batch_size,</span>
<span id="cb350-55"><a href="#cb350-55" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb350-56"><a href="#cb350-56" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>(Xv_stk, Yv_stk),</span>
<span id="cb350-57"><a href="#cb350-57" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb350-58"><a href="#cb350-58" aria-hidden="true" tabindex="-1"></a><span class="co"># History plot</span></span>
<span id="cb350-59"><a href="#cb350-59" aria-hidden="true" tabindex="-1"></a>history_plot(history)</span>
<span id="cb350-60"><a href="#cb350-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb350-61"><a href="#cb350-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb350-62"><a href="#cb350-62" aria-hidden="true" tabindex="-1"></a>Ytp_stk <span class="op">=</span> model.predict(Xt_stk)</span>
<span id="cb350-63"><a href="#cb350-63" aria-hidden="true" tabindex="-1"></a>Yvp_stk <span class="op">=</span> model.predict(Xv_stk)</span>
<span id="cb350-64"><a href="#cb350-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb350-65"><a href="#cb350-65" aria-hidden="true" tabindex="-1"></a><span class="co"># REPORT</span></span>
<span id="cb350-66"><a href="#cb350-66" aria-hidden="true" tabindex="-1"></a>regression_report(Yt_stk, Ytp_stk, Yv_stk, Yvp_stk)</span>
<span id="cb350-67"><a href="#cb350-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb350-68"><a href="#cb350-68" aria-hidden="true" tabindex="-1"></a><span class="co"># compute RMSE using numpy</span></span>
<span id="cb350-69"><a href="#cb350-69" aria-hidden="true" tabindex="-1"></a>training_RMSE_stk <span class="op">=</span> np.sqrt(mean_squared_error(Yt_stk, Ytp_stk))</span>
<span id="cb350-70"><a href="#cb350-70" aria-hidden="true" tabindex="-1"></a>validation_RMSE_stk <span class="op">=</span> np.sqrt(mean_squared_error(Yv_stk, Yvp_stk))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(3377, 5, 1) --&gt; (3377, 1)
(1123, 5, 1) --&gt; (1123, 1)
Model: "sequential_40"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 lstm_12 (LSTM)              (None, 32)                4352      
                                                                 
 dense_40 (Dense)            (None, 1)                 33        
                                                                 
=================================================================
Total params: 4385 (17.13 KB)
Trainable params: 4385 (17.13 KB)
Non-trainable params: 0 (0.00 Byte)
_________________________________________________________________
None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-133-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>106/106 [==============================] - 0s 2ms/step
36/36 [==============================] - 0s 2ms/step
---------- Regression report ----------
TRAINING:
 MSE: 0.002091984399747166
 MAE: 0.03466316595481215</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-133-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-133-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>VALIDATION:
 MSE: 0.373875263482317
 MAE: 0.2811309082041175</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-133-output-7.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-133-output-8.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Error Summary</strong></p>
<div class="cell" data-outputid="9568f17a-542b-4aba-ddb7-458a0b8283c3" data-execution_count="135">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb354"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb354-1"><a href="#cb354-1" aria-hidden="true" tabindex="-1"></a>error_table_stk_lstm_l2 <span class="op">=</span> [[<span class="st">'Model'</span>,<span class="st">'train_MSE'</span>,<span class="st">'train_MAE'</span>,<span class="st">'train_RMSE'</span>,<span class="st">'val_MSE'</span>,<span class="st">'val_MAE'</span>,<span class="st">'val_RMSE'</span>],</span>
<span id="cb354-2"><a href="#cb354-2" aria-hidden="true" tabindex="-1"></a>              [<span class="st">'LSTM(L2 Reg)'</span>,</span>
<span id="cb354-3"><a href="#cb354-3" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yt_stk, Ytp_stk),</span>
<span id="cb354-4"><a href="#cb354-4" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yt_stk, Ytp_stk),</span>
<span id="cb354-5"><a href="#cb354-5" aria-hidden="true" tabindex="-1"></a>               training_RMSE_stk,</span>
<span id="cb354-6"><a href="#cb354-6" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yv_stk, Yvp_stk),</span>
<span id="cb354-7"><a href="#cb354-7" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yv_stk, Yvp_stk),</span>
<span id="cb354-8"><a href="#cb354-8" aria-hidden="true" tabindex="-1"></a>               validation_RMSE_stk]]</span>
<span id="cb354-9"><a href="#cb354-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(error_table_stk_lstm_l2, headers<span class="op">=</span><span class="st">'firstrow'</span>, tablefmt<span class="op">=</span><span class="st">'fancy_grid'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>╒══════════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model        │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞══════════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ LSTM(L2 Reg) │  0.00209198 │   0.0346632 │    0.0457382 │  0.373875 │  0.281131 │   0.611453 │
╘══════════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
</div>
<div id="tabset-12-7" class="tab-pane" role="tabpanel" aria-labelledby="tabset-12-7-tab">
<div class="cell" data-outputid="eea7cb60-830e-44ca-e66b-5d39e40fe55d" data-execution_count="136">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb356"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb356-1"><a href="#cb356-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NEW SIZES</span></span>
<span id="cb356-2"><a href="#cb356-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xt_emissions.shape, <span class="st">"--&gt;"</span>, Yt_emissions.shape)</span>
<span id="cb356-3"><a href="#cb356-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Xv_emissions.shape, <span class="st">"--&gt;"</span>, Yv_emissions.shape)</span>
<span id="cb356-4"><a href="#cb356-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb356-5"><a href="#cb356-5" aria-hidden="true" tabindex="-1"></a><span class="co"># HYPERPARAMETERS</span></span>
<span id="cb356-6"><a href="#cb356-6" aria-hidden="true" tabindex="-1"></a>optimizer<span class="op">=</span><span class="st">"rmsprop"</span></span>
<span id="cb356-7"><a href="#cb356-7" aria-hidden="true" tabindex="-1"></a>loss_function<span class="op">=</span><span class="st">"MeanSquaredError"</span></span>
<span id="cb356-8"><a href="#cb356-8" aria-hidden="true" tabindex="-1"></a>learning_rate<span class="op">=</span><span class="fl">0.001</span></span>
<span id="cb356-9"><a href="#cb356-9" aria-hidden="true" tabindex="-1"></a>numbers_epochs<span class="op">=</span><span class="dv">200</span> <span class="co">#100</span></span>
<span id="cb356-10"><a href="#cb356-10" aria-hidden="true" tabindex="-1"></a>L2<span class="op">=</span> <span class="fl">1e-4</span></span>
<span id="cb356-11"><a href="#cb356-11" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>(Xt_emissions.shape[<span class="dv">1</span>],Xt_emissions.shape[<span class="dv">2</span>])</span>
<span id="cb356-12"><a href="#cb356-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb356-13"><a href="#cb356-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb356-14"><a href="#cb356-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ------ Choose the batch size ------</span></span>
<span id="cb356-15"><a href="#cb356-15" aria-hidden="true" tabindex="-1"></a><span class="co"># batch_size=1                       # stocastic training</span></span>
<span id="cb356-16"><a href="#cb356-16" aria-hidden="true" tabindex="-1"></a><span class="co"># # batch_size=int(len(x_train)/2.)    # mini-batch training</span></span>
<span id="cb356-17"><a href="#cb356-17" aria-hidden="true" tabindex="-1"></a>batch_size<span class="op">=</span><span class="bu">len</span>(Xt1_emissions)              <span class="co"># batch training</span></span>
<span id="cb356-18"><a href="#cb356-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb356-19"><a href="#cb356-19" aria-hidden="true" tabindex="-1"></a><span class="co"># BUILD MODEL</span></span>
<span id="cb356-20"><a href="#cb356-20" aria-hidden="true" tabindex="-1"></a>recurrent_hidden_units<span class="op">=</span><span class="dv">32</span></span>
<span id="cb356-21"><a href="#cb356-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb356-22"><a href="#cb356-22" aria-hidden="true" tabindex="-1"></a><span class="co"># CREATE MODEL</span></span>
<span id="cb356-23"><a href="#cb356-23" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> keras.Sequential()</span>
<span id="cb356-24"><a href="#cb356-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb356-25"><a href="#cb356-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ADD RECURRENT LAYER</span></span>
<span id="cb356-26"><a href="#cb356-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb356-27"><a href="#cb356-27" aria-hidden="true" tabindex="-1"></a><span class="co"># #COMMENT/UNCOMMENT TO USE RNN, LSTM,GRU</span></span>
<span id="cb356-28"><a href="#cb356-28" aria-hidden="true" tabindex="-1"></a>model.add(LSTM(</span>
<span id="cb356-29"><a href="#cb356-29" aria-hidden="true" tabindex="-1"></a><span class="co"># model.add(GRU(</span></span>
<span id="cb356-30"><a href="#cb356-30" aria-hidden="true" tabindex="-1"></a><span class="co">#model.add(SimpleRNN(</span></span>
<span id="cb356-31"><a href="#cb356-31" aria-hidden="true" tabindex="-1"></a>units<span class="op">=</span>recurrent_hidden_units,</span>
<span id="cb356-32"><a href="#cb356-32" aria-hidden="true" tabindex="-1"></a>return_sequences<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb356-33"><a href="#cb356-33" aria-hidden="true" tabindex="-1"></a>input_shape<span class="op">=</span>input_shape,</span>
<span id="cb356-34"><a href="#cb356-34" aria-hidden="true" tabindex="-1"></a><span class="co"># recurrent_dropout=0.8,</span></span>
<span id="cb356-35"><a href="#cb356-35" aria-hidden="true" tabindex="-1"></a>recurrent_regularizer<span class="op">=</span>regularizers.L2(L2),</span>
<span id="cb356-36"><a href="#cb356-36" aria-hidden="true" tabindex="-1"></a>activation<span class="op">=</span><span class="st">'relu'</span>)</span>
<span id="cb356-37"><a href="#cb356-37" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb356-38"><a href="#cb356-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb356-39"><a href="#cb356-39" aria-hidden="true" tabindex="-1"></a><span class="co"># NEED TO TAKE THE OUTPUT RNN AND CONVERT TO SCALAR</span></span>
<span id="cb356-40"><a href="#cb356-40" aria-hidden="true" tabindex="-1"></a>model.add(Dense(units<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span><span class="st">'linear'</span>))</span>
<span id="cb356-41"><a href="#cb356-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb356-42"><a href="#cb356-42" aria-hidden="true" tabindex="-1"></a><span class="co"># MODEL SUMMARY</span></span>
<span id="cb356-43"><a href="#cb356-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())<span class="op">;</span> <span class="co">#print(x_train.shape,y_train.shape)</span></span>
<span id="cb356-44"><a href="#cb356-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb356-45"><a href="#cb356-45" aria-hidden="true" tabindex="-1"></a><span class="co"># # COMPILING THE MODEL</span></span>
<span id="cb356-46"><a href="#cb356-46" aria-hidden="true" tabindex="-1"></a>opt <span class="op">=</span> keras.optimizers.RMSprop(learning_rate<span class="op">=</span>learning_rate)</span>
<span id="cb356-47"><a href="#cb356-47" aria-hidden="true" tabindex="-1"></a>model.<span class="bu">compile</span>(optimizer<span class="op">=</span>opt, loss<span class="op">=</span>loss_function)</span>
<span id="cb356-48"><a href="#cb356-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb356-49"><a href="#cb356-49" aria-hidden="true" tabindex="-1"></a><span class="co"># TRAINING YOUR MODEL</span></span>
<span id="cb356-50"><a href="#cb356-50" aria-hidden="true" tabindex="-1"></a>history <span class="op">=</span> model.fit(</span>
<span id="cb356-51"><a href="#cb356-51" aria-hidden="true" tabindex="-1"></a>    Xt_emissions,</span>
<span id="cb356-52"><a href="#cb356-52" aria-hidden="true" tabindex="-1"></a>    Yt_emissions,</span>
<span id="cb356-53"><a href="#cb356-53" aria-hidden="true" tabindex="-1"></a>    epochs<span class="op">=</span>numbers_epochs,</span>
<span id="cb356-54"><a href="#cb356-54" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span>batch_size,</span>
<span id="cb356-55"><a href="#cb356-55" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb356-56"><a href="#cb356-56" aria-hidden="true" tabindex="-1"></a>    validation_data<span class="op">=</span>(Xv_emissions, Yv_emissions),</span>
<span id="cb356-57"><a href="#cb356-57" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb356-58"><a href="#cb356-58" aria-hidden="true" tabindex="-1"></a><span class="co"># History plot</span></span>
<span id="cb356-59"><a href="#cb356-59" aria-hidden="true" tabindex="-1"></a>history_plot(history)</span>
<span id="cb356-60"><a href="#cb356-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb356-61"><a href="#cb356-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Predictions</span></span>
<span id="cb356-62"><a href="#cb356-62" aria-hidden="true" tabindex="-1"></a>Ytp_emissions <span class="op">=</span> model.predict(Xt_emissions)</span>
<span id="cb356-63"><a href="#cb356-63" aria-hidden="true" tabindex="-1"></a>Yvp_emissions <span class="op">=</span> model.predict(Xv_emissions)</span>
<span id="cb356-64"><a href="#cb356-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb356-65"><a href="#cb356-65" aria-hidden="true" tabindex="-1"></a><span class="co"># REPORT</span></span>
<span id="cb356-66"><a href="#cb356-66" aria-hidden="true" tabindex="-1"></a>regression_report(Yt_emissions, Ytp_emissions, Yv_emissions, Yvp_emissions)</span>
<span id="cb356-67"><a href="#cb356-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb356-68"><a href="#cb356-68" aria-hidden="true" tabindex="-1"></a><span class="co"># compute RMSE using numpy</span></span>
<span id="cb356-69"><a href="#cb356-69" aria-hidden="true" tabindex="-1"></a>training_RMSE_emissions <span class="op">=</span> np.sqrt(mean_squared_error(Yt_emissions, Ytp_emissions))</span>
<span id="cb356-70"><a href="#cb356-70" aria-hidden="true" tabindex="-1"></a>validation_RMSE_emissions <span class="op">=</span> np.sqrt(mean_squared_error(Yv_emissions, Yvp_emissions))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(227, 5, 1) --&gt; (227, 1)
(73, 5, 1) --&gt; (73, 1)
Model: "sequential_41"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 lstm_13 (LSTM)              (None, 32)                4352      
                                                                 
 dense_41 (Dense)            (None, 1)                 33        
                                                                 
=================================================================
Total params: 4385 (17.13 KB)
Trainable params: 4385 (17.13 KB)
Non-trainable params: 0 (0.00 Byte)
_________________________________________________________________
None</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-135-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>8/8 [==============================] - 0s 5ms/step
3/3 [==============================] - 0s 6ms/step
---------- Regression report ----------
TRAINING:
 MSE: 0.7241078736992722
 MAE: 0.4202230640627933</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-135-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-135-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>VALIDATION:
 MSE: 1.17440960957364
 MAE: 0.5130328755168816</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-135-output-7.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="dl_files/figure-html/cell-135-output-8.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Error Summary</strong></p>
<div class="cell" data-outputid="c10feb06-f88e-4e99-f8e0-31ecb16f4ba6" data-execution_count="137">
<details>
<summary>View Code</summary>
<div class="sourceCode cell-code" id="cb360"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb360-1"><a href="#cb360-1" aria-hidden="true" tabindex="-1"></a>error_table_emissions_lstm_l2 <span class="op">=</span> [[<span class="st">'Model'</span>,<span class="st">'train_MSE'</span>,<span class="st">'train_MAE'</span>,<span class="st">'train_RMSE'</span>,<span class="st">'val_MSE'</span>,<span class="st">'val_MAE'</span>,<span class="st">'val_RMSE'</span>],</span>
<span id="cb360-2"><a href="#cb360-2" aria-hidden="true" tabindex="-1"></a>              [<span class="st">'LSTM(L2 Reg)'</span>,</span>
<span id="cb360-3"><a href="#cb360-3" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yt_emissions, Ytp_emissions),</span>
<span id="cb360-4"><a href="#cb360-4" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yt_emissions, Ytp_emissions),</span>
<span id="cb360-5"><a href="#cb360-5" aria-hidden="true" tabindex="-1"></a>               training_RMSE_emissions,</span>
<span id="cb360-6"><a href="#cb360-6" aria-hidden="true" tabindex="-1"></a>               mean_squared_error(Yv_emissions, Yvp_emissions),</span>
<span id="cb360-7"><a href="#cb360-7" aria-hidden="true" tabindex="-1"></a>               mean_absolute_error(Yv_emissions, Yvp_emissions),</span>
<span id="cb360-8"><a href="#cb360-8" aria-hidden="true" tabindex="-1"></a>               validation_RMSE_emissions]]</span>
<span id="cb360-9"><a href="#cb360-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(error_table_emissions_lstm_l2, headers<span class="op">=</span><span class="st">'firstrow'</span>, tablefmt<span class="op">=</span><span class="st">'fancy_grid'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>╒══════════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model        │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞══════════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ LSTM(L2 Reg) │    0.724108 │    0.420223 │     0.850945 │   1.17441 │  0.513033 │     1.0837 │
╘══════════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="discussion" class="level2">
<h2 class="anchored" data-anchor-id="discussion">Discussion</h2>
<section id="ann-model-comparison" class="level3">
<h3 class="anchored" data-anchor-id="ann-model-comparison">ANN Model Comparison</h3>
<p><strong>Question 1: How do the results from the 3 different ANN models compare with each other in terms of accuracy and predictive power?</strong></p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-13-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-1" role="tab" aria-controls="tabset-13-1" aria-selected="true">Prices</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-13-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-2" role="tab" aria-controls="tabset-13-2" aria-selected="false">Consumption</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-13-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-3" role="tab" aria-controls="tabset-13-3" aria-selected="false">Production</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-13-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-4" role="tab" aria-controls="tabset-13-4" aria-selected="false">Imports</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-13-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-5" role="tab" aria-controls="tabset-13-5" aria-selected="false">Exports</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-13-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-6" role="tab" aria-controls="tabset-13-6" aria-selected="false">CVX Stocks</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-13-7-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-7" role="tab" aria-controls="tabset-13-7" aria-selected="false">CO2 Emissions</a></li></ul>
<div class="tab-content">
<div id="tabset-13-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-13-1-tab">
<div class="cell" data-outputid="81cece47-d481-4cd8-fb21-83099e268b65" data-execution_count="138">
<div class="cell-output cell-output-stdout">
<pre><code>╒══════════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model        │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞══════════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ RNN          │   0.0856424 │    0.215367 │     0.292647 │  0.150874 │  0.289132 │   0.388425 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ RNN(L2 Reg)  │   0.0969527 │    0.198325 │     0.311372 │  0.147882 │  0.25337  │   0.384555 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ GRU          │   0.0930746 │    0.212394 │     0.305081 │  0.183277 │  0.318754 │   0.428109 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ GRU(L2 Reg)  │   0.0943274 │    0.213642 │     0.307128 │  0.183933 │  0.303652 │   0.428875 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ LSTM         │   0.0928673 │    0.215475 │     0.304741 │  0.206514 │  0.336715 │   0.454438 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ LSTM(L2 Reg) │   0.0969785 │    0.215971 │     0.311414 │  0.186477 │  0.302549 │   0.43183  │
╘══════════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
<p>The result shows that the RNNs generally perform better than GRU and LSTM models in terms of training and validation MSE, MAE, and RMSE. This suggests that RNNs are more accurate in fitting the training data and also generalize better to validation data. Introducing L2 regularization tends to slightly raise training MSE across all models, indicating a balance between model complexity and accuracy. However, it often leads to improved generalization, as evidenced by lower or comparable validation errors, particularly in GRU and LSTM models.</p>
</div>
<div id="tabset-13-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-13-2-tab">
<div class="cell" data-outputid="51893346-874b-47a9-f9a0-2b777217aadc" data-execution_count="139">
<div class="cell-output cell-output-stdout">
<pre><code>╒══════════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model        │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞══════════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ RNN          │   0.123641  │    0.275929 │     0.351626 │  0.422054 │  0.522695 │   0.649657 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ RNN(L2 Reg)  │   0.0878347 │    0.230794 │     0.296369 │  0.37951  │  0.478876 │   0.616043 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ GRU          │   0.233557  │    0.368506 │     0.483277 │  0.592965 │  0.654887 │   0.770042 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ GRU(L2 Reg)  │   0.299569  │    0.434126 │     0.547329 │  1.21079  │  0.85321  │   1.10036  │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ LSTM         │   0.297096  │    0.437727 │     0.545065 │  1.04373  │  0.879395 │   1.02163  │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ LSTM(L2 Reg) │   0.274762  │    0.409304 │     0.524177 │  1.24162  │  0.896379 │   1.11428  │
╘══════════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
<p>The result shows that RNNs, especially with L2 regularization, perform best with the lowest error metrics, suggesting higher accuracy and generalization. In contrast, GRU and LSTM models, particularly with regularization, exhibit higher errors, indicating less effective predictions and potential overfitting, especially in complex models where they fail to capture underlying patterns as efficiently.</p>
</div>
<div id="tabset-13-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-13-3-tab">
<div class="cell" data-outputid="edfe1159-acbf-4dff-b72b-88bdf7849477" data-execution_count="140">
<div class="cell-output cell-output-stdout">
<pre><code>╒══════════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model        │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞══════════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ RNN          │   0.0227048 │    0.118012 │     0.150681 │  0.091456 │  0.2621   │   0.302417 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ RNN(L2 Reg)  │   0.0181818 │    0.104524 │     0.13484  │  0.087305 │  0.259603 │   0.295474 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ GRU          │   0.0229274 │    0.11412  │     0.151418 │  0.130364 │  0.328039 │   0.361059 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ GRU(L2 Reg)  │   0.02249   │    0.112564 │     0.149967 │  0.293959 │  0.498804 │   0.542179 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ LSTM         │   0.0233633 │    0.11192  │     0.152851 │  0.235821 │  0.444043 │   0.485614 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ LSTM(L2 Reg) │   0.0231367 │    0.112708 │     0.152108 │  0.098414 │  0.282986 │   0.31371  │
╘══════════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
<p>The results show that the L2 regularized RNN outperform other models, having the lowest training and validation MSE and MAE, indicating they generalize better on unseen data. Conversely, GRUs and LSTMs, especially with L2 regularization, show higher error rates in validation, suggesting potential overfitting or less effectiveness in capturing complex patterns. Particularly, regularized LSTMs and GRUs show considerable increases in validation errors compared to their training performance, highlighting challenges in model stability across different data subsets.</p>
</div>
<div id="tabset-13-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-13-4-tab">
<div class="cell" data-outputid="0f952d8c-2e85-49b2-b67b-a5b332934d61" data-execution_count="141">
<div class="cell-output cell-output-stdout">
<pre><code>╒══════════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model        │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞══════════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ RNN          │    0.156048 │    0.31658  │     0.395029 │  0.185671 │  0.359929 │   0.430895 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ RNN(L2 Reg)  │    0.122194 │    0.265084 │     0.349563 │  0.136967 │  0.296626 │   0.370091 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ GRU          │    0.191979 │    0.345011 │     0.438155 │  0.222296 │  0.372967 │   0.471482 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ GRU(L2 Reg)  │    0.187826 │    0.334333 │     0.433389 │  0.228349 │  0.373415 │   0.477858 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ LSTM         │    0.193516 │    0.342503 │     0.439905 │  0.219581 │  0.374944 │   0.468595 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ LSTM(L2 Reg) │    0.193618 │    0.347288 │     0.44002  │  0.227829 │  0.375522 │   0.477315 │
╘══════════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
<p>The results reveals that the RNN with L2 regularization shows superior performance, as they have lowest training and validation errors, which suggests better generalization on unseen data. In contrast, the GRU and LSTM models, particularly with L2 regularization, shows higher error, indicating potential overfitting. The regularized RNN model emerges as the most effective in managing overfitting and achieving higher predictive accuracy.</p>
</div>
<div id="tabset-13-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-13-5-tab">
<div class="cell" data-outputid="67e76d19-1b56-42c0-fbdb-c17c7ebabd0f" data-execution_count="142">
<div class="cell-output cell-output-stdout">
<pre><code>╒══════════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model        │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞══════════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ RNN          │  0.00535037 │   0.0551332 │    0.0731462 │  0.758507 │  0.640908 │   0.870923 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ RNN(L2 Reg)  │  0.00453961 │   0.0536078 │    0.0673766 │  1.22632  │  0.964119 │   1.10739  │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ GRU          │  0.00592626 │   0.0584674 │    0.0769822 │  0.889458 │  0.766761 │   0.943111 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ GRU(L2 Reg)  │  0.00766894 │   0.064497  │    0.0875725 │  2.70266  │  1.43477  │   1.64398  │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ LSTM         │  0.00766894 │   0.064497  │    0.0875725 │  2.70266  │  1.43477  │   1.64398  │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ LSTM(L2 Reg) │  0.00640586 │   0.0598533 │    0.0800366 │  2.23633  │  1.30582  │   1.49544  │
╘══════════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
<p>The RNN and GRU models without regularization outperform on the training set but show higher errors on validation data, suggesting overfitting. L2 Regularized RNN and GRU, and both LSTM models (with and without regularization) show less effective training and prediction capabilities with higher error rates across both sets, indicating potential issues in balancing bias and variance.</p>
</div>
<div id="tabset-13-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-13-6-tab">
<div class="cell" data-outputid="80eb2cbd-c1c5-4323-b184-5bb6864d8d8c" data-execution_count="143">
<div class="cell-output cell-output-stdout">
<pre><code>╒══════════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model        │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞══════════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ RNN          │  0.00385925 │   0.0493704 │    0.0621229 │  0.241482 │ 0.252935  │   0.491409 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ RNN(L2 Reg)  │  0.0019726  │   0.0355592 │    0.044414  │  0.012517 │ 0.0799382 │   0.111879 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ GRU          │  0.00248111 │   0.0379035 │    0.0498107 │  0.224071 │ 0.260936  │   0.473361 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ GRU(L2 Reg)  │  0.00274596 │   0.0389203 │    0.0524019 │  0.044396 │ 0.139761  │   0.210704 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ LSTM         │  0.0023674  │   0.0373848 │    0.0486559 │  0.344455 │ 0.312781  │   0.586903 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ LSTM(L2 Reg) │  0.00209198 │   0.0346632 │    0.0457382 │  0.373875 │ 0.281131  │   0.611453 │
╘══════════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
<p>The RNN and GRU models without regularization show lower training errors but higher validation errors, suggesting potential overfitting. In contrast, the L2 regularized models, especially RNN, significantly improve in validation, indicating effective mitigation against overfitting. The LSTM models, regardless of regularization, while maintaining competitive training errors, do not perform as well in validation, indicating less effective generalization.</p>
</div>
<div id="tabset-13-7" class="tab-pane" role="tabpanel" aria-labelledby="tabset-13-7-tab">
<div class="cell" data-outputid="dde1ccef-7590-4506-d84d-1c698c470f4a" data-execution_count="144">
<div class="cell-output cell-output-stdout">
<pre><code>╒══════════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model        │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞══════════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ RNN          │    0.30333  │    0.348757 │     0.550754 │   1.51433 │  0.968769 │    1.23058 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ RNN(L2 Reg)  │    0.246717 │    0.342717 │     0.496706 │   1.00403 │  0.774277 │    1.00201 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ GRU          │    0.826495 │    0.474815 │     0.909118 │   1.32186 │  0.484335 │    1.14972 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ GRU(L2 Reg)  │    0.767283 │    0.444922 │     0.875947 │   1.25035 │  0.440379 │    1.11819 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ LSTM         │    0.823936 │    0.479866 │     0.907709 │   1.30895 │  0.496887 │    1.14409 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ LSTM(L2 Reg) │    0.724108 │    0.420223 │     0.850945 │   1.17441 │  0.513033 │    1.0837  │
╘══════════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
<p>Across the models, the RNN and LSTM with L2 regularization show the best improvement in validation scores, indicating better generalization compared to their non-regularized counterparts. This suggests that regularization helps manage overfitting, thus enhancing the models’ predictive performance on new data. Notably, all models exhibit higher errors on validation data, which could suggest either overfitting on training data or underfitting to complex patterns not captured during training. This highlights the importance of model tuning and possibly more complex architectures or training procedures to better capture underlying data patterns.</p>
</div>
</div>
</div>
<p><strong>Question 2 What effect does including regularization have on your results?</strong></p>
<p>I used L2 regularization in all 3 ANN models because it prevents overfitting by adding a penalty proportional to the square of the model coefficients, promoting smaller weights. This technique helps improve the model’s generalization on unseen data particularly in scenarios where the model is complex or the training data is noisy, which is the most common challenges for natural gas dynamics and CO2 emissions datasets.</p>
<p>Including regularization in the above models improved validation metrics. For instance, in the natural gas prices dataset, the RNN with L2 regularization shows improved validation MSE and RMSE compared to the standard RNN, indicating it handles overfitting more effectively. But if we can see a notable increase in RMSE on the validation set compared to the training set across all datasets, suggesting that overfitting remains an issue even though regularization tries to mitigate it.</p>
<p><strong>Question 3 How far into the future can the deep learning model accurately predict the future?</strong></p>
<p>Deep learning models can accurately predict the near future based on factors like the dataset’s nature, the model’s complexity, and the forecast duration. These models are particularly effective in making short to medium-term predictions. However, their accuracy diminishes over longer periods. For datasets with variables like natural gas prices, consumption, and emissions—which are subject to numerous external influences and inherent volatility—predictions remain reliably precise for a short span, typically from a few days to a couple of months. Beyond this range, the predictions become increasingly uncertain and require frequent updates and adjustments to maintain accuracy.</p>
</section>
<section id="ann-vs.-traditional-univariate-ts-models" class="level3">
<h3 class="anchored" data-anchor-id="ann-vs.-traditional-univariate-ts-models">ANN vs.&nbsp;Traditional Univariate TS Models</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-14-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-1" role="tab" aria-controls="tabset-14-1" aria-selected="true">Prices</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-2" role="tab" aria-controls="tabset-14-2" aria-selected="false">Consumption</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-3" role="tab" aria-controls="tabset-14-3" aria-selected="false">Production</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-4" role="tab" aria-controls="tabset-14-4" aria-selected="false">Imports</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-5" role="tab" aria-controls="tabset-14-5" aria-selected="false">Exports</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-6" role="tab" aria-controls="tabset-14-6" aria-selected="false">CVX Stocks</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-7-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-7" role="tab" aria-controls="tabset-14-7" aria-selected="false">CO2 Emissions</a></li></ul>
<div class="tab-content">
<div id="tabset-14-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-14-1-tab">
<p><strong>Ann Models Error Summary</strong></p>
<div class="cell" data-outputid="b2f61e79-4088-450d-8d0e-d59b3d20c5fb" data-execution_count="145">
<div class="cell-output cell-output-stdout">
<pre><code>╒══════════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model        │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞══════════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ RNN          │   0.0856424 │    0.215367 │     0.292647 │  0.150874 │  0.289132 │   0.388425 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ RNN(L2 Reg)  │   0.0969527 │    0.198325 │     0.311372 │  0.147882 │  0.25337  │   0.384555 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ GRU          │   0.0930746 │    0.212394 │     0.305081 │  0.183277 │  0.318754 │   0.428109 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ GRU(L2 Reg)  │   0.0943274 │    0.213642 │     0.307128 │  0.183933 │  0.303652 │   0.428875 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ LSTM         │   0.0928673 │    0.215475 │     0.304741 │  0.206514 │  0.336715 │   0.454438 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ LSTM(L2 Reg) │   0.0969785 │    0.215971 │     0.311414 │  0.186477 │  0.302549 │   0.43183  │
╘══════════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
<p><strong>Traditional Univariate Models Error Summary</strong></p>
<div class="cell" data-outputid="cb7c7870-d0b6-4a0f-bd26-cf187a393481" data-execution_count="146">
<div class="cell-output cell-output-stdout">
<pre><code>╒═════════╤═════════════╤══════════╤══════════╤══════════╤═════════╤══════════╤═════════════╕
│ Model   │          ME │     RMSE │      MAE │      MPE │    MAPE │     MASE │        ACF1 │
╞═════════╪═════════════╪══════════╪══════════╪══════════╪═════════╪══════════╪═════════════╡
│ ARIMA   │ -0.00927973 │ 0.758939 │ 0.512161 │ -2.63271 │ 11.3002 │ 0.362227 │  0.00500843 │
├─────────┼─────────────┼──────────┼──────────┼──────────┼─────────┼──────────┼─────────────┤
│ SARIMA  │ -0.00818136 │ 0.79182  │ 0.522379 │ -1.36221 │ 11.2339 │ 0.369454 │ -0.00177239 │
╘═════════╧═════════════╧══════════╧══════════╧══════════╧═════════╧══════════╧═════════════╛</code></pre>
</div>
</div>
<p><strong>RMSE Comparison</strong></p>
<div class="cell" data-outputid="4005d9df-4efe-4b7d-ae92-9b9b20ec4a49" data-execution_count="147">
<div class="cell-output cell-output-stdout">
<pre><code>╒══════════════╤══════════╕
│ Model        │     RMSE │
╞══════════════╪══════════╡
│ RNN          │ 0.292647 │
├──────────────┼──────────┤
│ RNN(L2 Reg)  │ 0.311372 │
├──────────────┼──────────┤
│ GRU          │ 0.305081 │
├──────────────┼──────────┤
│ GRU(L2 Reg)  │ 0.307128 │
├──────────────┼──────────┤
│ LSTM         │ 0.304741 │
├──────────────┼──────────┤
│ LSTM(L2 Reg) │ 0.311414 │
├──────────────┼──────────┤
│ ARIMA        │ 0.758939 │
├──────────────┼──────────┤
│ SARIMA       │ 0.79182  │
╘══════════════╧══════════╛</code></pre>
</div>
</div>
</div>
<div id="tabset-14-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-14-2-tab">
<p><strong>Ann Models Error Summary</strong></p>
<div class="cell" data-outputid="bebe5945-9a98-49ea-de13-d8468bb55a41" data-execution_count="148">
<div class="cell-output cell-output-stdout">
<pre><code>╒══════════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model        │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞══════════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ RNN          │   0.123641  │    0.275929 │     0.351626 │  0.422054 │  0.522695 │   0.649657 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ RNN(L2 Reg)  │   0.0878347 │    0.230794 │     0.296369 │  0.37951  │  0.478876 │   0.616043 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ GRU          │   0.233557  │    0.368506 │     0.483277 │  0.592965 │  0.654887 │   0.770042 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ GRU(L2 Reg)  │   0.299569  │    0.434126 │     0.547329 │  1.21079  │  0.85321  │   1.10036  │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ LSTM         │   0.297096  │    0.437727 │     0.545065 │  1.04373  │  0.879395 │   1.02163  │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ LSTM(L2 Reg) │   0.274762  │    0.409304 │     0.524177 │  1.24162  │  0.896379 │   1.11428  │
╘══════════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
<p><strong>Traditional Univariate Models Error Summary</strong></p>
<div class="cell" data-outputid="0cac63ea-8dfd-4b65-c7d3-813f80bcf38c" data-execution_count="149">
<div class="cell-output cell-output-stdout">
<pre><code>╒═════════╤═════════╤══════════╤══════════╤══════════╤═════════╤══════════╤═════════════╕
│ Model   │      ME │     RMSE │      MAE │      MPE │    MAPE │     MASE │        ACF1 │
╞═════════╪═════════╪══════════╪══════════╪══════════╪═════════╪══════════╪═════════════╡
│ ARIMA   │ 26124.5 │ 233048   │ 179130   │ 0.199796 │ 7.93188 │ 1.53233  │  0.00778866 │
├─────────┼─────────┼──────────┼──────────┼──────────┼─────────┼──────────┼─────────────┤
│ SARIMA  │ 10818.3 │  98342.5 │  73926.5 │ 0.348918 │ 3.23593 │ 0.632388 │ -0.00785298 │
╘═════════╧═════════╧══════════╧══════════╧══════════╧═════════╧══════════╧═════════════╛</code></pre>
</div>
</div>
<p><strong>RMSE Comparison</strong></p>
<div class="cell" data-outputid="8b8b9d0f-2fc2-4dcf-9324-b4c8f2cf3ce2" data-execution_count="150">
<div class="cell-output cell-output-stdout">
<pre><code>╒══════════════╤═══════════════╕
│ Model        │          RMSE │
╞══════════════╪═══════════════╡
│ RNN          │      0.351626 │
├──────────────┼───────────────┤
│ RNN(L2 Reg)  │      0.296369 │
├──────────────┼───────────────┤
│ GRU          │      0.483277 │
├──────────────┼───────────────┤
│ GRU(L2 Reg)  │      0.547329 │
├──────────────┼───────────────┤
│ LSTM         │      0.545065 │
├──────────────┼───────────────┤
│ LSTM(L2 Reg) │      0.524177 │
├──────────────┼───────────────┤
│ ARIMA        │ 233048        │
├──────────────┼───────────────┤
│ SARIMA       │  98342.5      │
╘══════════════╧═══════════════╛</code></pre>
</div>
</div>
</div>
<div id="tabset-14-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-14-3-tab">
<p><strong>Ann Models Error Summary</strong></p>
<div class="cell" data-outputid="bf35c223-dfe7-4de3-eb1d-f92c74a04416" data-execution_count="158">
<div class="cell-output cell-output-stdout">
<pre><code>╒══════════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model        │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞══════════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ RNN          │   0.0227048 │    0.118012 │     0.150681 │  0.091456 │  0.2621   │   0.302417 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ RNN(L2 Reg)  │   0.0181818 │    0.104524 │     0.13484  │  0.087305 │  0.259603 │   0.295474 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ GRU          │   0.0229274 │    0.11412  │     0.151418 │  0.130364 │  0.328039 │   0.361059 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ GRU(L2 Reg)  │   0.02249   │    0.112564 │     0.149967 │  0.293959 │  0.498804 │   0.542179 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ LSTM         │   0.0233633 │    0.11192  │     0.152851 │  0.235821 │  0.444043 │   0.485614 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ LSTM(L2 Reg) │   0.0231367 │    0.112708 │     0.152108 │  0.098414 │  0.282986 │   0.31371  │
╘══════════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
<p><strong>Traditional Univariate Models Error Summary</strong></p>
<div class="cell" data-outputid="30f5ad26-1471-4b24-a7c2-63cf4cbe5ef1" data-execution_count="159">
<div class="cell-output cell-output-stdout">
<pre><code>╒═════════╤══════════╤═════════╤═════════╤══════════╤═════════╤══════════╤════════════╕
│ Model   │       ME │    RMSE │     MAE │      MPE │    MAPE │     MASE │       ACF1 │
╞═════════╪══════════╪═════════╪═════════╪══════════╪═════════╪══════════╪════════════╡
│ ARIMA   │ 22028.8  │ 97945.8 │ 73544.6 │ 0.684651 │ 2.7679  │ 0.564422 │ -0.0177529 │
├─────────┼──────────┼─────────┼─────────┼──────────┼─────────┼──────────┼────────────┤
│ SARIMA  │  2289.61 │ 52995.2 │ 34932.6 │ 0.079716 │ 1.31955 │ 0.268092 │  0.0231852 │
╘═════════╧══════════╧═════════╧═════════╧══════════╧═════════╧══════════╧════════════╛</code></pre>
</div>
</div>
<p><strong>RMSE Comparison</strong></p>
<div class="cell" data-outputid="00abae83-0710-4619-f5c5-96375ce87ed8" data-execution_count="160">
<div class="cell-output cell-output-stdout">
<pre><code>╒══════════════╤══════════════╕
│ Model        │         RMSE │
╞══════════════╪══════════════╡
│ RNN          │     0.150681 │
├──────────────┼──────────────┤
│ RNN(L2 Reg)  │     0.13484  │
├──────────────┼──────────────┤
│ GRU          │     0.151418 │
├──────────────┼──────────────┤
│ GRU(L2 Reg)  │     0.149967 │
├──────────────┼──────────────┤
│ LSTM         │     0.152851 │
├──────────────┼──────────────┤
│ LSTM(L2 Reg) │     0.152108 │
├──────────────┼──────────────┤
│ ARIMA        │ 97945.8      │
├──────────────┼──────────────┤
│ SARIMA       │ 52995.2      │
╘══════════════╧══════════════╛</code></pre>
</div>
</div>
</div>
<div id="tabset-14-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-14-4-tab">
<p><strong>Ann Models Error Summary</strong></p>
<div class="cell" data-outputid="ad5efd48-f918-47dc-da78-92cb69a17551" data-execution_count="161">
<div class="cell-output cell-output-stdout">
<pre><code>╒══════════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model        │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞══════════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ RNN          │    0.156048 │    0.31658  │     0.395029 │  0.185671 │  0.359929 │   0.430895 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ RNN(L2 Reg)  │    0.122194 │    0.265084 │     0.349563 │  0.136967 │  0.296626 │   0.370091 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ GRU          │    0.191979 │    0.345011 │     0.438155 │  0.222296 │  0.372967 │   0.471482 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ GRU(L2 Reg)  │    0.187826 │    0.334333 │     0.433389 │  0.228349 │  0.373415 │   0.477858 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ LSTM         │    0.193516 │    0.342503 │     0.439905 │  0.219581 │  0.374944 │   0.468595 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ LSTM(L2 Reg) │    0.193618 │    0.347288 │     0.44002  │  0.227829 │  0.375522 │   0.477315 │
╘══════════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
<p><strong>Traditional Univariate Models Error Summary</strong></p>
<div class="cell" data-outputid="dd556c59-2dc6-4c61-b008-85e5bc4ecfc7" data-execution_count="162">
<div class="cell-output cell-output-stdout">
<pre><code>╒═════════╤═══════════╤═════════╤═════════╤═══════════╤═════════╤══════════╤═══════════╕
│ Model   │        ME │    RMSE │     MAE │       MPE │    MAPE │     MASE │      ACF1 │
╞═════════╪═══════════╪═════════╪═════════╪═══════════╪═════════╪══════════╪═══════════╡
│ ARIMA   │ -129.508  │ 22945.8 │ 18087.9 │ -0.616726 │ 6.37179 │ 0.808696 │ 0.0337695 │
├─────────┼───────────┼─────────┼─────────┼───────────┼─────────┼──────────┼───────────┤
│ SARIMA  │   63.5282 │ 17693.6 │ 14186.8 │ -0.209191 │ 4.95986 │ 0.634282 │ 0.0273341 │
╘═════════╧═══════════╧═════════╧═════════╧═══════════╧═════════╧══════════╧═══════════╛</code></pre>
</div>
</div>
<p><strong>RMSE Comparison</strong></p>
<div class="cell" data-outputid="d6d5e5b9-3d88-44bb-8b96-44c4be76c0a6" data-execution_count="163">
<div class="cell-output cell-output-stdout">
<pre><code>╒══════════════╤══════════════╕
│ Model        │         RMSE │
╞══════════════╪══════════════╡
│ RNN          │     0.395029 │
├──────────────┼──────────────┤
│ RNN(L2 Reg)  │     0.349563 │
├──────────────┼──────────────┤
│ GRU          │     0.438155 │
├──────────────┼──────────────┤
│ GRU(L2 Reg)  │     0.433389 │
├──────────────┼──────────────┤
│ LSTM         │     0.439905 │
├──────────────┼──────────────┤
│ LSTM(L2 Reg) │     0.44002  │
├──────────────┼──────────────┤
│ ARIMA        │ 22945.8      │
├──────────────┼──────────────┤
│ SARIMA       │ 17693.6      │
╘══════════════╧══════════════╛</code></pre>
</div>
</div>
</div>
<div id="tabset-14-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-14-5-tab">
<p><strong>Ann Models Error Summary</strong></p>
<div class="cell" data-outputid="18e24339-e36f-46e2-e69a-dd033f5796f2" data-execution_count="164">
<div class="cell-output cell-output-stdout">
<pre><code>╒══════════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model        │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞══════════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ RNN          │  0.00535037 │   0.0551332 │    0.0731462 │  0.758507 │  0.640908 │   0.870923 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ RNN(L2 Reg)  │  0.00453961 │   0.0536078 │    0.0673766 │  1.22632  │  0.964119 │   1.10739  │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ GRU          │  0.00592626 │   0.0584674 │    0.0769822 │  0.889458 │  0.766761 │   0.943111 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ GRU(L2 Reg)  │  0.00766894 │   0.064497  │    0.0875725 │  2.70266  │  1.43477  │   1.64398  │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ LSTM         │  0.00766894 │   0.064497  │    0.0875725 │  2.70266  │  1.43477  │   1.64398  │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ LSTM(L2 Reg) │  0.00640586 │   0.0598533 │    0.0800366 │  2.23633  │  1.30582  │   1.49544  │
╘══════════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
<p><strong>Traditional Univariate Models Error Summary</strong></p>
<div class="cell" data-outputid="d556911f-f07b-4324-d064-442b5a28a173" data-execution_count="165">
<div class="cell-output cell-output-stdout">
<pre><code>╒═════════╤═══════════╤═════════╤══════════╤═══════════╤══════════╤══════════╤════════════╕
│ Model   │        ME │    RMSE │      MAE │       MPE │     MAPE │     MASE │       ACF1 │
╞═════════╪═══════════╪═════════╪══════════╪═══════════╪══════════╪══════════╪════════════╡
│ ARIMA   │ 2304.26   │ 21024.2 │ 12413.9  │  0.373212 │ 10.4586  │ 0.450189 │ -0.010844  │
├─────────┼───────────┼─────────┼──────────┼───────────┼──────────┼──────────┼────────────┤
│ SARIMA  │   88.1159 │ 16309.7 │  9630.99 │ -0.372932 │  9.00983 │ 0.349268 │ -0.0809737 │
╘═════════╧═══════════╧═════════╧══════════╧═══════════╧══════════╧══════════╧════════════╛</code></pre>
</div>
</div>
<p><strong>RMSE Comparison</strong></p>
<div class="cell" data-outputid="2da4fa44-8611-47ab-eea7-f0803ee0cc7c" data-execution_count="166">
<div class="cell-output cell-output-stdout">
<pre><code>╒══════════════╤═══════════════╕
│ Model        │          RMSE │
╞══════════════╪═══════════════╡
│ RNN          │     0.0731462 │
├──────────────┼───────────────┤
│ RNN(L2 Reg)  │     0.0673766 │
├──────────────┼───────────────┤
│ GRU          │     0.0769822 │
├──────────────┼───────────────┤
│ GRU(L2 Reg)  │     0.0875725 │
├──────────────┼───────────────┤
│ LSTM         │     0.0875725 │
├──────────────┼───────────────┤
│ LSTM(L2 Reg) │     0.0800366 │
├──────────────┼───────────────┤
│ ARIMA        │ 21024.2       │
├──────────────┼───────────────┤
│ SARIMA       │ 16309.7       │
╘══════════════╧═══════════════╛</code></pre>
</div>
</div>
</div>
<div id="tabset-14-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-14-6-tab">
<p><strong>Ann Models Error Summary</strong></p>
<div class="cell" data-outputid="dbcd6d7f-8f3e-46f2-d41f-b540b72db797" data-execution_count="155">
<div class="cell-output cell-output-stdout">
<pre><code>╒══════════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model        │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞══════════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ RNN          │  0.00385925 │   0.0493704 │    0.0621229 │  0.241482 │ 0.252935  │   0.491409 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ RNN(L2 Reg)  │  0.0019726  │   0.0355592 │    0.044414  │  0.012517 │ 0.0799382 │   0.111879 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ GRU          │  0.00248111 │   0.0379035 │    0.0498107 │  0.224071 │ 0.260936  │   0.473361 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ GRU(L2 Reg)  │  0.00274596 │   0.0389203 │    0.0524019 │  0.044396 │ 0.139761  │   0.210704 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ LSTM         │  0.0023674  │   0.0373848 │    0.0486559 │  0.344455 │ 0.312781  │   0.586903 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ LSTM(L2 Reg) │  0.00209198 │   0.0346632 │    0.0457382 │  0.373875 │ 0.281131  │   0.611453 │
╘══════════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
<p><strong>Traditional Univariate Models Error Summary</strong></p>
<div class="cell" data-outputid="4d8a910f-3f90-4c78-ae78-9365b111bfe7" data-execution_count="156">
<div class="cell-output cell-output-stdout">
<pre><code>╒═════════╤═══════════╤═════════╤══════════╤═══════════╤═════════╤═══════════╤════════════╕
│ Model   │        ME │    RMSE │      MAE │       MPE │    MAPE │      MASE │       ACF1 │
╞═════════╪═══════════╪═════════╪══════════╪═══════════╪═════════╪═══════════╪════════════╡
│ ARIMA   │ 0.0269576 │ 1.15102 │ 0.686711 │ 0.0246547 │ 1.19127 │ 0.0519912 │ 0.00422394 │
╘═════════╧═══════════╧═════════╧══════════╧═══════════╧═════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
<p><strong>RMSE Comparison</strong></p>
<div class="cell" data-outputid="56dabeb9-c91d-4a13-b923-1cf90167d799" data-execution_count="157">
<div class="cell-output cell-output-stdout">
<pre><code>╒══════════════╤═══════════╕
│ Model        │      RMSE │
╞══════════════╪═══════════╡
│ RNN          │ 0.0621229 │
├──────────────┼───────────┤
│ RNN(L2 Reg)  │ 0.044414  │
├──────────────┼───────────┤
│ GRU          │ 0.0498107 │
├──────────────┼───────────┤
│ GRU(L2 Reg)  │ 0.0524019 │
├──────────────┼───────────┤
│ LSTM         │ 0.0486559 │
├──────────────┼───────────┤
│ LSTM(L2 Reg) │ 0.0457382 │
├──────────────┼───────────┤
│ ARIMA        │ 1.15102   │
╘══════════════╧═══════════╛</code></pre>
</div>
</div>
</div>
<div id="tabset-14-7" class="tab-pane" role="tabpanel" aria-labelledby="tabset-14-7-tab">
<p><strong>Ann Models Error Summary</strong></p>
<div class="cell" data-outputid="300b96a6-19f6-4eee-fe04-b04b84f85791" data-execution_count="151">
<div class="cell-output cell-output-stdout">
<pre><code>╒══════════════╤═════════════╤═════════════╤══════════════╤═══════════╤═══════════╤════════════╕
│ Model        │   train_MSE │   train_MAE │   train_RMSE │   val_MSE │   val_MAE │   val_RMSE │
╞══════════════╪═════════════╪═════════════╪══════════════╪═══════════╪═══════════╪════════════╡
│ RNN          │    0.30333  │    0.348757 │     0.550754 │   1.51433 │  0.968769 │    1.23058 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ RNN(L2 Reg)  │    0.246717 │    0.342717 │     0.496706 │   1.00403 │  0.774277 │    1.00201 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ GRU          │    0.826495 │    0.474815 │     0.909118 │   1.32186 │  0.484335 │    1.14972 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ GRU(L2 Reg)  │    0.767283 │    0.444922 │     0.875947 │   1.25035 │  0.440379 │    1.11819 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ LSTM         │    0.823936 │    0.479866 │     0.907709 │   1.30895 │  0.496887 │    1.14409 │
├──────────────┼─────────────┼─────────────┼──────────────┼───────────┼───────────┼────────────┤
│ LSTM(L2 Reg) │    0.724108 │    0.420223 │     0.850945 │   1.17441 │  0.513033 │    1.0837  │
╘══════════════╧═════════════╧═════════════╧══════════════╧═══════════╧═══════════╧════════════╛</code></pre>
</div>
</div>
<p><strong>Traditional Univariate Models Error Summary</strong></p>
<div class="cell" data-outputid="2334dc79-321c-4d7a-a679-734b288f9646" data-execution_count="152">
<div class="cell-output cell-output-stdout">
<pre><code>╒═════════╤══════════╤═════════╤═════════╤══════════╤═════════╤══════════╤════════════╕
│ Model   │       ME │    RMSE │     MAE │      MPE │    MAPE │     MASE │       ACF1 │
╞═════════╪══════════╪═════════╪═════════╪══════════╪═════════╪══════════╪════════════╡
│ ARIMA   │ -2.50447 │ 240.128 │ 153.942 │ -54.1323 │ 110.854 │ 0.768645 │ -0.0062189 │
╘═════════╧══════════╧═════════╧═════════╧══════════╧═════════╧══════════╧════════════╛</code></pre>
</div>
</div>
<p><strong>RMSE Comparison</strong></p>
<div class="cell" data-outputid="4bf88bc0-01ea-475a-9941-760011a48a9f" data-execution_count="154">
<div class="cell-output cell-output-stdout">
<pre><code>╒══════════════╤════════════╕
│ Model        │       RMSE │
╞══════════════╪════════════╡
│ RNN          │   0.550754 │
├──────────────┼────────────┤
│ RNN(L2 Reg)  │   0.496706 │
├──────────────┼────────────┤
│ GRU          │   0.909118 │
├──────────────┼────────────┤
│ GRU(L2 Reg)  │   0.875947 │
├──────────────┼────────────┤
│ LSTM         │   0.907709 │
├──────────────┼────────────┤
│ LSTM(L2 Reg) │   0.850945 │
├──────────────┼────────────┤
│ ARIMA        │ 240.128    │
╘══════════════╧════════════╛</code></pre>
</div>
</div>
</div>
</div>
</div>
<p><strong>Question 4 How does your deep learning modeling compare to the traditional single-variable time-series ARMA/ARIMA models from HW-3?</strong></p>
<p>The results show that deep learning models often excel in capturing complex patterns but may require techniques like regularization to manage overfitting and ensure they generalize well to new, unseen datasets. In comparison, traditional time-series models like ARIMA might not capture complex patterns as effectively but can provide stable and consistent predictions across different scenarios.</p>
<p>For example, the RNN model in natural gas prices dataset has a training MSE of about 0.086 and a validation MSE of about 0.151. This shows that while the model predicts fairly accurately on the training data, its predictions become less reliable on unseen data. In contrast, the traditional ARIMA model has an RMSE of about 0.759, suggesting that while it may not capture complex patterns as well as the RNN, it maintains a moderate level of prediction error across different data. Moreover, the GRU model with L2 regularization in the natural gas consumption dataset shows a training RMSE of about 0.547 and a validation RMSE of approximately 1.100. This example indicates significant overfitting, as the model’s error nearly doubles when applied to new data. On the other hand, the SARIMA model has a much higher RMSE of about 98,342 on the training set, which is extraordinarily high and suggests that the model might not be well-suited for this dataset without adjustments or considering model inadequacies. Furthermore, in natural gas production dataset, the LSTM model with L2 regularization shows smaller training and validation RMSEs of about 0.152 and 0.313, respectively. This demonstrates that the regularization helps in managing overfitting effectively, keeping the model’s performance more consistent across new data. Conversely, the ARIMA model here has a significantly lower RMSE of 97,945, highlighting a potential good fit for simpler models in stable data environments.</p>
<p><strong>Model Comparison</strong></p>
<p>RMSE Comparison: Lookin at the RMSE values, deep learning models such as RNN, LSTM, and their L2 regularized versions tend to have lower RMSE on training datasets, indicating a strong fit to the data. For example, in the natural gas prices dataset, the LSTM model shows a training RMSE of 0.304 compared to its validation RMSE of 0.454, reflecting overfitting. In contrast, traditional models like ARIMA and SARIMA in the same dataset have higher RMSE values (0.759 and 0.792, respectively) on the training set, suggesting that they are less flexible in capturing the complexities of the data but may generalize better on unseen data. However, the deep learning models’ validation RMSEs are considerably closer to their training RMSEs than those of traditional models, indicating potential for better generalization with proper tuning.</p>
<p>Forecasting Comparison: Deep learning models, particularly LSTM and GRU, have shown capabilities in modeling complex temporal sequences effectively, which is evident from their performance on various datasets. For example, the LSTM model in the natural gas imports dataset achieves a lower validation RMSE of 0.468 compared to the traditional ARIMA model’s RMSE of 22945.8, highlighting the superiority of LSTM in handling complex patterns. Similarly, in the natural gas production dataset, the LSTM model reduces the validation RMSE to 0.313, outperforming the traditional models. This demonstrates that deep learning models are particularly effective in scenarios where data has non-linear relationships and requires capturing long-term dependencies. Moreover, traditional models like ARIMA and SARIMAX still hold substantial value, particularly in scenarios where understanding the influence of external variables is critical.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
      <div class="nav-footer-center">Copyright 2024, Samiksha Rajendra Thikekar</div>
  </div>
</footer>



</body></html>